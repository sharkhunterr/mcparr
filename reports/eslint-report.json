[{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ErrorAlert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Groups/GroupCreateModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Groups/GroupDetail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchGroupDetail'. Either include it or remove the dependency array.","line":61,"column":6,"nodeType":"ArrayExpression","endLine":61,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchGroupDetail, group.id]","fix":{"range":[2056,2066],"text":"[fetchGroupDetail, group.id]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'availableTools' and 'centralUsers.length'. Either include them or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, availableTools, centralUsers.length]","fix":{"range":[2285,2296],"text":"[activeTab, availableTools, centralUsers.length]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'isToolPermitted'. Either include it or remove the dependency array.","line":306,"column":6,"nodeType":"ArrayExpression","endLine":306,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [groupDetail, availableTools, isToolPermitted]","fix":{"range":[9942,9971],"text":"[groupDetail, availableTools, isToolPermitted]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\nimport type { FC } from 'react';\nimport {\n  Shield,\n  Users,\n  Wrench,\n  Save,\n  X,\n  Plus,\n  Trash2,\n  RefreshCw,\n  ChevronDown,\n  ChevronRight,\n  Search,\n  Zap\n} from 'lucide-react';\nimport { api } from '../../lib/api';\nimport type { Group, GroupDetail as GroupDetailType, AvailableToolsResponse } from '../../types/api';\nimport { getServiceColor } from '../../lib/serviceColors';\n\ninterface GroupDetailProps {\n  group: Group;\n  onClose: () => void;\n  onUpdated: () => void;\n}\n\ninterface CentralUser {\n  central_user_id: string;\n  central_username: string;\n  service_count: number;\n}\n\nconst GroupDetail: FC<GroupDetailProps> = ({ group, onClose, onUpdated }) => {\n  const [groupDetail, setGroupDetail] = useState<GroupDetailType | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState<'info' | 'members' | 'permissions'>('info');\n\n  // Edit state\n  const [editName, setEditName] = useState(group.name);\n  const [editDescription, setEditDescription] = useState(group.description || '');\n  const [editColor, setEditColor] = useState(group.color || '#6366f1');\n  const [editPriority, setEditPriority] = useState(group.priority);\n\n  // Members state\n  const [centralUsers, setCentralUsers] = useState<CentralUser[]>([]);\n  const [loadingUsers, setLoadingUsers] = useState(false);\n  const [showAddMember, setShowAddMember] = useState(false);\n  const [memberSearchTerm, setMemberSearchTerm] = useState('');\n\n  // Permissions state\n  const [availableTools, setAvailableTools] = useState<AvailableToolsResponse | null>(null);\n  const [loadingTools, setLoadingTools] = useState(false);\n  const [expandedServices, setExpandedServices] = useState<Set<string>>(new Set());\n  const [toolSearchQuery, setToolSearchQuery] = useState('');\n  const [savingTool, setSavingTool] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchGroupDetail();\n  }, [group.id]);\n\n  useEffect(() => {\n    if (activeTab === 'members' && centralUsers.length === 0) {\n      fetchCentralUsers();\n    }\n    if (activeTab === 'permissions' && !availableTools) {\n      fetchAvailableTools();\n    }\n  }, [activeTab]);\n\n  const fetchGroupDetail = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const detail = await api.groups.get(group.id);\n      setGroupDetail(detail);\n      setEditName(detail.name);\n      setEditDescription(detail.description || '');\n      setEditColor(detail.color || '#6366f1');\n      setEditPriority(detail.priority);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch group details');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCentralUsers = async () => {\n    try {\n      setLoadingUsers(true);\n      const response = await fetch(`${api.getBaseUrl()}/api/users/central-users`);\n      if (response.ok) {\n        const data = await response.json();\n        setCentralUsers(data.users || []);\n      }\n    } catch (err) {\n      console.error('Failed to fetch central users:', err);\n    } finally {\n      setLoadingUsers(false);\n    }\n  };\n\n  const fetchAvailableTools = async () => {\n    try {\n      setLoadingTools(true);\n      const tools = await api.groups.availableTools();\n      setAvailableTools(tools);\n    } catch (err) {\n      console.error('Failed to fetch available tools:', err);\n    } finally {\n      setLoadingTools(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      setSaving(true);\n      setError(null);\n      await api.groups.update(group.id, {\n        name: editName,\n        description: editDescription || undefined,\n        color: editColor,\n        priority: editPriority\n      });\n      onUpdated();\n      fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to save group');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleAddMember = async (centralUserId: string) => {\n    try {\n      await api.groups.members.add(group.id, { central_user_id: centralUserId, enabled: true });\n      fetchGroupDetail();\n      setShowAddMember(false);\n      setMemberSearchTerm('');\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add member');\n    }\n  };\n\n  const handleRemoveMember = async (membershipId: string) => {\n    if (!confirm('Remove this member from the group?')) return;\n    try {\n      await api.groups.members.remove(group.id, membershipId);\n      fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to remove member');\n    }\n  };\n\n  const handleToggleTool = async (toolName: string, serviceType: string, isCurrentlyEnabled: boolean) => {\n    setSavingTool(toolName);\n    try {\n      if (isCurrentlyEnabled) {\n        // Find and remove the permission\n        const permission = groupDetail?.tool_permissions.find(p => p.tool_name === toolName);\n        if (permission) {\n          await api.groups.permissions.delete(group.id, permission.id);\n        }\n      } else {\n        await api.groups.permissions.add(group.id, {\n          tool_name: toolName,\n          service_type: serviceType,\n          enabled: true\n        });\n      }\n      await fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to toggle tool');\n    } finally {\n      setSavingTool(null);\n    }\n  };\n\n  const handleAddAllToolsForService = async (serviceType: string) => {\n    if (!availableTools) return;\n    const tools = availableTools.tools_by_service[serviceType];\n    if (!tools || tools.length === 0) return;\n\n    try {\n      // Add each tool individually (not as wildcard) so they show as labels\n      const toolNames = tools.map(t => t.name);\n      await api.groups.permissions.bulk(group.id, {\n        tool_names: toolNames,\n        service_type: serviceType,\n        enabled: true\n      });\n      fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add permissions');\n    }\n  };\n\n  const handleRemoveAllToolsForService = async (serviceType: string) => {\n    if (!groupDetail || !availableTools) return;\n    const tools = availableTools.tools_by_service[serviceType];\n    if (!tools || tools.length === 0) return;\n\n    try {\n      // Remove each permission for this service\n      const toolNames = tools.map(t => t.name);\n      for (const toolName of toolNames) {\n        const permission = groupDetail.tool_permissions.find(p => p.tool_name === toolName);\n        if (permission) {\n          await api.groups.permissions.delete(group.id, permission.id);\n        }\n      }\n      fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to remove permissions');\n    }\n  };\n\n  const handleAddAllTools = async () => {\n    if (!availableTools) return;\n\n    try {\n      // Add ALL tools from ALL services individually\n      for (const [serviceType, tools] of Object.entries(availableTools.tools_by_service)) {\n        if (tools.length > 0) {\n          const toolNames = tools.map(t => t.name);\n          await api.groups.permissions.bulk(group.id, {\n            tool_names: toolNames,\n            service_type: serviceType,\n            enabled: true\n          });\n        }\n      }\n      fetchGroupDetail();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add permissions');\n    }\n  };\n\n  const toggleServiceExpand = (service: string) => {\n    const newExpanded = new Set(expandedServices);\n    if (newExpanded.has(service)) {\n      newExpanded.delete(service);\n    } else {\n      newExpanded.add(service);\n    }\n    setExpandedServices(newExpanded);\n  };\n\n  const isToolPermitted = (toolName: string, serviceType?: string): boolean => {\n    if (!groupDetail) return false;\n    return groupDetail.tool_permissions.some(p =>\n      p.enabled && (\n        p.tool_name === toolName ||\n        (p.tool_name === '*' && (!p.service_type || p.service_type === serviceType))\n      )\n    );\n  };\n\n  const getMemberIds = (): Set<string> => {\n    if (!groupDetail) return new Set();\n    return new Set(groupDetail.memberships.map(m => m.central_user_id));\n  };\n\n  const filteredUsersToAdd = centralUsers.filter(user => {\n    const memberIds = getMemberIds();\n    if (memberIds.has(user.central_user_id)) return false;\n    if (!memberSearchTerm) return true;\n    return user.central_username.toLowerCase().includes(memberSearchTerm.toLowerCase()) ||\n           user.central_user_id.toLowerCase().includes(memberSearchTerm.toLowerCase());\n  });\n\n  // Filter tools by search query\n  const filteredToolsByService = useMemo(() => {\n    if (!availableTools) return {};\n    if (!toolSearchQuery.trim()) return availableTools.tools_by_service;\n\n    const query = toolSearchQuery.toLowerCase();\n    const filtered: Record<string, typeof availableTools.tools_by_service[string]> = {};\n\n    Object.entries(availableTools.tools_by_service).forEach(([service, tools]) => {\n      const matchingTools = tools.filter(\n        tool => tool.name.toLowerCase().includes(query) ||\n                tool.description?.toLowerCase().includes(query) ||\n                service.toLowerCase().includes(query)\n      );\n      if (matchingTools.length > 0) {\n        filtered[service] = matchingTools;\n      }\n    });\n\n    return filtered;\n  }, [availableTools, toolSearchQuery]);\n\n  // Count enabled tools per service\n  const enabledCountByService = useMemo(() => {\n    if (!groupDetail || !availableTools) return {};\n    const counts: Record<string, { enabled: number; total: number }> = {};\n\n    Object.entries(availableTools.tools_by_service).forEach(([service, tools]) => {\n      const enabled = tools.filter(t => isToolPermitted(t.name, service)).length;\n      counts[service] = { enabled, total: tools.length };\n    });\n\n    return counts;\n  }, [groupDetail, availableTools]);\n\n  if (loading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <RefreshCw className=\"w-6 h-6 text-indigo-600 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (!groupDetail) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-gray-500\">\n        Groupe non trouvé\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <div\n            className=\"w-4 h-4 rounded-full\"\n            style={{ backgroundColor: groupDetail.color || '#6366f1' }}\n          />\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            {groupDetail.name}\n          </h2>\n          {groupDetail.is_system && (\n            <span className=\"px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded\">\n              Système\n            </span>\n          )}\n        </div>\n        <button\n          onClick={onClose}\n          className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\n        {[\n          { id: 'info', label: 'Informations', icon: Shield },\n          { id: 'members', label: `Membres (${groupDetail.member_count})`, icon: Users },\n          { id: 'permissions', label: `Outils (${groupDetail.tool_count})`, icon: Wrench }\n        ].map(tab => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id as typeof activeTab)}\n            className={`flex items-center space-x-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${\n              activeTab === tab.id\n                ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'\n            }`}\n          >\n            <tab.icon className=\"w-4 h-4\" />\n            <span>{tab.label}</span>\n          </button>\n        ))}\n      </div>\n\n      {/* Error */}\n      {error && (\n        <div className=\"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\">\n          <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        {/* Info Tab */}\n        {activeTab === 'info' && (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Nom\n              </label>\n              <input\n                type=\"text\"\n                value={editName}\n                onChange={(e) => setEditName(e.target.value)}\n                disabled={groupDetail.is_system}\n                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 dark:disabled:bg-gray-800\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Description\n              </label>\n              <textarea\n                value={editDescription}\n                onChange={(e) => setEditDescription(e.target.value)}\n                rows={3}\n                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                  Couleur\n                </label>\n                <div className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"color\"\n                    value={editColor}\n                    onChange={(e) => setEditColor(e.target.value)}\n                    className=\"w-10 h-10 rounded cursor-pointer border border-gray-300 dark:border-gray-600\"\n                  />\n                  <input\n                    type=\"text\"\n                    value={editColor}\n                    onChange={(e) => setEditColor(e.target.value)}\n                    className=\"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                  Priorité\n                </label>\n                <input\n                  type=\"number\"\n                  value={editPriority}\n                  onChange={(e) => setEditPriority(parseInt(e.target.value) || 0)}\n                  className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n                  Priorité plus élevée = résolution en premier\n                </p>\n              </div>\n            </div>\n\n            <div className=\"pt-4 flex justify-end\">\n              <button\n                onClick={handleSave}\n                disabled={saving || !editName.trim()}\n                className=\"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors\"\n              >\n                {saving ? (\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <Save className=\"w-4 h-4\" />\n                )}\n                <span>Sauvegarder</span>\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Members Tab */}\n        {activeTab === 'members' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Membres du groupe\n              </h3>\n              <button\n                onClick={() => setShowAddMember(!showAddMember)}\n                className=\"flex items-center space-x-1 px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded-lg transition-colors\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                <span>Ajouter</span>\n              </button>\n            </div>\n\n            {/* Add Member Panel */}\n            {showAddMember && (\n              <div className=\"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\n                <div className=\"relative mb-3\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Rechercher un utilisateur...\"\n                    value={memberSearchTerm}\n                    onChange={(e) => setMemberSearchTerm(e.target.value)}\n                    className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg\"\n                  />\n                </div>\n\n                {loadingUsers ? (\n                  <div className=\"flex items-center justify-center py-4\">\n                    <RefreshCw className=\"w-5 h-5 text-indigo-500 animate-spin\" />\n                  </div>\n                ) : (\n                  <div className=\"max-h-48 overflow-y-auto space-y-1\">\n                    {filteredUsersToAdd.map(user => (\n                      <div\n                        key={user.central_user_id}\n                        onClick={() => handleAddMember(user.central_user_id)}\n                        className=\"flex items-center justify-between p-2 hover:bg-white dark:hover:bg-gray-700 rounded cursor-pointer\"\n                      >\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                            {user.central_username}\n                          </p>\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                            {user.service_count} service{user.service_count > 1 ? 's' : ''}\n                          </p>\n                        </div>\n                        <Plus className=\"w-4 h-4 text-indigo-600\" />\n                      </div>\n                    ))}\n                    {filteredUsersToAdd.length === 0 && (\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400 text-center py-4\">\n                        Aucun utilisateur disponible\n                      </p>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Members List */}\n            <div className=\"space-y-2\">\n              {groupDetail.memberships.map(member => (\n                <div\n                  key={member.id}\n                  className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg\"\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-8 h-8 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center\">\n                      <Users className=\"w-4 h-4 text-indigo-600\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                        {member.central_username || member.central_user_id}\n                      </p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        Ajouté le {new Date(member.granted_at).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => handleRemoveMember(member.central_user_id)}\n                    className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              ))}\n\n              {groupDetail.memberships.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                  <Users className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">Aucun membre</p>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Permissions Tab - Refonte Mobile-First */}\n        {activeTab === 'permissions' && (\n          <div className=\"space-y-3\">\n            {/* Search + Quick Actions - Compact */}\n            <div className=\"sticky top-0 bg-white dark:bg-gray-800 pb-2 -mt-1 pt-1 z-10\">\n              {/* Search bar + action in one row */}\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Rechercher...\"\n                    value={toolSearchQuery}\n                    onChange={(e) => setToolSearchQuery(e.target.value)}\n                    className=\"w-full pl-8 pr-7 py-1.5 text-xs border border-gray-300 dark:border-gray-600 bg-transparent dark:text-white rounded-md focus:ring-1 focus:ring-indigo-500\"\n                  />\n                  {toolSearchQuery && (\n                    <button\n                      onClick={() => setToolSearchQuery('')}\n                      className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n                    >\n                      <X className=\"w-3.5 h-3.5\" />\n                    </button>\n                  )}\n                </div>\n                <button\n                  onClick={handleAddAllTools}\n                  className=\"flex items-center gap-1 px-2 py-1.5 text-xs font-medium bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors whitespace-nowrap\"\n                >\n                  <Zap className=\"w-3 h-3\" />\n                  Tout\n                </button>\n                <span className=\"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap\">\n                  {groupDetail.tool_count}/{availableTools?.total_tools || 0}\n                </span>\n              </div>\n            </div>\n\n            {/* Tools by service */}\n            {loadingTools ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <RefreshCw className=\"w-6 h-6 text-indigo-500 animate-spin\" />\n              </div>\n            ) : Object.keys(filteredToolsByService).length > 0 ? (\n              <div className=\"space-y-2\">\n                {Object.entries(filteredToolsByService).map(([serviceType, tools]) => {\n                  const colors = getServiceColor(serviceType);\n                  const Icon = colors.icon;\n                  const isExpanded = expandedServices.has(serviceType);\n                  const counts = enabledCountByService[serviceType] || { enabled: 0, total: 0 };\n\n                  return (\n                    <div\n                      key={serviceType}\n                      className={`rounded-lg overflow-hidden border ${colors.border}`}\n                    >\n                      {/* Service header */}\n                      <button\n                        onClick={() => toggleServiceExpand(serviceType)}\n                        className={`w-full flex items-center justify-between px-3 py-2.5 ${colors.bg} hover:opacity-90 transition-opacity`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`p-1.5 rounded-lg ${colors.badge} ${colors.badgeDark}`}>\n                            <Icon className=\"w-4 h-4\" />\n                          </div>\n                          <div className=\"text-left\">\n                            <span className={`font-medium text-sm capitalize ${colors.text}`}>\n                              {serviceType}\n                            </span>\n                            <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\">\n                              {counts.enabled}/{counts.total}\n                            </span>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {/* Quick toggle all for this service */}\n                          {counts.enabled === counts.total && counts.total > 0 ? (\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleRemoveAllToolsForService(serviceType);\n                              }}\n                              className=\"px-2 py-0.5 text-xs font-medium text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors\"\n                            >\n                              Aucun\n                            </button>\n                          ) : (\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleAddAllToolsForService(serviceType);\n                              }}\n                              className=\"px-2 py-0.5 text-xs font-medium text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 rounded transition-colors\"\n                            >\n                              Tous\n                            </button>\n                          )}\n                          {isExpanded ? (\n                            <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n                          ) : (\n                            <ChevronRight className=\"w-4 h-4 text-gray-500\" />\n                          )}\n                        </div>\n                      </button>\n\n                      {/* Tools list */}\n                      {isExpanded && (\n                        <div className=\"bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700\">\n                          {tools.map(tool => {\n                            const isEnabled = isToolPermitted(tool.name, serviceType);\n                            const isSaving = savingTool === tool.name;\n\n                            return (\n                              <div\n                                key={tool.name}\n                                className={`flex items-center gap-3 px-3 py-2.5 transition-colors ${\n                                  isEnabled ? 'bg-indigo-50/50 dark:bg-indigo-900/10' : ''\n                                }`}\n                              >\n                                {/* Toggle button */}\n                                <button\n                                  onClick={() => handleToggleTool(tool.name, serviceType, isEnabled)}\n                                  disabled={isSaving}\n                                  className={`flex-shrink-0 w-9 h-5 rounded-full transition-colors relative ${\n                                    isEnabled\n                                      ? 'bg-indigo-600'\n                                      : 'bg-gray-300 dark:bg-gray-600'\n                                  } ${isSaving ? 'opacity-50' : ''}`}\n                                >\n                                  <span\n                                    className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow-sm transition-all duration-200 ${\n                                      isEnabled ? 'left-[18px]' : 'left-0.5'\n                                    }`}\n                                  />\n                                  {isSaving && (\n                                    <RefreshCw className=\"absolute inset-0 m-auto w-3 h-3 text-white animate-spin\" />\n                                  )}\n                                </button>\n\n                                {/* Tool info */}\n                                <div className=\"flex-1 min-w-0\">\n                                  <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                                    {tool.name.replace(`${serviceType}_`, '')}\n                                  </p>\n                                  {tool.description && (\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">\n                                      {tool.description}\n                                    </p>\n                                  )}\n                                </div>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                <Wrench className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n                <p className=\"text-sm\">\n                  {toolSearchQuery ? 'Aucun outil ne correspond à la recherche' : 'Aucun outil disponible'}\n                </p>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default GroupDetail;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Groups/GroupList.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchGroups'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchGroups, showDisabled]","fix":{"range":[858,872],"text":"[fetchGroups, showDisabled]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  Shield,\n  Plus,\n  Trash2,\n  Users,\n  Wrench,\n  RefreshCw,\n  Search,\n  XCircle,\n  ChevronRight,\n  ToggleLeft,\n  ToggleRight\n} from 'lucide-react';\nimport { api } from '../../lib/api';\nimport type { Group } from '../../types/api';\n\ninterface GroupListProps {\n  onSelectGroup: (group: Group) => void;\n  onCreateGroup: () => void;\n  selectedGroupId?: string;\n}\n\nconst GroupList: FC<GroupListProps> = ({ onSelectGroup, onCreateGroup, selectedGroupId }) => {\n  const [groups, setGroups] = useState<Group[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDisabled, setShowDisabled] = useState(false);\n\n  useEffect(() => {\n    fetchGroups();\n  }, [showDisabled]);\n\n  const fetchGroups = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const response = await api.groups.list(showDisabled ? undefined : true);\n      setGroups(response.groups);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch groups');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleEnabled = async (group: Group, e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      await api.groups.update(group.id, { enabled: !group.enabled });\n      fetchGroups();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update group');\n    }\n  };\n\n  const handleDeleteGroup = async (group: Group, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (group.is_system) {\n      setError('Cannot delete system groups');\n      return;\n    }\n    if (!confirm(`Are you sure you want to delete the group \"${group.name}\"?`)) {\n      return;\n    }\n    try {\n      await api.groups.delete(group.id);\n      fetchGroups();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete group');\n    }\n  };\n\n  const filteredGroups = groups.filter(group =>\n    group.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (group.description && group.description.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  if (loading) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"animate-pulse space-y-3\">\n          {[...Array(3)].map((_, i) => (\n            <div key={i} className=\"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center space-x-2\">\n            <Shield className=\"w-5 h-5 text-indigo-600\" />\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Groupes</h2>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={fetchGroups}\n              disabled={loading}\n              className=\"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n              title=\"Actualiser\"\n            >\n              <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n            </button>\n            <button\n              onClick={onCreateGroup}\n              className=\"flex items-center space-x-1 px-3 py-1.5 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors\"\n            >\n              <Plus className=\"w-4 h-4\" />\n              <span>Nouveau</span>\n            </button>\n          </div>\n        </div>\n\n        {/* Search */}\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n          <input\n            type=\"text\"\n            placeholder=\"Rechercher un groupe...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n          />\n        </div>\n\n        {/* Show disabled toggle */}\n        <div className=\"flex items-center justify-between mt-3\">\n          <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n            {filteredGroups.length} groupe{filteredGroups.length > 1 ? 's' : ''}\n          </span>\n          <label className=\"flex items-center space-x-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              checked={showDisabled}\n              onChange={(e) => setShowDisabled(e.target.checked)}\n              className=\"sr-only\"\n            />\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">Afficher désactivés</span>\n            {showDisabled ? (\n              <ToggleRight className=\"w-5 h-5 text-indigo-600\" />\n            ) : (\n              <ToggleLeft className=\"w-5 h-5 text-gray-400\" />\n            )}\n          </label>\n        </div>\n      </div>\n\n      {/* Error */}\n      {error && (\n        <div className=\"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\">\n          <div className=\"flex items-center\">\n            <XCircle className=\"w-4 h-4 text-red-500 mr-2\" />\n            <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      {/* Group List */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-2\">\n        {filteredGroups.map((group) => (\n          <div\n            key={group.id}\n            onClick={() => onSelectGroup(group)}\n            className={`p-3 rounded-lg border cursor-pointer transition-all ${\n              selectedGroupId === group.id\n                ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800'\n            } ${!group.enabled ? 'opacity-60' : ''}`}\n          >\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-start space-x-3 min-w-0\">\n                {/* Color indicator */}\n                <div\n                  className=\"w-3 h-3 rounded-full mt-1.5 flex-shrink-0\"\n                  style={{ backgroundColor: group.color || '#6366f1' }}\n                />\n                <div className=\"min-w-0\">\n                  <div className=\"flex items-center space-x-2\">\n                    <h3 className=\"font-medium text-gray-900 dark:text-white truncate\">\n                      {group.name}\n                    </h3>\n                    {group.is_system && (\n                      <span className=\"px-1.5 py-0.5 text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded\">\n                        Système\n                      </span>\n                    )}\n                    {!group.enabled && (\n                      <span className=\"px-1.5 py-0.5 text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded\">\n                        Désactivé\n                      </span>\n                    )}\n                  </div>\n                  {group.description && (\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate\">\n                      {group.description}\n                    </p>\n                  )}\n                  <div className=\"flex items-center space-x-3 mt-2 text-xs text-gray-500 dark:text-gray-400\">\n                    <span className=\"flex items-center\">\n                      <Users className=\"w-3 h-3 mr-1\" />\n                      {group.member_count}\n                    </span>\n                    <span className=\"flex items-center\">\n                      <Wrench className=\"w-3 h-3 mr-1\" />\n                      {group.tool_count}\n                    </span>\n                    <span>Priorité: {group.priority}</span>\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-1 flex-shrink-0\">\n                <button\n                  onClick={(e) => handleToggleEnabled(group, e)}\n                  className={`p-1.5 rounded transition-colors ${\n                    group.enabled\n                      ? 'text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20'\n                      : 'text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'\n                  }`}\n                  title={group.enabled ? 'Désactiver' : 'Activer'}\n                >\n                  {group.enabled ? (\n                    <ToggleRight className=\"w-4 h-4\" />\n                  ) : (\n                    <ToggleLeft className=\"w-4 h-4\" />\n                  )}\n                </button>\n                {!group.is_system && (\n                  <button\n                    onClick={(e) => handleDeleteGroup(group, e)}\n                    className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors\"\n                    title=\"Supprimer\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                )}\n                <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n              </div>\n            </div>\n          </div>\n        ))}\n\n        {filteredGroups.length === 0 && (\n          <div className=\"text-center py-8\">\n            <Shield className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3\" />\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {searchTerm ? 'Aucun groupe trouvé' : 'Aucun groupe créé'}\n            </p>\n            {!searchTerm && (\n              <button\n                onClick={onCreateGroup}\n                className=\"mt-3 text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400\"\n              >\n                Créer un premier groupe\n              </button>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default GroupList;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Groups/GroupManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Groups/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349,352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349,352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { NavLink } from 'react-router-dom';\nimport {\n  Home,\n  Server,\n  Users,\n  Settings,\n  Activity,\n  Menu,\n  X,\n  Zap,\n  Bot,\n  Brain,\n  Sun,\n  Moon,\n} from 'lucide-react';\nimport { useTheme } from '../contexts/ThemeContext';\n\ninterface NavigationItem {\n  name: string;\n  href: string;\n  icon: React.FC<any>;\n  badge?: number;\n}\n\nconst navigation: NavigationItem[] = [\n  { name: 'Dashboard', href: '/', icon: Home },\n  { name: 'Services', href: '/services', icon: Server },\n  { name: 'Users', href: '/users', icon: Users },\n  { name: 'MCP Server', href: '/mcp', icon: Bot },\n  { name: 'Training IA', href: '/training', icon: Brain },\n  { name: 'Monitoring', href: '/monitoring', icon: Activity },\n  { name: 'Configuration', href: '/configuration', icon: Settings },\n];\n\ninterface LayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function Layout({ children }: LayoutProps) {\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const { theme, resolvedTheme, setTheme } = useTheme();\n\n  const toggleTheme = () => {\n    if (theme === 'system') {\n      setTheme(resolvedTheme === 'dark' ? 'light' : 'dark');\n    } else {\n      setTheme(theme === 'dark' ? 'light' : 'dark');\n    }\n  };\n\n  return (\n    <div className=\"h-screen flex bg-gray-50 dark:bg-gray-900\">\n      {/* Mobile sidebar backdrop */}\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 z-40 md:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        >\n          <div className=\"fixed inset-0 bg-gray-600 bg-opacity-75\" />\n        </div>\n      )}\n\n      {/* Sidebar */}\n      <div\n        className={`fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transform ${\n          sidebarOpen ? 'translate-x-0' : '-translate-x-full'\n        } transition-transform duration-200 ease-in-out md:translate-x-0 md:static md:flex md:flex-col`}\n      >\n        {/* Sidebar header - height matches main header */}\n        <div className=\"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 h-[57px] flex items-center flex-shrink-0\">\n          <div className=\"flex items-center justify-between w-full\">\n            <div className=\"flex items-center space-x-2\">\n              <Zap className=\"h-7 w-7 text-primary-600\" />\n              <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n                MCParr\n              </h1>\n            </div>\n            <button\n              type=\"button\"\n              className=\"md:hidden p-1 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700\"\n              onClick={() => setSidebarOpen(false)}\n            >\n              <X className=\"h-6 w-6\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Sidebar content */}\n        <div className=\"flex-1 flex flex-col overflow-y-auto\">\n          {/* Navigation */}\n          <nav className=\"flex-1 px-3 pt-4 pb-4\">\n            <div className=\"space-y-1\">\n              {navigation.map((item) => (\n                <NavLink\n                  key={item.name}\n                  to={item.href}\n                  className={({ isActive }) =>\n                    `nav-link ${isActive ? 'nav-link-active' : 'nav-link-inactive'}`\n                  }\n                  onClick={() => setSidebarOpen(false)}\n                >\n                  <item.icon className=\"mr-3 h-5 w-5 flex-shrink-0\" />\n                  {item.name}\n                  {item.badge && (\n                    <span className=\"ml-auto bg-primary-100 text-primary-600 py-0.5 px-2.5 text-xs rounded-full\">\n                      {item.badge}\n                    </span>\n                  )}\n                </NavLink>\n              ))}\n            </div>\n          </nav>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        {/* Top navigation - height matches sidebar header */}\n        <header className=\"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 md:px-6 h-[57px] flex items-center flex-shrink-0\">\n          <div className=\"flex items-center justify-between w-full\">\n            <div className=\"flex items-center\">\n              <button\n                type=\"button\"\n                className=\"md:hidden p-1 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 mr-3\"\n                onClick={() => setSidebarOpen(true)}\n              >\n                <Menu className=\"h-6 w-6\" />\n              </button>\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Dashboard\n              </h2>\n            </div>\n\n            <div className=\"flex items-center space-x-3\">\n              {/* Theme toggle */}\n              <button\n                onClick={toggleTheme}\n                className=\"p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n                title={`Theme: ${theme}`}\n              >\n                {resolvedTheme === 'dark' ? (\n                  <Sun className=\"h-5 w-5\" />\n                ) : (\n                  <Moon className=\"h-5 w-5\" />\n                )}\n              </button>\n\n              {/* User menu placeholder */}\n              <div className=\"flex items-center\">\n                <div className=\"h-8 w-8 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center\">\n                  <span className=\"text-xs font-medium text-gray-600 dark:text-gray-300\">A</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        {/* Page content */}\n        <main className=\"flex-1 p-4 md:p-6 overflow-y-auto bg-gray-50 dark:bg-gray-900\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/LogExport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Observability/AlertManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport type { FC, FormEvent } from 'react';\nimport { api } from '../../lib/api';\n\ninterface AlertConfig {\n  id: string;\n  name: string;\n  description: string | null;\n  enabled: boolean;\n  severity: string;\n  metric_type: string;\n  threshold_operator: string;\n  threshold_value: number;\n  duration_seconds: number;\n  service_id: string | null;\n  service_type: string | null;\n  notification_channels: string[];\n  notification_config: Record<string, any>;\n  cooldown_minutes: number;\n  last_triggered_at: string | null;\n  trigger_count: number;\n  is_firing: boolean;\n  tags: Record<string, string>;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface AlertHistory {\n  id: string;\n  alert_config_id: string;\n  alert_name: string;\n  severity: string;\n  triggered_at: string;\n  resolved_at: string | null;\n  is_resolved: boolean;\n  metric_value: number;\n  threshold_value: number;\n  service_id: string | null;\n  message: string;\n  notifications_sent: boolean;\n  notification_details: Record<string, any>;\n  created_at: string;\n}\n\ninterface AlertStats {\n  total_triggered: number;\n  active_count: number;\n  by_severity: Record<string, number>;\n  mttr_seconds: number;\n  mttr_formatted: string;\n  period_hours: number;\n}\n\nconst severityColors: Record<string, string> = {\n  low: 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300',\n  medium: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',\n  high: 'bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300',\n  critical: 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300',\n};\n\nexport const AlertManager: FC = () => {\n  const [activeTab, setActiveTab] = useState<'active' | 'configs' | 'history'>('active');\n  const [configs, setConfigs] = useState<AlertConfig[]>([]);\n  const [history, setHistory] = useState<AlertHistory[]>([]);\n  const [activeAlerts, setActiveAlerts] = useState<AlertHistory[]>([]);\n  const [stats, setStats] = useState<AlertStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [severities, setSeverities] = useState<string[]>([]);\n  const [metricTypes, setMetricTypes] = useState<string[]>([]);\n  const [operators, setOperators] = useState<{ value: string; label: string }[]>([]);\n\n  const fetchData = useCallback(async () => {\n    try {\n      const [configsRes, historyRes, activeRes, statsRes] = await Promise.all([\n        api.alerts.configs.list(),\n        api.alerts.history.list({ limit: 50 }),\n        api.alerts.history.active(),\n        api.alerts.stats(24),\n      ]);\n      setConfigs(configsRes.items);\n      setHistory(historyRes.items);\n      setActiveAlerts(activeRes);\n      setStats(statsRes);\n    } catch (error) {\n      console.error('Failed to fetch alerts:', error);\n    }\n  }, []);\n\n  const fetchMetadata = useCallback(async () => {\n    try {\n      const [sevRes, metricRes, opRes] = await Promise.all([\n        api.alerts.severities(),\n        api.alerts.metricTypes(),\n        api.alerts.operators(),\n      ]);\n      setSeverities(sevRes.severities || []);\n      setMetricTypes(metricRes.metric_types || []);\n      setOperators(opRes.operators || []);\n    } catch (error) {\n      console.error('Failed to fetch metadata:', error);\n    }\n  }, []);\n\n  useEffect(() => {\n    const load = async () => {\n      setLoading(true);\n      await Promise.all([fetchData(), fetchMetadata()]);\n      setLoading(false);\n    };\n    load();\n  }, [fetchData, fetchMetadata]);\n\n  const handleToggleConfig = async (config: AlertConfig) => {\n    try {\n      await api.alerts.configs.toggle(config.id, !config.enabled);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to toggle alert:', error);\n    }\n  };\n\n  const handleDeleteConfig = async (id: string) => {\n    if (!confirm('Are you sure you want to delete this alert configuration?')) return;\n    try {\n      await api.alerts.configs.delete(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to delete alert:', error);\n    }\n  };\n\n  const handleResolveAlert = async (id: string) => {\n    try {\n      await api.alerts.history.resolve(id, 'Manually resolved');\n      fetchData();\n    } catch (error) {\n      console.error('Failed to resolve alert:', error);\n    }\n  };\n\n  const formatTimestamp = (timestamp: string) => {\n    return new Date(timestamp).toLocaleString();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold text-gray-900 dark:text-white\">\n            Alert Management\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            Configure and manage system alerts\n          </p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          Create Alert\n        </button>\n      </div>\n\n      {/* Stats Cards */}\n      {stats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Active Alerts</div>\n            <div className={`text-2xl font-bold ${stats.active_count > 0 ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'}`}>\n              {stats.active_count}\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Triggered (24h)</div>\n            <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              {stats.total_triggered}\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">MTTR</div>\n            <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              {stats.mttr_formatted || '-'}\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Critical (24h)</div>\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n              {stats.by_severity?.critical || 0}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Tabs */}\n      <div className=\"border-b border-gray-200 dark:border-gray-700\">\n        <nav className=\"flex -mb-px space-x-8\">\n          {[\n            { id: 'active', label: 'Active Alerts', count: activeAlerts.length },\n            { id: 'configs', label: 'Configurations', count: configs.length },\n            { id: 'history', label: 'History' },\n          ].map(tab => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as typeof activeTab)}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === tab.id\n                  ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n              }`}\n            >\n              {tab.label}\n              {tab.count !== undefined && (\n                <span className={`ml-2 px-2 py-0.5 rounded-full text-xs ${\n                  tab.id === 'active' && tab.count > 0\n                    ? 'bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-400'\n                    : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400'\n                }`}>\n                  {tab.count}\n                </span>\n              )}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Content */}\n      {loading ? (\n        <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Loading...</div>\n      ) : (\n        <>\n          {/* Active Alerts */}\n          {activeTab === 'active' && (\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n              {activeAlerts.length === 0 ? (\n                <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n                  <svg className=\"w-12 h-12 mx-auto mb-4 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                  </svg>\n                  No active alerts - everything is running smoothly!\n                </div>\n              ) : (\n                <ul className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n                  {activeAlerts.map(alert => (\n                    <li key={alert.id} className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${severityColors[alert.severity]}`}>\n                            {alert.severity.toUpperCase()}\n                          </span>\n                          <div>\n                            <h4 className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                              {alert.alert_name}\n                            </h4>\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                              Triggered {formatTimestamp(alert.triggered_at)}\n                            </p>\n                          </div>\n                        </div>\n                        <button\n                          onClick={() => handleResolveAlert(alert.id)}\n                          className=\"px-3 py-1 text-sm border border-green-500 text-green-600 rounded hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors\"\n                        >\n                          Resolve\n                        </button>\n                      </div>\n                      <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\n                        {alert.message}\n                      </p>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          )}\n\n          {/* Configurations */}\n          {activeTab === 'configs' && (\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n              {configs.length === 0 ? (\n                <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n                  No alert configurations yet. Create one to get started!\n                </div>\n              ) : (\n                <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                  <thead className=\"bg-gray-50 dark:bg-gray-900\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Name</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Severity</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Condition</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Status</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Triggered</th>\n                      <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n                    {configs.map(config => (\n                      <tr key={config.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                        <td className=\"px-4 py-3\">\n                          <div className=\"text-sm font-medium text-gray-900 dark:text-white\">{config.name}</div>\n                          {config.description && (\n                            <div className=\"text-xs text-gray-500 dark:text-gray-400\">{config.description}</div>\n                          )}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${severityColors[config.severity]}`}>\n                            {config.severity}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-400\">\n                          {config.metric_type} {config.threshold_operator} {config.threshold_value}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-2\">\n                            {config.is_firing && (\n                              <span className=\"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300\">\n                                FIRING\n                              </span>\n                            )}\n                            <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${\n                              config.enabled\n                                ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300'\n                                : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300'\n                            }`}>\n                              {config.enabled ? 'Enabled' : 'Disabled'}\n                            </span>\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400\">\n                          {config.trigger_count}x\n                        </td>\n                        <td className=\"px-4 py-3 text-right\">\n                          <div className=\"flex items-center justify-end gap-2\">\n                            <button\n                              onClick={() => handleToggleConfig(config)}\n                              className=\"px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700\"\n                            >\n                              {config.enabled ? 'Disable' : 'Enable'}\n                            </button>\n                            <button\n                              onClick={() => handleDeleteConfig(config.id)}\n                              className=\"px-2 py-1 text-xs border border-red-300 text-red-600 rounded hover:bg-red-50 dark:hover:bg-red-900/20\"\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              )}\n            </div>\n          )}\n\n          {/* History */}\n          {activeTab === 'history' && (\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n              {history.length === 0 ? (\n                <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n                  No alert history yet\n                </div>\n              ) : (\n                <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                  <thead className=\"bg-gray-50 dark:bg-gray-900\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Alert</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Severity</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Triggered</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Resolved</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Value</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n                    {history.map(h => (\n                      <tr key={h.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                        <td className=\"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white\">\n                          {h.alert_name}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${severityColors[h.severity]}`}>\n                            {h.severity}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400\">\n                          {formatTimestamp(h.triggered_at)}\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          {h.is_resolved ? (\n                            <span className=\"text-sm text-green-600 dark:text-green-400\">\n                              {formatTimestamp(h.resolved_at!)}\n                            </span>\n                          ) : (\n                            <span className=\"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300\">\n                              Active\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400\">\n                          {h.metric_value} / {h.threshold_value}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              )}\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Create Alert Modal */}\n      {showCreateModal && (\n        <CreateAlertModal\n          severities={severities}\n          metricTypes={metricTypes}\n          operators={operators}\n          onClose={() => setShowCreateModal(false)}\n          onCreated={() => {\n            setShowCreateModal(false);\n            fetchData();\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\ninterface CreateAlertModalProps {\n  severities: string[];\n  metricTypes: string[];\n  operators: { value: string; label: string }[];\n  onClose: () => void;\n  onCreated: () => void;\n}\n\nconst CreateAlertModal: FC<CreateAlertModalProps> = ({\n  severities,\n  metricTypes,\n  operators,\n  onClose,\n  onCreated,\n}) => {\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    severity: 'medium',\n    metric_type: 'cpu',\n    threshold_operator: '>',\n    threshold_value: 80,\n    duration_seconds: 60,\n    cooldown_minutes: 15,\n  });\n  const [saving, setSaving] = useState(false);\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    setSaving(true);\n    try {\n      await api.alerts.configs.create(formData);\n      onCreated();\n    } catch (error) {\n      console.error('Failed to create alert:', error);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n        <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n            Create Alert Configuration\n          </h3>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-gray-500\">\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n        <form onSubmit={handleSubmit} className=\"px-6 py-4 space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Name</label>\n            <input\n              type=\"text\"\n              value={formData.name}\n              onChange={e => setFormData({ ...formData, name: e.target.value })}\n              className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              required\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Description</label>\n            <textarea\n              value={formData.description}\n              onChange={e => setFormData({ ...formData, description: e.target.value })}\n              className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              rows={2}\n            />\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Severity</label>\n              <select\n                value={formData.severity}\n                onChange={e => setFormData({ ...formData, severity: e.target.value })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              >\n                {severities.map(s => (\n                  <option key={s} value={s}>{s.charAt(0).toUpperCase() + s.slice(1)}</option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Metric</label>\n              <select\n                value={formData.metric_type}\n                onChange={e => setFormData({ ...formData, metric_type: e.target.value })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              >\n                {metricTypes.map(m => (\n                  <option key={m} value={m}>{m.toUpperCase()}</option>\n                ))}\n              </select>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Operator</label>\n              <select\n                value={formData.threshold_operator}\n                onChange={e => setFormData({ ...formData, threshold_operator: e.target.value })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              >\n                {operators.map(op => (\n                  <option key={op.value} value={op.value}>{op.label} ({op.value})</option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Threshold</label>\n              <input\n                type=\"number\"\n                value={formData.threshold_value}\n                onChange={e => setFormData({ ...formData, threshold_value: parseFloat(e.target.value) })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Duration (sec)</label>\n              <input\n                type=\"number\"\n                value={formData.duration_seconds}\n                onChange={e => setFormData({ ...formData, duration_seconds: parseInt(e.target.value) })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Cooldown (min)</label>\n              <input\n                type=\"number\"\n                value={formData.cooldown_minutes}\n                onChange={e => setFormData({ ...formData, cooldown_minutes: parseInt(e.target.value) })}\n                className=\"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n          </div>\n          <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={saving}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {saving ? 'Creating...' : 'Create Alert'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default AlertManager;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Observability/LogViewer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[435,438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[435,438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { api } from '../../lib/api';\nimport LogExport from '../LogExport';\n\ninterface LogEntry {\n  id: string;\n  level: string;\n  message: string;\n  source: string;\n  component: string | null;\n  correlation_id: string | null;\n  request_id: string | null;\n  user_id: string | null;\n  service_id: string | null;\n  service_type: string | null;\n  extra_data: Record<string, any>;\n  exception_type: string | null;\n  exception_message: string | null;\n  stack_trace: string | null;\n  duration_ms: number | null;\n  logged_at: string;\n  created_at: string;\n}\n\ninterface LogStats {\n  total: number;\n  by_level: Record<string, number>;\n  by_source: Record<string, number>;\n  error_rate: number;\n  period_hours: number;\n}\n\ninterface LogFilters {\n  level?: string;\n  source?: string;\n  service_id?: string;\n  search?: string;\n  start_time?: string;\n  end_time?: string;\n}\n\nconst levelColors: Record<string, string> = {\n  debug: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300',\n  info: 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300',\n  warning: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',\n  error: 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300',\n  critical: 'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300',\n};\n\nexport const LogViewer: React.FC = () => {\n  const [logs, setLogs] = useState<LogEntry[]>([]);\n  const [stats, setStats] = useState<LogStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [total, setTotal] = useState(0);\n  const [filters, setFilters] = useState<LogFilters>({});\n  const [sources, setSources] = useState<string[]>([]);\n  const [levels, setLevels] = useState<string[]>([]);\n  const [selectedLog, setSelectedLog] = useState<LogEntry | null>(null);\n  const [page, setPage] = useState(0);\n  const [autoRefresh, setAutoRefresh] = useState(false);\n  const [showExportModal, setShowExportModal] = useState(false);\n  const limit = 50;\n\n  const fetchLogs = useCallback(async () => {\n    try {\n      const response = await api.logs.list({\n        ...filters,\n        skip: page * limit,\n        limit,\n      });\n      setLogs(response.items);\n      setTotal(response.total);\n    } catch (error) {\n      console.error('Failed to fetch logs:', error);\n    }\n  }, [filters, page]);\n\n  const fetchStats = useCallback(async () => {\n    try {\n      const response = await api.logs.stats(24);\n      setStats(response);\n    } catch (error) {\n      console.error('Failed to fetch log stats:', error);\n    }\n  }, []);\n\n  const fetchMetadata = useCallback(async () => {\n    try {\n      const [sourcesRes, levelsRes] = await Promise.all([\n        api.logs.sources(),\n        api.logs.levels(),\n      ]);\n      setSources(sourcesRes.sources || []);\n      setLevels(levelsRes.levels || []);\n    } catch (error) {\n      console.error('Failed to fetch metadata:', error);\n    }\n  }, []);\n\n  useEffect(() => {\n    const loadInitialData = async () => {\n      setLoading(true);\n      await Promise.all([fetchLogs(), fetchStats(), fetchMetadata()]);\n      setLoading(false);\n    };\n    loadInitialData();\n  }, [fetchLogs, fetchStats, fetchMetadata]);\n\n  useEffect(() => {\n    if (autoRefresh) {\n      const interval = setInterval(() => {\n        fetchLogs();\n        fetchStats();\n      }, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [autoRefresh, fetchLogs, fetchStats]);\n\n  const handleFilterChange = (key: keyof LogFilters, value: string) => {\n    setFilters(prev => ({\n      ...prev,\n      [key]: value || undefined,\n    }));\n    setPage(0);\n  };\n\n  const formatTimestamp = (timestamp: string) => {\n    return new Date(timestamp).toLocaleString();\n  };\n\n  const totalPages = Math.ceil(total / limit);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold text-gray-900 dark:text-white\">\n            Log Viewer\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            View and search system logs\n          </p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <label className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n            <input\n              type=\"checkbox\"\n              checked={autoRefresh}\n              onChange={e => setAutoRefresh(e.target.checked)}\n              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n            />\n            Auto-refresh\n          </label>\n          <button\n            onClick={() => setShowExportModal(true)}\n            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n            </svg>\n            Export\n          </button>\n          <button\n            onClick={() => { fetchLogs(); fetchStats(); }}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            Refresh\n          </button>\n        </div>\n      </div>\n\n      {/* Stats Cards */}\n      {stats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Total Logs (24h)</div>\n            <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              {stats.total.toLocaleString()}\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Error Rate</div>\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n              {stats.error_rate}%\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Errors</div>\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n              {(stats.by_level?.error || 0) + (stats.by_level?.critical || 0)}\n            </div>\n          </div>\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">Warnings</div>\n            <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n              {stats.by_level?.warning || 0}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Filters */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Level\n            </label>\n            <select\n              value={filters.level || ''}\n              onChange={e => handleFilterChange('level', e.target.value)}\n              className=\"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n            >\n              <option value=\"\">All levels</option>\n              {levels.map(level => (\n                <option key={level} value={level}>\n                  {level.charAt(0).toUpperCase() + level.slice(1)}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Source\n            </label>\n            <select\n              value={filters.source || ''}\n              onChange={e => handleFilterChange('source', e.target.value)}\n              className=\"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n            >\n              <option value=\"\">All sources</option>\n              {sources.map(source => (\n                <option key={source} value={source}>{source}</option>\n              ))}\n            </select>\n          </div>\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Search\n            </label>\n            <input\n              type=\"text\"\n              value={filters.search || ''}\n              onChange={e => handleFilterChange('search', e.target.value)}\n              placeholder=\"Search in messages...\"\n              className=\"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n            />\n          </div>\n          <div className=\"flex items-end\">\n            <button\n              onClick={() => { setFilters({}); setPage(0); }}\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n            >\n              Clear filters\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Log Table */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n            Loading logs...\n          </div>\n        ) : logs.length === 0 ? (\n          <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n            No logs found\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                <thead className=\"bg-gray-50 dark:bg-gray-900\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                      Time\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                      Level\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                      Source\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                      Message\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                      Duration\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n                  {logs.map(log => (\n                    <tr\n                      key={log.id}\n                      onClick={() => setSelectedLog(log)}\n                      className=\"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors\"\n                    >\n                      <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\n                        {formatTimestamp(log.logged_at)}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${levelColors[log.level] || levelColors.info}`}>\n                          {log.level.toUpperCase()}\n                        </span>\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-white\">\n                        {log.source}\n                        {log.component && (\n                          <span className=\"text-gray-400 dark:text-gray-500\">/{log.component}</span>\n                        )}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900 dark:text-white max-w-md truncate\">\n                        {log.message}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\n                        {log.duration_ms ? `${log.duration_ms}ms` : '-'}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            <div className=\"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                Showing {page * limit + 1} to {Math.min((page + 1) * limit, total)} of {total} logs\n              </div>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setPage(p => Math.max(0, p - 1))}\n                  disabled={page === 0}\n                  className=\"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700\"\n                >\n                  Previous\n                </button>\n                <span className=\"px-3 py-1 text-sm text-gray-600 dark:text-gray-400\">\n                  Page {page + 1} of {totalPages}\n                </span>\n                <button\n                  onClick={() => setPage(p => Math.min(totalPages - 1, p + 1))}\n                  disabled={page >= totalPages - 1}\n                  className=\"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700\"\n                >\n                  Next\n                </button>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Log Detail Modal */}\n      {selectedLog && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto\">\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n              <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n                Log Details\n              </h3>\n              <button\n                onClick={() => setSelectedLog(null)}\n                className=\"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300\"\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            <div className=\"px-6 py-4 space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Time</label>\n                  <p className=\"text-gray-900 dark:text-white\">{formatTimestamp(selectedLog.logged_at)}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Level</label>\n                  <p>\n                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${levelColors[selectedLog.level]}`}>\n                      {selectedLog.level.toUpperCase()}\n                    </span>\n                  </p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Source</label>\n                  <p className=\"text-gray-900 dark:text-white\">{selectedLog.source}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Component</label>\n                  <p className=\"text-gray-900 dark:text-white\">{selectedLog.component || '-'}</p>\n                </div>\n                {selectedLog.correlation_id && (\n                  <div className=\"col-span-2\">\n                    <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Correlation ID</label>\n                    <p className=\"text-gray-900 dark:text-white font-mono text-sm\">{selectedLog.correlation_id}</p>\n                  </div>\n                )}\n                {selectedLog.duration_ms && (\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Duration</label>\n                    <p className=\"text-gray-900 dark:text-white\">{selectedLog.duration_ms}ms</p>\n                  </div>\n                )}\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Message</label>\n                <p className=\"text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900 p-3 rounded-lg mt-1\">\n                  {selectedLog.message}\n                </p>\n              </div>\n              {selectedLog.exception_type && (\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Exception</label>\n                  <div className=\"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg mt-1\">\n                    <p className=\"font-mono text-sm text-red-700 dark:text-red-300\">\n                      {selectedLog.exception_type}: {selectedLog.exception_message}\n                    </p>\n                    {selectedLog.stack_trace && (\n                      <pre className=\"mt-2 text-xs text-red-600 dark:text-red-400 overflow-x-auto\">\n                        {selectedLog.stack_trace}\n                      </pre>\n                    )}\n                  </div>\n                </div>\n              )}\n              {Object.keys(selectedLog.extra_data || {}).length > 0 && (\n                <div>\n                  <label className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Extra Data</label>\n                  <pre className=\"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg mt-1 text-sm overflow-x-auto\">\n                    {JSON.stringify(selectedLog.extra_data, null, 2)}\n                  </pre>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Export Modal */}\n      {showExportModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full\">\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n              <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n                Export Logs\n              </h3>\n              <button\n                onClick={() => setShowExportModal(false)}\n                className=\"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300\"\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            <div className=\"p-6\">\n              <LogExport filters={filters} onClose={() => setShowExportModal(false)} />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LogViewer;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Observability/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ServiceForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.port'. Either include it or remove the dependency array.","line":227,"column":6,"nodeType":"ArrayExpression","endLine":227,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [formData.port, formData.service_type]","fix":{"range":[5894,5917],"text":"[formData.port, formData.service_type]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { X, Eye, EyeOff, HelpCircle, AlertCircle } from 'lucide-react';\n\ninterface ServiceFormData {\n  name: string;\n  service_type: string;\n  description: string;\n  base_url: string;\n  port: string;\n  api_key: string;\n  username: string;\n  password: string;\n  enabled: boolean;\n  health_check_enabled: boolean;\n  health_check_interval: string;\n}\n\ninterface ServiceFormProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (data: ServiceFormData) => Promise<void>;\n  initialData?: Partial<ServiceFormData>;\n  isEditing?: boolean;\n}\n\nconst SERVICE_TYPES = [\n  {\n    value: 'plex',\n    label: 'Plex Media Server',\n    description: 'Personal media streaming service',\n    fields: ['api_key'],\n    defaultPort: '32400',\n    authType: 'token',\n    urlPlaceholder: 'http://plex.local'\n  },\n  {\n    value: 'overseerr',\n    label: 'Overseerr',\n    description: 'Media request and management system',\n    fields: ['api_key'],\n    defaultPort: '5055',\n    authType: 'api_key',\n    urlPlaceholder: 'http://overseerr.local'\n  },\n  {\n    value: 'tautulli',\n    label: 'Tautulli',\n    description: 'Plex monitoring and statistics',\n    fields: ['api_key'],\n    defaultPort: '8181',\n    authType: 'api_key',\n    urlPlaceholder: 'http://tautulli.local'\n  },\n  {\n    value: 'zammad',\n    label: 'Zammad',\n    description: 'Helpdesk and ticketing system',\n    fields: ['api_key'],\n    defaultPort: '3000',\n    authType: 'token',\n    urlPlaceholder: 'http://zammad.local'\n  },\n  {\n    value: 'authentik',\n    label: 'Authentik',\n    description: 'Identity provider and SSO',\n    fields: ['api_key'],\n    defaultPort: '9000',\n    authType: 'bearer',\n    urlPlaceholder: 'http://authentik.local'\n  },\n  {\n    value: 'openwebui',\n    label: 'Open WebUI',\n    description: 'AI chat interface for LLMs (Ollama, OpenAI, etc.)',\n    fields: ['api_key'],\n    defaultPort: '8080',\n    authType: 'bearer',\n    urlPlaceholder: 'http://openwebui.local'\n  },\n  {\n    value: 'ollama',\n    label: 'Ollama',\n    description: 'Local LLM server for running AI models',\n    fields: [],\n    defaultPort: '11434',\n    authType: 'none',\n    urlPlaceholder: 'http://ollama.local'\n  },\n  {\n    value: 'radarr',\n    label: 'Radarr',\n    description: 'Movie collection manager and downloader',\n    fields: ['api_key'],\n    defaultPort: '7878',\n    authType: 'api_key',\n    urlPlaceholder: 'http://radarr.local'\n  },\n  {\n    value: 'sonarr',\n    label: 'Sonarr',\n    description: 'TV series collection manager and downloader',\n    fields: ['api_key'],\n    defaultPort: '8989',\n    authType: 'api_key',\n    urlPlaceholder: 'http://sonarr.local'\n  },\n  {\n    value: 'prowlarr',\n    label: 'Prowlarr',\n    description: 'Indexer manager for *arr stack',\n    fields: ['api_key'],\n    defaultPort: '9696',\n    authType: 'api_key',\n    urlPlaceholder: 'http://prowlarr.local'\n  },\n  {\n    value: 'jackett',\n    label: 'Jackett',\n    description: 'Torrent indexer proxy',\n    fields: ['api_key'],\n    defaultPort: '9117',\n    authType: 'api_key',\n    urlPlaceholder: 'http://jackett.local'\n  },\n  {\n    value: 'deluge',\n    label: 'Deluge',\n    description: 'BitTorrent client',\n    fields: ['password'],\n    defaultPort: '8112',\n    authType: 'password',\n    urlPlaceholder: 'http://deluge.local'\n  },\n  {\n    value: 'komga',\n    label: 'Komga',\n    description: 'Comic and manga server (API key preferred, or username/password)',\n    fields: ['api_key'],\n    defaultPort: '25600',\n    authType: 'api_key',\n    urlPlaceholder: 'http://komga.local'\n  },\n  {\n    value: 'romm',\n    label: 'RomM',\n    description: 'ROM management system (uses username/password - no API keys)',\n    fields: ['username', 'password'],\n    defaultPort: '8080',\n    authType: 'basic',\n    urlPlaceholder: 'http://romm.local'\n  },\n  {\n    value: 'audiobookshelf',\n    label: 'Audiobookshelf',\n    description: 'Audiobook and podcast server with listening progress tracking',\n    fields: ['api_key'],\n    defaultPort: '13378',\n    authType: 'bearer',\n    urlPlaceholder: 'http://audiobookshelf.local'\n  },\n  {\n    value: 'wikijs',\n    label: 'Wiki.js',\n    description: 'Modern wiki and documentation platform with GraphQL API',\n    fields: ['api_key'],\n    defaultPort: '3000',\n    authType: 'bearer',\n    urlPlaceholder: 'http://wiki.local'\n  },\n  {\n    value: 'monitoring',\n    label: 'Monitoring System',\n    description: 'Custom monitoring service',\n    fields: ['api_key'],\n    defaultPort: '3001',\n    authType: 'api_key',\n    urlPlaceholder: 'http://monitor.local'\n  },\n  {\n    value: 'custom',\n    label: 'Custom Service',\n    description: 'Generic service configuration',\n    fields: ['api_key', 'username', 'password'],\n    defaultPort: '',\n    authType: 'custom',\n    urlPlaceholder: 'http://service.local'\n  }\n];\n\nconst ServiceForm: React.FC<ServiceFormProps> = ({\n  isOpen,\n  onClose,\n  onSubmit,\n  initialData = {},\n  isEditing = false\n}) => {\n  const [formData, setFormData] = useState<ServiceFormData>({\n    name: '',\n    service_type: '',\n    description: '',\n    base_url: '',\n    port: '',\n    api_key: '',\n    username: '',\n    password: '',\n    enabled: true,\n    health_check_enabled: true,\n    health_check_interval: '300',\n    ...initialData\n  });\n\n  const [showPassword, setShowPassword] = useState(false);\n  const [showApiKey, setShowApiKey] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  const selectedServiceType = SERVICE_TYPES.find(type => type.value === formData.service_type);\n\n  useEffect(() => {\n    if (formData.service_type && !formData.port) {\n      const serviceType = SERVICE_TYPES.find(type => type.value === formData.service_type);\n      if (serviceType && serviceType.defaultPort) {\n        setFormData(prev => ({ ...prev, port: serviceType.defaultPort }));\n      }\n    }\n  }, [formData.service_type]);\n\n  const handleChange = (field: keyof ServiceFormData, value: string | boolean) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n\n    // Clear error for this field\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  };\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      newErrors.name = 'Service name is required';\n    }\n\n    if (!formData.service_type) {\n      newErrors.service_type = 'Service type is required';\n    }\n\n    if (!formData.base_url.trim()) {\n      newErrors.base_url = 'Base URL is required';\n    } else {\n      try {\n        new URL(formData.base_url);\n      } catch {\n        newErrors.base_url = 'Invalid URL format';\n      }\n    }\n\n    if (formData.port && (isNaN(Number(formData.port)) || Number(formData.port) < 1 || Number(formData.port) > 65535)) {\n      newErrors.port = 'Port must be a number between 1 and 65535';\n    }\n\n    // Validate auth fields based on service type\n    if (selectedServiceType) {\n      if (selectedServiceType.fields.includes('api_key') && !formData.api_key.trim()) {\n        newErrors.api_key = 'API key is required for this service type';\n      }\n      if (selectedServiceType.fields.includes('username') && !formData.username.trim()) {\n        newErrors.username = 'Username is required for this service type';\n      }\n      if (selectedServiceType.fields.includes('password') && !formData.password.trim()) {\n        newErrors.password = 'Password is required for this service type';\n      }\n    }\n\n    if (formData.health_check_interval && isNaN(Number(formData.health_check_interval))) {\n      newErrors.health_check_interval = 'Health check interval must be a number';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await onSubmit(formData);\n      onClose();\n    } catch (error) {\n      console.error('Error submitting form:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n              {isEditing ? 'Edit Service' : 'Add New Service'}\n            </h3>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors text-gray-600 dark:text-gray-400\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* Basic Information */}\n          <div className=\"space-y-4\">\n            <h4 className=\"text-lg font-medium text-gray-900 dark:text-white\">Basic Information</h4>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Service Name *\n              </label>\n              <input\n                type=\"text\"\n                value={formData.name}\n                onChange={(e) => handleChange('name', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                  errors.name ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                }`}\n                placeholder=\"My Plex Server\"\n                disabled={loading}\n              />\n              {errors.name && (\n                <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                  <AlertCircle className=\"w-4 h-4 mr-1\" />\n                  {errors.name}\n                </p>\n              )}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Service Type *\n              </label>\n              <select\n                value={formData.service_type}\n                onChange={(e) => handleChange('service_type', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                  errors.service_type ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                }`}\n                disabled={loading}\n              >\n                <option value=\"\">Select a service type</option>\n                {SERVICE_TYPES.map((type) => (\n                  <option key={type.value} value={type.value}>\n                    {type.label}\n                  </option>\n                ))}\n              </select>\n              {selectedServiceType && (\n                <p className=\"mt-1 text-sm text-gray-600 dark:text-gray-400\">\n                  {selectedServiceType.description}\n                </p>\n              )}\n              {errors.service_type && (\n                <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                  <AlertCircle className=\"w-4 h-4 mr-1\" />\n                  {errors.service_type}\n                </p>\n              )}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Description\n              </label>\n              <textarea\n                value={formData.description}\n                onChange={(e) => handleChange('description', e.target.value)}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"Optional description of this service\"\n                disabled={loading}\n              />\n            </div>\n          </div>\n\n          {/* Connection Settings */}\n          <div className=\"space-y-4\">\n            <h4 className=\"text-lg font-medium text-gray-900 dark:text-white\">Connection Settings</h4>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Base URL *\n                </label>\n                <input\n                  type=\"url\"\n                  value={formData.base_url}\n                  onChange={(e) => handleChange('base_url', e.target.value)}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                    errors.base_url ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                  }`}\n                  placeholder={selectedServiceType?.urlPlaceholder || 'http://service.local'}\n                  disabled={loading}\n                />\n                {errors.base_url && (\n                  <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                    <AlertCircle className=\"w-4 h-4 mr-1\" />\n                    {errors.base_url}\n                  </p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Port\n                </label>\n                <input\n                  type=\"number\"\n                  value={formData.port}\n                  onChange={(e) => handleChange('port', e.target.value)}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                    errors.port ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                  }`}\n                  placeholder=\"8080\"\n                  min=\"1\"\n                  max=\"65535\"\n                  disabled={loading}\n                />\n                {errors.port && (\n                  <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                    <AlertCircle className=\"w-4 h-4 mr-1\" />\n                    {errors.port}\n                  </p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Authentication */}\n          {selectedServiceType && selectedServiceType.fields.length > 0 && (\n            <div className=\"space-y-4\">\n              <h4 className=\"text-lg font-medium text-gray-900 dark:text-white\">Authentication</h4>\n\n              {selectedServiceType.fields.includes('api_key') && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    API Key *\n                    <HelpCircle className=\"w-4 h-4 inline ml-1 text-gray-400\" />\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      type={showApiKey ? 'text' : 'password'}\n                      value={formData.api_key}\n                      onChange={(e) => handleChange('api_key', e.target.value)}\n                      className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10 dark:bg-gray-700 dark:text-white ${\n                        errors.api_key ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                      }`}\n                      placeholder=\"Enter your API key\"\n                      disabled={loading}\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowApiKey(!showApiKey)}\n                      className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n                    >\n                      {showApiKey ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                    </button>\n                  </div>\n                  {errors.api_key && (\n                    <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {errors.api_key}\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {selectedServiceType.fields.includes('username') && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Username *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.username}\n                    onChange={(e) => handleChange('username', e.target.value)}\n                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                      errors.username ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                    }`}\n                    placeholder=\"Username\"\n                    disabled={loading}\n                  />\n                  {errors.username && (\n                    <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {errors.username}\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {selectedServiceType.fields.includes('password') && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Password *\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      type={showPassword ? 'text' : 'password'}\n                      value={formData.password}\n                      onChange={(e) => handleChange('password', e.target.value)}\n                      className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10 dark:bg-gray-700 dark:text-white ${\n                        errors.password ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                      }`}\n                      placeholder=\"Password\"\n                      disabled={loading}\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowPassword(!showPassword)}\n                      className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n                    >\n                      {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                    </button>\n                  </div>\n                  {errors.password && (\n                    <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {errors.password}\n                    </p>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Health Check Settings */}\n          <div className=\"space-y-4\">\n            <h4 className=\"text-lg font-medium text-gray-900 dark:text-white\">Health Check Settings</h4>\n\n            <div className=\"flex items-center space-x-3\">\n              <input\n                type=\"checkbox\"\n                id=\"health_check_enabled\"\n                checked={formData.health_check_enabled}\n                onChange={(e) => handleChange('health_check_enabled', e.target.checked)}\n                className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                disabled={loading}\n              />\n              <label htmlFor=\"health_check_enabled\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Enable health monitoring\n              </label>\n            </div>\n\n            {formData.health_check_enabled && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Health Check Interval (seconds)\n                </label>\n                <input\n                  type=\"number\"\n                  value={formData.health_check_interval}\n                  onChange={(e) => handleChange('health_check_interval', e.target.value)}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${\n                    errors.health_check_interval ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'\n                  }`}\n                  placeholder=\"300\"\n                  min=\"30\"\n                  disabled={loading}\n                />\n                {errors.health_check_interval && (\n                  <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                    <AlertCircle className=\"w-4 h-4 mr-1\" />\n                    {errors.health_check_interval}\n                  </p>\n                )}\n                <p className=\"mt-1 text-sm text-gray-600 dark:text-gray-400\">\n                  How often to check if the service is responding (minimum 30 seconds)\n                </p>\n              </div>\n            )}\n\n            <div className=\"flex items-center space-x-3\">\n              <input\n                type=\"checkbox\"\n                id=\"enabled\"\n                checked={formData.enabled}\n                onChange={(e) => handleChange('enabled', e.target.checked)}\n                className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                disabled={loading}\n              />\n              <label htmlFor=\"enabled\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Enable service immediately\n              </label>\n            </div>\n          </div>\n\n          {/* Form Actions */}\n          <div className=\"flex justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n              disabled={loading}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              disabled={loading}\n            >\n              {loading ? 'Saving...' : isEditing ? 'Save Changes' : 'Create Service'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default ServiceForm;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ServiceStatus/ServiceStatusDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2044,2047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2044,2047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2135,2138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2135,2138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2235,2238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2235,2238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2303,2306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2303,2306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2592,2595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2592,2595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  Activity,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Clock,\n  RefreshCw,\n  TrendingUp,\n  Server,\n  Wifi,\n  WifiOff\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../../lib/api';\n\ninterface ServiceHealth {\n  service_id: string;\n  service_name: string;\n  service_type: string;\n  status: 'active' | 'inactive' | 'error' | 'testing';\n  last_test_at?: string;\n  last_test_success?: boolean;\n  last_error?: string;\n  response_time_ms?: number;\n  enabled: boolean;\n  uptime_percentage?: number;\n  base_url: string;\n  port?: number;\n}\n\ninterface ServiceMetrics {\n  total_services: number;\n  active_services: number;\n  error_services: number;\n  average_response_time: number;\n  uptime_percentage: number;\n  services_by_type: Record<string, number>;\n}\n\nconst ServiceStatusDashboard: FC = () => {\n  const [services, setServices] = useState<ServiceHealth[]>([]);\n  const [metrics, setMetrics] = useState<ServiceMetrics | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [refreshing, setRefreshing] = useState(false);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [refreshInterval, setRefreshInterval] = useState(30); // seconds\n\n  useEffect(() => {\n    fetchServiceStatus();\n\n    if (autoRefresh) {\n      const interval = setInterval(fetchServiceStatus, refreshInterval * 1000);\n      return () => clearInterval(interval);\n    }\n  }, [autoRefresh, refreshInterval]);\n\n  const fetchServiceStatus = async () => {\n    try {\n      setRefreshing(true);\n      setError(null);\n\n      // Fetch services data\n      const servicesResponse = await fetch(`${getApiBaseUrl()}/api/services/`);\n      if (!servicesResponse.ok) {\n        throw new Error('Failed to fetch services');\n      }\n      const servicesData = await servicesResponse.json();\n\n      // Calculate metrics\n      const totalServices = servicesData.length;\n      const activeServices = servicesData.filter((s: any) => s.status === 'active').length;\n      const errorServices = servicesData.filter((s: any) => s.status === 'error').length;\n\n      const responseTimes = servicesData\n        .filter((s: any) => s.last_test_success && s.response_time_ms)\n        .map((s: any) => s.response_time_ms);\n\n      const avgResponseTime = responseTimes.length > 0\n        ? Math.round(responseTimes.reduce((a: number, b: number) => a + b, 0) / responseTimes.length)\n        : 0;\n\n      const servicesByType = servicesData.reduce((acc: Record<string, number>, service: any) => {\n        acc[service.service_type] = (acc[service.service_type] || 0) + 1;\n        return acc;\n      }, {});\n\n      const uptimePercentage = totalServices > 0\n        ? Math.round((activeServices / totalServices) * 100)\n        : 100;\n\n      setServices(servicesData);\n      setMetrics({\n        total_services: totalServices,\n        active_services: activeServices,\n        error_services: errorServices,\n        average_response_time: avgResponseTime,\n        uptime_percentage: uptimePercentage,\n        services_by_type: servicesByType\n      });\n\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch service status');\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  };\n\n  const getStatusIcon = (service: ServiceHealth) => {\n    if (service.status === 'testing') {\n      return <Activity className=\"w-4 h-4 text-blue-500 animate-pulse\" />;\n    }\n    if (!service.enabled) {\n      return <Clock className=\"w-4 h-4 text-gray-400\" />;\n    }\n    if (service.status === 'active' && service.last_test_success) {\n      return <CheckCircle className=\"w-4 h-4 text-green-500\" />;\n    }\n    if (service.status === 'error' || service.last_test_success === false) {\n      return <XCircle className=\"w-4 h-4 text-red-500\" />;\n    }\n    return <AlertCircle className=\"w-4 h-4 text-yellow-500\" />;\n  };\n\n  const getServiceTypeIcon = (type: string) => {\n    const iconClass = \"w-2 h-2 rounded-full\";\n    switch (type?.toLowerCase()) {\n      case 'plex':\n        return <div className={`${iconClass} bg-purple-500`}></div>;\n      case 'authentik':\n        return <div className={`${iconClass} bg-blue-500`}></div>;\n      case 'overseerr':\n        return <div className={`${iconClass} bg-green-500`}></div>;\n      case 'tautulli':\n        return <div className={`${iconClass} bg-orange-500`}></div>;\n      case 'zammad':\n        return <div className={`${iconClass} bg-red-500`}></div>;\n      default:\n        return <div className={`${iconClass} bg-gray-500`}></div>;\n    }\n  };\n\n  const formatResponseTime = (timeMs?: number) => {\n    if (!timeMs) return 'N/A';\n    if (timeMs < 1000) return `${timeMs}ms`;\n    return `${(timeMs / 1000).toFixed(1)}s`;\n  };\n\n  const formatLastTest = (timestamp?: string) => {\n    if (!timestamp) return 'Never tested';\n\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / (1000 * 60));\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-6\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n            {[...Array(4)].map((_, i) => (\n              <div key={i} className=\"bg-gray-200 h-24 rounded-lg\"></div>\n            ))}\n          </div>\n          <div className=\"bg-gray-200 h-64 rounded-lg\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900 flex items-center\">\n            <Activity className=\"w-8 h-8 mr-3 text-blue-600\" />\n            Service Status Monitor\n          </h1>\n          <p className=\"text-gray-600 mt-1\">\n            Real-time monitoring of all homelab services\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          <label className=\"flex items-center space-x-2\">\n            <input\n              type=\"checkbox\"\n              checked={autoRefresh}\n              onChange={(e) => setAutoRefresh(e.target.checked)}\n              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n            />\n            <span className=\"text-sm text-gray-700\">Auto-refresh</span>\n          </label>\n\n          <select\n            value={refreshInterval}\n            onChange={(e) => setRefreshInterval(parseInt(e.target.value))}\n            className=\"text-sm border border-gray-300 rounded px-2 py-1\"\n          >\n            <option value={10}>10s</option>\n            <option value={30}>30s</option>\n            <option value={60}>1m</option>\n            <option value={300}>5m</option>\n          </select>\n\n          <button\n            onClick={fetchServiceStatus}\n            disabled={refreshing}\n            className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n          >\n            <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\n            <span>Refresh</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n          <div className=\"flex items-center\">\n            <XCircle className=\"w-5 h-5 text-red-500 mr-2\" />\n            <span className=\"text-red-700\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      {/* Metrics Cards */}\n      {metrics && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Services</p>\n                <p className=\"text-2xl font-bold text-gray-900\">{metrics.total_services}</p>\n              </div>\n              <Server className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Active Services</p>\n                <p className=\"text-2xl font-bold text-green-600\">{metrics.active_services}</p>\n              </div>\n              <Wifi className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Error Services</p>\n                <p className=\"text-2xl font-bold text-red-600\">{metrics.error_services}</p>\n              </div>\n              <WifiOff className=\"w-8 h-8 text-red-500\" />\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Uptime</p>\n                <p className=\"text-2xl font-bold text-blue-600\">{metrics.uptime_percentage}%</p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Service Status Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {services.map((service) => (\n          <div\n            key={service.service_id}\n            className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\"\n          >\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                {getServiceTypeIcon(service.service_type)}\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{service.service_name}</h3>\n                  <p className=\"text-sm text-gray-600 capitalize\">{service.service_type}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                {getStatusIcon(service)}\n                <span className={`text-sm px-2 py-1 rounded ${\n                  service.status === 'active' && service.last_test_success\n                    ? 'bg-green-100 text-green-800'\n                    : service.status === 'error' || service.last_test_success === false\n                    ? 'bg-red-100 text-red-800'\n                    : !service.enabled\n                    ? 'bg-gray-100 text-gray-800'\n                    : 'bg-yellow-100 text-yellow-800'\n                }`}>\n                  {!service.enabled\n                    ? 'Disabled'\n                    : service.status === 'active' && service.last_test_success\n                    ? 'Online'\n                    : service.status === 'error' || service.last_test_success === false\n                    ? 'Offline'\n                    : 'Unknown'\n                  }\n                </span>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">URL:</span>\n                <span className=\"font-mono text-gray-900\">\n                  {service.base_url}{service.port ? `:${service.port}` : ''}\n                </span>\n              </div>\n\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Response Time:</span>\n                <span className=\"font-medium\">\n                  {formatResponseTime(service.response_time_ms)}\n                </span>\n              </div>\n\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Last Test:</span>\n                <span className=\"font-medium\">\n                  {formatLastTest(service.last_test_at)}\n                </span>\n              </div>\n\n              {service.last_error && (\n                <div className=\"mt-2 p-2 bg-red-50 rounded text-red-600 text-sm\">\n                  {service.last_error}\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {services.length === 0 && !loading && (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\n          <Server className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Services Found</h3>\n          <p className=\"text-gray-600\">Configure services first to see their status here.</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ServiceStatusDashboard;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ServiceStatus/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/ServiceTestModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/SystemMetrics/MetricsCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[134,137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[134,137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { FC } from 'react';\n\ninterface MetricsCardProps {\n  title: string;\n  value: string | number;\n  unit?: string;\n  icon: FC<any>;\n  trend?: 'up' | 'down' | 'stable';\n  trendValue?: string;\n  color?: 'primary' | 'success' | 'warning' | 'danger';\n  loading?: boolean;\n}\n\nconst colorClasses = {\n  primary: 'text-primary-600 bg-primary-100',\n  success: 'text-success-600 bg-success-100',\n  warning: 'text-warning-600 bg-warning-100',\n  danger: 'text-danger-600 bg-danger-100',\n};\n\nconst trendClasses = {\n  up: 'text-success-600',\n  down: 'text-danger-600',\n  stable: 'text-gray-500',\n};\n\nexport default function MetricsCard({\n  title,\n  value,\n  unit = '',\n  icon: Icon,\n  trend,\n  trendValue,\n  color = 'primary',\n  loading = false,\n}: MetricsCardProps) {\n  if (loading) {\n    return (\n      <div className=\"card\">\n        <div className=\"card-body\">\n          <div className=\"animate-pulse\">\n            <div className=\"flex items-center\">\n              <div className=\"h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-lg\"></div>\n              <div className=\"ml-3 flex-1\">\n                <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20\"></div>\n                <div className=\"mt-2 h-6 bg-gray-200 dark:bg-gray-700 rounded w-16\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"card animate-fade-in hover-lift\">\n      <div className=\"card-body\">\n        <div className=\"flex items-center\">\n          <div className={`p-2 rounded-lg transition-colors duration-200 ${colorClasses[color]}`}>\n            <Icon className=\"h-6 w-6\" />\n          </div>\n          <div className=\"ml-3 flex-1 min-w-0\">\n            <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400 truncate\">{title}</p>\n            <div className=\"flex items-baseline space-x-2 flex-wrap\">\n              <p className=\"text-xl sm:text-2xl font-semibold text-gray-900 dark:text-white\">\n                {value}\n                {unit && <span className=\"text-base sm:text-lg text-gray-500 dark:text-gray-400\">{unit}</span>}\n              </p>\n              {trend && trendValue && (\n                <span className={`text-xs sm:text-sm transition-colors duration-200 ${trendClasses[trend]}`}>\n                  {trend === 'up' ? '↗' : trend === 'down' ? '↘' : '→'}\n                  <span className=\"hidden sm:inline ml-1\">{trendValue}</span>\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/SystemMetrics/MetricsGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Training/SessionDetailsModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Training/SessionDetailsModal.tsx:261:7\n  259 |   useEffect(() => {\n  260 |     if (isOpen && sessionId) {\n> 261 |       setLoading(true);\n      |       ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  262 |       setError(null);\n  263 |       apiClient\n  264 |         .get<SessionSummary>(`/api/training/sessions/${sessionId}/summary`)","line":261,"column":7,"nodeType":null,"endLine":261,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Session Details Modal - Displays comprehensive training session summary\n */\n\nimport { useState, useEffect } from 'react';\nimport { apiClient } from '../../lib/api';\n\ninterface LossDataPoint {\n  step: number;\n  loss: number;\n}\n\ninterface SessionSummary {\n  session_id: string;\n  name: string;\n  status: string;\n  base_model: string;\n  output_model: string | null;\n  training_backend: string;\n  started_at: string | null;\n  completed_at: string | null;\n  duration_seconds: number | null;\n  duration_formatted: string;\n  total_epochs: number;\n  total_steps: number;\n  final_step: number;\n  progress_percent: number;\n  dataset_size: number;\n  final_loss: number | null;\n  final_learning_rate: number | null;\n  error_message: string | null;\n  prompts_count: number;\n  prompts: Array<{ id: string; name: string; category: string }>;\n  hyperparameters: Record<string, unknown>;\n  metrics_analysis: {\n    total_metrics_points?: number;\n    initial_loss?: number;\n    final_loss?: number;\n    min_loss?: number;\n    max_loss?: number;\n    avg_loss?: number;\n    loss_improvement?: number;\n    loss_improvement_percent?: number;\n    trend?: string;\n  };\n  assessment: {\n    health: string;\n    message: string;\n    icon: string;\n  };\n  loss_history?: LossDataPoint[];\n}\n\ninterface SessionDetailsModalProps {\n  sessionId: string | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\n// Status badge colors\nfunction getStatusColor(status: string): string {\n  switch (status) {\n    case 'completed':\n      return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400';\n    case 'failed':\n      return 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400';\n    case 'running':\n    case 'preparing':\n      return 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400';\n    case 'cancelled':\n      return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';\n    case 'pending':\n      return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400';\n    default:\n      return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';\n  }\n}\n\n// Health indicator colors\nfunction getHealthColor(health: string): string {\n  switch (health) {\n    case 'excellent':\n      return 'text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20';\n    case 'good':\n      return 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20';\n    case 'warning':\n      return 'text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20';\n    case 'critical':\n      return 'text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20';\n    default:\n      return 'text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800';\n  }\n}\n\nfunction formatDate(isoString: string | null): string {\n  if (!isoString) return '-';\n  const date = new Date(isoString);\n  return date.toLocaleString('fr-FR', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n}\n\nfunction formatNumber(num: number | null | undefined, decimals: number = 4): string {\n  if (num === null || num === undefined) return '-';\n  return num.toFixed(decimals);\n}\n\n// Simple SVG Line Chart for Loss Evolution\nfunction LossChart({ data }: { data: LossDataPoint[] }) {\n  if (!data || data.length < 2) {\n    return (\n      <div className=\"flex items-center justify-center h-32 text-gray-400 dark:text-gray-500 text-sm\">\n        Pas assez de donnees pour afficher le graphique\n      </div>\n    );\n  }\n\n  const width = 400;\n  const height = 120;\n  const padding = { top: 10, right: 10, bottom: 25, left: 45 };\n  const chartWidth = width - padding.left - padding.right;\n  const chartHeight = height - padding.top - padding.bottom;\n\n  // Get min/max values\n  const losses = data.map(d => d.loss);\n  const steps = data.map(d => d.step);\n  const minLoss = Math.min(...losses);\n  const maxLoss = Math.max(...losses);\n  const minStep = Math.min(...steps);\n  const maxStep = Math.max(...steps);\n\n  // Add padding to Y axis\n  const yPadding = (maxLoss - minLoss) * 0.1 || 0.1;\n  const yMin = Math.max(0, minLoss - yPadding);\n  const yMax = maxLoss + yPadding;\n\n  // Scale functions\n  const xScale = (step: number) =>\n    padding.left + ((step - minStep) / (maxStep - minStep || 1)) * chartWidth;\n  const yScale = (loss: number) =>\n    padding.top + chartHeight - ((loss - yMin) / (yMax - yMin || 1)) * chartHeight;\n\n  // Create path for the line\n  const pathData = data\n    .map((d, i) => `${i === 0 ? 'M' : 'L'} ${xScale(d.step)} ${yScale(d.loss)}`)\n    .join(' ');\n\n  // Y-axis labels (3 ticks)\n  const yTicks = [yMin, (yMin + yMax) / 2, yMax];\n\n  return (\n    <svg viewBox={`0 0 ${width} ${height}`} className=\"w-full h-auto\">\n      {/* Grid lines */}\n      {yTicks.map((tick, i) => (\n        <line\n          key={i}\n          x1={padding.left}\n          y1={yScale(tick)}\n          x2={width - padding.right}\n          y2={yScale(tick)}\n          stroke=\"currentColor\"\n          strokeOpacity={0.1}\n          strokeDasharray=\"2,2\"\n        />\n      ))}\n\n      {/* Y-axis labels */}\n      {yTicks.map((tick, i) => (\n        <text\n          key={i}\n          x={padding.left - 5}\n          y={yScale(tick)}\n          textAnchor=\"end\"\n          dominantBaseline=\"middle\"\n          className=\"fill-gray-500 dark:fill-gray-400\"\n          fontSize=\"9\"\n        >\n          {tick.toFixed(2)}\n        </text>\n      ))}\n\n      {/* X-axis labels */}\n      <text\n        x={padding.left}\n        y={height - 5}\n        textAnchor=\"start\"\n        className=\"fill-gray-500 dark:fill-gray-400\"\n        fontSize=\"9\"\n      >\n        {minStep}\n      </text>\n      <text\n        x={width - padding.right}\n        y={height - 5}\n        textAnchor=\"end\"\n        className=\"fill-gray-500 dark:fill-gray-400\"\n        fontSize=\"9\"\n      >\n        {maxStep}\n      </text>\n      <text\n        x={width / 2}\n        y={height - 5}\n        textAnchor=\"middle\"\n        className=\"fill-gray-400 dark:fill-gray-500\"\n        fontSize=\"9\"\n      >\n        Steps\n      </text>\n\n      {/* Line chart */}\n      <path\n        d={pathData}\n        fill=\"none\"\n        stroke=\"url(#lossGradient)\"\n        strokeWidth={2}\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n\n      {/* Gradient definition */}\n      <defs>\n        <linearGradient id=\"lossGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n          <stop offset=\"0%\" stopColor=\"#ef4444\" />\n          <stop offset=\"100%\" stopColor=\"#22c55e\" />\n        </linearGradient>\n      </defs>\n\n      {/* Start and end points */}\n      <circle\n        cx={xScale(data[0].step)}\n        cy={yScale(data[0].loss)}\n        r={3}\n        className=\"fill-red-500\"\n      />\n      <circle\n        cx={xScale(data[data.length - 1].step)}\n        cy={yScale(data[data.length - 1].loss)}\n        r={3}\n        className=\"fill-green-500\"\n      />\n    </svg>\n  );\n}\n\nexport default function SessionDetailsModal({\n  sessionId,\n  isOpen,\n  onClose,\n}: SessionDetailsModalProps) {\n  const [summary, setSummary] = useState<SessionSummary | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen && sessionId) {\n      setLoading(true);\n      setError(null);\n      apiClient\n        .get<SessionSummary>(`/api/training/sessions/${sessionId}/summary`)\n        .then((data) => {\n          setSummary(data);\n          setLoading(false);\n        })\n        .catch((err) => {\n          setError(err.message || 'Failed to load session details');\n          setLoading(false);\n        });\n    }\n  }, [isOpen, sessionId]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/50 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between px-6 py-4 border-b dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              Details de la session\n            </h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            >\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"px-6 py-4 overflow-y-auto max-h-[calc(90vh-120px)]\">\n            {loading && (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent\"></div>\n              </div>\n            )}\n\n            {error && (\n              <div className=\"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-lg\">\n                {error}\n              </div>\n            )}\n\n            {summary && !loading && (\n              <div className=\"space-y-6\">\n                {/* Assessment Banner */}\n                <div className={`p-4 rounded-lg ${getHealthColor(summary.assessment.health)}`}>\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-2xl\">{summary.assessment.icon}</span>\n                    <div>\n                      <p className=\"font-medium\">{summary.assessment.message}</p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Basic Info */}\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                      Nom\n                    </h3>\n                    <p className=\"text-gray-900 dark:text-white font-medium\">{summary.name}</p>\n                  </div>\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                      Status\n                    </h3>\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(summary.status)}`}>\n                      {summary.status}\n                    </span>\n                  </div>\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                      Modele de base\n                    </h3>\n                    <p className=\"text-gray-900 dark:text-white text-sm font-mono\">\n                      {summary.base_model}\n                    </p>\n                  </div>\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                      Modele de sortie\n                    </h3>\n                    <p className=\"text-gray-900 dark:text-white text-sm font-mono\">\n                      {summary.output_model || '-'}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Timing */}\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4\">\n                  <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">\n                    Timing\n                  </h3>\n                  <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Debut</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {formatDate(summary.started_at)}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Fin</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {formatDate(summary.completed_at)}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Duree</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {summary.duration_formatted}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Progress */}\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4\">\n                  <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">\n                    Progression\n                  </h3>\n                  <div className=\"grid grid-cols-4 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Epochs</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {summary.total_epochs}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Steps</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {summary.final_step} / {summary.total_steps}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Progres</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {summary.progress_percent.toFixed(1)}%\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500 dark:text-gray-400\">Prompts</p>\n                      <p className=\"text-gray-900 dark:text-white font-medium\">\n                        {summary.prompts_count}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Metrics */}\n                {summary.metrics_analysis && Object.keys(summary.metrics_analysis).length > 0 && (\n                  <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4\">\n                    <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">\n                      Metriques\n                    </h3>\n                    <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Loss initial</p>\n                        <p className=\"text-gray-900 dark:text-white font-mono\">\n                          {formatNumber(summary.metrics_analysis.initial_loss)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Loss final</p>\n                        <p className=\"text-gray-900 dark:text-white font-mono\">\n                          {formatNumber(summary.metrics_analysis.final_loss)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Amelioration</p>\n                        <p className={`font-mono font-medium ${\n                          (summary.metrics_analysis.loss_improvement_percent || 0) > 0\n                            ? 'text-green-600 dark:text-green-400'\n                            : (summary.metrics_analysis.loss_improvement_percent || 0) < 0\n                            ? 'text-red-600 dark:text-red-400'\n                            : 'text-gray-900 dark:text-white'\n                        }`}>\n                          {summary.metrics_analysis.loss_improvement_percent !== undefined\n                            ? `${summary.metrics_analysis.loss_improvement_percent > 0 ? '+' : ''}${summary.metrics_analysis.loss_improvement_percent.toFixed(1)}%`\n                            : '-'}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Loss min</p>\n                        <p className=\"text-gray-900 dark:text-white font-mono\">\n                          {formatNumber(summary.metrics_analysis.min_loss)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Loss max</p>\n                        <p className=\"text-gray-900 dark:text-white font-mono\">\n                          {formatNumber(summary.metrics_analysis.max_loss)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-500 dark:text-gray-400\">Tendance</p>\n                        <p className={`font-medium ${\n                          summary.metrics_analysis.trend === 'decreasing'\n                            ? 'text-green-600 dark:text-green-400'\n                            : summary.metrics_analysis.trend === 'increasing'\n                            ? 'text-red-600 dark:text-red-400'\n                            : 'text-gray-900 dark:text-white'\n                        }`}>\n                          {summary.metrics_analysis.trend === 'decreasing' && 'En baisse'}\n                          {summary.metrics_analysis.trend === 'increasing' && 'En hausse'}\n                          {summary.metrics_analysis.trend === 'stable' && 'Stable'}\n                          {!summary.metrics_analysis.trend && '-'}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Loss Evolution Chart */}\n                {summary.loss_history && summary.loss_history.length > 0 && (\n                  <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4\">\n                    <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">\n                      Evolution du Loss\n                    </h3>\n                    <LossChart data={summary.loss_history} />\n                  </div>\n                )}\n\n                {/* Error Message */}\n                {summary.error_message && (\n                  <div className=\"bg-red-50 dark:bg-red-900/20 rounded-lg p-4\">\n                    <h3 className=\"text-sm font-semibold text-red-700 dark:text-red-400 mb-2\">\n                      Erreur\n                    </h3>\n                    <p className=\"text-red-600 dark:text-red-300 text-sm font-mono whitespace-pre-wrap\">\n                      {summary.error_message}\n                    </p>\n                  </div>\n                )}\n\n                {/* Hyperparameters */}\n                {summary.hyperparameters && Object.keys(summary.hyperparameters).length > 0 && (\n                  <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4\">\n                    <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">\n                      Hyperparametres\n                    </h3>\n                    <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                      {Object.entries(summary.hyperparameters).map(([key, value]) => (\n                        <div key={key} className=\"flex justify-between\">\n                          <span className=\"text-gray-500 dark:text-gray-400\">{key}</span>\n                          <span className=\"text-gray-900 dark:text-white font-mono\">\n                            {typeof value === 'number' ? value.toFixed(6).replace(/\\.?0+$/, '') : String(value)}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-end px-6 py-4 border-t dark:border-gray-700\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n            >\n              Fermer\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Training/SessionLogsModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLogs'. Either include it or remove the dependency array.","line":75,"column":6,"nodeType":"ArrayExpression","endLine":75,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, sessionId, isSessionRunning, fetchLogs]","fix":{"range":[2487,2524],"text":"[isOpen, sessionId, isSessionRunning, fetchLogs]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLogs'. Either include it or remove the dependency array.","line":91,"column":6,"nodeType":"ArrayExpression","endLine":91,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, sessionId, autoRefresh, isSessionRunning, fetchLogs]","fix":{"range":[2988,3038],"text":"[isOpen, sessionId, autoRefresh, isSessionRunning, fetchLogs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Session Logs Modal - Displays training logs for a session\n */\n\nimport { useState, useEffect, useRef } from 'react';\nimport { apiClient } from '../../lib/api';\nimport { FileText, Download, RefreshCw, X, Radio } from 'lucide-react';\n\ninterface SessionLogsModalProps {\n  sessionId: string | null;\n  sessionName?: string;\n  sessionStatus?: string;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function SessionLogsModal({\n  sessionId,\n  sessionName,\n  sessionStatus,\n  isOpen,\n  onClose,\n}: SessionLogsModalProps) {\n  // Only allow live refresh for running/preparing sessions (status is lowercase from API)\n  const isSessionRunning = sessionStatus === 'running' || sessionStatus === 'preparing';\n  const [logs, setLogs] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [refreshing, setRefreshing] = useState(false); // Silent refresh indicator\n  const [error, setError] = useState<string | null>(null);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const logsEndRef = useRef<HTMLDivElement>(null);\n  const logsContainerRef = useRef<HTMLDivElement>(null);\n  const refreshIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const previousLogsLength = useRef<number>(0);\n\n  const fetchLogs = async (silent = false) => {\n    if (!sessionId) return;\n\n    // Only show full loading on initial load, not on silent refreshes\n    if (!silent) {\n      setLoading(true);\n    } else {\n      setRefreshing(true);\n    }\n    setError(null);\n\n    try {\n      const data = await apiClient.get<{ logs: string | null }>(`/api/training/sessions/${sessionId}/logs`);\n      // Only update if logs actually changed (compare length to avoid unnecessary re-renders)\n      const newLogsLength = data.logs?.length || 0;\n      if (newLogsLength !== previousLogsLength.current) {\n        previousLogsLength.current = newLogsLength;\n        setLogs(data.logs);\n      }\n    } catch (err: unknown) {\n      const error = err as { message?: string };\n      // Only show error on initial load, ignore errors during silent refresh\n      if (!silent) {\n        setError(error.message || 'Erreur lors du chargement des logs');\n      }\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen && sessionId) {\n      fetchLogs();\n    }\n    // Reset autoRefresh when modal opens - only enable for running sessions\n    if (isOpen) {\n      setAutoRefresh(isSessionRunning);\n    }\n  }, [isOpen, sessionId, isSessionRunning]);\n\n  // Auto-refresh logs every 3 seconds when enabled (only for running sessions)\n  useEffect(() => {\n    if (isOpen && sessionId && autoRefresh && isSessionRunning) {\n      refreshIntervalRef.current = setInterval(() => {\n        fetchLogs(true); // Silent refresh\n      }, 3000);\n    }\n\n    return () => {\n      if (refreshIntervalRef.current) {\n        clearInterval(refreshIntervalRef.current);\n        refreshIntervalRef.current = null;\n      }\n    };\n  }, [isOpen, sessionId, autoRefresh, isSessionRunning]);\n\n  // Auto-scroll to bottom when logs are loaded or updated\n  useEffect(() => {\n    if (logs && !loading && logsContainerRef.current) {\n      // Use setTimeout to ensure DOM is updated before scrolling\n      setTimeout(() => {\n        if (logsContainerRef.current) {\n          logsContainerRef.current.scrollTop = logsContainerRef.current.scrollHeight;\n        }\n      }, 50);\n    }\n  }, [logs, loading]);\n\n  const scrollToBottom = () => {\n    if (logsContainerRef.current) {\n      logsContainerRef.current.scrollTop = logsContainerRef.current.scrollHeight;\n    }\n  };\n\n  const downloadLogs = () => {\n    if (!logs) return;\n\n    const blob = new Blob([logs], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `training-logs-${sessionId}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/50 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between px-6 py-4 border-b dark:border-gray-700\">\n            <div className=\"flex items-center gap-3\">\n              <FileText className=\"w-5 h-5 text-gray-500\" />\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Logs de la session\n              </h2>\n              {sessionName && (\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  - {sessionName}\n                </span>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {/* Live toggle - only show for running sessions */}\n              {isSessionRunning && (\n                <button\n                  onClick={() => setAutoRefresh(!autoRefresh)}\n                  className={`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-colors ${\n                    autoRefresh\n                      ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'\n                  }`}\n                  title={autoRefresh ? 'Désactiver le rafraîchissement automatique' : 'Activer le rafraîchissement automatique'}\n                >\n                  <Radio className={`w-3.5 h-3.5 ${autoRefresh ? 'animate-pulse' : ''}`} />\n                  Live\n                </button>\n              )}\n              <button\n                onClick={() => fetchLogs(false)}\n                disabled={loading || refreshing}\n                className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-50\"\n                title=\"Rafraîchir\"\n              >\n                <RefreshCw className={`w-5 h-5 ${loading || refreshing ? 'animate-spin' : ''}`} />\n              </button>\n              {logs && (\n                <button\n                  onClick={downloadLogs}\n                  className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                  title=\"Télécharger\"\n                >\n                  <Download className=\"w-5 h-5\" />\n                </button>\n              )}\n              <button\n                onClick={onClose}\n                className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div ref={logsContainerRef} className=\"px-6 py-4 overflow-y-auto max-h-[calc(90vh-140px)]\">\n            {loading && (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent\"></div>\n              </div>\n            )}\n\n            {error && (\n              <div className=\"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-lg\">\n                {error}\n              </div>\n            )}\n\n            {!loading && !error && logs === null && (\n              <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n                <FileText className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p>Aucun log disponible pour cette session</p>\n                <p className=\"text-sm mt-2\">\n                  Les logs sont enregistrés à la fin de l'entraînement\n                </p>\n              </div>\n            )}\n\n            {!loading && !error && logs && (\n              <div className=\"bg-gray-900 dark:bg-black rounded-lg p-4 font-mono text-sm overflow-x-auto\">\n                <pre className=\"text-gray-100 whitespace-pre-wrap break-words\">\n                  {logs}\n                </pre>\n                <div ref={logsEndRef} />\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-between items-center px-6 py-4 border-t dark:border-gray-700\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {logs && `${logs.split('\\n').length} lignes`}\n            </div>\n            <div className=\"flex gap-2\">\n              {logs && (\n                <button\n                  onClick={scrollToBottom}\n                  className=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors\"\n                >\n                  Aller à la fin\n                </button>\n              )}\n              <button\n                onClick={onClose}\n                className=\"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n              >\n                Fermer\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Training/TrainingMetricsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Training/TrainingOverview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1518,1521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1518,1521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1591,1594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1591,1594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Training Overview - Dashboard-style overview for AI Training\n */\n\nimport { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport {\n  Brain,\n  Server,\n  Cpu,\n  Zap,\n  Play,\n  CheckCircle,\n  FileText,\n  TrendingDown,\n  TrendingUp,\n  Minus,\n  AlertCircle,\n  Activity,\n  Wifi,\n  WifiOff,\n  ExternalLink,\n  ChevronRight,\n  Download,\n  Settings,\n  Upload,\n  Loader2,\n} from 'lucide-react';\nimport { api } from '../../lib/api';\n\n// Types\ninterface Worker {\n  id: string;\n  name: string;\n  url: string;\n  status: 'online' | 'offline' | 'busy' | 'error';\n  enabled: boolean;\n  gpu_available: boolean;\n  gpu_names: string[];\n  gpu_memory_total_mb: number;\n  current_job_id: string | null;\n  current_session_id: string | null;\n  total_jobs_completed: number;\n  last_seen_at: string;\n}\n\ninterface TrainingStats {\n  total_sessions: number;\n  active_sessions: number;\n  completed_sessions: number;\n  failed_sessions: number;\n  total_prompts: number;\n  validated_prompts: number;\n  prompts_by_category: Record<string, number>;\n  recent_sessions: RecentSession[];\n}\n\ninterface TrainingPrompt {\n  id: string;\n  tags: string[];\n}\n\ninterface RecentSession {\n  id: string;\n  name: string;\n  status: string;\n  base_model: string;\n  training_type: string;\n  progress_percent: number;\n  loss?: number | null;\n  started_at?: string | null;\n  completed_at?: string | null;\n  dataset_size: number;\n}\n\ninterface OllamaStatus {\n  status: string;\n  version?: string;\n  url: string;\n  error?: string;\n  models: any[];\n  model_count: number;\n  total_size_gb: number;\n  running_models: any[];\n  running_count: number;\n}\n\ninterface ActiveSessionWithMetrics {\n  id: string;\n  name: string;\n  base_model: string;\n  training_type: string;\n  status?: string;\n  progress_percent: number;\n  current_epoch: number;\n  total_epochs: number;\n  current_step: number;\n  total_steps: number;\n  loss?: number;\n  learning_rate?: number;\n  started_at?: string;\n  _realtime_metrics?: {\n    phase?: string;\n    gpu?: {\n      gpu_name?: string;\n      memory_used_mb?: number;\n      memory_total_mb?: number;\n      memory_percent?: number;\n      utilization_percent?: number;\n      temperature_celsius?: number;\n      power_watts?: number;\n    };\n    time?: {\n      tokens_per_second?: number;\n      step_duration_ms?: number;\n    };\n    quality?: {\n      loss_trend?: string;\n      training_health?: string;\n      health_message?: string;\n    };\n    convergence?: {\n      best_loss?: number;\n    };\n  };\n}\n\ninterface TrainingOverviewProps {\n  stats: TrainingStats | null;\n  ollamaStatus: OllamaStatus | null;\n  activeSessions: ActiveSessionWithMetrics[];\n  wsConnected: boolean;\n  onViewLogs?: (id: string, name?: string, status?: string) => void;\n}\n\n// Stat card component - MCP style (compact)\nconst StatCard = ({\n  title,\n  value,\n  subtitle,\n  color = 'blue',\n}: {\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  color?: string;\n}) => {\n  const colorClasses: Record<string, string> = {\n    blue: 'text-blue-600 dark:text-blue-400',\n    green: 'text-green-600 dark:text-green-400',\n    purple: 'text-purple-600 dark:text-purple-400',\n    orange: 'text-orange-600 dark:text-orange-400',\n    red: 'text-red-600 dark:text-red-400',\n    yellow: 'text-yellow-600 dark:text-yellow-400',\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-2.5 sm:p-4 shadow\">\n      <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">{title}</p>\n      <p className={`text-lg sm:text-2xl font-bold ${colorClasses[color] || colorClasses.blue}`}>\n        {value}\n      </p>\n      {subtitle && (\n        <p className=\"text-[10px] sm:text-xs text-gray-400 dark:text-gray-500 mt-0.5 sm:mt-1 truncate\">{subtitle}</p>\n      )}\n    </div>\n  );\n};\n\n// Worker card component\nconst WorkerCard = ({ worker }: { worker: Worker }) => {\n  const statusColors = {\n    online: 'bg-green-500',\n    offline: 'bg-gray-400',\n    busy: 'bg-yellow-500',\n    error: 'bg-red-500',\n  };\n\n  const statusLabels = {\n    online: 'En ligne',\n    offline: 'Hors ligne',\n    busy: 'Occupe',\n    error: 'Erreur',\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className=\"flex items-center gap-3\">\n          <div className={`p-2 rounded-lg ${worker.gpu_available ? 'bg-orange-100 dark:bg-orange-900/30' : 'bg-gray-100 dark:bg-gray-700'}`}>\n            <Cpu className={`w-5 h-5 ${worker.gpu_available ? 'text-orange-600 dark:text-orange-400' : 'text-gray-500'}`} />\n          </div>\n          <div>\n            <h4 className=\"font-medium text-gray-900 dark:text-white\">{worker.name}</h4>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">{worker.url}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-1.5\">\n          <span className={`w-2 h-2 rounded-full ${statusColors[worker.status]}`} />\n          <span className=\"text-xs text-gray-500 dark:text-gray-400\">{statusLabels[worker.status]}</span>\n        </div>\n      </div>\n\n      {worker.gpu_available && worker.gpu_names.length > 0 && (\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 mb-3\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Zap className=\"w-4 h-4 text-orange-500\" />\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n              {worker.gpu_names[0]}\n            </span>\n          </div>\n          {worker.gpu_memory_total_mb > 0 && (\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {(worker.gpu_memory_total_mb / 1024).toFixed(1)} GB VRAM\n            </p>\n          )}\n        </div>\n      )}\n\n      <div className=\"flex items-center justify-between text-sm\">\n        <div className=\"flex items-center gap-1 text-gray-500 dark:text-gray-400\">\n          <CheckCircle className=\"w-4 h-4 text-green-500\" />\n          <span>{worker.total_jobs_completed} jobs</span>\n        </div>\n        {worker.current_job_id && (\n          <span className=\"text-xs px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full\">\n            En cours\n          </span>\n        )}\n      </div>\n    </div>\n  );\n};\n\n// Service colors for stacked bar\nconst SERVICE_COLORS: Record<string, { bg: string; text: string }> = {\n  homeassistant: { bg: 'bg-cyan-500', text: 'text-cyan-600 dark:text-cyan-400' },\n  ollama: { bg: 'bg-purple-500', text: 'text-purple-600 dark:text-purple-400' },\n  filesystem: { bg: 'bg-green-500', text: 'text-green-600 dark:text-green-400' },\n  docker: { bg: 'bg-blue-500', text: 'text-blue-600 dark:text-blue-400' },\n  git: { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n  memory: { bg: 'bg-pink-500', text: 'text-pink-600 dark:text-pink-400' },\n  browser: { bg: 'bg-yellow-500', text: 'text-yellow-600 dark:text-yellow-400' },\n  puppeteer: { bg: 'bg-indigo-500', text: 'text-indigo-600 dark:text-indigo-400' },\n  plex: { bg: 'bg-amber-500', text: 'text-amber-600 dark:text-amber-400' },\n  tautulli: { bg: 'bg-rose-500', text: 'text-rose-600 dark:text-rose-400' },\n  overseerr: { bg: 'bg-emerald-500', text: 'text-emerald-600 dark:text-emerald-400' },\n  radarr: { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n  sonarr: { bg: 'bg-sky-500', text: 'text-sky-600 dark:text-sky-400' },\n  prowlarr: { bg: 'bg-violet-500', text: 'text-violet-600 dark:text-violet-400' },\n  jackett: { bg: 'bg-fuchsia-500', text: 'text-fuchsia-600 dark:text-fuchsia-400' },\n  bazarr: { bg: 'bg-lime-500', text: 'text-lime-600 dark:text-lime-400' },\n  lidarr: { bg: 'bg-teal-500', text: 'text-teal-600 dark:text-teal-400' },\n  zammad: { bg: 'bg-red-500', text: 'text-red-600 dark:text-red-400' },\n  authentik: { bg: 'bg-orange-600', text: 'text-orange-700 dark:text-orange-400' },\n  proxmox: { bg: 'bg-slate-500', text: 'text-slate-600 dark:text-slate-400' },\n  system: { bg: 'bg-gray-500', text: 'text-gray-600 dark:text-gray-400' },\n  komga: { bg: 'bg-red-400', text: 'text-red-500 dark:text-red-400' },\n  romm: { bg: 'bg-blue-400', text: 'text-blue-500 dark:text-blue-400' },\n  deluge: { bg: 'bg-blue-600', text: 'text-blue-700 dark:text-blue-400' },\n  openwebui: { bg: 'bg-purple-400', text: 'text-purple-500 dark:text-purple-400' },\n};\n\nconst DEFAULT_COLORS = [\n  { bg: 'bg-blue-500', text: 'text-blue-600 dark:text-blue-400' },\n  { bg: 'bg-purple-500', text: 'text-purple-600 dark:text-purple-400' },\n  { bg: 'bg-green-500', text: 'text-green-600 dark:text-green-400' },\n  { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n  { bg: 'bg-pink-500', text: 'text-pink-600 dark:text-pink-400' },\n  { bg: 'bg-cyan-500', text: 'text-cyan-600 dark:text-cyan-400' },\n  { bg: 'bg-yellow-500', text: 'text-yellow-600 dark:text-yellow-400' },\n];\n\nconst getServiceColor = (serviceName: string, index: number) => {\n  const lowerName = serviceName.toLowerCase();\n  if (SERVICE_COLORS[lowerName]) {\n    return SERVICE_COLORS[lowerName];\n  }\n  return DEFAULT_COLORS[index % DEFAULT_COLORS.length];\n};\n\n// Horizontal stacked bar chart for prompts by service\nconst ServiceStackedBar = ({ data, total }: { data: Record<string, number>; total: number }) => {\n  const sortedServices = Object.entries(data).sort((a, b) => b[1] - a[1]);\n\n  if (sortedServices.length === 0) {\n    return (\n      <div className=\"text-center py-4 text-gray-500 dark:text-gray-400 text-sm\">\n        Aucune donnée\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {/* Stacked Bar */}\n      <div className=\"h-5 rounded-full overflow-hidden flex bg-gray-100 dark:bg-gray-700\">\n        {sortedServices.map(([serviceName, count], index) => {\n          const color = getServiceColor(serviceName, index);\n          const percentage = total > 0 ? (count / total) * 100 : 0;\n\n          return (\n            <div\n              key={serviceName}\n              className={`${color.bg} h-full transition-all duration-300 hover:opacity-80`}\n              style={{ width: `${percentage}%` }}\n              title={`${serviceName}: ${count} (${percentage.toFixed(1)}%)`}\n            />\n          );\n        })}\n      </div>\n\n      {/* Legend */}\n      <div className=\"flex flex-wrap gap-x-4 gap-y-1.5\">\n        {sortedServices.map(([serviceName, count], index) => {\n          const color = getServiceColor(serviceName, index);\n          const percentage = total > 0 ? (count / total) * 100 : 0;\n\n          return (\n            <div key={serviceName} className=\"flex items-center gap-1.5 text-xs\">\n              <span className={`w-2.5 h-2.5 rounded-full ${color.bg}`} />\n              <span className=\"text-gray-600 dark:text-gray-400 capitalize\">{serviceName}</span>\n              <span className=\"font-medium text-gray-900 dark:text-white\">{count}</span>\n              <span className=\"text-gray-400 dark:text-gray-500\">({percentage.toFixed(0)}%)</span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n// Sessions history mini chart\nconst SessionsHistoryChart = ({ sessions }: { sessions: RecentSession[] }) => {\n  if (!sessions || sessions.length === 0) return null;\n\n  const maxLoss = Math.max(...sessions.filter(s => s.loss != null).map(s => s.loss!), 2);\n\n  return (\n    <div className=\"flex items-end gap-1 h-16\">\n      {sessions.slice(0, 10).reverse().map((session) => {\n        const height = session.loss != null ? Math.max((session.loss / maxLoss) * 100, 10) : 10;\n        const color = session.status === 'completed' ? 'bg-green-500' :\n                      session.status === 'failed' ? 'bg-red-500' : 'bg-yellow-500';\n        return (\n          <div\n            key={session.id}\n            className=\"flex-1 flex flex-col items-center justify-end\"\n            title={`${session.name}: Loss ${session.loss?.toFixed(4) || 'N/A'}`}\n          >\n            <div\n              className={`w-full ${color} rounded-t-sm transition-all hover:opacity-80`}\n              style={{ height: `${height}%` }}\n            />\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n// Pipeline steps configuration\nconst PIPELINE_STEPS = [\n  { id: 'preparing', label: 'Preparation', icon: Settings },\n  { id: 'downloading', label: 'Pull Model', icon: Download },\n  { id: 'training', label: 'Training', icon: Brain },\n  { id: 'exporting', label: 'Export GGUF', icon: FileText },\n  { id: 'importing', label: 'Import Ollama', icon: Upload },\n  { id: 'completed', label: 'Termine', icon: CheckCircle },\n];\n\n// Pipeline steps component\nconst PipelineSteps = ({ currentPhase }: { currentPhase?: string }) => {\n  const getStepStatus = (stepId: string): 'completed' | 'active' | 'pending' => {\n    if (!currentPhase) return 'pending';\n\n    const currentIndex = PIPELINE_STEPS.findIndex(s => s.id === currentPhase);\n    const stepIndex = PIPELINE_STEPS.findIndex(s => s.id === stepId);\n\n    if (currentPhase === 'completed' || currentPhase === 'failed') {\n      // All steps completed (or failed)\n      return currentPhase === 'completed' ? 'completed' : (stepIndex < currentIndex ? 'completed' : 'pending');\n    }\n\n    if (stepIndex < currentIndex) return 'completed';\n    if (stepIndex === currentIndex) return 'active';\n    return 'pending';\n  };\n\n  return (\n    <div className=\"flex items-center justify-between gap-1 mb-4\">\n      {PIPELINE_STEPS.map((step, index) => {\n        const status = getStepStatus(step.id);\n        const Icon = step.icon;\n        const isLast = index === PIPELINE_STEPS.length - 1;\n\n        return (\n          <div key={step.id} className=\"flex items-center flex-1\">\n            <div className=\"flex flex-col items-center\">\n              <div className={`\n                w-8 h-8 rounded-full flex items-center justify-center transition-all\n                ${status === 'completed' ? 'bg-green-500 text-white' : ''}\n                ${status === 'active' ? 'bg-purple-500 text-white ring-2 ring-purple-300 dark:ring-purple-700' : ''}\n                ${status === 'pending' ? 'bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500' : ''}\n              `}>\n                {status === 'active' ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ) : status === 'completed' ? (\n                  <CheckCircle className=\"w-4 h-4\" />\n                ) : (\n                  <Icon className=\"w-4 h-4\" />\n                )}\n              </div>\n              <span className={`\n                text-[10px] mt-1 text-center leading-tight whitespace-nowrap\n                ${status === 'active' ? 'text-purple-600 dark:text-purple-400 font-medium' : ''}\n                ${status === 'completed' ? 'text-green-600 dark:text-green-400' : ''}\n                ${status === 'pending' ? 'text-gray-400 dark:text-gray-500' : ''}\n              `}>\n                {step.label}\n              </span>\n            </div>\n            {!isLast && (\n              <div className={`\n                flex-1 h-0.5 mx-1 mb-4 transition-all\n                ${status === 'completed' ? 'bg-green-500' : 'bg-gray-200 dark:bg-gray-700'}\n              `} />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n// Loss trend indicator component\nconst LossTrendIndicator = ({ trend }: { trend?: string }) => {\n  if (!trend) return null;\n\n  const getTrendInfo = (trend: string) => {\n    switch (trend) {\n      case 'decreasing':\n      case 'decreasing_fast':\n        return { icon: TrendingDown, color: 'text-green-400', label: 'En baisse' };\n      case 'increasing':\n      case 'increasing_fast':\n        return { icon: TrendingUp, color: 'text-red-400', label: 'En hausse' };\n      case 'stable':\n      case 'plateauing':\n        return { icon: Minus, color: 'text-yellow-400', label: 'Stable' };\n      default:\n        return { icon: Minus, color: 'text-gray-400', label: '-' };\n    }\n  };\n\n  const { icon: Icon, color, label } = getTrendInfo(trend);\n\n  return (\n    <div className={`flex items-center gap-1 ${color}`}>\n      <Icon className=\"w-4 h-4\" />\n      <span className=\"text-xs\">{label}</span>\n    </div>\n  );\n};\n\n// Active training card\nconst ActiveTrainingCard = ({ session, onViewLogs }: { session: ActiveSessionWithMetrics; onViewLogs?: (id: string, name?: string, status?: string) => void }) => {\n  const formatDuration = (startedAt: string | undefined) => {\n    if (!startedAt) return '-';\n    const start = new Date(startedAt);\n    const now = new Date();\n    const diffMs = now.getTime() - start.getTime();\n    const hours = Math.floor(diffMs / (1000 * 60 * 60));\n    const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);\n    if (hours > 0) return `${hours}h ${minutes}m`;\n    if (minutes > 0) return `${minutes}m ${seconds}s`;\n    return `${seconds}s`;\n  };\n\n  const getLossColor = (loss: number | undefined) => {\n    if (loss === undefined) return 'text-gray-500';\n    if (loss < 0.5) return 'text-green-500';\n    if (loss < 1.0) return 'text-yellow-500';\n    if (loss < 2.0) return 'text-orange-500';\n    return 'text-red-500';\n  };\n\n  const lossTrend = session._realtime_metrics?.quality?.loss_trend;\n\n  // Health color for dark mode compatible display\n  const getHealthColorDark = (health: string | undefined) => {\n    switch (health) {\n      case 'excellent': return 'text-green-500';\n      case 'good': return 'text-blue-500';\n      case 'warning': return 'text-yellow-500';\n      case 'critical': return 'text-red-500';\n      default: return 'text-gray-500';\n    }\n  };\n\n  const currentPhase = session._realtime_metrics?.phase;\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <div>\n            <h4 className=\"font-semibold text-lg text-gray-900 dark:text-white\">{session.name}</h4>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">{session.base_model}</p>\n          </div>\n          {onViewLogs && (\n            <button\n              onClick={() => onViewLogs(session.id, session.name, session.status)}\n              className=\"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n              title=\"Voir les logs en direct\"\n            >\n              <FileText className=\"w-4 h-4\" />\n            </button>\n          )}\n        </div>\n        <div className=\"text-right\">\n          <p className=\"text-3xl font-bold text-purple-600 dark:text-purple-400\">{session.progress_percent.toFixed(1)}%</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">{formatDuration(session.started_at)}</p>\n        </div>\n      </div>\n\n      {/* Pipeline Steps */}\n      <PipelineSteps currentPhase={currentPhase} />\n\n      {/* Progress bar */}\n      <div className=\"mb-4\">\n        <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n          <div\n            className=\"bg-purple-500 h-2 rounded-full transition-all\"\n            style={{ width: `${Math.min(session.progress_percent, 100)}%` }}\n          />\n        </div>\n        <div className=\"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1\">\n          <span>Epoch {session.current_epoch}/{session.total_epochs}</span>\n          <span>Step {session.current_step}/{session.total_steps}</span>\n        </div>\n      </div>\n\n      {/* Metrics grid */}\n      <div className=\"grid grid-cols-4 gap-3\">\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-2 text-center\">\n          <div className=\"flex items-center justify-center gap-1\">\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Loss</p>\n            <LossTrendIndicator trend={lossTrend} />\n          </div>\n          <p className={`text-lg font-bold ${session.loss !== undefined ? getLossColor(session.loss) : 'text-gray-900 dark:text-white'}`}>\n            {session.loss?.toFixed(4) || '-'}\n          </p>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-2 text-center\">\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">LR</p>\n          <p className=\"text-lg font-bold text-gray-900 dark:text-white\">\n            {session.learning_rate ? session.learning_rate.toExponential(1) : '-'}\n          </p>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-2 text-center\">\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Vitesse</p>\n          <p className=\"text-lg font-bold text-gray-900 dark:text-white\">\n            {session._realtime_metrics?.time?.tokens_per_second?.toFixed(0) || '-'} tok/s\n          </p>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-2 text-center\">\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Sante</p>\n          <p className={`text-lg font-bold capitalize ${getHealthColorDark(session._realtime_metrics?.quality?.training_health)}`}>\n            {session._realtime_metrics?.quality?.training_health || '-'}\n          </p>\n        </div>\n      </div>\n\n      {/* GPU metrics - Always show */}\n      <div className=\"mt-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <Zap className=\"w-4 h-4 text-orange-500\" />\n          <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n            {session._realtime_metrics?.gpu?.gpu_name || 'GPU'}\n          </span>\n        </div>\n        <div className=\"grid grid-cols-4 gap-3 text-sm\">\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Utilisation</p>\n            <p className=\"font-medium text-gray-900 dark:text-white\">\n              {session._realtime_metrics?.gpu?.utilization_percent?.toFixed(0) ?? '-'}%\n            </p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">VRAM</p>\n            <p className=\"font-medium text-gray-900 dark:text-white\">\n              {session._realtime_metrics?.gpu?.memory_percent?.toFixed(0) ?? '-'}%\n            </p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Temp</p>\n            <p className={`font-medium ${\n              (session._realtime_metrics?.gpu?.temperature_celsius ?? 0) > 80 ? 'text-red-500' :\n              (session._realtime_metrics?.gpu?.temperature_celsius ?? 0) > 70 ? 'text-yellow-500' : 'text-gray-900 dark:text-white'\n            }`}>\n              {session._realtime_metrics?.gpu?.temperature_celsius ?? '-'}°C\n            </p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Power</p>\n            <p className=\"font-medium text-gray-900 dark:text-white\">\n              {session._realtime_metrics?.gpu?.power_watts?.toFixed(0) ?? '-'}W\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Main component\nexport default function TrainingOverview({\n  stats,\n  ollamaStatus,\n  activeSessions,\n  wsConnected,\n  onViewLogs,\n}: TrainingOverviewProps) {\n  const [workers, setWorkers] = useState<Worker[]>([]);\n  const [loadingWorkers, setLoadingWorkers] = useState(true);\n  const [promptsByService, setPromptsByService] = useState<Record<string, number>>({});\n  const [loadingPrompts, setLoadingPrompts] = useState(true);\n\n  useEffect(() => {\n    const fetchWorkers = async () => {\n      try {\n        const res = await api.workers.list();\n        setWorkers(res || []);\n      } catch (error) {\n        console.error('Failed to fetch workers:', error);\n      } finally {\n        setLoadingWorkers(false);\n      }\n    };\n    fetchWorkers();\n  }, []);\n\n  // Fetch prompts to calculate service distribution\n  useEffect(() => {\n    const fetchPrompts = async () => {\n      try {\n        const res = await api.training.prompts.list();\n        // API returns array directly, not {prompts: [...]}\n        const prompts = Array.isArray(res) ? res : (res?.prompts || []);\n\n        // Known service names to filter tags\n        const serviceNames = [\n          'prowlarr', 'radarr', 'sonarr', 'lidarr', 'readarr', 'bazarr',\n          'tautulli', 'overseerr', 'ombi', 'plex', 'jellyfin', 'emby',\n          'komga', 'zammad', 'system', 'ollama', 'homeassistant', 'unifi',\n          'proxmox', 'portainer', 'docker', 'traefik', 'nginx'\n        ];\n\n        // Count prompts by service tags (only count known services)\n        const serviceCount: Record<string, number> = {};\n        prompts.forEach((prompt: TrainingPrompt) => {\n          if (prompt.tags && Array.isArray(prompt.tags)) {\n            // Find the first tag that matches a known service\n            const serviceTags = prompt.tags.filter((tag: string) =>\n              serviceNames.includes(tag.toLowerCase())\n            );\n            // Count each service tag found\n            serviceTags.forEach((tag: string) => {\n              const normalizedTag = tag.toLowerCase();\n              serviceCount[normalizedTag] = (serviceCount[normalizedTag] || 0) + 1;\n            });\n          }\n        });\n\n        setPromptsByService(serviceCount);\n      } catch (error) {\n        console.error('Failed to fetch prompts:', error);\n      } finally {\n        setLoadingPrompts(false);\n      }\n    };\n    fetchPrompts();\n  }, []);\n\n  const successRate = stats?.total_sessions\n    ? ((stats.completed_sessions / stats.total_sessions) * 100).toFixed(0)\n    : '0';\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Active Training Sessions */}\n      {activeSessions.length > 0 && (\n        <div>\n          <div className=\"flex items-center justify-between mb-3\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Play className=\"w-5 h-5 text-green-500 animate-pulse\" />\n              Entrainement en cours\n            </h3>\n            <span className={`flex items-center gap-1 text-xs px-2 py-1 rounded-full ${\n              wsConnected ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300' :\n                           'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\n            }`}>\n              {wsConnected ? <Wifi className=\"w-3 h-3\" /> : <WifiOff className=\"w-3 h-3\" />}\n              {wsConnected ? 'Live' : 'Offline'}\n            </span>\n          </div>\n          <div className=\"space-y-4\">\n            {activeSessions.map((session) => (\n              <ActiveTrainingCard key={session.id} session={session} onViewLogs={onViewLogs} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Stats Row */}\n      <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Sessions\"\n          value={stats?.total_sessions || 0}\n          subtitle={`${stats?.active_sessions || 0} actives`}\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"Prompts\"\n          value={stats?.total_prompts || 0}\n          subtitle={`${stats?.validated_prompts || 0} valides`}\n          color=\"purple\"\n        />\n        <StatCard\n          title=\"Taux de succes\"\n          value={`${successRate}%`}\n          subtitle={`${stats?.completed_sessions || 0} completees`}\n          color={stats?.failed_sessions && stats.failed_sessions > 0 ? 'orange' : 'green'}\n        />\n        <StatCard\n          title=\"Workers\"\n          value={workers.filter(w => w.status === 'online').length}\n          subtitle={`${workers.length} configures`}\n          color=\"orange\"\n        />\n      </div>\n\n      {/* Workers and Ollama Row */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Workers */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Server className=\"w-5 h-5 text-orange-500\" />\n              Training Workers\n            </h3>\n            <Link\n              to=\"/training?tab=workers\"\n              className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\n            >\n              Gerer <ChevronRight className=\"w-4 h-4\" />\n            </Link>\n          </div>\n          {loadingWorkers ? (\n            <div className=\"space-y-3\">\n              {[1, 2].map(i => (\n                <div key={i} className=\"h-24 bg-gray-100 dark:bg-gray-700 rounded-lg animate-pulse\" />\n              ))}\n            </div>\n          ) : workers.length > 0 ? (\n            <div className=\"space-y-3\">\n              {workers.slice(0, 3).map((worker) => (\n                <WorkerCard key={worker.id} worker={worker} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              <Server className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n              <p>Aucun worker configure</p>\n              <Link to=\"/training?tab=workers\" className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block\">\n                Ajouter un worker\n              </Link>\n            </div>\n          )}\n        </div>\n\n        {/* Ollama Status */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Brain className=\"w-5 h-5 text-purple-500\" />\n              Ollama Server\n            </h3>\n            <span className={`px-2 py-1 text-xs rounded-full ${\n              ollamaStatus?.status === 'healthy'\n                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\n                : ollamaStatus?.status === 'not_configured'\n                ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\n                : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\n            }`}>\n              {ollamaStatus?.status === 'healthy' ? 'Connecte' :\n               ollamaStatus?.status === 'not_configured' ? 'Non configure' : 'Erreur'}\n            </span>\n          </div>\n\n          {ollamaStatus?.status === 'healthy' ? (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-3 gap-3\">\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{ollamaStatus.model_count}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Modeles</p>\n                </div>\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{ollamaStatus.total_size_gb.toFixed(1)}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">GB Total</p>\n                </div>\n                <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{ollamaStatus.running_count}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Actifs</p>\n                </div>\n              </div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                Version: {ollamaStatus.version} - {ollamaStatus.url}\n              </p>\n            </div>\n          ) : ollamaStatus?.status === 'not_configured' ? (\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0\" />\n                <div>\n                  <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">Ollama non configure</p>\n                  <Link\n                    to=\"/services\"\n                    className=\"inline-flex items-center gap-1 mt-2 text-sm text-yellow-700 dark:text-yellow-300 hover:underline\"\n                  >\n                    Configurer <ExternalLink className=\"w-3 h-3\" />\n                  </Link>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n              <p className=\"text-sm text-red-800 dark:text-red-200\">\n                {ollamaStatus?.error || 'Connexion echouee'}\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Prompts and Sessions Row */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Prompts by Service */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <FileText className=\"w-5 h-5 text-purple-500\" />\n              Prompts par service\n            </h3>\n            <Link\n              to=\"/training?tab=prompts\"\n              className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\n            >\n              Voir tout <ChevronRight className=\"w-4 h-4\" />\n            </Link>\n          </div>\n          {loadingPrompts ? (\n            <div className=\"space-y-3\">\n              {[1, 2, 3].map(i => (\n                <div key={i} className=\"h-8 bg-gray-100 dark:bg-gray-700 rounded animate-pulse\" />\n              ))}\n            </div>\n          ) : Object.keys(promptsByService).length > 0 ? (\n            <ServiceStackedBar data={promptsByService} total={Object.values(promptsByService).reduce((a, b) => a + b, 0)} />\n          ) : (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              <FileText className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n              <p>Aucun prompt</p>\n            </div>\n          )}\n        </div>\n\n        {/* Recent Sessions */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Activity className=\"w-5 h-5 text-blue-500\" />\n              Sessions recentes\n            </h3>\n            <Link\n              to=\"/training?tab=sessions\"\n              className=\"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\n            >\n              Voir tout <ChevronRight className=\"w-4 h-4\" />\n            </Link>\n          </div>\n\n          {stats?.recent_sessions && stats.recent_sessions.length > 0 ? (\n            <div className=\"space-y-4\">\n              {/* Mini chart */}\n              <div className=\"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">Evolution du Loss (10 dernieres)</p>\n                <SessionsHistoryChart sessions={stats.recent_sessions} />\n              </div>\n\n              {/* List */}\n              <div className=\"space-y-2\">\n                {stats.recent_sessions.slice(0, 4).map((session) => (\n                  <div\n                    key={session.id}\n                    className=\"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-900/50 rounded-lg\"\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-sm text-gray-900 dark:text-white truncate\">\n                        {session.name}\n                      </p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {session.dataset_size} prompts - Loss: {session.loss?.toFixed(4) || 'N/A'}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {['completed', 'failed', 'cancelled'].includes(session.status) && onViewLogs && (\n                        <button\n                          onClick={() => onViewLogs(session.id, session.name, session.status)}\n                          className=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n                          title=\"Voir les logs\"\n                        >\n                          <FileText className=\"w-4 h-4\" />\n                        </button>\n                      )}\n                      <span className={`px-2 py-0.5 text-xs rounded-full ${\n                        session.status === 'completed'\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\n                          : session.status === 'failed'\n                          ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\n                          : 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\n                      }`}>\n                        {session.status}\n                      </span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              <Activity className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n              <p>Aucune session</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/CentralizedUserDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[629,632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[629,632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCentralizedUser'. Either include it or remove the dependency array.","line":172,"column":6,"nodeType":"ArrayExpression","endLine":172,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [centralUserId, fetchCentralizedUser]","fix":{"range":[4688,4703],"text":"[centralUserId, fetchCentralizedUser]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  User,\n  Mail,\n  Users,\n  RefreshCw,\n  Shield,\n  Clock,\n  Database,\n  AlertCircle,\n  CheckCircle\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../../lib/api';\nimport { getServiceColor } from '../../lib/serviceColors';\n\ninterface CentralizedUserData {\n  central_user_id: string;\n  emails: string[];\n  usernames: string[];\n  display_names: string[];\n  primary_email: string;\n  primary_username: string;\n  primary_display_name: string;\n  service_data: Record<string, {\n    service_name: string;\n    service_type: string;\n    user_data: any;\n    updated_at: string;\n  }>;\n  active_services: string[];\n  service_count: number;\n  roles: Record<string, string>;\n  is_admin_anywhere: boolean;\n  last_updated: string;\n}\n\ninterface UserGroup {\n  id: string;\n  name: string;\n  description?: string;\n  color?: string;\n  icon?: string;\n  priority: number;\n}\n\ninterface CentralizedUserDashboardProps {\n  centralUserId?: string;\n  onUserSelect?: (userId: string) => void;\n}\n\nconst CentralizedUserDashboard: FC<CentralizedUserDashboardProps> = ({\n  centralUserId,\n  onUserSelect\n}) => {\n  const [userData, setUserData] = useState<CentralizedUserData | null>(null);\n  const [allUsers, setAllUsers] = useState<CentralizedUserData[]>([]);\n  const [userGroups, setUserGroups] = useState<UserGroup[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [syncing, setSyncing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedUser, setSelectedUser] = useState<string | null>(centralUserId || null);\n\n  const fetchUserGroups = async (userId: string) => {\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/groups/user/${encodeURIComponent(userId)}`);\n      if (response.ok) {\n        const data = await response.json();\n        setUserGroups(data.groups || []);\n      }\n    } catch (err) {\n      console.error('Error fetching user groups:', err);\n    }\n  };\n\n  const fetchCentralizedUser = async (userId: string, refresh = false) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const response = await fetch(\n        `${getApiBaseUrl()}/api/users/centralized/${userId}${refresh ? '?refresh=true' : ''}`\n      );\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error('User not found or has no active mappings');\n        }\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to fetch user data');\n      }\n\n      const data = await response.json();\n      setUserData(data);\n\n      // Also fetch user groups\n      await fetchUserGroups(userId);\n\n    } catch (err) {\n      console.error('Error fetching centralized user data:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch user data';\n      setError(errorMessage);\n      setUserData(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAllUsers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/centralized`);\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to fetch users');\n      }\n\n      const data = await response.json();\n      setAllUsers(data.users || []);\n\n    } catch (err) {\n      console.error('Error fetching all users:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch users';\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const syncUserMetadata = async (userId: string) => {\n    try {\n      setSyncing(true);\n      setError(null);\n\n      const response = await fetch(\n        `${getApiBaseUrl()}/api/users/centralized/${userId}/sync`,\n        { method: 'POST' }\n      );\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to sync user data');\n      }\n\n      const result = await response.json();\n      console.log('Sync result:', result);\n\n      // Refresh user data after sync\n      if (selectedUser) {\n        await fetchCentralizedUser(selectedUser, false);\n      }\n\n    } catch (err) {\n      console.error('Error syncing user data:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to sync user data';\n      setError(errorMessage);\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  useEffect(() => {\n    if (centralUserId) {\n      setSelectedUser(centralUserId);\n      fetchCentralizedUser(centralUserId);\n    } else {\n      fetchAllUsers();\n    }\n  }, [centralUserId]);\n\n  const handleUserSelect = (userId: string) => {\n    setSelectedUser(userId);\n    fetchCentralizedUser(userId);\n    onUserSelect?.(userId);\n  };\n\n\n  const formatDateTime = (dateStr: string) => {\n    return new Date(dateStr).toLocaleString();\n  };\n\n  if (loading && !userData && allUsers.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 sm:p-6\">\n        <div className=\"flex items-center justify-center\">\n          <RefreshCw className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-500 animate-spin mr-2 sm:mr-3\" />\n          <span className=\"text-sm sm:text-lg text-gray-600 dark:text-gray-400\">Chargement...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n          <div className=\"flex items-center space-x-3 min-w-0\">\n            <Database className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0\" />\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n                Données centralisées\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n                Vue unifiée de tous les services\n              </p>\n            </div>\n          </div>\n\n          {selectedUser && (\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={() => fetchCentralizedUser(selectedUser, true)}\n                disabled={loading}\n                className=\"flex items-center space-x-2 px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n              >\n                <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n                <span className=\"hidden sm:inline\">Actualiser</span>\n              </button>\n\n              <button\n                onClick={() => syncUserMetadata(selectedUser)}\n                disabled={syncing}\n                className=\"flex items-center space-x-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n              >\n                <Database className={`w-4 h-4 ${syncing ? 'animate-pulse' : ''}`} />\n                <span>{syncing ? 'Sync...' : 'Sync'}</span>\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n          <div className=\"flex items-center\">\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-2\" />\n            <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6\">\n        {/* User Selection Panel */}\n        {!centralUserId && (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4\">\n            <h4 className=\"font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4 text-sm sm:text-base\">Sélectionner</h4>\n            <div className=\"space-y-2 max-h-64 sm:max-h-96 overflow-y-auto\">\n              {allUsers.map((user) => (\n                <div\n                  key={user.central_user_id}\n                  onClick={() => handleUserSelect(user.central_user_id)}\n                  className={`p-2 sm:p-3 rounded-lg cursor-pointer transition-colors ${\n                    selectedUser === user.central_user_id\n                      ? 'bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700'\n                      : 'hover:bg-gray-50 dark:hover:bg-gray-700 border-transparent'\n                  } border`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"min-w-0\">\n                      <p className=\"font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate\">\n                        {user.primary_display_name || user.primary_username || user.central_user_id}\n                      </p>\n                      <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate\">{user.primary_email}</p>\n                      <div className=\"flex items-center space-x-2 mt-1\">\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">{user.service_count} services</span>\n                        {user.is_admin_anywhere && (\n                          <Shield className=\"w-3 h-3 text-red-500\" />\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* User Details Panel */}\n        {userData && (\n          <div className={`space-y-6 ${centralUserId ? 'lg:col-span-3' : 'lg:col-span-2'}`}>\n            {/* User Overview */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center\">\n                    <User className=\"w-8 h-8 text-blue-600\" />\n                  </div>\n                  <div>\n                    <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n                      {userData.primary_display_name || userData.primary_username || userData.central_user_id}\n                    </h2>\n                    <p className=\"text-gray-600 dark:text-gray-400\">{userData.primary_email}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <span className=\"text-sm text-gray-500 dark:text-gray-400\">ID: {userData.central_user_id}</span>\n                      {userData.is_admin_anywhere && (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400\">\n                          <Shield className=\"w-3 h-3 mr-1\" />\n                          Admin\n                        </span>\n                      )}\n                    </div>\n                    {/* Group Labels */}\n                    {userGroups.length > 0 && (\n                      <div className=\"flex flex-wrap items-center gap-1.5 mt-2\">\n                        {userGroups.map((group) => (\n                          <span\n                            key={group.id}\n                            className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium\"\n                            style={{\n                              backgroundColor: `${group.color || '#6366f1'}20`,\n                              color: group.color || '#6366f1',\n                              border: `1px solid ${group.color || '#6366f1'}40`\n                            }}\n                          >\n                            <Shield className=\"w-3 h-3 mr-1\" />\n                            {group.name}\n                          </span>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">Last Updated</p>\n                  <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {formatDateTime(userData.last_updated)}\n                  </p>\n                </div>\n              </div>\n\n              {/* Summary Stats */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                  <Users className=\"w-6 h-6 text-blue-600 mx-auto mb-1\" />\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">Services</p>\n                  <p className=\"text-xl font-bold text-blue-600\">{userData.service_count}</p>\n                </div>\n\n                <div className=\"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                  <Mail className=\"w-6 h-6 text-green-600 mx-auto mb-1\" />\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">Emails</p>\n                  <p className=\"text-xl font-bold text-green-600\">{userData.emails.length}</p>\n                </div>\n\n                <div className=\"text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n                  <User className=\"w-6 h-6 text-purple-600 mx-auto mb-1\" />\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">Usernames</p>\n                  <p className=\"text-xl font-bold text-purple-600\">{userData.usernames.length}</p>\n                </div>\n\n                <div className=\"text-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\n                  <Shield className=\"w-6 h-6 text-orange-600 mx-auto mb-1\" />\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">Admin Access</p>\n                  <p className=\"text-xl font-bold text-orange-600\">\n                    {Object.values(userData.roles).filter(r => r === 'admin').length}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* All Emails & Usernames */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\n                <h4 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center\">\n                  <Mail className=\"w-4 h-4 mr-2 text-green-600\" />\n                  All Emails ({userData.emails.length})\n                </h4>\n                <div className=\"space-y-2\">\n                  {userData.emails.map((email, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800/50 rounded\">\n                      <span className=\"text-sm text-gray-900 dark:text-white\">{email}</span>\n                      {email === userData.primary_email && (\n                        <span className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-2 py-1 rounded\">Primary</span>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\n                <h4 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center\">\n                  <User className=\"w-4 h-4 mr-2 text-purple-600\" />\n                  All Usernames ({userData.usernames.length})\n                </h4>\n                <div className=\"space-y-2\">\n                  {userData.usernames.map((username, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800/50 rounded\">\n                      <span className=\"text-sm text-gray-900 dark:text-white\">{username}</span>\n                      {username === userData.primary_username && (\n                        <span className=\"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 px-2 py-1 rounded\">Primary</span>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            {/* Service Details */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\n                <Database className=\"w-4 h-4 mr-2 text-blue-600\" />\n                Service Details ({userData.service_count})\n              </h4>\n              <div className=\"space-y-4\">\n                {Object.entries(userData.service_data).map(([serviceId, serviceInfo]) => (\n                  <div key={serviceId} className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className={`w-3 h-3 rounded-full ${getServiceColor(serviceInfo.service_type).dot}`}></div>\n                        <div>\n                          <h5 className=\"font-medium text-gray-900 dark:text-white\">{serviceInfo.service_name}</h5>\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400 capitalize\">{serviceInfo.service_type}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${\n                          userData.roles[serviceId] === 'admin'\n                            ? 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400'\n                            : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300'\n                        }`}>\n                          {userData.roles[serviceId] === 'admin' && <Shield className=\"w-3 h-3 mr-1\" />}\n                          {userData.roles[serviceId]}\n                        </span>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                          {formatDateTime(serviceInfo.updated_at)}\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm\">\n                      <div>\n                        <span className=\"text-gray-600 dark:text-gray-400\">User ID:</span>\n                        <p className=\"font-medium text-gray-900 dark:text-white\">{serviceInfo.user_data.user_id || 'N/A'}</p>\n                      </div>\n                      <div>\n                        <span className=\"text-gray-600 dark:text-gray-400\">Username:</span>\n                        <p className=\"font-medium text-gray-900 dark:text-white\">{serviceInfo.user_data.username || 'N/A'}</p>\n                      </div>\n                      <div>\n                        <span className=\"text-gray-600 dark:text-gray-400\">Email:</span>\n                        <p className=\"font-medium text-gray-900 dark:text-white\">{serviceInfo.user_data.email || 'N/A'}</p>\n                      </div>\n                    </div>\n\n                    {serviceInfo.user_data.fresh_data && (\n                      <div className=\"mt-3 p-3 bg-green-50 dark:bg-green-900/20 rounded\">\n                        <div className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                          <span className=\"text-sm text-green-700 dark:text-green-400\">Fresh data available from service</span>\n                          <Clock className=\"w-3 h-3 text-green-600\" />\n                          <span className=\"text-xs text-green-600 dark:text-green-400\">\n                            {formatDateTime(serviceInfo.user_data.last_fetched)}\n                          </span>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CentralizedUserDashboard;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/UserMappingCreator.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[550,553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[550,553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  Search,\n  Link,\n  CheckCircle,\n  XCircle,\n  RefreshCw,\n  User\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../../lib/api';\nimport { getServiceColor } from '../../lib/serviceColors';\n\ninterface ServiceUser {\n  id?: string;\n  user_id?: string;\n  username?: string;\n  login?: string;\n  email?: string;\n  name?: string;\n  friendly_name?: string;\n  is_active?: boolean;\n  is_admin?: boolean;\n  is_superuser?: boolean;\n  is_staff?: boolean;\n  [key: string]: any;\n}\n\ninterface ServiceData {\n  service_name: string;\n  service_type: string;\n  base_url: string;\n  users: ServiceUser[];\n  user_count: number;\n  note?: string;\n  error?: string;\n}\n\ninterface EnumerationData {\n  services: Record<string, ServiceData>;\n  total_services: number;\n  successful_enumerations: number;\n  errors: string[];\n  enumerated_at: string;\n}\n\ninterface SelectedUser {\n  service_id: string;\n  service_name: string;\n  service_type: string;\n  user_id: string;\n  username: string;\n  email?: string;\n  role: string;\n  user_data: ServiceUser;\n}\n\n\ninterface UserMappingCreatorProps {\n  onMappingCreated?: () => void;\n}\n\nconst UserMappingCreator: FC<UserMappingCreatorProps> = ({\n  onMappingCreated\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [enumerationData, setEnumerationData] = useState<EnumerationData | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedServiceFilter, setSelectedServiceFilter] = useState<string>('all');\n  const [selectedUsers, setSelectedUsers] = useState<SelectedUser[]>([]);\n  const [creating, setCreating] = useState(false);\n  const [success, setSuccess] = useState<string | null>(null);\n  const [showUsernameModal, setShowUsernameModal] = useState(false);\n  const [selectedUsernameOption, setSelectedUsernameOption] = useState<string>('');\n  const [customUsernameInput, setCustomUsernameInput] = useState('');\n\n  const enumerateUsers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      console.log('🔍 Enumerating users from all services...');\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/enumerate-users`);\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to enumerate users');\n      }\n\n      const data = await response.json();\n      console.log('✅ User enumeration completed:', data);\n\n      setEnumerationData(data);\n\n    } catch (err) {\n      console.error('❌ User enumeration failed:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to enumerate users';\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    enumerateUsers();\n  }, []);\n\n  const getDisplayName = (user: ServiceUser): string => {\n    return user.username || user.login || user.name || user.friendly_name || user.email || 'Unknown User';\n  };\n\n  const getUserId = (user: ServiceUser): string => {\n    return user.id || user.user_id || user.username || user.login || 'unknown';\n  };\n\n  const toggleUserSelection = (serviceId: string, user: ServiceUser) => {\n    if (!enumerationData) return;\n\n    const serviceData = enumerationData.services[serviceId];\n    const selectedUser: SelectedUser = {\n      service_id: serviceId,\n      service_name: serviceData.service_name,\n      service_type: serviceData.service_type,\n      user_id: getUserId(user),\n      username: getDisplayName(user),\n      email: user.email,\n      role: user.is_admin || user.is_superuser ? 'admin' : 'user',\n      user_data: user\n    };\n\n    setSelectedUsers(prev => {\n      const isAlreadySelected = prev.some(\n        u => u.service_id === serviceId && u.user_id === selectedUser.user_id\n      );\n\n      if (isAlreadySelected) {\n        // Remove if already selected\n        return prev.filter(\n          u => !(u.service_id === serviceId && u.user_id === selectedUser.user_id)\n        );\n      } else {\n        // Add to selection\n        return [...prev, selectedUser];\n      }\n    });\n  };\n\n  const isUserSelected = (serviceId: string, user: ServiceUser): boolean => {\n    const userId = getUserId(user);\n    return selectedUsers.some(u => u.service_id === serviceId && u.user_id === userId);\n  };\n\n  const createMappingFromSelection = async () => {\n    if (selectedUsers.length === 0) {\n      setError('Please select at least one user');\n      return;\n    }\n\n    try {\n      setCreating(true);\n      setError(null);\n      setSuccess(null);\n\n      // Get primary email and username from selection\n      const allEmails = selectedUsers\n        .map(u => u.email)\n        .filter(email => email && email.trim() !== '');\n      const primaryEmail = allEmails.length > 0 ? allEmails[0] : null;\n\n      const allUsernames = selectedUsers\n        .map(u => u.username)\n        .filter(username => username && username.trim() !== '' && username !== 'Unknown User');\n\n      // Use the selected username from modal\n      let primaryUsername: string;\n      if (selectedUsernameOption === 'custom') {\n        primaryUsername = customUsernameInput.trim();\n      } else if (selectedUsernameOption && selectedUsernameOption !== 'auto') {\n        primaryUsername = selectedUsernameOption;\n      } else {\n        primaryUsername = allUsernames.length > 0 ? allUsernames[0] : '';\n      }\n\n      // Generate central_user_id like auto-detection: email > username > fallback\n      let centralUserId: string;\n      if (primaryEmail) {\n        centralUserId = primaryEmail.toLowerCase().trim();\n      } else if (primaryUsername) {\n        centralUserId = primaryUsername.toLowerCase().trim();\n      } else {\n        // Fallback: use first user's username or generate unique ID\n        const fallbackName = allUsernames[0] || `user_${Date.now()}`;\n        centralUserId = fallbackName.toLowerCase().trim();\n      }\n\n      // Ensure primaryUsername has a value\n      if (!primaryUsername) {\n        primaryUsername = centralUserId;\n      }\n\n      // Create all mappings directly\n      const results = [];\n      for (const user of selectedUsers) {\n        const mappingRequest = {\n          central_user_id: centralUserId,\n          central_username: primaryUsername,\n          central_email: primaryEmail,\n          service_config_id: user.service_id,\n          service_user_id: String(user.user_id),\n          service_username: String(user.username || user.user_id),\n          service_email: user.email || null,\n          role: user.role,\n          status: 'active',\n          sync_enabled: true,\n          service_metadata: {}\n        };\n\n        try {\n          const response = await fetch(`${getApiBaseUrl()}/api/users/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(mappingRequest),\n          });\n\n          if (response.ok) {\n            results.push({ success: true, user: user });\n          } else {\n            const errorData = await response.json();\n            console.error('❌ Mapping creation failed:', {\n              errorData,\n              detail: errorData.detail,\n              request: mappingRequest\n            });\n            const errorMessage = Array.isArray(errorData.detail)\n              ? errorData.detail.map((e: { loc?: string[]; msg: string }) => `${e.loc?.join('.')}: ${e.msg}`).join(', ')\n              : errorData.detail || 'Unknown error';\n            results.push({ success: false, user: user, error: errorMessage });\n          }\n        } catch (err) {\n          results.push({ success: false, user: user, error: (err as Error).message });\n        }\n      }\n\n      const successCount = results.filter(r => r.success).length;\n      const failCount = results.filter(r => !r.success).length;\n\n      if (successCount > 0) {\n        setSuccess(`Successfully created ${successCount} mapping${successCount > 1 ? 's' : ''} for user \"${primaryUsername}\"`);\n        // Clear selection\n        setSelectedUsers([]);\n        resetUsernameModal();\n\n        // Trigger parent refresh if available\n        if (onMappingCreated) {\n          onMappingCreated();\n        }\n      }\n\n      if (failCount > 0) {\n        setError(`Failed to create ${failCount} mapping${failCount > 1 ? 's' : ''}`);\n      }\n\n    } catch (err) {\n      setError(`Failed to create mappings: ${(err as Error).message}`);\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  const clearSelection = () => {\n    setSelectedUsers([]);\n    resetUsernameModal();\n  };\n\n  const resetUsernameModal = () => {\n    setShowUsernameModal(false);\n    setSelectedUsernameOption('');\n    setCustomUsernameInput('');\n  };\n\n  // Get suggested username from selected users\n  const getSuggestedUsernames = () => {\n    const usernames = selectedUsers\n      .map(u => u.username)\n      .filter(username => username && username.trim() !== '' && username !== 'Unknown User');\n    return [...new Set(usernames)]; // Remove duplicates\n  };\n\n  const handleCreateMappingClick = () => {\n    if (selectedUsers.length === 0) {\n      setError('Please select at least one user');\n      return;\n    }\n\n    const suggestedUsernames = getSuggestedUsernames();\n    if (suggestedUsernames.length > 1) {\n      // Show modal to let user choose\n      setShowUsernameModal(true);\n    } else {\n      // Proceed directly with creation\n      createMappingFromSelection();\n    }\n  };\n\n  const proceedWithMappingCreation = () => {\n    setShowUsernameModal(false);\n    createMappingFromSelection();\n  };\n\n  // Removed removeMappingEntry and createMappings - no longer needed without pending mappings\n\n  /*const createMappings = async () => {\n    if (pendingMappings.length === 0) {\n      setError('No mappings to create');\n      return;\n    }\n\n    try {\n      setCreating(true);\n      setError(null);\n\n      const mappingRequests = [];\n\n      for (const userMapping of pendingMappings) {\n        // Get the primary email and username from all mappings for this central user\n        const allEmails = userMapping.mappings\n          .map(m => m.email)\n          .filter(email => email && email.trim() !== '');\n        const primaryEmail = allEmails.length > 0 ? allEmails[0] : null;\n\n        const allUsernames = userMapping.mappings\n          .map(m => m.username)\n          .filter(username => username && username.trim() !== '' && username !== 'Unknown User');\n        const primaryUsername = allUsernames.length > 0 ? allUsernames[0] : `user${userMapping.central_user_id}`;\n\n        for (const mapping of userMapping.mappings) {\n          mappingRequests.push({\n            central_user_id: userMapping.central_user_id,\n            central_username: primaryUsername,\n            central_email: primaryEmail,\n            service_config_id: mapping.service_id,\n            service_user_id: mapping.user_id,\n            service_username: mapping.username,\n            service_email: mapping.email,\n            role: mapping.role,\n            status: 'active',\n            sync_enabled: true\n          });\n        }\n      }\n\n      console.log('🔄 Creating mappings:', mappingRequests);\n\n      const results = [];\n      for (const mappingRequest of mappingRequests) {\n        try {\n          const response = await fetch(`${getApiBaseUrl()}/api/users/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(mappingRequest),\n          });\n\n          if (response.ok) {\n            results.push({ success: true, mapping: mappingRequest });\n          } else {\n            const errorData = await response.json();\n            console.error('❌ Mapping creation failed:', {\n              status: response.status,\n              errorData,\n              requestData: mappingRequest\n            });\n            results.push({\n              success: false,\n              mapping: mappingRequest,\n              error: errorData.detail || `HTTP ${response.status}: ${JSON.stringify(errorData)}`\n            });\n          }\n        } catch (err) {\n          results.push({\n            success: false,\n            mapping: mappingRequest,\n            error: err instanceof Error ? err.message : 'Unknown error'\n          });\n        }\n      }\n\n      const successful = results.filter(r => r.success).length;\n      const failed = results.filter(r => !r.success).length;\n\n      console.log('✅ Mappings created:', { successful, failed, results });\n\n      if (successful > 0) {\n        setPendingMappings([]);\n        onMappingCreated?.();\n        alert(`Successfully created ${successful} user mappings!${failed > 0 ? ` (${failed} failed)` : ''}`);\n      } else {\n        const failedResults = results.filter(r => !r.success);\n        const errorDetails = failedResults.map(r => r.error).join('; ');\n        setError(`Failed to create mappings: ${errorDetails}`);\n        console.error('❌ Failed mapping results:', failedResults);\n      }\n\n    } catch (err) {\n      console.error('❌ Failed to create mappings:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create mappings';\n      setError(errorMessage);\n    } finally {\n      setCreating(false);\n    }\n  };*/\n\n\n  const filteredServices = enumerationData ? Object.entries(enumerationData.services).filter(([serviceId, serviceData]) => {\n    const matchesSearch = !searchTerm ||\n      serviceData.service_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      serviceData.users.some(user =>\n        getDisplayName(user).toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (user.email && user.email.toLowerCase().includes(searchTerm.toLowerCase()))\n      );\n\n    const matchesService = selectedServiceFilter === 'all' || serviceId === selectedServiceFilter;\n\n    return matchesSearch && matchesService && serviceData.users.length > 0;\n  }) : [];\n\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 sm:p-6\">\n        <div className=\"flex items-center justify-center\">\n          <RefreshCw className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-500 animate-spin mr-2 sm:mr-3\" />\n          <span className=\"text-sm sm:text-lg text-gray-600 dark:text-gray-400\">Chargement des utilisateurs...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n          <div className=\"flex items-center space-x-3 min-w-0\">\n            <Link className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0\" />\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n                Mapping manuel\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n                Lier les comptes utilisateurs entre services\n              </p>\n            </div>\n          </div>\n\n          <button\n            onClick={enumerateUsers}\n            disabled={loading}\n            className=\"w-full sm:w-auto flex items-center justify-center space-x-2 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n          >\n            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n            <span>Actualiser</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 sm:p-4\">\n          <div className=\"flex items-center\">\n            <XCircle className=\"w-5 h-5 text-red-500 mr-2 flex-shrink-0\" />\n            <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      {/* Success Display */}\n      {success && (\n        <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 sm:p-4\">\n          <div className=\"flex items-center\">\n            <CheckCircle className=\"w-5 h-5 text-green-500 mr-2 flex-shrink-0\" />\n            <span className=\"text-sm text-green-700 dark:text-green-400\">{success}</span>\n          </div>\n        </div>\n      )}\n\n      {/* Selected Users Panel */}\n      {selectedUsers.length > 0 && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-blue-200 dark:border-blue-800 p-3 sm:p-4\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3 sm:mb-4\">\n            <h4 className=\"font-semibold text-gray-900 dark:text-white flex items-center text-sm sm:text-base\">\n              <User className=\"w-4 h-4 mr-2 text-blue-600\" />\n              Sélectionnés ({selectedUsers.length})\n            </h4>\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={clearSelection}\n                className=\"px-2 sm:px-3 py-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n              >\n                Effacer\n              </button>\n              <button\n                onClick={handleCreateMappingClick}\n                disabled={creating}\n                className=\"px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n              >\n                {creating ? 'Création...' : 'Créer'}\n              </button>\n            </div>\n          </div>\n\n          {/* Preview usernames and emails */}\n          <div className=\"mb-3 sm:mb-4 p-2 sm:p-3 bg-gray-50 dark:bg-gray-900 rounded-lg\">\n            <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2\">Aperçu - ID basé sur :</p>\n            <div className=\"flex flex-wrap gap-1.5 sm:gap-2\">\n              {selectedUsers.filter(u => u.email).length > 0 && (\n                <span className=\"px-2 py-0.5 sm:py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 rounded text-xs sm:text-sm truncate max-w-full\">\n                  {selectedUsers.find(u => u.email)?.email}\n                </span>\n              )}\n              {getSuggestedUsernames().slice(0, 3).map((username, index) => (\n                <span key={index} className=\"px-2 py-0.5 sm:py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400 rounded text-xs sm:text-sm\">\n                  {username}\n                </span>\n              ))}\n              {getSuggestedUsernames().length === 0 && !selectedUsers.some(u => u.email) && (\n                <span className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-500\">Aucun email/username</span>\n              )}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 max-h-40 overflow-y-auto\">\n            {selectedUsers.map((user, index) => (\n              <div key={index} className=\"flex items-center justify-between p-2 sm:p-3 bg-gray-50 dark:bg-gray-900 rounded-lg\">\n                <div className=\"flex items-center space-x-2 min-w-0\">\n                  <div className={`w-2 h-2 rounded-full flex-shrink-0 ${getServiceColor(user.service_type).dot}`}></div>\n                  <div className=\"min-w-0\">\n                    <p className=\"text-xs sm:text-sm font-medium text-gray-900 dark:text-white truncate\">{user.username}</p>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">{user.service_name}</p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => toggleUserSelection(user.service_id, user.user_data)}\n                  className=\"p-1 text-gray-600 dark:text-gray-400 hover:text-red-700 dark:hover:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors flex-shrink-0\"\n                >\n                  <XCircle className=\"w-4 h-4\" />\n                </button>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Filters */}\n      {enumerationData && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4\">\n          <div className=\"flex flex-col sm:flex-row gap-2 sm:gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Rechercher...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full pl-10 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              />\n            </div>\n\n            <select\n              value={selectedServiceFilter}\n              onChange={(e) => setSelectedServiceFilter(e.target.value)}\n              className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            >\n              <option value=\"all\">Tous les services</option>\n              {Object.entries(enumerationData.services).map(([serviceId, serviceData]) => (\n                <option key={serviceId} value={serviceId}>\n                  {serviceData.service_name} ({serviceData.user_count})\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      )}\n\n      {/* Services and Users */}\n      {enumerationData && (\n        <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-gray-900 dark:text-white text-sm sm:text-base\">Utilisateurs par service</h4>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4\">\n            {filteredServices.map(([serviceId, serviceData]) => (\n              <div key={serviceId} className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\n                <div className=\"p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className={`w-3 h-3 rounded-full flex-shrink-0 ${getServiceColor(serviceData.service_type).dot}`}></div>\n                    <div className=\"min-w-0\">\n                      <h3 className=\"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate\">{serviceData.service_name}</h3>\n                      <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">{serviceData.user_count} utilisateurs</p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"divide-y divide-gray-100 dark:divide-gray-700 max-h-60 sm:max-h-80 overflow-y-auto\">\n                  {serviceData.users\n                    .filter(user =>\n                      !searchTerm ||\n                      getDisplayName(user).toLowerCase().includes(searchTerm.toLowerCase()) ||\n                      (user.email && user.email.toLowerCase().includes(searchTerm.toLowerCase()))\n                    )\n                    .map((user, index) => {\n                      // Extract user details\n                      const userId = user.id || user.user_id || '-';\n                      const username = user.username || user.login || '-';\n                      const displayName = user.friendly_name || user.name || username;\n                      const email = user.email || '-';\n                      const lastActivity = user.last_seen || user.last_active || user.updated_at || user.last_login || null;\n\n                      // Format last activity\n                      const formatLastActivity = (timestamp: string | null) => {\n                        if (!timestamp) return null;\n                        try {\n                          const date = new Date(timestamp);\n                          const now = new Date();\n                          const diffMs = now.getTime() - date.getTime();\n                          const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n                          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n\n                          if (diffHours < 1) return 'Just now';\n                          if (diffHours < 24) return `${diffHours}h ago`;\n                          if (diffDays < 7) return `${diffDays}d ago`;\n                          return date.toLocaleDateString();\n                        } catch {\n                          return null;\n                        }\n                      };\n\n                      return (\n                        <div\n                          key={index}\n                          className={`p-2 sm:p-3 cursor-pointer transition-colors border-2 ${\n                            isUserSelected(serviceId, user)\n                              ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30'\n                              : 'bg-white dark:bg-gray-800 border-transparent hover:bg-gray-50 dark:hover:bg-gray-700'\n                          }`}\n                          onClick={() => toggleUserSelection(serviceId, user)}\n                        >\n                          <div className=\"flex items-start space-x-2 sm:space-x-3\">\n                            <User className=\"w-4 h-4 text-gray-500 dark:text-gray-400 mt-1 shrink-0\" />\n                            <div className=\"flex-1 min-w-0\">\n                              {/* Main display name */}\n                              <p className=\"font-medium text-gray-900 dark:text-white truncate text-sm\">{displayName}</p>\n\n                              {/* User details grid */}\n                              <div className=\"mt-1 grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs\">\n                                {/* ID */}\n                                <div className=\"flex items-center text-gray-500 dark:text-gray-400\">\n                                  <span className=\"text-gray-400 dark:text-gray-500 mr-1\">ID:</span>\n                                  <span className=\"font-mono truncate\">{String(userId).substring(0, 8)}{String(userId).length > 8 ? '..' : ''}</span>\n                                </div>\n\n                                {/* Username */}\n                                {username !== displayName && username !== '-' && (\n                                  <div className=\"flex items-center text-gray-500 dark:text-gray-400\">\n                                    <span className=\"text-gray-400 dark:text-gray-500 mr-1\">User:</span>\n                                    <span className=\"truncate\">{username}</span>\n                                  </div>\n                                )}\n\n                                {/* Email */}\n                                {email !== '-' && (\n                                  <div className=\"flex items-center text-gray-500 dark:text-gray-400 col-span-2\">\n                                    <span className=\"text-gray-400 dark:text-gray-500 mr-1\">Email:</span>\n                                    <span className=\"truncate\">{email}</span>\n                                  </div>\n                                )}\n\n                                {/* Last activity */}\n                                {formatLastActivity(lastActivity) && (\n                                  <div className=\"flex items-center text-gray-500 dark:text-gray-400\">\n                                    <span className=\"text-gray-400 dark:text-gray-500 mr-1\">Last:</span>\n                                    <span>{formatLastActivity(lastActivity)}</span>\n                                  </div>\n                                )}\n                              </div>\n\n                              {/* Role badges */}\n                              <div className=\"flex items-center flex-wrap gap-1 mt-1.5\">\n                                {(user.is_admin || user.is_superuser) && (\n                                  <span className=\"px-1.5 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded text-xs\">Admin</span>\n                                )}\n                                {user.is_staff && (\n                                  <span className=\"px-1.5 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded text-xs\">Staff</span>\n                                )}\n                                {user.is_active === false && (\n                                  <span className=\"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded text-xs\">Inactif</span>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                </div>\n              </div>\n            ))}\n            </div>\n        </div>\n      )}\n\n      {/* Enumeration Errors */}\n      {enumerationData?.errors && enumerationData.errors.length > 0 && (\n        <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 sm:p-4\">\n          <h4 className=\"font-medium text-yellow-800 dark:text-yellow-400 mb-2 text-sm\">Avertissements</h4>\n          <div className=\"space-y-1\">\n            {enumerationData.errors.map((error, index) => (\n              <p key={index} className=\"text-xs sm:text-sm text-yellow-700 dark:text-yellow-400\">{error}</p>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Username Selection Modal */}\n      {showUsernameModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 max-w-md w-full\">\n            <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4\">\n              Choisir le nom d'utilisateur\n            </h3>\n            <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-3 sm:mb-4\">\n              Plusieurs noms d'utilisateurs ont été trouvés. Choisissez celui à utiliser :\n            </p>\n\n            <div className=\"space-y-2 sm:space-y-3 mb-4 sm:mb-6 max-h-64 overflow-y-auto\">\n              {/* Auto-select first username */}\n              <label className=\"flex items-center space-x-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"username\"\n                  value=\"auto\"\n                  checked={selectedUsernameOption === 'auto'}\n                  onChange={(e) => setSelectedUsernameOption(e.target.value)}\n                  className=\"text-blue-600 focus:ring-blue-500\"\n                />\n                <div className=\"min-w-0\">\n                  <div className=\"font-medium text-gray-900 dark:text-white text-sm\">Auto</div>\n                  <div className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate\">\n                    {getSuggestedUsernames()[0] || 'auto-généré'}\n                  </div>\n                </div>\n              </label>\n\n              {/* Individual service usernames */}\n              {getSuggestedUsernames().map((username, index) => {\n                const serviceNames = selectedUsers\n                  .filter(u => u.username === username)\n                  .map(u => u.service_name)\n                  .join(', ');\n\n                return (\n                  <label key={index} className=\"flex items-center space-x-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      name=\"username\"\n                      value={username}\n                      checked={selectedUsernameOption === username}\n                      onChange={(e) => setSelectedUsernameOption(e.target.value)}\n                      className=\"text-blue-600 focus:ring-blue-500\"\n                    />\n                    <div className=\"min-w-0\">\n                      <div className=\"font-medium text-gray-900 dark:text-white text-sm truncate\">{username}</div>\n                      <div className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate\">De: {serviceNames}</div>\n                    </div>\n                  </label>\n                );\n              })}\n\n              {/* Custom username */}\n              <label className=\"flex items-center space-x-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"username\"\n                  value=\"custom\"\n                  checked={selectedUsernameOption === 'custom'}\n                  onChange={(e) => setSelectedUsernameOption(e.target.value)}\n                  className=\"text-blue-600 focus:ring-blue-500\"\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"font-medium text-gray-900 dark:text-white text-sm\">Personnalisé</div>\n                  {selectedUsernameOption === 'custom' && (\n                    <input\n                      type=\"text\"\n                      placeholder=\"Entrer un nom...\"\n                      value={customUsernameInput}\n                      onChange={(e) => setCustomUsernameInput(e.target.value)}\n                      className=\"mt-2 w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      autoFocus\n                    />\n                  )}\n                </div>\n              </label>\n            </div>\n\n            <div className=\"flex justify-end space-x-2 sm:space-x-3\">\n              <button\n                onClick={resetUsernameModal}\n                className=\"px-3 sm:px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n              >\n                Annuler\n              </button>\n              <button\n                onClick={proceedWithMappingCreation}\n                disabled={!selectedUsernameOption || (selectedUsernameOption === 'custom' && !customUsernameInput.trim())}\n                className=\"px-3 sm:px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n              >\n                Créer\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default UserMappingCreator;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/UserMappingDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[409,412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[409,412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport type { FC } from 'react';\nimport {\n  Users,\n  Search,\n  Link,\n  Shield\n} from 'lucide-react';\n\nimport UserMappingDetector from './UserMappingDetector';\nimport UserMappingList from './UserMappingList';\nimport UserMappingCreator from './UserMappingCreator';\nimport { GroupManagement } from '../Groups';\n\ninterface UserMappingDashboardProps {\n  onEditMapping?: (mapping: any) => void;\n}\n\nconst UserMappingDashboard: FC<UserMappingDashboardProps> = ({\n  onEditMapping\n}) => {\n  const [activeTab, setActiveTab] = useState<'detector' | 'manual' | 'list' | 'groups'>('detector');\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  const handleDetectionComplete = () => {\n    // Refresh the mappings list when detection completes\n    setRefreshTrigger(prev => prev + 1);\n    // Stay on detector tab to show results\n    // Only switch to list if there are actual suggestions\n  };\n\n  const handleMappingChange = () => {\n    // Refresh components when mappings are modified\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const tabs = [\n    {\n      id: 'detector' as const,\n      label: 'Auto',\n      labelFull: 'Auto-Détection',\n      icon: Search\n    },\n    {\n      id: 'manual' as const,\n      label: 'Manuel',\n      labelFull: 'Mapping Manuel',\n      icon: Link\n    },\n    {\n      id: 'list' as const,\n      label: 'Liste',\n      labelFull: 'Mappings',\n      icon: Users\n    },\n    {\n      id: 'groups' as const,\n      label: 'Groupes',\n      labelFull: 'Gestion des Groupes',\n      icon: Shield\n    }\n  ];\n\n  return (\n    <div className=\"p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Users className=\"w-6 h-6 sm:w-8 sm:h-8 text-blue-600\" />\n            Utilisateurs\n          </h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n            Gestion des mappings utilisateurs\n          </p>\n        </div>\n\n      </div>\n\n      {/* Tab Navigation - Compact horizontal pills */}\n      <div className=\"mb-4 sm:mb-6 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0\">\n        <nav className=\"flex gap-1.5 sm:gap-2 min-w-max sm:min-w-0 sm:flex-wrap\">\n          {tabs.map((tab) => {\n            const Icon = tab.icon;\n            const isActive = activeTab === tab.id;\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                title={tab.labelFull}\n                className={`flex items-center gap-1.5 py-1.5 px-2.5 sm:py-2 sm:px-3 rounded-full font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${\n                  isActive\n                    ? 'bg-blue-600 text-white shadow-sm'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n              >\n                <Icon className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                <span>{tab.label}</span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* Tab Content */}\n      <div className=\"space-y-6\">\n        {activeTab === 'manual' && (\n          <UserMappingCreator onMappingCreated={handleMappingChange} />\n        )}\n\n        {activeTab === 'detector' && (\n          <UserMappingDetector onDetectionComplete={handleDetectionComplete} />\n        )}\n\n        {activeTab === 'list' && (\n          <UserMappingList\n            key={refreshTrigger}\n            onEditMapping={onEditMapping}\n          />\n        )}\n\n        {activeTab === 'groups' && (\n          <GroupManagement />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserMappingDashboard;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/UserMappingDetector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[529,532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[529,532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3501,3504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3501,3504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3630,3633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3630,3633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11714,11717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11714,11717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  Search,\n  XCircle,\n  Activity,\n  Filter\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../../lib/api';\nimport { getServiceColor } from '../../lib/serviceColors';\n\ninterface UserSuggestion {\n  central_user_id: string;\n  service_config_id: string;\n  service_user_id?: string;\n  service_username?: string;\n  service_email?: string;\n  confidence_score: number;\n  matching_attributes: string[];\n  role: string;\n  metadata: Record<string, any>;\n}\n\ninterface DetectionResults {\n  total_services: number;\n  services_scanned: number;\n  total_suggestions: number;\n  suggestions: UserSuggestion[];\n  high_confidence_suggestions: UserSuggestion[];\n  medium_confidence_suggestions: UserSuggestion[];\n  low_confidence_suggestions: UserSuggestion[];\n  errors: string[];\n  service_combinations?: Array<{\n    service_1: string;\n    service_2: string;\n    suggestions_found: number;\n  }>;\n  started_at: string;\n  completed_at?: string;\n}\n\ninterface UserMappingDetectorProps {\n  onDetectionComplete?: (results: DetectionResults) => void;\n}\n\nconst UserMappingDetector: FC<UserMappingDetectorProps> = ({\n  onDetectionComplete\n}) => {\n  const [detecting, setDetecting] = useState(false);\n  const [results, setResults] = useState<DetectionResults | null>(null);\n  const [availableServices, setAvailableServices] = useState<any[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSuggestions, setSelectedSuggestions] = useState<Set<number>>(new Set());\n  const [confidenceFilter, setConfidenceFilter] = useState<'all' | 'high' | 'medium' | 'low'>('all');\n\n  useEffect(() => {\n    fetchAvailableServices();\n  }, []);\n\n  const fetchAvailableServices = async () => {\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/services/`);\n      const services = await response.json();\n\n      // Get all enabled services for display\n      const enabledServices = services.filter(\n        (service: any) => service.enabled\n      );\n      setAvailableServices(enabledServices);\n    } catch (err) {\n      console.error('Failed to fetch services:', err);\n      setError('Failed to load available services');\n    }\n  };\n\n  const startDetection = async () => {\n    if (availableServices.length < 2) {\n      setError('You need at least 2 enabled services to detect user mappings');\n      return;\n    }\n\n    setDetecting(true);\n    setResults(null);\n    setError(null);\n    setSelectedSuggestions(new Set());\n\n    try {\n      console.log('🔍 Starting automatic user mapping detection across all services...');\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/auto-detect-mappings`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Detection failed');\n      }\n\n      const detectionResults = await response.json();\n      console.log('✅ Detection completed:', detectionResults);\n\n      setResults(detectionResults);\n      onDetectionComplete?.(detectionResults);\n\n    } catch (err) {\n      console.error('❌ Detection failed:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error occurred';\n      setError(errorMessage);\n    } finally {\n      setDetecting(false);\n    }\n  };\n\n  // Toggle all suggestions for a user group\n  const toggleUserGroupSelection = (userGroup: any) => {\n    const newSelection = new Set(selectedSuggestions);\n    const groupIndices = userGroup.suggestions.map((suggestion: any) =>\n      results!.suggestions.indexOf(suggestion)\n    );\n\n    const allSelected = groupIndices.every((idx: number) => newSelection.has(idx));\n\n    if (allSelected) {\n      // Deselect all\n      groupIndices.forEach((idx: number) => newSelection.delete(idx));\n    } else {\n      // Select all\n      groupIndices.forEach((idx: number) => newSelection.add(idx));\n    }\n\n    setSelectedSuggestions(newSelection);\n  };\n\n  const selectAllByConfidence = (confidence: 'high' | 'medium' | 'low') => {\n    if (!results) return;\n\n    const suggestionsToSelect = results[`${confidence}_confidence_suggestions`] || [];\n    const newSelection = new Set(selectedSuggestions);\n\n    suggestionsToSelect.forEach((suggestion) => {\n      const globalIndex = results.suggestions.indexOf(suggestion);\n      if (globalIndex !== -1) {\n        newSelection.add(globalIndex);\n      }\n    });\n\n    setSelectedSuggestions(newSelection);\n  };\n\n  const createMappingsFromSelected = async () => {\n    if (!results || selectedSuggestions.size === 0) {\n      setError('Please select at least one suggestion to create mappings');\n      return;\n    }\n\n    try {\n      const selectedSuggestionsArray = Array.from(selectedSuggestions).map(\n        index => results.suggestions[index]\n      );\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/create-from-suggestions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          suggestions: selectedSuggestionsArray,\n          auto_approve_high_confidence: false\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to create mappings');\n      }\n\n      const createResults = await response.json();\n      console.log('✅ Mappings created:', createResults);\n\n      // Reset selection and show success\n      setSelectedSuggestions(new Set());\n      setError(null);\n\n      // Optionally refresh detection results\n      alert(`Successfully created ${createResults.created_mappings} user mappings!`);\n\n    } catch (err) {\n      console.error('❌ Failed to create mappings:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to create mappings';\n      setError(errorMessage);\n    }\n  };\n\n  const getConfidenceColor = (score: number) => {\n    if (score >= 0.9) return 'text-green-600 bg-green-100';\n    if (score >= 0.7) return 'text-yellow-600 bg-yellow-100';\n    return 'text-red-600 bg-red-100';\n  };\n\n  const getConfidenceBadge = (score: number) => {\n    if (score >= 0.9) return 'HIGH';\n    if (score >= 0.7) return 'MED';\n    return 'LOW';\n  };\n\n  const getFilteredSuggestions = () => {\n    if (!results) return [];\n\n    switch (confidenceFilter) {\n      case 'high':\n        return results.high_confidence_suggestions;\n      case 'medium':\n        return results.medium_confidence_suggestions;\n      case 'low':\n        return results.low_confidence_suggestions;\n      default:\n        return results.suggestions;\n    }\n  };\n\n  // Group suggestions by central user ID to show all services for each user\n  const getGroupedSuggestions = () => {\n    const suggestions = getFilteredSuggestions();\n    const grouped: Record<string, typeof suggestions> = {};\n\n    suggestions.forEach((suggestion) => {\n      const key = suggestion.central_user_id;\n      if (!grouped[key]) {\n        grouped[key] = [];\n      }\n      grouped[key].push(suggestion);\n    });\n\n    return Object.entries(grouped).map(([centralUserId, userSuggestions]) => ({\n      centralUserId,\n      suggestions: userSuggestions,\n      // Calculate average confidence for this user\n      avgConfidence: userSuggestions.reduce((sum, s) => sum + s.confidence_score, 0) / userSuggestions.length,\n      // Use the best suggestion for display purposes\n      mainSuggestion: userSuggestions.reduce((best, current) =>\n        current.confidence_score > best.confidence_score ? current : best\n      )\n    }));\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\n      <div className=\"p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n          <div className=\"flex items-center space-x-3 min-w-0\">\n            <Search className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0\" />\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n                Détection automatique\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n                Scanner les services pour détecter les mappings\n              </p>\n            </div>\n          </div>\n\n          <button\n            onClick={startDetection}\n            disabled={detecting || availableServices.length < 2}\n            className=\"w-full sm:w-auto flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm\"\n            title={availableServices.length < 2 ? 'Need at least 2 services' : 'Start detection'}\n          >\n            {detecting ? (\n              <Activity className=\"w-4 h-4 animate-pulse\" />\n            ) : (\n              <Search className=\"w-4 h-4\" />\n            )}\n            <span>{detecting ? 'Scan...' : 'Détecter'}</span>\n          </button>\n        </div>\n      </div>\n\n      <div className=\"p-3 sm:p-4\">\n        {/* Available Services Display - Compact */}\n        <div className=\"mb-3\">\n          <div className=\"flex items-center flex-wrap gap-2\">\n            <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Services ({availableServices.length}):</span>\n            {availableServices.length > 0 ? (\n              availableServices.map((service) => (\n                <span\n                  key={service.id}\n                  className=\"inline-flex items-center gap-1.5 px-2 py-0.5 text-xs font-medium rounded-full border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300\"\n                >\n                  <span className={`w-2 h-2 rounded-full flex-shrink-0 ${getServiceColor(service.service_type).dot}`}></span>\n                  {service.name}\n                </span>\n              ))\n            ) : (\n              <span className=\"text-xs text-gray-500 dark:text-gray-400 italic\">Aucun service configuré</span>\n            )}\n          </div>\n        </div>\n\n        {/* Error Display */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\">\n            <div className=\"flex items-center\">\n              <XCircle className=\"w-5 h-5 text-red-500 mr-2\" />\n              <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n            </div>\n          </div>\n        )}\n\n        {/* Detection Progress */}\n        {detecting && (\n          <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-center\">\n              <Activity className=\"w-5 h-5 text-blue-500 mr-2 animate-spin\" />\n              <span className=\"text-sm text-blue-700 dark:text-blue-400\">\n                Scan en cours des services configurés...\n              </span>\n            </div>\n          </div>\n        )}\n\n        {/* Detection Results */}\n        {results && (\n          <div className=\"space-y-3\">\n            {/* Confidence Filters */}\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n              <div className=\"flex items-center space-x-2\">\n                <Filter className=\"w-4 h-4 text-gray-500 dark:text-gray-400\" />\n                <select\n                  value={confidenceFilter}\n                  onChange={(e) => setConfidenceFilter(e.target.value as any)}\n                  className=\"px-2 py-1.5 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded\"\n                >\n                  <option value=\"all\">Tous ({results.total_suggestions})</option>\n                  <option value=\"high\">Haute ({results.high_confidence_suggestions.length})</option>\n                  <option value=\"medium\">Moyenne ({results.medium_confidence_suggestions.length})</option>\n                  <option value=\"low\">Basse ({results.low_confidence_suggestions.length})</option>\n                </select>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => selectAllByConfidence('high')}\n                  className=\"px-2 sm:px-3 py-1.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors\"\n                >\n                  Sélect. haute conf.\n                </button>\n                <button\n                  onClick={createMappingsFromSelected}\n                  disabled={selectedSuggestions.size === 0}\n                  className=\"px-3 py-1.5 text-xs sm:text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n                >\n                  Créer ({selectedSuggestions.size})\n                </button>\n              </div>\n            </div>\n\n            {/* Users List - Grouped by Central User */}\n            {getGroupedSuggestions().length > 0 ? (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 max-h-80 sm:max-h-96 overflow-y-auto\">\n                {getGroupedSuggestions().map((userGroup) => {\n                const groupIndices = userGroup.suggestions.map(suggestion =>\n                  results!.suggestions.indexOf(suggestion)\n                );\n                const allSelected = groupIndices.every(idx => selectedSuggestions.has(idx));\n                const someSelected = groupIndices.some(idx => selectedSuggestions.has(idx));\n\n                const mainSuggestion = userGroup.mainSuggestion;\n                const sourceUser = mainSuggestion.metadata?.source_user;\n                const targetUser = mainSuggestion.metadata?.target_user;\n                const displayEmail = targetUser?.email || mainSuggestion.service_email;\n\n                // Use the best display name available\n                const mainName = targetUser?.username || targetUser?.friendly_name ||\n                               sourceUser?.name || mainSuggestion.service_username ||\n                               userGroup.centralUserId;\n\n                return (\n                  <div\n                    key={userGroup.centralUserId}\n                    className={`p-3 border rounded-lg cursor-pointer transition-all duration-200 ${\n                      allSelected\n                        ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 shadow-sm'\n                        : someSelected\n                        ? 'border-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 shadow-sm'\n                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm bg-white dark:bg-gray-800'\n                    }`}\n                    onClick={() => toggleUserGroupSelection(userGroup)}\n                  >\n                    <div className=\"space-y-2\">\n                      {/* Header with checkbox and confidence */}\n                      <div className=\"flex items-start justify-between\">\n                        <input\n                          type=\"checkbox\"\n                          checked={allSelected}\n                          ref={(el) => {\n                            if (el) el.indeterminate = someSelected && !allSelected;\n                          }}\n                          onChange={() => toggleUserGroupSelection(userGroup)}\n                          className=\"mt-1 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500\"\n                        />\n                        <div className=\"flex items-center space-x-2\">\n                          <span className={`px-2 py-1 text-xs font-medium rounded ${getConfidenceColor(userGroup.avgConfidence)}`}>\n                            {getConfidenceBadge(userGroup.avgConfidence)} {Math.round(userGroup.avgConfidence * 100)}%\n                          </span>\n                          <span className=\"px-2 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded\">\n                            {userGroup.suggestions.length} services\n                          </span>\n                        </div>\n                      </div>\n\n                      {/* Main name and email */}\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-white text-base\">{mainName}</h3>\n                        {displayEmail && (\n                          <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\">{displayEmail}</span>\n                        )}\n                      </div>\n\n                      {/* Service details - show all services with user info */}\n                      <div className=\"space-y-2\">\n                        {userGroup.suggestions.map((suggestion, idx) => {\n                          const serviceType = suggestion.metadata?.target_service?.toLowerCase() || 'unknown';\n                          const colors = getServiceColor(serviceType);\n\n                          // Get user details from metadata\n                          const targetUser = suggestion.metadata?.target_user || {};\n                          const userId = targetUser.id || targetUser.user_id || suggestion.service_user_id || '-';\n                          const username = targetUser.username || targetUser.friendly_name || targetUser.name || suggestion.service_username || '-';\n                          const email = targetUser.email || suggestion.service_email || '-';\n\n                          return (\n                            <div key={idx} className={`p-2 border rounded ${colors.border} ${colors.bg}`}>\n                              <div className=\"flex items-center space-x-2 mb-1\">\n                                <div className={`w-2.5 h-2.5 ${colors.dot} rounded-full`}></div>\n                                <span className={`text-xs font-semibold capitalize ${colors.text}`}>{serviceType}</span>\n                              </div>\n                              <div className=\"grid grid-cols-3 gap-1 text-xs\">\n                                <div>\n                                  <span className=\"text-gray-500\">ID:</span>\n                                  <span className=\"ml-1 text-gray-800 font-mono\">{String(userId).substring(0, 12)}{String(userId).length > 12 ? '...' : ''}</span>\n                                </div>\n                                <div>\n                                  <span className=\"text-gray-500\">User:</span>\n                                  <span className=\"ml-1 text-gray-800\">{username}</span>\n                                </div>\n                                <div>\n                                  <span className=\"text-gray-500\">Email:</span>\n                                  <span className=\"ml-1 text-gray-800\">{email !== '-' ? email : <span className=\"text-gray-400\">-</span>}</span>\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n\n                      {/* Matching criteria badges - show all unique attributes */}\n                      <div className=\"flex flex-wrap gap-1\">\n                        {Array.from(new Set(userGroup.suggestions.flatMap(s => s.matching_attributes))).map((attr, idx) => (\n                          <span\n                            key={idx}\n                            className=\"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700\"\n                          >\n                            {attr === 'id_exact' && '🎯 Same ID'}\n                            {attr === 'username_exact' && '👤 Same Username'}\n                            {attr === 'email_exact' && '📧 Same Email'}\n                            {attr === 'friendly_name_exact' && '🏷️ Same Display Name'}\n                            {attr === 'username_friendly_match' && '🔗 Username/Name Match'}\n                            {attr === 'username_fuzzy' && '👤 Similar Username'}\n                            {attr === 'email_fuzzy' && '📧 Similar Email'}\n                            {attr === 'name_fuzzy' && '🏷️ Similar Name'}\n                          </span>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                );\n                })}\n              </div>\n            ) : (\n              <div className=\"text-center py-6 sm:py-8 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\n                <Search className=\"w-10 h-10 sm:w-12 sm:h-12 text-gray-400 mx-auto mb-3 sm:mb-4\" />\n                <h3 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2\">Aucun mapping détecté</h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3 sm:mb-4 px-4\">\n                  Aucun utilisateur avec des identifiants correspondants n'a été trouvé.\n                </p>\n                <p className=\"text-sm text-blue-600 dark:text-blue-400\">\n                  Créez des mappings manuellement via l'onglet \"Manual Mapping\".\n                </p>\n              </div>\n            )}\n\n            {/* Errors */}\n            {results.errors.length > 0 && (\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium text-gray-900 dark:text-white\">Erreurs de détection</h4>\n                {results.errors.map((error, index) => (\n                  <div key={index} className=\"p-2 bg-red-50 dark:bg-red-900/20 rounded text-red-700 dark:text-red-400 text-sm\">\n                    {error}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserMappingDetector;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/UserMappingList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[691,694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[691,694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1435,1438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1435,1438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMappings'. Either include it or remove the dependency array.","line":121,"column":6,"nodeType":"ArrayExpression","endLine":121,"endColumn":53,"suggestions":[{"desc":"Update the dependencies array to be: [page, statusFilter, serviceFilter, searchTerm, fetchMappings]","fix":{"range":[3268,3315],"text":"[page, statusFilter, serviceFilter, searchTerm, fetchMappings]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  Users,\n  Edit,\n  Trash2,\n  XCircle,\n  Search,\n  RefreshCw,\n  Plus,\n  Pause,\n  User,\n  Link\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../../lib/api';\nimport { getServiceColor } from '../../lib/serviceColors';\n\ninterface UserMapping {\n  id: string;\n  central_user_id: string;\n  service_config_id: string;\n  service_user_id?: string;\n  service_username?: string;\n  service_email?: string;\n  role: string;\n  status: string;\n  sync_enabled: boolean;\n  last_sync_at?: string;\n  last_sync_success?: boolean;\n  last_sync_error?: string;\n  sync_attempts: number;\n  service_metadata?: Record<string, any>;\n  created_at: string;\n  updated_at: string;\n  service_config?: {\n    id: string;\n    name: string;\n    service_type: string;\n    base_url: string;\n  };\n}\n\ninterface UserMappingListResponse {\n  mappings: UserMapping[];\n  total: number;\n  skip: number;\n  limit: number;\n}\n\ninterface GroupedUserMapping {\n  central_user_id: string;\n  central_username: string;\n  central_email?: string;\n  mappings: UserMapping[];\n  total_services: number;\n  active_services: number;\n  last_activity: string;\n}\n\ninterface ServiceUser {\n  id?: string;\n  user_id?: string;\n  username?: string;\n  login?: string;\n  email?: string;\n  name?: string;\n  friendly_name?: string;\n  is_active?: boolean;\n  is_admin?: boolean;\n  is_superuser?: boolean;\n  [key: string]: any;\n}\n\ninterface ServiceData {\n  service_name: string;\n  service_type: string;\n  base_url: string;\n  users: ServiceUser[];\n  user_count: number;\n  error?: string;\n}\n\ninterface EnumerationData {\n  services: Record<string, ServiceData>;\n  total_services: number;\n  successful_enumerations: number;\n  errors: string[];\n}\n\ninterface UserMappingListProps {\n  onEditMapping?: (mapping: UserMapping) => void;\n  onCreateMapping?: () => void;\n}\n\nconst UserMappingList: FC<UserMappingListProps> = ({\n  onEditMapping,\n  onCreateMapping\n}) => {\n  const [mappings, setMappings] = useState<UserMapping[]>([]);\n  const [groupedMappings, setGroupedMappings] = useState<GroupedUserMapping[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [serviceFilter, setServiceFilter] = useState<string>('all');\n  const [total, setTotal] = useState(0);\n  const [page, setPage] = useState(0);\n  const [limit] = useState(1000); // Maximum limit to get all mappings\n  const [editingUser, setEditingUser] = useState<GroupedUserMapping | null>(null);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editUsername, setEditUsername] = useState('');\n  const [enumerationData, setEnumerationData] = useState<EnumerationData | null>(null);\n  const [loadingEnumeration, setLoadingEnumeration] = useState(false);\n  const [showAddServicePanel, setShowAddServicePanel] = useState(false);\n  const [selectedServiceId, setSelectedServiceId] = useState<string>('');\n  const [selectedServiceUser, setSelectedServiceUser] = useState<ServiceUser | null>(null);\n  const [addingMapping, setAddingMapping] = useState(false);\n\n  useEffect(() => {\n    fetchMappings();\n  }, [page, statusFilter, serviceFilter, searchTerm]);\n\n  const fetchMappings = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const params = new URLSearchParams({\n        skip: (page * limit).toString(),\n        limit: limit.toString(),\n      });\n\n      if (statusFilter !== 'all') {\n        params.append('status', statusFilter);\n      }\n\n      if (serviceFilter !== 'all') {\n        params.append('service_id', serviceFilter);\n      }\n\n      if (searchTerm) {\n        params.append('central_user_id', searchTerm);\n      }\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/?${params.toString()}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch user mappings');\n      }\n\n      const data: UserMappingListResponse = await response.json();\n      setMappings(data.mappings);\n      setTotal(data.total);\n\n      // Group mappings by central user\n      groupMappingsByUser(data.mappings);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch mappings');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteMapping = async (mappingId: string) => {\n    if (!confirm('Are you sure you want to delete this user mapping?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/users/${mappingId}`, {\n        method: 'DELETE'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete mapping');\n      }\n\n      // Refresh the list\n      fetchMappings();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete mapping');\n    }\n  };\n\n  const toggleSyncEnabled = async (mapping: UserMapping) => {\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/users/${mapping.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          sync_enabled: !mapping.sync_enabled\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to update mapping');\n      }\n\n      // Refresh the list\n      fetchMappings();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update mapping');\n    }\n  };\n\n  const formatLastSync = (timestamp?: string) => {\n    if (!timestamp) return 'Never';\n\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffMins = Math.floor(diffMs / (1000 * 60));\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  const groupMappingsByUser = (mappings: UserMapping[]) => {\n    const grouped = mappings.reduce((acc, mapping) => {\n      const centralUserId = mapping.central_user_id;\n\n      if (!acc[centralUserId]) {\n        // Find the username from any mapping with central data\n        const centralUsername = mappings.find(m =>\n          m.central_user_id === centralUserId &&\n          m.service_username &&\n          m.service_username.trim() !== ''\n        )?.service_username || `user${centralUserId}`;\n\n        acc[centralUserId] = {\n          central_user_id: centralUserId,\n          central_username: centralUsername,\n          central_email: mapping.service_email || undefined,\n          mappings: [],\n          total_services: 0,\n          active_services: 0,\n          last_activity: mapping.last_sync_at || mapping.created_at\n        };\n      }\n\n      acc[centralUserId].mappings.push(mapping);\n      acc[centralUserId].total_services += 1;\n\n      if (mapping.status === 'active') {\n        acc[centralUserId].active_services += 1;\n      }\n\n      // Update last activity to most recent\n      const lastActivity = mapping.last_sync_at || mapping.updated_at;\n      if (lastActivity > acc[centralUserId].last_activity) {\n        acc[centralUserId].last_activity = lastActivity;\n      }\n\n      return acc;\n    }, {} as Record<string, GroupedUserMapping>);\n\n    setGroupedMappings(Object.values(grouped).sort((a, b) =>\n      new Date(b.last_activity).getTime() - new Date(a.last_activity).getTime()\n    ));\n  };\n\n  const getServiceTypeColorClass = (serviceType: string, isActive: boolean = true) => {\n    const colors = getServiceColor(serviceType);\n    if (isActive) {\n      return `${colors.badge} ${colors.badgeDark} border ${colors.border}`;\n    }\n    return `bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-600`;\n  };\n\n  const getServiceDisplayName = (serviceType: string) => {\n    // Capitalize first letter\n    return serviceType.charAt(0).toUpperCase() + serviceType.slice(1);\n  };\n\n  const deleteUserGroup = async (centralUserId: string) => {\n    if (!confirm('Are you sure you want to delete all mappings for this user? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      const userMappings = mappings.filter(m => m.central_user_id === centralUserId);\n\n      // Delete all mappings for this user\n      await Promise.all(userMappings.map(mapping =>\n        fetch(`${getApiBaseUrl()}/api/users/${mapping.id}`, {\n          method: 'DELETE'\n        })\n      ));\n\n      // Refresh the list\n      fetchMappings();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete user mappings');\n    }\n  };\n\n  const openEditUserModal = async (userGroup: GroupedUserMapping) => {\n    setShowEditModal(true);\n    setEditUsername(userGroup.central_username);\n    setShowAddServicePanel(false);\n    setSelectedServiceId('');\n    setSelectedServiceUser(null);\n\n    // Fetch ALL mappings for this user (not just paginated ones)\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/users/central-user/${encodeURIComponent(userGroup.central_user_id)}`);\n      if (response.ok) {\n        const allMappings: UserMapping[] = await response.json();\n        setEditingUser({\n          ...userGroup,\n          mappings: allMappings,\n          total_services: allMappings.length,\n          active_services: allMappings.filter(m => m.status === 'active').length\n        });\n      } else {\n        // Fallback to paginated data\n        setEditingUser(userGroup);\n      }\n    } catch (err) {\n      console.error('Failed to fetch all user mappings:', err);\n      setEditingUser(userGroup);\n    }\n\n    // Fetch enumeration data if not already loaded\n    if (!enumerationData) {\n      await fetchEnumerationData();\n    }\n  };\n\n  const closeEditModal = () => {\n    setEditingUser(null);\n    setEditUsername('');\n    setShowEditModal(false);\n    setShowAddServicePanel(false);\n    setSelectedServiceId('');\n    setSelectedServiceUser(null);\n  };\n\n  const fetchEnumerationData = async () => {\n    try {\n      setLoadingEnumeration(true);\n      const response = await fetch(`${getApiBaseUrl()}/api/users/enumerate-users`);\n      if (response.ok) {\n        const data = await response.json();\n        setEnumerationData(data);\n      }\n    } catch (err) {\n      console.error('Failed to fetch enumeration data:', err);\n    } finally {\n      setLoadingEnumeration(false);\n    }\n  };\n\n  const getDisplayName = (user: ServiceUser): string => {\n    return user.username || user.login || user.name || user.friendly_name || user.email || 'Unknown User';\n  };\n\n  const getUserId = (user: ServiceUser): string => {\n    return String(user.id || user.user_id || user.username || user.login || 'unknown');\n  };\n\n  // Get services that are not yet mapped for this user\n  const getUnmappedServices = (): [string, ServiceData][] => {\n    if (!enumerationData || !editingUser) return [];\n\n    const mappedServiceIds = new Set(\n      editingUser.mappings.map(m => m.service_config_id)\n    );\n\n    return Object.entries(enumerationData.services).filter(\n      ([serviceId]) => !mappedServiceIds.has(serviceId)\n    );\n  };\n\n  const addServiceMapping = async () => {\n    if (!editingUser || !selectedServiceId || !selectedServiceUser || !enumerationData) return;\n\n    try {\n      setAddingMapping(true);\n\n      const mappingRequest = {\n        central_user_id: editingUser.central_user_id,\n        central_username: editUsername || editingUser.central_username,\n        central_email: editingUser.central_email || null,\n        service_config_id: selectedServiceId,\n        service_user_id: getUserId(selectedServiceUser),\n        service_username: getDisplayName(selectedServiceUser),\n        service_email: selectedServiceUser.email || null,\n        role: selectedServiceUser.is_admin || selectedServiceUser.is_superuser ? 'admin' : 'user',\n        status: 'active',\n        sync_enabled: true,\n        service_metadata: {}\n      };\n\n      const response = await fetch(`${getApiBaseUrl()}/api/users/`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(mappingRequest)\n      });\n\n      if (response.ok) {\n        // Refresh mappings and update modal\n        await fetchMappings();\n        setShowAddServicePanel(false);\n        setSelectedServiceId('');\n        setSelectedServiceUser(null);\n\n        // Update editingUser with new mapping\n        const newMapping = await response.json();\n        setEditingUser(prev => prev ? {\n          ...prev,\n          mappings: [...prev.mappings, newMapping],\n          total_services: prev.total_services + 1,\n          active_services: prev.active_services + 1\n        } : null);\n      } else {\n        const errorData = await response.json();\n        setError(errorData.detail || 'Failed to add service mapping');\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to add service mapping');\n    } finally {\n      setAddingMapping(false);\n    }\n  };\n\n  const removeMappingFromEditModal = async (mappingId: string) => {\n    if (!confirm('Are you sure you want to remove this service mapping?')) return;\n\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/users/${mappingId}`, {\n        method: 'DELETE'\n      });\n\n      if (response.ok) {\n        // Update editingUser\n        setEditingUser(prev => prev ? {\n          ...prev,\n          mappings: prev.mappings.filter(m => m.id !== mappingId),\n          total_services: prev.total_services - 1,\n          active_services: prev.active_services - 1\n        } : null);\n\n        // Refresh main list\n        fetchMappings();\n      } else {\n        setError('Failed to remove service mapping');\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to remove mapping');\n    }\n  };\n\n  const saveUserEdit = async () => {\n    if (!editingUser || !editUsername.trim()) return;\n\n    try {\n      // Update all mappings for this user with the new username\n      const updatePromises = editingUser.mappings.map(mapping =>\n        fetch(`${getApiBaseUrl()}/api/users/${mapping.id}`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            service_username: editUsername.trim()\n          })\n        })\n      );\n\n      await Promise.all(updatePromises);\n\n      // Refresh the list\n      fetchMappings();\n      closeEditModal();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update user mappings');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-6\"></div>\n          <div className=\"space-y-4\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"bg-gray-200 h-16 rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\n      <div className=\"p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n          <div className=\"flex items-center space-x-3 min-w-0\">\n            <Users className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0\" />\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n                Mappings\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n                {total} mapping{total > 1 ? 's' : ''}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={fetchMappings}\n              disabled={loading}\n              className=\"flex items-center space-x-2 px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n            >\n              <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n              <span className=\"hidden sm:inline\">Actualiser</span>\n            </button>\n            {onCreateMapping && (\n              <button\n                onClick={onCreateMapping}\n                className=\"flex items-center space-x-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                <span className=\"hidden sm:inline\">Ajouter</span>\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-3 sm:p-4\">\n        {/* Filters */}\n        <div className=\"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-4\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n            <input\n              type=\"text\"\n              placeholder=\"Rechercher...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full pl-10 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            />\n          </div>\n\n          <select\n            value={statusFilter}\n            onChange={(e) => setStatusFilter(e.target.value)}\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          >\n            <option value=\"all\">Tous statuts</option>\n            <option value=\"active\">Actif</option>\n            <option value=\"pending\">En attente</option>\n            <option value=\"failed\">Échoué</option>\n            <option value=\"syncing\">Synchro</option>\n          </select>\n\n          <select\n            value={serviceFilter}\n            onChange={(e) => setServiceFilter(e.target.value)}\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          >\n            <option value=\"all\">Tous services</option>\n          </select>\n        </div>\n\n        {/* Error Display */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\">\n            <div className=\"flex items-center\">\n              <XCircle className=\"w-5 h-5 text-red-500 mr-2 flex-shrink-0\" />\n              <span className=\"text-sm text-red-700 dark:text-red-400\">{error}</span>\n            </div>\n          </div>\n        )}\n\n        {/* Grouped Mappings List */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4\">\n          {groupedMappings.map((userGroup) => (\n            <div\n              key={userGroup.central_user_id}\n              className=\"p-3 sm:p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-gray-300 dark:hover:border-gray-600 transition-colors h-fit\"\n            >\n              {/* User Header */}\n              <div className=\"flex items-start justify-between mb-2 sm:mb-3\">\n                <div className=\"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1\">\n                  <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center shrink-0\">\n                    <Users className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-blue-600\" />\n                  </div>\n                  <div className=\"min-w-0 flex-1\">\n                    <h3 className=\"font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate\">{userGroup.central_username}</h3>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                      {userGroup.active_services}/{userGroup.total_services} actif\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center space-x-1 shrink-0\">\n                  <button\n                    onClick={() => openEditUserModal(userGroup)}\n                    className=\"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors\"\n                    title=\"Edit user information\"\n                  >\n                    <Edit className=\"w-3.5 h-3.5\" />\n                  </button>\n                  <button\n                    onClick={() => deleteUserGroup(userGroup.central_user_id)}\n                    className=\"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors\"\n                    title=\"Delete all mappings for this user\"\n                  >\n                    <Trash2 className=\"w-3.5 h-3.5\" />\n                  </button>\n                </div>\n              </div>\n\n              {/* Last Activity */}\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 mb-3\">\n                Dernière activité: {formatLastSync(userGroup.last_activity)}\n              </div>\n\n              {/* Service Badges */}\n              <div className=\"flex flex-wrap gap-2 mb-3\">\n                {userGroup.mappings.map((mapping) => {\n                  const isActive = mapping.status === 'active' && mapping.sync_enabled && mapping.last_sync_success !== false;\n                  return (\n                    <div\n                      key={mapping.id}\n                      className={`inline-flex items-center px-2 py-1 rounded text-xs font-medium transition-colors relative group ${\n                        getServiceTypeColorClass(mapping.service_config?.service_type || '', isActive)\n                      }`}\n                    >\n                      {/* Status indicator */}\n                      <div className={`w-1.5 h-1.5 rounded-full mr-1.5 ${\n                        mapping.status === 'active' && mapping.last_sync_success !== false\n                          ? 'bg-green-500'\n                          : mapping.status === 'syncing'\n                          ? 'bg-blue-500'\n                          : 'bg-red-500'\n                      }`}></div>\n\n                      <span>\n                        {getServiceDisplayName(mapping.service_config?.service_type || '')}\n                      </span>\n\n                      {!mapping.sync_enabled && (\n                        <Pause className=\"w-3 h-3 ml-1 opacity-60\" />\n                      )}\n\n                      {/* Simplified Tooltip */}\n                      <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20\">\n                        <div>{mapping.service_username} • {mapping.status}</div>\n                        <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-900\"></div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              {/* Service Details (expandable) */}\n              <details className=\"mt-3\">\n                <summary className=\"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white\">\n                  Voir les détails\n                </summary>\n                <div className=\"mt-2 space-y-2 pl-4 border-l-2 border-gray-200 dark:border-gray-600\">\n                  {userGroup.mappings.map((mapping) => (\n                    <div key={mapping.id} className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-2 text-sm\">\n                      <div className=\"flex items-center space-x-2 min-w-0\">\n                        <span className=\"font-medium text-gray-700 dark:text-gray-300 truncate\">\n                          {mapping.service_config?.name || 'Unknown'}\n                        </span>\n                        <span className=\"text-gray-500 dark:text-gray-400\">→</span>\n                        <span className=\"text-gray-600 dark:text-gray-400 truncate\">\n                          {mapping.service_username || 'No user'}\n                        </span>\n                      </div>\n\n                      <div className=\"flex items-center space-x-2 flex-shrink-0\">\n                        <button\n                          onClick={() => toggleSyncEnabled(mapping)}\n                          className={`px-2 py-1 text-xs font-medium rounded ${\n                            mapping.sync_enabled\n                              ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400'\n                              : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-400'\n                          }`}\n                        >\n                          {mapping.sync_enabled ? 'Sync On' : 'Sync Off'}\n                        </button>\n\n                        {onEditMapping && (\n                          <button\n                            onClick={() => onEditMapping(mapping)}\n                            className=\"p-1 text-gray-600 dark:text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors\"\n                          >\n                            <Edit className=\"w-3 h-3\" />\n                          </button>\n                        )}\n\n                        <button\n                          onClick={() => deleteMapping(mapping.id)}\n                          className=\"p-1 text-gray-600 dark:text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded transition-colors\"\n                        >\n                          <Trash2 className=\"w-3 h-3\" />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </details>\n            </div>\n          ))}\n        </div>\n\n        {/* Empty State */}\n        {groupedMappings.length === 0 && !loading && (\n          <div className=\"text-center py-8 sm:py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n            <Users className=\"w-10 h-10 sm:w-12 sm:h-12 text-gray-400 mx-auto mb-3 sm:mb-4\" />\n            <h3 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2\">Aucun mapping</h3>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4 px-4\">\n              {searchTerm || statusFilter !== 'all' || serviceFilter !== 'all'\n                ? 'Aucun mapping ne correspond aux filtres.'\n                : 'Commencez par détecter ou créer des mappings.'\n              }\n            </p>\n            {onCreateMapping && (\n              <button\n                onClick={onCreateMapping}\n                className=\"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                <span>Créer un mapping</span>\n              </button>\n            )}\n          </div>\n        )}\n\n        {/* Pagination */}\n        {total > limit && (\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n            <div className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n              {groupedMappings.length} utilisateurs / {total} mappings\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={() => setPage(page - 1)}\n                disabled={page === 0}\n                className=\"px-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n              >\n                Précédent\n              </button>\n              <button\n                onClick={() => setPage(page + 1)}\n                disabled={(page + 1) * limit >= total}\n                className=\"px-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n              >\n                Suivant\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Edit User Modal */}\n        {showEditModal && editingUser && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\n                <Edit className=\"w-5 h-5 mr-2 text-blue-600\" />\n                Éditer: {editingUser.central_username}\n              </h3>\n\n              <div className=\"space-y-4 mb-6\">\n                {/* Central Username */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Nom d'utilisateur\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={editUsername}\n                    onChange={(e) => setEditUsername(e.target.value)}\n                    className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    placeholder=\"Entrer un nom...\"\n                  />\n                </div>\n\n                {/* Connected Services with Remove Button */}\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Services connectés ({editingUser.mappings.length})\n                    </label>\n                    {getUnmappedServices().length > 0 && (\n                      <button\n                        onClick={() => setShowAddServicePanel(!showAddServicePanel)}\n                        className=\"flex items-center space-x-1 px-2 py-1 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors\"\n                      >\n                        <Plus className=\"w-4 h-4\" />\n                        <span>Ajouter</span>\n                      </button>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    {editingUser.mappings.map((mapping) => (\n                      <div key={mapping.id} className=\"flex items-center justify-between p-2 sm:p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex items-center space-x-2 sm:space-x-3 min-w-0\">\n                          <div className={`w-3 h-3 rounded-full flex-shrink-0 ${getServiceColor(mapping.service_config?.service_type || '').dot}`}></div>\n                          <div className=\"min-w-0\">\n                            <span className=\"text-sm font-medium text-gray-900 dark:text-white truncate block\">\n                              {mapping.service_config?.name || 'Unknown Service'}\n                            </span>\n                            <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                              {mapping.service_username}\n                              {mapping.service_email && ` (${mapping.service_email})`}\n                            </p>\n                          </div>\n                        </div>\n                        <button\n                          onClick={() => removeMappingFromEditModal(mapping.id)}\n                          className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded transition-colors flex-shrink-0\"\n                          title=\"Supprimer ce mapping\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    ))}\n\n                    {editingUser.mappings.length === 0 && (\n                      <div className=\"text-center py-4 text-gray-500 dark:text-gray-400 text-sm\">\n                        Aucun mapping. Ajoutez-en un ci-dessous.\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Add Service Panel */}\n                {showAddServicePanel && (\n                  <div className=\"p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                    <h4 className=\"font-medium text-gray-900 dark:text-white mb-3 flex items-center text-sm\">\n                      <Link className=\"w-4 h-4 mr-2 text-blue-600\" />\n                      Ajouter un service\n                    </h4>\n\n                    {loadingEnumeration ? (\n                      <div className=\"flex items-center justify-center py-4\">\n                        <RefreshCw className=\"w-5 h-5 text-blue-500 animate-spin mr-2\" />\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">Chargement...</span>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                        {/* Service Selection */}\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                            Service\n                          </label>\n                          <select\n                            value={selectedServiceId}\n                            onChange={(e) => {\n                              setSelectedServiceId(e.target.value);\n                              setSelectedServiceUser(null);\n                            }}\n                            className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                          >\n                            <option value=\"\">Choisir un service...</option>\n                            {getUnmappedServices().map(([serviceId, serviceData]) => (\n                              <option key={serviceId} value={serviceId}>\n                                {serviceData.service_name} ({serviceData.user_count})\n                              </option>\n                            ))}\n                          </select>\n                        </div>\n\n                        {/* User Selection */}\n                        {selectedServiceId && enumerationData?.services[selectedServiceId] && (\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                              Utilisateur\n                            </label>\n                            <div className=\"max-h-40 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800\">\n                              {enumerationData.services[selectedServiceId].users.map((user, index) => (\n                                <div\n                                  key={index}\n                                  onClick={() => setSelectedServiceUser(user)}\n                                  className={`p-2 cursor-pointer border-b dark:border-gray-700 last:border-b-0 transition-colors ${\n                                    selectedServiceUser === user\n                                      ? 'bg-blue-100 dark:bg-blue-900/30 border-blue-200'\n                                      : 'hover:bg-gray-50 dark:hover:bg-gray-700'\n                                  }`}\n                                >\n                                  <div className=\"flex items-center space-x-2\">\n                                    <User className=\"w-4 h-4 text-gray-400\" />\n                                    <div className=\"min-w-0\">\n                                      <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                                        {getDisplayName(user)}\n                                      </p>\n                                      {user.email && (\n                                        <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">{user.email}</p>\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Add Button */}\n                        <div className=\"flex justify-end space-x-2\">\n                          <button\n                            onClick={() => {\n                              setShowAddServicePanel(false);\n                              setSelectedServiceId('');\n                              setSelectedServiceUser(null);\n                            }}\n                            className=\"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n                          >\n                            Annuler\n                          </button>\n                          <button\n                            onClick={addServiceMapping}\n                            disabled={!selectedServiceId || !selectedServiceUser || addingMapping}\n                            className=\"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center\"\n                          >\n                            {addingMapping ? (\n                              <>\n                                <RefreshCw className=\"w-4 h-4 mr-1 animate-spin\" />\n                                Ajout...\n                              </>\n                            ) : (\n                              <>\n                                <Plus className=\"w-4 h-4 mr-1\" />\n                                Ajouter\n                              </>\n                            )}\n                          </button>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {/* User Info */}\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-700\">\n                  <p><strong>ID:</strong> {editingUser.central_user_id}</p>\n                  <p><strong>Services:</strong> {editingUser.total_services} ({editingUser.active_services} actifs)</p>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end space-x-2 sm:space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n                <button\n                  onClick={closeEditModal}\n                  className=\"px-3 sm:px-4 py-2 text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                >\n                  Fermer\n                </button>\n                <button\n                  onClick={saveUserEdit}\n                  disabled={!editUsername.trim()}\n                  className=\"px-3 sm:px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n                >\n                  Sauvegarder\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserMappingList;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserMapping/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/UserSync.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[830,833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[830,833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2160,2163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2160,2163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport type { FC } from 'react';\nimport {\n  RefreshCw,\n  CheckCircle,\n  XCircle,\n  Clock,\n  Play,\n  Settings,\n  Eye,\n  EyeOff,\n  Activity,\n  User\n} from 'lucide-react';\nimport { getApiBaseUrl } from '../lib/api';\n\ninterface SyncProgress {\n  totalMappings: number;\n  successfulSyncs: number;\n  failedSyncs: number;\n  skippedSyncs: number;\n  currentMapping?: string;\n  startedAt?: string;\n  completedAt?: string;\n}\n\ninterface SyncResult {\n  success: boolean;\n  centralUserId: string;\n  totalMappings: number;\n  successfulSyncs: number;\n  failedSyncs: number;\n  syncDetails: Array<{\n    serviceId: string;\n    serviceName: string;\n    success: boolean;\n    error?: string;\n  }>;\n}\n\ninterface UserSyncProps {\n  centralUserId?: string;\n  serviceFilter?: string;\n  onSyncComplete?: (result: any) => void;\n}\n\nconst UserSync: FC<UserSyncProps> = ({\n  centralUserId,\n  serviceFilter,\n  onSyncComplete\n}) => {\n  const [syncing, setSyncing] = useState(false);\n  const [syncProgress, setSyncProgress] = useState<SyncProgress | null>(null);\n  const [syncResult, setSyncResult] = useState<SyncResult | null>(null);\n  const [showDetails, setShowDetails] = useState(false);\n  const [autoSync, setAutoSync] = useState(false);\n  const [syncInterval, setSyncInterval] = useState(3600); // Default 1 hour\n  const [lastSyncTime, setLastSyncTime] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Load last sync time from localStorage or API\n    const savedSyncTime = localStorage.getItem(`lastSync_${centralUserId || 'all'}`);\n    if (savedSyncTime) {\n      setLastSyncTime(savedSyncTime);\n    }\n  }, [centralUserId]);\n\n  const startSync = async (forceSync: boolean = false) => {\n    setSyncing(true);\n    setSyncResult(null);\n    setSyncProgress({\n      totalMappings: 0,\n      successfulSyncs: 0,\n      failedSyncs: 0,\n      skippedSyncs: 0,\n      startedAt: new Date().toISOString()\n    });\n    setError(null);\n\n    try {\n      const endpoint = centralUserId\n        ? `/api/users/${centralUserId}/sync`\n        : '/api/users/sync-all';\n\n      const requestBody: any = {\n        force_sync: forceSync\n      };\n\n      if (serviceFilter) {\n        requestBody.service_type = serviceFilter;\n      }\n\n      console.log('🔄 Starting user synchronization...');\n\n      const response = await fetch(`${getApiBaseUrl()}${endpoint}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Sync request failed');\n      }\n\n      const result = await response.json();\n      console.log('✅ Sync completed:', result);\n\n      setSyncResult(result);\n      setSyncProgress(prev => prev ? {\n        ...prev,\n        completedAt: new Date().toISOString(),\n        totalMappings: result.totalMappings || 0,\n        successfulSyncs: result.successfulSyncs || 0,\n        failedSyncs: result.failedSyncs || 0,\n        skippedSyncs: result.skippedSyncs || 0\n      } : null);\n\n      // Save sync time\n      const syncTime = new Date().toISOString();\n      setLastSyncTime(syncTime);\n      localStorage.setItem(`lastSync_${centralUserId || 'all'}`, syncTime);\n\n      // Call completion callback\n      onSyncComplete?.(result);\n\n    } catch (err) {\n      console.error('❌ Sync failed:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error occurred';\n      setError(errorMessage);\n      setSyncProgress(prev => prev ? {\n        ...prev,\n        completedAt: new Date().toISOString()\n      } : null);\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const formatLastSync = (timestamp: string | null) => {\n    if (!timestamp) return 'Never';\n\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffMins = Math.floor(diffMs / (1000 * 60));\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  const getSyncIcon = () => {\n    if (syncing) {\n      return <RefreshCw className=\"w-5 h-5 text-blue-500 animate-spin\" />;\n    }\n    if (syncResult?.success) {\n      return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n    }\n    if (error) {\n      return <XCircle className=\"w-5 h-5 text-red-500\" />;\n    }\n    return <RefreshCw className=\"w-5 h-5 text-gray-500\" />;\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n      <div className=\"p-4 border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            {getSyncIcon()}\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                User Synchronization\n              </h3>\n              <p className=\"text-sm text-gray-600\">\n                {centralUserId\n                  ? `Sync user: ${centralUserId}`\n                  : 'Sync all users across services'\n                }\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setShowDetails(!showDetails)}\n              className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors\"\n            >\n              {showDetails ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n            </button>\n            <button\n              onClick={() => startSync(false)}\n              disabled={syncing}\n              className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              <Play className=\"w-4 h-4\" />\n              <span>{syncing ? 'Syncing...' : 'Start Sync'}</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-4\">\n        {/* Sync Status */}\n        {syncProgress && (\n          <div className=\"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-sm font-medium text-blue-900\">\n                {syncing ? 'Synchronizing...' : 'Sync Completed'}\n              </span>\n              {syncing && <Activity className=\"w-4 h-4 text-blue-500 animate-pulse\" />}\n            </div>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div>\n                <span className=\"text-gray-600\">Total:</span>\n                <span className=\"ml-2 font-medium\">{syncProgress.totalMappings}</span>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Success:</span>\n                <span className=\"ml-2 font-medium text-green-600\">{syncProgress.successfulSyncs}</span>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Failed:</span>\n                <span className=\"ml-2 font-medium text-red-600\">{syncProgress.failedSyncs}</span>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Skipped:</span>\n                <span className=\"ml-2 font-medium text-yellow-600\">{syncProgress.skippedSyncs}</span>\n              </div>\n            </div>\n\n            {syncProgress.currentMapping && (\n              <div className=\"mt-2 text-sm text-gray-600\">\n                Currently syncing: <span className=\"font-medium\">{syncProgress.currentMapping}</span>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Error Display */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 rounded-lg border border-red-200\">\n            <div className=\"flex items-center\">\n              <XCircle className=\"w-5 h-5 text-red-500 mr-2\" />\n              <span className=\"text-sm text-red-700\">{error}</span>\n            </div>\n          </div>\n        )}\n\n        {/* Quick Info */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n          <div className=\"flex items-center space-x-2\">\n            <Clock className=\"w-4 h-4 text-gray-500\" />\n            <div>\n              <span className=\"text-sm text-gray-600\">Last Sync:</span>\n              <span className=\"ml-2 text-sm font-medium\">{formatLastSync(lastSyncTime)}</span>\n            </div>\n          </div>\n\n          {serviceFilter && (\n            <div className=\"flex items-center space-x-2\">\n              <Settings className=\"w-4 h-4 text-gray-500\" />\n              <div>\n                <span className=\"text-sm text-gray-600\">Service:</span>\n                <span className=\"ml-2 text-sm font-medium capitalize\">{serviceFilter}</span>\n              </div>\n            </div>\n          )}\n\n          {centralUserId && (\n            <div className=\"flex items-center space-x-2\">\n              <User className=\"w-4 h-4 text-gray-500\" />\n              <div>\n                <span className=\"text-sm text-gray-600\">User:</span>\n                <span className=\"ml-2 text-sm font-medium\">{centralUserId}</span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Sync Controls */}\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <button\n            onClick={() => startSync(true)}\n            disabled={syncing}\n            className=\"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors\"\n          >\n            Force Sync\n          </button>\n\n          <label className=\"flex items-center space-x-2 text-sm\">\n            <input\n              type=\"checkbox\"\n              checked={autoSync}\n              onChange={(e) => setAutoSync(e.target.checked)}\n              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n            />\n            <span>Auto-sync</span>\n          </label>\n\n          <select\n            value={syncInterval}\n            onChange={(e) => setSyncInterval(parseInt(e.target.value))}\n            className=\"text-sm border border-gray-300 rounded px-2 py-1\"\n          >\n            <option value={300}>5 minutes</option>\n            <option value={900}>15 minutes</option>\n            <option value={3600}>1 hour</option>\n            <option value={21600}>6 hours</option>\n            <option value={86400}>24 hours</option>\n          </select>\n        </div>\n\n        {/* Detailed Results */}\n        {showDetails && syncResult && (\n          <div className=\"mt-4 space-y-3\">\n            <h4 className=\"text-sm font-medium text-gray-900\">Sync Details</h4>\n            {syncResult.syncDetails.map((detail, index) => (\n              <div\n                key={index}\n                className={`p-3 rounded-lg border ${\n                  detail.success\n                    ? 'border-green-200 bg-green-50'\n                    : 'border-red-200 bg-red-50'\n                }`}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-2\">\n                    {detail.success ? (\n                      <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                    ) : (\n                      <XCircle className=\"w-4 h-4 text-red-500\" />\n                    )}\n                    <span className=\"text-sm font-medium\">{detail.serviceName}</span>\n                  </div>\n                  <span className={`text-xs px-2 py-1 rounded ${\n                    detail.success\n                      ? 'bg-green-100 text-green-800'\n                      : 'bg-red-100 text-red-800'\n                  }`}>\n                    {detail.success ? 'Success' : 'Failed'}\n                  </span>\n                </div>\n                {detail.error && (\n                  <p className=\"mt-1 text-sm text-red-600\">{detail.error}</p>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default UserSync;","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/VirtualLogList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Workers/WorkerCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1694,1697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1694,1697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2060,2063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2060,2063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { api } from '../../lib/api';\n\ninterface Worker {\n  id: string;\n  name: string;\n  description?: string;\n  url: string;\n  status: string;\n  enabled: boolean;\n  last_seen_at?: string;\n  last_error?: string;\n  gpu_available: boolean;\n  gpu_count: number;\n  gpu_names: string[];\n  gpu_memory_total_mb: number;\n  worker_version?: string;\n  platform?: string;\n  current_job_id?: string;\n  current_session_id?: string;\n  total_jobs_completed: number;\n  total_training_time_seconds: number;\n}\n\ninterface WorkerCardProps {\n  worker: Worker;\n  onRefresh: () => void;\n  onEdit: (worker: Worker) => void;\n  onDelete: (worker: Worker) => void;\n}\n\nconst statusColors: Record<string, { bg: string; text: string; dot: string }> = {\n  online: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-800 dark:text-green-300', dot: 'bg-green-500' },\n  training: { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-800 dark:text-blue-300', dot: 'bg-blue-500 animate-pulse' },\n  offline: { bg: 'bg-gray-100 dark:bg-gray-800', text: 'text-gray-600 dark:text-gray-400', dot: 'bg-gray-400' },\n  error: { bg: 'bg-red-100 dark:bg-red-900/30', text: 'text-red-800 dark:text-red-300', dot: 'bg-red-500' },\n  unknown: { bg: 'bg-yellow-100 dark:bg-yellow-900/30', text: 'text-yellow-800 dark:text-yellow-300', dot: 'bg-yellow-500' },\n};\n\nexport function WorkerCard({ worker, onRefresh, onEdit, onDelete }: WorkerCardProps) {\n  const [testing, setTesting] = useState(false);\n  const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null);\n  const [showMetrics, setShowMetrics] = useState(false);\n  const [metrics, setMetrics] = useState<any>(null);\n  const [loadingMetrics, setLoadingMetrics] = useState(false);\n\n  const statusStyle = statusColors[worker.status] || statusColors.unknown;\n\n  const handleTest = async () => {\n    setTesting(true);\n    setTestResult(null);\n    try {\n      const result = await api.workers.test(worker.id);\n      setTestResult(result);\n      onRefresh();\n    } catch (err: any) {\n      setTestResult({ success: false, message: err.message || 'Test failed' });\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  const handleRefresh = async () => {\n    try {\n      await api.workers.refresh(worker.id);\n      onRefresh();\n    } catch (err) {\n      console.error('Failed to refresh worker:', err);\n    }\n  };\n\n  const handleToggleMetrics = async () => {\n    if (!showMetrics && worker.status !== 'offline') {\n      setLoadingMetrics(true);\n      try {\n        const data = await api.workers.getMetrics(worker.id);\n        setMetrics(data);\n      } catch (err) {\n        console.error('Failed to load metrics:', err);\n      } finally {\n        setLoadingMetrics(false);\n      }\n    }\n    setShowMetrics(!showMetrics);\n  };\n\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    if (hours > 0) return `${hours}h ${minutes}m`;\n    return `${minutes}m`;\n  };\n\n  return (\n    <div className={`bg-white dark:bg-gray-800 rounded-lg shadow-sm border ${\n      !worker.enabled ? 'opacity-60 border-gray-200 dark:border-gray-700' : 'border-gray-200 dark:border-gray-700'\n    }`}>\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className={`w-10 h-10 rounded-lg ${worker.gpu_available ? 'bg-green-100 dark:bg-green-900/30' : 'bg-gray-100 dark:bg-gray-700'} flex items-center justify-center`}>\n              <svg className={`w-6 h-6 ${worker.gpu_available ? 'text-green-600 dark:text-green-400' : 'text-gray-400'}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\" />\n              </svg>\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900 dark:text-white\">{worker.name}</h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 font-mono\">{worker.url}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusStyle.bg} ${statusStyle.text}`}>\n              <span className={`w-2 h-2 mr-1.5 rounded-full ${statusStyle.dot}`}></span>\n              {worker.status}\n            </span>\n          </div>\n        </div>\n        {worker.description && (\n          <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">{worker.description}</p>\n        )}\n      </div>\n\n      {/* GPU Info */}\n      {worker.gpu_available && (\n        <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2\">\n              <svg className=\"w-5 h-5 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\" />\n              </svg>\n              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                {worker.gpu_count} GPU{worker.gpu_count > 1 ? 's' : ''}\n              </span>\n            </div>\n            <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {(worker.gpu_memory_total_mb / 1024).toFixed(1)} GB VRAM\n            </span>\n          </div>\n          {worker.gpu_names.length > 0 && (\n            <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n              {worker.gpu_names.join(', ')}\n            </p>\n          )}\n        </div>\n      )}\n\n      {/* Stats */}\n      <div className=\"px-4 py-3 grid grid-cols-3 gap-4 text-center border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">{worker.total_jobs_completed}</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Jobs</p>\n        </div>\n        <div>\n          <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            {formatDuration(worker.total_training_time_seconds)}\n          </p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Training time</p>\n        </div>\n        <div>\n          <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            {worker.worker_version || '-'}\n          </p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Version</p>\n        </div>\n      </div>\n\n      {/* Metrics Panel */}\n      {showMetrics && (\n        <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700\">\n          {loadingMetrics ? (\n            <div className=\"flex items-center justify-center py-2\">\n              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500\"></div>\n            </div>\n          ) : metrics ? (\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <span className=\"text-gray-500 dark:text-gray-400\">CPU:</span>\n                <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.cpu_percent?.toFixed(1)}%</span>\n              </div>\n              <div>\n                <span className=\"text-gray-500 dark:text-gray-400\">RAM:</span>\n                <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.memory_percent?.toFixed(1)}%</span>\n              </div>\n              {metrics.gpu_utilization_percent !== null && (\n                <>\n                  <div>\n                    <span className=\"text-gray-500 dark:text-gray-400\">GPU:</span>\n                    <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.gpu_utilization_percent?.toFixed(1)}%</span>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-500 dark:text-gray-400\">VRAM:</span>\n                    <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.gpu_memory_percent?.toFixed(1)}%</span>\n                  </div>\n                  {metrics.gpu_temperature_c && (\n                    <div>\n                      <span className=\"text-gray-500 dark:text-gray-400\">GPU Temp:</span>\n                      <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.gpu_temperature_c}°C</span>\n                    </div>\n                  )}\n                  {metrics.gpu_power_draw_w && (\n                    <div>\n                      <span className=\"text-gray-500 dark:text-gray-400\">Power:</span>\n                      <span className=\"ml-2 text-gray-900 dark:text-white\">{metrics.gpu_power_draw_w?.toFixed(0)}W</span>\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n          ) : (\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">No metrics available</p>\n          )}\n        </div>\n      )}\n\n      {/* Error */}\n      {worker.last_error && (\n        <div className=\"px-4 py-2 bg-red-50 dark:bg-red-900/20 border-b border-red-200 dark:border-red-800\">\n          <p className=\"text-sm text-red-600 dark:text-red-400\">{worker.last_error}</p>\n        </div>\n      )}\n\n      {/* Test Result */}\n      {testResult && (\n        <div className={`px-4 py-2 ${testResult.success ? 'bg-green-50 dark:bg-green-900/20' : 'bg-red-50 dark:bg-red-900/20'} border-b border-gray-200 dark:border-gray-700`}>\n          <p className={`text-sm ${testResult.success ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>\n            {testResult.message}\n          </p>\n        </div>\n      )}\n\n      {/* Actions */}\n      <div className=\"px-4 py-3 flex items-center justify-between\">\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={handleTest}\n            disabled={testing}\n            className=\"px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md disabled:opacity-50\"\n          >\n            {testing ? 'Testing...' : 'Test'}\n          </button>\n          <button\n            onClick={handleRefresh}\n            className=\"px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md\"\n          >\n            Refresh\n          </button>\n          {worker.status !== 'offline' && (\n            <button\n              onClick={handleToggleMetrics}\n              className=\"px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md\"\n            >\n              {showMetrics ? 'Hide Metrics' : 'Metrics'}\n            </button>\n          )}\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={() => onEdit(worker)}\n            className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            title=\"Edit\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\n            </svg>\n          </button>\n          <button\n            onClick={() => onDelete(worker)}\n            className=\"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400\"\n            title=\"Delete\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Workers/WorkerForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1166,1169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1166,1169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1577,1580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1577,1580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { api } from '../../lib/api';\n\ninterface Worker {\n  id?: string;\n  name: string;\n  description?: string;\n  url: string;\n  api_key?: string;\n  enabled?: boolean;\n  ollama_service_id?: string;\n}\n\ninterface OllamaService {\n  id: string;\n  name: string;\n  url: string;\n}\n\ninterface WorkerFormProps {\n  worker?: Worker;\n  onSubmit: (data: Worker) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport function WorkerForm({ worker, onSubmit, onCancel }: WorkerFormProps) {\n  const [formData, setFormData] = useState<Worker>({\n    name: '',\n    description: '',\n    url: 'http://',\n    api_key: '',\n    enabled: true,\n    ollama_service_id: '',\n    ...worker,\n  });\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [ollamaServices, setOllamaServices] = useState<OllamaService[]>([]);\n  const [loadingServices, setLoadingServices] = useState(true);\n\n  useEffect(() => {\n    loadOllamaServices();\n  }, []);\n\n  const loadOllamaServices = async () => {\n    try {\n      const services = await api.services.list();\n      const ollama = services.filter((s: any) => s.service_type === 'ollama' && s.enabled);\n      setOllamaServices(ollama);\n    } catch (err) {\n      console.error('Failed to load Ollama services:', err);\n    } finally {\n      setLoadingServices(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setSubmitting(true);\n\n    try {\n      await onSubmit(formData);\n    } catch (err: any) {\n      setError(err.message || 'Failed to save worker');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full mx-4\">\n        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n            {worker?.id ? 'Edit Worker' : 'Add Training Worker'}\n          </h2>\n          <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n            Configure a GPU training worker for fine-tuning models\n          </p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n          {error && (\n            <div className=\"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md\">\n              <p className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Name *\n            </label>\n            <input\n              type=\"text\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"IA PC Worker\"\n              required\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Description\n            </label>\n            <input\n              type=\"text\"\n              value={formData.description || ''}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"GPU worker for LLM training\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Worker URL *\n            </label>\n            <input\n              type=\"url\"\n              value={formData.url}\n              onChange={(e) => setFormData({ ...formData, url: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"http://192.168.1.100:8080\"\n              required\n            />\n            <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n              URL of the training worker API (Docker container)\n            </p>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              API Key (optional)\n            </label>\n            <input\n              type=\"password\"\n              value={formData.api_key || ''}\n              onChange={(e) => setFormData({ ...formData, api_key: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"Optional API key for authentication\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Ollama Service (for model import)\n            </label>\n            <select\n              value={formData.ollama_service_id || ''}\n              onChange={(e) => setFormData({ ...formData, ollama_service_id: e.target.value || undefined })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              disabled={loadingServices}\n            >\n              <option value=\"\">Use worker default</option>\n              {ollamaServices.map((service) => (\n                <option key={service.id} value={service.id}>\n                  {service.name} ({service.url})\n                </option>\n              ))}\n            </select>\n            <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n              Select which Ollama server to import the trained model to\n            </p>\n          </div>\n\n          {worker?.id && (\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                id=\"enabled\"\n                checked={formData.enabled}\n                onChange={(e) => setFormData({ ...formData, enabled: e.target.checked })}\n                className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n              />\n              <label htmlFor=\"enabled\" className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\n                Worker enabled\n              </label>\n            </div>\n          )}\n\n          <div className=\"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={submitting}\n              className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md disabled:opacity-50\"\n            >\n              {submitting ? 'Saving...' : worker?.id ? 'Save Changes' : 'Add Worker'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Workers/WorkerList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1411,1414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1411,1414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1554,1557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1554,1557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1927,1930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1927,1930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { api } from '../../lib/api';\nimport { WorkerCard } from './WorkerCard';\nimport { WorkerForm } from './WorkerForm';\n\ninterface Worker {\n  id: string;\n  name: string;\n  description?: string;\n  url: string;\n  status: string;\n  enabled: boolean;\n  last_seen_at?: string;\n  last_error?: string;\n  gpu_available: boolean;\n  gpu_count: number;\n  gpu_names: string[];\n  gpu_memory_total_mb: number;\n  worker_version?: string;\n  platform?: string;\n  current_job_id?: string;\n  current_session_id?: string;\n  total_jobs_completed: number;\n  total_training_time_seconds: number;\n}\n\nexport function WorkerList() {\n  const [workers, setWorkers] = useState<Worker[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showForm, setShowForm] = useState(false);\n  const [editingWorker, setEditingWorker] = useState<Worker | undefined>();\n  const [deletingWorker, setDeletingWorker] = useState<Worker | null>(null);\n\n  useEffect(() => {\n    loadWorkers();\n  }, []);\n\n  const loadWorkers = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await api.workers.list();\n      setWorkers(data);\n    } catch (err: any) {\n      setError(err.message || 'Failed to load workers');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateWorker = async (data: any) => {\n    await api.workers.create(data);\n    setShowForm(false);\n    await loadWorkers();\n  };\n\n  const handleUpdateWorker = async (data: any) => {\n    if (!editingWorker) return;\n    await api.workers.update(editingWorker.id, data);\n    setEditingWorker(undefined);\n    await loadWorkers();\n  };\n\n  const handleDeleteWorker = async () => {\n    if (!deletingWorker) return;\n    try {\n      await api.workers.delete(deletingWorker.id);\n      setDeletingWorker(null);\n      await loadWorkers();\n    } catch (err: any) {\n      alert(err.message || 'Failed to delete worker');\n    }\n  };\n\n  const handleRefreshAll = async () => {\n    try {\n      await api.workers.refreshAll();\n      // Reload after a short delay to get updated statuses\n      setTimeout(loadWorkers, 2000);\n    } catch (err) {\n      console.error('Failed to refresh workers:', err);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n        <p className=\"text-red-600 dark:text-red-400\">{error}</p>\n        <button\n          onClick={loadWorkers}\n          className=\"mt-2 text-sm text-red-600 dark:text-red-400 hover:underline\"\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Training Workers</h2>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            GPU workers for fine-tuning LLM models\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <button\n            onClick={handleRefreshAll}\n            className=\"px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700\"\n          >\n            <span className=\"flex items-center\">\n              <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n              </svg>\n              Refresh All\n            </span>\n          </button>\n          <button\n            onClick={() => setShowForm(true)}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md\"\n          >\n            <span className=\"flex items-center\">\n              <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n              </svg>\n              Add Worker\n            </span>\n          </button>\n        </div>\n      </div>\n\n      {/* Workers Grid */}\n      {workers.length === 0 ? (\n        <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n          <svg className=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\" />\n          </svg>\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900 dark:text-white\">No training workers</h3>\n          <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n            Add a GPU worker to enable fine-tuning capabilities\n          </p>\n          <button\n            onClick={() => setShowForm(true)}\n            className=\"mt-4 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md\"\n          >\n            Add Worker\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {workers.map((worker) => (\n            <WorkerCard\n              key={worker.id}\n              worker={worker}\n              onRefresh={loadWorkers}\n              onEdit={(w) => setEditingWorker(w)}\n              onDelete={(w) => setDeletingWorker(w)}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Add/Edit Form Modal */}\n      {(showForm || editingWorker) && (\n        <WorkerForm\n          worker={editingWorker}\n          onSubmit={editingWorker ? handleUpdateWorker : handleCreateWorker}\n          onCancel={() => {\n            setShowForm(false);\n            setEditingWorker(undefined);\n          }}\n        />\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {deletingWorker && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Delete Worker</h3>\n            <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n              Are you sure you want to delete \"{deletingWorker.name}\"? This action cannot be undone.\n            </p>\n            <div className=\"mt-6 flex justify-end space-x-3\">\n              <button\n                onClick={() => setDeletingWorker(null)}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleDeleteWorker}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md\"\n              >\n                Delete\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/components/Workers/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/contexts/SettingsContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":87,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":87,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\n\nexport type LogLevel = 'debug' | 'info' | 'warning' | 'error' | 'critical';\nexport type Language = 'fr' | 'en';\n\ninterface AppSettings {\n  // General\n  language: Language;\n  autoRefresh: boolean;\n  refreshInterval: number; // seconds\n\n  // Logging\n  logLevel: LogLevel;\n  logToConsole: boolean;\n  logToBackend: boolean;\n\n  // Notifications\n  notificationsEnabled: boolean;\n  soundEnabled: boolean;\n  alertOnError: boolean;\n\n  // Dashboard\n  dashboardCompactMode: boolean;\n  showSystemMetrics: boolean;\n  showMcpStats: boolean;\n}\n\nconst defaultSettings: AppSettings = {\n  language: 'fr',\n  autoRefresh: true,\n  refreshInterval: 10,\n  logLevel: 'info',\n  logToConsole: true,\n  logToBackend: true,\n  notificationsEnabled: true,\n  soundEnabled: false,\n  alertOnError: true,\n  dashboardCompactMode: false,\n  showSystemMetrics: true,\n  showMcpStats: true,\n};\n\ninterface SettingsContextType {\n  settings: AppSettings;\n  updateSettings: (updates: Partial<AppSettings>) => void;\n  resetSettings: () => void;\n}\n\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\n\nconst SETTINGS_KEY = 'mcparr-settings';\n\nexport function SettingsProvider({ children }: { children: ReactNode }) {\n  const [settings, setSettings] = useState<AppSettings>(() => {\n    if (typeof window === 'undefined') return defaultSettings;\n    try {\n      const stored = localStorage.getItem(SETTINGS_KEY);\n      if (stored) {\n        return { ...defaultSettings, ...JSON.parse(stored) };\n      }\n    } catch {\n      // Invalid JSON, use defaults\n    }\n    return defaultSettings;\n  });\n\n  useEffect(() => {\n    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n  }, [settings]);\n\n  const updateSettings = (updates: Partial<AppSettings>) => {\n    setSettings((prev) => ({ ...prev, ...updates }));\n  };\n\n  const resetSettings = () => {\n    setSettings(defaultSettings);\n    localStorage.removeItem(SETTINGS_KEY);\n  };\n\n  return (\n    <SettingsContext.Provider value={{ settings, updateSettings, resetSettings }}>\n      {children}\n    </SettingsContext.Provider>\n  );\n}\n\nexport function useSettings() {\n  const context = useContext(SettingsContext);\n  if (context === undefined) {\n    throw new Error('useSettings must be used within a SettingsProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/contexts/ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":75,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":75,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\n\ntype Theme = 'light' | 'dark' | 'system';\n\ninterface ThemeContextType {\n  theme: Theme;\n  resolvedTheme: 'light' | 'dark';\n  setTheme: (theme: Theme) => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nconst THEME_KEY = 'mcparr-theme';\n\nfunction getSystemTheme(): 'light' | 'dark' {\n  if (typeof window === 'undefined') return 'light';\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n}\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setThemeState] = useState<Theme>(() => {\n    if (typeof window === 'undefined') return 'system';\n    const stored = localStorage.getItem(THEME_KEY);\n    if (stored === 'light' || stored === 'dark' || stored === 'system') {\n      return stored;\n    }\n    return 'system';\n  });\n\n  const [resolvedTheme, setResolvedTheme] = useState<'light' | 'dark'>(() => {\n    if (theme === 'system') return getSystemTheme();\n    return theme;\n  });\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    const applyTheme = () => {\n      const resolved = theme === 'system' ? getSystemTheme() : theme;\n      setResolvedTheme(resolved);\n\n      if (resolved === 'dark') {\n        root.classList.add('dark');\n      } else {\n        root.classList.remove('dark');\n      }\n    };\n\n    applyTheme();\n\n    // Listen for system theme changes\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = () => {\n      if (theme === 'system') {\n        applyTheme();\n      }\n    };\n\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, [theme]);\n\n  const setTheme = (newTheme: Theme) => {\n    setThemeState(newTheme);\n    localStorage.setItem(THEME_KEY, newTheme);\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, resolvedTheme, setTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/hooks/useSystemMetrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/hooks/useTrainingWebSocket.ts","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":268,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":268,"endColumn":58,"suggestions":[{"messageId":"addBrackets","fix":{"range":[7401,7765],"text":"{ const sessionUpdate = message as SessionUpdate;\n          setSessionUpdates(prev => {\n            const updated = new Map(prev);\n            updated.set(sessionUpdate.session_id, sessionUpdate);\n            return updated;\n          });\n          // Use ref to avoid re-creating this callback\n          onSessionUpdateRef.current?.(sessionUpdate);\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":279,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":279,"endColumn":56,"suggestions":[{"messageId":"addBrackets","fix":{"range":[7802,8324],"text":"{ const logMessage = message as LogLineMessage;\n          setSessionLogs(prev => {\n            const updated = new Map(prev);\n            const logs = updated.get(logMessage.session_id) || [];\n            // Keep last 500 logs per session\n            const newLogs = [...logs, logMessage.data].slice(-500);\n            updated.set(logMessage.session_id, newLogs);\n            return updated;\n          });\n          // Use ref to avoid re-creating this callback\n          onLogLineRef.current?.(logMessage);\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":306,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8773,8776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8773,8776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'connect' and 'disconnect'. Either include them or remove the dependency array.","line":507,"column":6,"nodeType":"ArrayExpression","endLine":507,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [autoConnect, connect, disconnect]","fix":{"range":[14697,14710],"text":"[autoConnect, connect, disconnect]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\nimport { getApiBaseUrl } from '../lib/api';\n\n// ============= Training Metrics Types =============\n\nexport interface ProgressMetrics {\n  current_epoch: number;\n  total_epochs: number;\n  current_step: number;\n  total_steps: number;\n  progress_percent: number;\n  samples_processed: number;\n  tokens_processed: number;\n}\n\nexport interface PerformanceMetrics {\n  loss: number | null;\n  loss_history: number[];\n  perplexity: number | null;\n  gradient_norm: number | null;\n  learning_rate: number | null;\n  accuracy: number | null;\n  entropy: number | null;\n}\n\nexport interface GPUMetrics {\n  gpu_id?: number;\n  gpu_name?: string;\n  memory_used_mb: number | null;\n  memory_total_mb: number | null;\n  memory_percent: number | null;\n  utilization_percent: number | null;\n  temperature_celsius: number | null;\n  power_watts?: number | null;\n}\n\nexport interface TimeMetrics {\n  elapsed_seconds: number;\n  eta_seconds: number | null;\n  samples_per_second: number;\n  tokens_per_second: number;\n  step_duration_ms: number;\n}\n\nexport type LossTrend = 'decreasing' | 'stable' | 'increasing' | 'fluctuating';\nexport type TrainingHealth = 'excellent' | 'good' | 'warning' | 'critical';\nexport type OverfittingRisk = 'low' | 'medium' | 'high';\n\nexport interface QualityIndicators {\n  loss_trend: LossTrend;\n  loss_improvement_rate: number;\n  training_health: TrainingHealth;\n  health_message: string;\n  overfitting_risk: OverfittingRisk;\n}\n\nexport interface ConvergenceMetrics {\n  best_loss: number | null;\n  best_loss_epoch: number;\n  best_loss_step: number;\n  epochs_without_improvement: number;\n  should_early_stop: boolean;\n  early_stop_reason: string | null;\n}\n\nexport interface TrainingMetrics {\n  progress: ProgressMetrics;\n  performance: PerformanceMetrics;\n  gpu: GPUMetrics | null;\n  time: TimeMetrics;\n  quality: QualityIndicators;\n  convergence: ConvergenceMetrics;\n}\n\n// ============= Message Types =============\n\nexport type UpdateType = 'progress' | 'metrics' | 'started' | 'completed' | 'failed' | 'cancelled';\n\nexport interface SessionUpdate {\n  type: 'session_update';\n  session_id: string;\n  update_type: UpdateType;\n  data: TrainingMetrics;\n  timestamp: string;\n}\n\nexport interface LogLine {\n  timestamp: string;\n  level: string;\n  message: string;\n  job_id?: string;\n}\n\nexport interface LogLineMessage {\n  type: 'log_line';\n  session_id: string;\n  data: LogLine;\n  timestamp: string;\n}\n\n// Legacy types for backward compatibility\nexport interface OllamaHealth {\n  status: 'healthy' | 'unhealthy' | 'unknown';\n  version?: string;\n  url?: string;\n  error?: string;\n}\n\nexport interface OllamaModel {\n  name: string;\n  model: string;\n  modified_at?: string;\n  size: number;\n  size_gb: number;\n  digest: string;\n  family: string;\n  parameter_size: string;\n  quantization_level: string;\n  details: Record<string, unknown>;\n}\n\nexport interface OllamaMetrics {\n  type: 'ollama_metrics';\n  health: OllamaHealth;\n  models: OllamaModel[];\n  running_models: Record<string, unknown>[];\n  model_count?: number;\n  total_size_gb?: number;\n  running_count?: number;\n  error?: string;\n  timestamp?: string;\n}\n\nexport interface TrainingStats {\n  active_sessions: number;\n  queued_sessions: number;\n  completed_today: number;\n  total_prompts: number;\n  validated_prompts: number;\n}\n\nexport interface TrainingUpdate {\n  type: 'training_update';\n  stats: TrainingStats;\n  recent_activity: Record<string, unknown>[];\n  timestamp?: string;\n}\n\nexport interface SessionProgress {\n  current_step: number;\n  total_steps: number;\n  percent_complete: number;\n  current_prompt: string | null;\n  prompts_processed: number;\n  prompts_total: number;\n}\n\nexport interface SessionMetricsLegacy {\n  loss: number | null;\n  accuracy: number | null;\n  learning_rate: number | null;\n  elapsed_seconds: number;\n  estimated_remaining_seconds: number | null;\n}\n\nexport interface SessionProgressUpdate {\n  type: 'session_progress';\n  session_id: string;\n  status: string;\n  progress: SessionProgress;\n  metrics: SessionMetricsLegacy;\n  timestamp?: string;\n}\n\ntype TrainingMessage =\n  | OllamaMetrics\n  | TrainingUpdate\n  | SessionProgressUpdate\n  | SessionUpdate\n  | LogLineMessage\n  | { type: string; [key: string]: unknown };\n\ninterface UseTrainingWebSocketOptions {\n  autoConnect?: boolean;\n  reconnectInterval?: number;\n  maxReconnectAttempts?: number;\n  onSessionUpdate?: (update: SessionUpdate) => void;\n  onLogLine?: (log: LogLineMessage) => void;\n}\n\ninterface UseTrainingWebSocketReturn {\n  connected: boolean;\n  connecting: boolean;\n  error: string | null;\n  ollamaMetrics: OllamaMetrics | null;\n  trainingUpdate: TrainingUpdate | null;\n  sessionProgress: SessionProgressUpdate | null;\n  // New: real-time session updates\n  sessionUpdates: Map<string, SessionUpdate>;\n  sessionLogs: Map<string, LogLine[]>;\n  connect: () => void;\n  disconnect: () => void;\n  subscribeToOllamaMetrics: (intervalSeconds?: number, ollamaUrl?: string) => void;\n  unsubscribeFromOllamaMetrics: () => void;\n  subscribeToTraining: (intervalSeconds?: number) => void;\n  unsubscribeFromTraining: () => void;\n  subscribeToSession: (sessionId: string, intervalSeconds?: number) => void;\n  unsubscribeFromSession: (sessionId?: string) => void;\n}\n\nexport function useTrainingWebSocket(\n  options: UseTrainingWebSocketOptions = {}\n): UseTrainingWebSocketReturn {\n  const {\n    autoConnect = false,\n    reconnectInterval = 5000,\n    maxReconnectAttempts = 5,\n    onSessionUpdate,\n    onLogLine,\n  } = options;\n\n  const [connected, setConnected] = useState(false);\n  const [connecting, setConnecting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [ollamaMetrics, setOllamaMetrics] = useState<OllamaMetrics | null>(null);\n  const [trainingUpdate, setTrainingUpdate] = useState<TrainingUpdate | null>(null);\n  const [sessionProgress, setSessionProgress] = useState<SessionProgressUpdate | null>(null);\n  const [sessionUpdates, setSessionUpdates] = useState<Map<string, SessionUpdate>>(new Map());\n  const [sessionLogs, setSessionLogs] = useState<Map<string, LogLine[]>>(new Map());\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectAttemptsRef = useRef(0);\n  const reconnectTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const subscribedSessionsRef = useRef<Set<string>>(new Set());\n  const connectingRef = useRef(false);\n  const mountedRef = useRef(true);\n  // Store callbacks in refs to avoid dependency issues\n  const onSessionUpdateRef = useRef(onSessionUpdate);\n  const onLogLineRef = useRef(onLogLine);\n\n  // Keep refs updated with latest callbacks\n  useEffect(() => {\n    onSessionUpdateRef.current = onSessionUpdate;\n  }, [onSessionUpdate]);\n\n  useEffect(() => {\n    onLogLineRef.current = onLogLine;\n  }, [onLogLine]);\n\n  const getWsUrl = useCallback(() => {\n    const baseUrl = getApiBaseUrl();\n    // Convert http(s) to ws(s)\n    const wsProtocol = baseUrl.startsWith('https') ? 'wss' : 'ws';\n    const wsHost = baseUrl.replace(/^https?:\\/\\//, '');\n    return `${wsProtocol}://${wsHost}/api/training/ws`;\n  }, []);\n\n  const handleMessage = useCallback((event: MessageEvent) => {\n    try {\n      const message: TrainingMessage = JSON.parse(event.data);\n\n      switch (message.type) {\n        case 'connected':\n          console.log('[TrainingWS] Connected');\n          break;\n\n        case 'session_update':\n          const sessionUpdate = message as SessionUpdate;\n          setSessionUpdates(prev => {\n            const updated = new Map(prev);\n            updated.set(sessionUpdate.session_id, sessionUpdate);\n            return updated;\n          });\n          // Use ref to avoid re-creating this callback\n          onSessionUpdateRef.current?.(sessionUpdate);\n          break;\n\n        case 'log_line':\n          const logMessage = message as LogLineMessage;\n          setSessionLogs(prev => {\n            const updated = new Map(prev);\n            const logs = updated.get(logMessage.session_id) || [];\n            // Keep last 500 logs per session\n            const newLogs = [...logs, logMessage.data].slice(-500);\n            updated.set(logMessage.session_id, newLogs);\n            return updated;\n          });\n          // Use ref to avoid re-creating this callback\n          onLogLineRef.current?.(logMessage);\n          break;\n\n        case 'ollama_metrics':\n          setOllamaMetrics(message as OllamaMetrics);\n          break;\n\n        case 'training_update':\n          setTrainingUpdate(message as TrainingUpdate);\n          break;\n\n        case 'session_progress':\n          setSessionProgress(message as SessionProgressUpdate);\n          break;\n\n        case 'subscribed':\n        case 'unsubscribed':\n          console.log(`[TrainingWS] ${message.type}: ${(message as any).session_id}`);\n          break;\n\n        case 'ollama_metrics_subscribed':\n        case 'ollama_metrics_unsubscribed':\n        case 'training_subscribed':\n        case 'training_unsubscribed':\n        case 'session_subscribed':\n        case 'session_unsubscribed':\n          console.log(`[TrainingWS] ${message.type}`);\n          break;\n\n        case 'pong':\n          // Heartbeat response\n          break;\n\n        case 'error':\n          console.error('[TrainingWS] Error:', message);\n          setError((message as { message?: string }).message || 'Unknown error');\n          break;\n\n        default:\n          console.log('[TrainingWS] Unknown message:', message);\n      }\n    } catch (err) {\n      console.error('[TrainingWS] Failed to parse message:', err);\n    }\n  }, []);\n\n  const connect = useCallback(() => {\n    // Check if already connected or connecting using refs to avoid dependency issues\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      return;\n    }\n\n    if (wsRef.current?.readyState === WebSocket.CONNECTING) {\n      return;\n    }\n\n    if (connectingRef.current) {\n      return;\n    }\n\n    connectingRef.current = true;\n    setConnecting(true);\n    setError(null);\n\n    const wsUrl = getWsUrl();\n    console.log('[TrainingWS] Connecting to:', wsUrl);\n\n    try {\n      const ws = new WebSocket(wsUrl);\n\n      ws.onopen = () => {\n        if (!mountedRef.current) return;\n        console.log('[TrainingWS] Opened');\n        connectingRef.current = false;\n        setConnected(true);\n        setConnecting(false);\n        setError(null);\n        reconnectAttemptsRef.current = 0;\n\n        // Re-subscribe to all previously subscribed sessions\n        subscribedSessionsRef.current.forEach((sessionId) => {\n          ws.send(JSON.stringify({ type: 'subscribe', session_id: sessionId }));\n        });\n      };\n\n      ws.onclose = (event) => {\n        if (!mountedRef.current) return;\n        console.log('[TrainingWS] Closed:', event.code, event.reason);\n        connectingRef.current = false;\n        setConnected(false);\n        setConnecting(false);\n        wsRef.current = null;\n\n        // Auto-reconnect if not closed intentionally and component still mounted\n        if (mountedRef.current && event.code !== 1000 && reconnectAttemptsRef.current < maxReconnectAttempts) {\n          reconnectAttemptsRef.current += 1;\n          console.log(\n            `[TrainingWS] Reconnecting (attempt ${reconnectAttemptsRef.current}/${maxReconnectAttempts})...`\n          );\n          reconnectTimeoutRef.current = setTimeout(() => {\n            if (mountedRef.current) {\n              connect();\n            }\n          }, reconnectInterval);\n        }\n      };\n\n      ws.onerror = (event) => {\n        if (!mountedRef.current) return;\n        console.error('[TrainingWS] Error:', event);\n        setError('WebSocket connection error');\n        connectingRef.current = false;\n        setConnecting(false);\n      };\n\n      ws.onmessage = handleMessage;\n\n      wsRef.current = ws;\n    } catch (err) {\n      console.error('[TrainingWS] Failed to create WebSocket:', err);\n      setError(err instanceof Error ? err.message : 'Failed to connect');\n      connectingRef.current = false;\n      setConnecting(false);\n    }\n  }, [getWsUrl, handleMessage, maxReconnectAttempts, reconnectInterval]);\n\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n\n    if (wsRef.current) {\n      wsRef.current.close(1000, 'Client disconnect');\n      wsRef.current = null;\n    }\n\n    connectingRef.current = false;\n    setConnected(false);\n    setConnecting(false);\n    reconnectAttemptsRef.current = maxReconnectAttempts; // Prevent auto-reconnect\n  }, [maxReconnectAttempts]);\n\n  const sendMessage = useCallback((message: Record<string, unknown>) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n    } else {\n      console.warn('[TrainingWS] Not connected, cannot send message');\n    }\n  }, []);\n\n  const subscribeToOllamaMetrics = useCallback(\n    (intervalSeconds: number = 10, ollamaUrl?: string) => {\n      sendMessage({\n        type: 'subscribe_ollama_metrics',\n        interval_seconds: intervalSeconds,\n        ...(ollamaUrl && { ollama_url: ollamaUrl }),\n      });\n    },\n    [sendMessage]\n  );\n\n  const unsubscribeFromOllamaMetrics = useCallback(() => {\n    sendMessage({ type: 'unsubscribe_ollama_metrics' });\n    setOllamaMetrics(null);\n  }, [sendMessage]);\n\n  const subscribeToTraining = useCallback(\n    (intervalSeconds: number = 5) => {\n      sendMessage({\n        type: 'subscribe_training',\n        interval_seconds: intervalSeconds,\n      });\n    },\n    [sendMessage]\n  );\n\n  const unsubscribeFromTraining = useCallback(() => {\n    sendMessage({ type: 'unsubscribe_training' });\n    setTrainingUpdate(null);\n  }, [sendMessage]);\n\n  const subscribeToSession = useCallback(\n    (sessionId: string, intervalSeconds: number = 2) => {\n      subscribedSessionsRef.current.add(sessionId);\n      sendMessage({\n        type: 'subscribe',\n        session_id: sessionId,\n        interval_seconds: intervalSeconds,\n      });\n    },\n    [sendMessage]\n  );\n\n  const unsubscribeFromSession = useCallback((sessionId?: string) => {\n    if (sessionId) {\n      subscribedSessionsRef.current.delete(sessionId);\n      sendMessage({ type: 'unsubscribe', session_id: sessionId });\n    } else {\n      // Legacy: unsubscribe from current session\n      sendMessage({ type: 'unsubscribe_session' });\n    }\n    setSessionProgress(null);\n  }, [sendMessage]);\n\n  // Auto-connect on mount if enabled\n  useEffect(() => {\n    mountedRef.current = true;\n\n    if (autoConnect) {\n      connect();\n    }\n\n    return () => {\n      mountedRef.current = false;\n      disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoConnect]);\n\n  // Keepalive ping\n  useEffect(() => {\n    if (!connected) return;\n\n    const pingInterval = setInterval(() => {\n      sendMessage({ type: 'ping' });\n    }, 30000);\n\n    return () => clearInterval(pingInterval);\n  }, [connected, sendMessage]);\n\n  return {\n    connected,\n    connecting,\n    error,\n    ollamaMetrics,\n    trainingUpdate,\n    sessionProgress,\n    sessionUpdates,\n    sessionLogs,\n    connect,\n    disconnect,\n    subscribeToOllamaMetrics,\n    unsubscribeFromOllamaMetrics,\n    subscribeToTraining,\n    unsubscribeFromTraining,\n    subscribeToSession,\n    unsubscribeFromSession,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/lib/api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1367,1370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1367,1370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1706,1709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1706,1709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3101,3104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3101,3104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3150,3153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3150,3153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3587,3590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3587,3590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3726,3729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3726,3729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3752,3755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3752,3755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3948,3951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3948,3951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3974,3977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3974,3977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4171,4174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4171,4174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4197,4200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4197,4200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4397,4400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4397,4400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4597,4600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4597,4600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4913,4916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4913,4916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5689,5692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5689,5692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5736,5739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5736,5739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6909,6912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6909,6912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6988,6991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6988,6991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":264,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7490,7493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7490,7493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7568,7571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7568,7571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":271,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7755,7758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7755,7758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8266,8269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8266,8269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8512,8515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8512,8515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":292,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8680,8683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8680,8683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8766,8769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8766,8769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":302,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9129,9132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9129,9132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10064,10067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10064,10067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10251,10254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10251,10254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":348,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11175,11178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11175,11178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":359,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11648,11651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11648,11651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11725,11728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11725,11728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12918,12921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12918,12921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15487,15490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15487,15490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":423,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15576,15579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15576,15579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17269,17272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17269,17272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":454,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17357,17360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17357,17360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":463,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":463,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17822,17825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17822,17825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":543,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21065,21068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21065,21068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":38,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * API client with error handling and correlation IDs\n */\n\n// ApiResponse type is defined in types/api.ts but not used here directly\n\ninterface RequestOptions extends RequestInit {\n  params?: Record<string, string | number | boolean>;\n}\n\n/**\n * Get the API base URL dynamically based on the current environment\n * This allows the frontend to work from any device on the network\n */\nconst getApiBaseUrl = (): string => {\n  // Check for explicit environment variable first\n  const envApiUrl = import.meta.env.VITE_API_URL;\n\n  // In production, use the environment variable if set\n  if (import.meta.env.PROD && envApiUrl) {\n    return envApiUrl;\n  }\n\n  // In development or if no env var, dynamically use the current hostname\n  // This allows access from other devices on the local network\n  const hostname = typeof window !== 'undefined' ? window.location.hostname : 'localhost';\n  return `http://${hostname}:8000`;\n};\n\nclass ApiClient {\n  private baseUrl: string;\n  private defaultHeaders: Record<string, string>;\n\n  constructor(baseUrl?: string) {\n    this.baseUrl = baseUrl || getApiBaseUrl();\n    this.defaultHeaders = {\n      'Content-Type': 'application/json',\n    };\n  }\n\n  private generateCorrelationId(): string {\n    return `frontend-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private buildUrl(path: string, params?: Record<string, any>): string {\n    const url = new URL(path, this.baseUrl);\n\n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          url.searchParams.append(key, value.toString());\n        }\n      });\n    }\n\n    return url.toString();\n  }\n\n  private async makeRequest<T = any>(\n    method: string,\n    path: string,\n    options: RequestOptions = {}\n  ): Promise<T> {\n    const { params, ...fetchOptions } = options;\n\n    const url = this.buildUrl(path, params);\n    const correlationId = this.generateCorrelationId();\n\n    const headers = {\n      ...this.defaultHeaders,\n      'X-Correlation-ID': correlationId,\n      ...fetchOptions.headers,\n    };\n\n    try {\n      const response = await fetch(url, {\n        method,\n        headers,\n        ...fetchOptions,\n      });\n\n      // Handle 204 No Content responses (common for DELETE operations)\n      if (response.status === 204) {\n        return undefined as T;\n      }\n\n      const contentType = response.headers.get('Content-Type');\n      let data;\n\n      if (contentType?.includes('application/json')) {\n        data = await response.json();\n      } else {\n        const text = await response.text();\n        // Try to parse as JSON if it looks like JSON, otherwise return the text\n        if (text && (text.startsWith('{') || text.startsWith('['))) {\n          try {\n            data = JSON.parse(text);\n          } catch {\n            data = text;\n          }\n        } else {\n          data = text || undefined;\n        }\n      }\n\n      if (!response.ok) {\n        const error = new Error(\n          data?.error || data?.message || `HTTP ${response.status}: ${response.statusText}`\n        );\n        (error as any).status = response.status;\n        (error as any).correlationId = response.headers.get('X-Correlation-ID') || correlationId;\n        throw error;\n      }\n\n      return data;\n    } catch (error) {\n      console.error(`API Error [${method} ${path}]:`, error);\n\n      if (error instanceof TypeError && error.message.includes('fetch')) {\n        throw new Error('Network error: Unable to connect to API server');\n      }\n\n      throw error;\n    }\n  }\n\n  // HTTP Methods\n  async get<T = any>(path: string, options: RequestOptions = {}): Promise<T> {\n    return this.makeRequest<T>('GET', path, options);\n  }\n\n  async post<T = any>(path: string, data?: any, options: RequestOptions = {}): Promise<T> {\n    return this.makeRequest<T>('POST', path, {\n      ...options,\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async put<T = any>(path: string, data?: any, options: RequestOptions = {}): Promise<T> {\n    return this.makeRequest<T>('PUT', path, {\n      ...options,\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async patch<T = any>(path: string, data?: any, options: RequestOptions = {}): Promise<T> {\n    return this.makeRequest<T>('PATCH', path, {\n      ...options,\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async delete<T = any>(path: string, options: RequestOptions = {}): Promise<T> {\n    return this.makeRequest<T>('DELETE', path, options);\n  }\n\n  // Convenience methods for common patterns\n  async getWithPagination<T = any>(\n    path: string,\n    offset: number = 0,\n    limit: number = 100,\n    options: RequestOptions = {}\n  ): Promise<T> {\n    return this.get<T>(path, {\n      ...options,\n      params: {\n        ...options.params,\n        offset,\n        limit,\n      },\n    });\n  }\n\n  // File upload helper\n  async uploadFile<T = any>(\n    path: string,\n    file: File,\n    fieldName: string = 'file',\n    additionalData?: Record<string, string>\n  ): Promise<T> {\n    const correlationId = this.generateCorrelationId();\n    const formData = new FormData();\n\n    formData.append(fieldName, file);\n\n    if (additionalData) {\n      Object.entries(additionalData).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n    }\n\n    const response = await fetch(this.buildUrl(path), {\n      method: 'POST',\n      headers: {\n        'X-Correlation-ID': correlationId,\n      },\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const data = await response.json().catch(() => ({}));\n      const error = new Error(data.error || `Upload failed: ${response.statusText}`);\n      (error as any).status = response.status;\n      (error as any).correlationId = response.headers.get('X-Correlation-ID') || correlationId;\n      throw error;\n    }\n\n    return response.json();\n  }\n}\n\n// Create default API client instance\nexport const apiClient = new ApiClient();\n\n// Export class for custom instances\nexport { ApiClient };\n\n// Export the base URL getter for components that need it\nexport { getApiBaseUrl };\n\n// API endpoint helpers\nexport const api = {\n  // Base URL helper\n  getBaseUrl: getApiBaseUrl,\n\n  // Health\n  health: () => apiClient.get('/health'),\n  healthDetailed: () => apiClient.get('/health/detailed'),\n\n  // Dashboard\n  dashboard: {\n    overview: () => apiClient.get('/api/v1/dashboard/overview'),\n  },\n\n  // System\n  system: {\n    health: () => apiClient.get('/api/v1/system/health'),\n    metrics: (duration: string = '5m') =>\n      apiClient.get('/api/v1/system/metrics', { params: { duration } }),\n    currentMetrics: () => apiClient.get('/api/v1/system/system-metrics'),\n  },\n\n  // Services\n  services: {\n    list: (status?: string) =>\n      apiClient.get('/api/services/', { params: status ? { status } : {} }),\n    get: (id: string) => apiClient.get(`/api/services/${id}`),\n    create: (data: any) => apiClient.post('/api/services/', data),\n    update: (id: string, data: any) => apiClient.put(`/api/services/${id}`, data),\n    delete: (id: string) => apiClient.delete(`/api/services/${id}`),\n    test: (id: string) => apiClient.post(`/api/services/${id}/test`),\n  },\n\n  // Users\n  users: {\n    list: (search?: string, service?: string) =>\n      apiClient.get('/api/v1/users', {\n        params: {\n          ...(search && { search }),\n          ...(service && { service })\n        }\n      }),\n    get: (id: string) => apiClient.get(`/api/v1/users/${id}`),\n    create: (data: any) => apiClient.post('/api/v1/users', data),\n    update: (id: string, data: any) => apiClient.put(`/api/v1/users/${id}`, data),\n    syncAuthentik: () => apiClient.post('/api/v1/users/sync-authentik'),\n  },\n\n  // Logs\n  logs: {\n    list: (filters?: Record<string, any>) =>\n      apiClient.get('/api/logs/', { params: filters }),\n    stats: (hours: number = 24) =>\n      apiClient.get('/api/logs/stats', { params: { hours } }),\n    sources: () => apiClient.get('/api/logs/sources'),\n    components: (source?: string) =>\n      apiClient.get('/api/logs/components', { params: source ? { source } : {} }),\n    trace: (correlationId: string) =>\n      apiClient.get(`/api/logs/trace/${correlationId}`),\n    get: (id: string) => apiClient.get(`/api/logs/${id}`),\n    create: (data: any) => apiClient.post('/api/logs/', data),\n    cleanup: () => apiClient.post('/api/logs/cleanup'),\n    levels: () => apiClient.get('/api/logs/levels/available'),\n  },\n\n  // Alerts\n  alerts: {\n    configs: {\n      list: (filters?: Record<string, any>) =>\n        apiClient.get('/api/alerts/configs', { params: filters }),\n      get: (id: string) => apiClient.get(`/api/alerts/configs/${id}`),\n      create: (data: any) => apiClient.post('/api/alerts/configs', data),\n      update: (id: string, data: any) =>\n        apiClient.patch(`/api/alerts/configs/${id}`, data),\n      delete: (id: string) => apiClient.delete(`/api/alerts/configs/${id}`),\n      toggle: (id: string, enabled: boolean) =>\n        apiClient.post(`/api/alerts/configs/${id}/toggle`, null, {\n          params: { enabled },\n        }),\n    },\n    history: {\n      list: (filters?: Record<string, any>) =>\n        apiClient.get('/api/alerts/history', { params: filters }),\n      active: () => apiClient.get('/api/alerts/active'),\n      resolve: (id: string, message?: string) =>\n        apiClient.post(`/api/alerts/history/${id}/resolve`, null, {\n          params: message ? { message } : {},\n        }),\n    },\n    stats: (hours: number = 24) =>\n      apiClient.get('/api/alerts/stats', { params: { hours } }),\n    severities: () => apiClient.get('/api/alerts/severities'),\n    metricTypes: () => apiClient.get('/api/alerts/metric-types'),\n    operators: () => apiClient.get('/api/alerts/operators'),\n  },\n\n  // Configuration\n  config: {\n    list: (category?: string) =>\n      apiClient.get('/api/v1/config', { params: category ? { category } : {} }),\n    update: (settings: Record<string, string>) =>\n      apiClient.put('/api/v1/config', settings),\n    backup: () => apiClient.get('/api/v1/config/backup'),\n    restore: (backup: any) => apiClient.post('/api/v1/config/backup', backup),\n  },\n\n  // MCP\n  mcp: {\n    status: () => apiClient.get('/api/mcp/status'),\n    requests: {\n      list: (filters?: Record<string, any>) =>\n        apiClient.get('/api/mcp/requests', { params: filters }),\n      get: (id: string) => apiClient.get(`/api/mcp/requests/${id}`),\n    },\n    stats: (hours: number = 24) =>\n      apiClient.get('/api/mcp/stats', { params: { hours } }),\n    toolUsage: (hours: number = 24) =>\n      apiClient.get('/api/mcp/tools/usage', { params: { hours } }),\n    hourlyUsage: (hours: number = 24) =>\n      apiClient.get('/api/mcp/hourly-usage', { params: { hours } }),\n    userStats: (hours: number = 24) =>\n      apiClient.get('/api/mcp/user-stats', { params: { hours } }),\n    userServiceStats: (hours: number = 24) =>\n      apiClient.get('/api/mcp/user-service-stats', { params: { hours } }),\n    hourlyUsageByUser: (hours: number = 24) =>\n      apiClient.get('/api/mcp/hourly-usage-by-user', { params: { hours } }),\n    tools: () => apiClient.get('/api/mcp/tools'),\n    executeTool: (toolName: string, params: Record<string, any> = {}) =>\n      apiClient.post('/api/mcp/tools/test', { tool_name: toolName, arguments: params }),\n    cleanup: (retentionDays: number = 30) =>\n      apiClient.delete('/api/mcp/cleanup', { params: { retention_days: retentionDays } }),\n  },\n\n  // Groups\n  groups: {\n    list: (enabled?: boolean) =>\n      apiClient.get('/api/groups/', { params: enabled !== undefined ? { enabled } : {} }),\n    get: (id: string) => apiClient.get(`/api/groups/${id}`),\n    create: (data: any) => apiClient.post('/api/groups/', data),\n    update: (id: string, data: any) => apiClient.put(`/api/groups/${id}`, data),\n    delete: (id: string) => apiClient.delete(`/api/groups/${id}`),\n    // Members\n    members: {\n      list: (groupId: string) => apiClient.get(`/api/groups/${groupId}/members`),\n      add: (groupId: string, data: { central_user_id: string; enabled?: boolean; granted_by?: string }) =>\n        apiClient.post(`/api/groups/${groupId}/members`, data),\n      remove: (groupId: string, membershipId: string) =>\n        apiClient.delete(`/api/groups/${groupId}/members/${membershipId}`),\n      bulk: (groupId: string, data: { central_user_ids: string[]; action: 'add' | 'remove' }) =>\n        apiClient.post(`/api/groups/${groupId}/members/bulk`, data),\n    },\n    // Permissions\n    permissions: {\n      list: (groupId: string, serviceType?: string) =>\n        apiClient.get(`/api/groups/${groupId}/permissions`, {\n          params: serviceType ? { service_type: serviceType } : {}\n        }),\n      add: (groupId: string, data: { tool_name: string; service_type?: string; enabled?: boolean; description?: string }) =>\n        apiClient.post(`/api/groups/${groupId}/permissions`, data),\n      update: (groupId: string, permissionId: string, data: any) =>\n        apiClient.put(`/api/groups/${groupId}/permissions/${permissionId}`, data),\n      delete: (groupId: string, permissionId: string) =>\n        apiClient.delete(`/api/groups/${groupId}/permissions/${permissionId}`),\n      bulk: (groupId: string, data: { tool_names: string[]; service_type?: string; enabled: boolean }) =>\n        apiClient.post(`/api/groups/${groupId}/permissions/bulk`, data),\n    },\n    // User groups\n    userGroups: (userId: string) => apiClient.get(`/api/groups/user/${userId}`),\n    // Check permission\n    checkPermission: (data: { central_user_id: string; tool_name: string; service_type?: string }) =>\n      apiClient.post('/api/groups/check-permission', data),\n    // Available tools\n    availableTools: () => apiClient.get('/api/groups/available-tools'),\n    // Tools with groups (for displaying group labels on tools)\n    toolsWithGroups: () => apiClient.get('/api/groups/tools-with-groups'),\n  },\n\n  // Training\n  training: {\n    // Ollama\n    ollama: {\n      status: (serviceId?: string) =>\n        apiClient.get('/api/training/ollama/status', { params: serviceId ? { service_id: serviceId } : {} }),\n      metrics: (serviceId?: string) =>\n        apiClient.get('/api/training/ollama/metrics', { params: serviceId ? { service_id: serviceId } : {} }),\n      models: (serviceId?: string) =>\n        apiClient.get('/api/training/ollama/models', { params: serviceId ? { service_id: serviceId } : {} }),\n      modelInfo: (modelName: string, serviceId?: string) =>\n        apiClient.get(`/api/training/ollama/models/${encodeURIComponent(modelName)}`, { params: serviceId ? { service_id: serviceId } : {} }),\n      deleteModel: (modelName: string, serviceId?: string) =>\n        apiClient.delete(`/api/training/ollama/models/${encodeURIComponent(modelName)}`, { params: serviceId ? { service_id: serviceId } : {} }),\n      loadModel: (modelName: string, serviceId?: string) =>\n        apiClient.post(`/api/training/ollama/models/${encodeURIComponent(modelName)}/load`, null, { params: serviceId ? { service_id: serviceId } : {} }),\n      unloadModel: (modelName: string, serviceId?: string) =>\n        apiClient.post(`/api/training/ollama/models/${encodeURIComponent(modelName)}/unload`, null, { params: serviceId ? { service_id: serviceId } : {} }),\n    },\n    // Sessions\n    sessions: {\n      list: (filters?: { status?: string; skip?: number; limit?: number }) =>\n        apiClient.get('/api/training/sessions', { params: filters }),\n      get: (id: string) => apiClient.get(`/api/training/sessions/${id}`),\n      create: (data: any) => apiClient.post('/api/training/sessions', data),\n      update: (id: string, data: any) => apiClient.patch(`/api/training/sessions/${id}`, data),\n      delete: (id: string) => apiClient.delete(`/api/training/sessions/${id}`),\n      duplicate: (id: string) => apiClient.post(`/api/training/sessions/${id}/duplicate`),\n      start: (id: string, backend: 'ollama_modelfile' | 'unsloth' = 'ollama_modelfile') =>\n        apiClient.post(`/api/training/sessions/${id}/start`, null, { params: { backend } }),\n      cancel: (id: string) => apiClient.post(`/api/training/sessions/${id}/cancel`),\n      getLogs: (id: string) => apiClient.get(`/api/training/sessions/${id}/logs`),\n      getSummary: (id: string) => apiClient.get(`/api/training/sessions/${id}/summary`),\n      // Session prompts management\n      getPrompts: (id: string) => apiClient.get(`/api/training/sessions/${id}/prompts`),\n      setPrompts: (id: string, promptIds: string[]) =>\n        apiClient.put(`/api/training/sessions/${id}/prompts`, { prompt_ids: promptIds }),\n      addPrompts: (id: string, promptIds: string[]) =>\n        apiClient.post(`/api/training/sessions/${id}/prompts/add`, { prompt_ids: promptIds }),\n      removePrompts: (id: string, promptIds: string[]) =>\n        apiClient.post(`/api/training/sessions/${id}/prompts/remove`, { prompt_ids: promptIds }),\n    },\n    // Prompts\n    prompts: {\n      list: (filters?: {\n        category?: string;\n        difficulty?: string;\n        validated?: boolean;\n        enabled?: boolean;\n        session_id?: string;\n        search?: string;\n        skip?: number;\n        limit?: number;\n      }) => apiClient.get('/api/training/prompts', { params: filters }),\n      get: (id: string) => apiClient.get(`/api/training/prompts/${id}`),\n      create: (data: any) => apiClient.post('/api/training/prompts', data),\n      update: (id: string, data: any) => apiClient.patch(`/api/training/prompts/${id}`, data),\n      delete: (id: string) => apiClient.delete(`/api/training/prompts/${id}`),\n      validate: (id: string, score?: number, validatedBy?: string) =>\n        apiClient.post(`/api/training/prompts/${id}/validate`, null, {\n          params: {\n            ...(score !== undefined && { score }),\n            ...(validatedBy && { validated_by: validatedBy }),\n          },\n        }),\n      import: (prompts: any[]) => apiClient.post('/api/training/prompts/import', prompts),\n      export: (filters?: { category?: string; session_id?: string; format?: string }) =>\n        apiClient.get('/api/training/prompts/export', { params: filters }),\n      seed: (reset: boolean = false) => apiClient.post('/api/training/prompts/seed', undefined, { params: { reset } }),\n      deleteAll: () => apiClient.delete('/api/training/prompts/all'),\n    },\n    // Stats\n    stats: () => apiClient.get('/api/training/stats'),\n    // Worker (GPU training worker)\n    worker: {\n      status: () => apiClient.get('/api/training/worker/status'),\n      models: () => apiClient.get('/api/training/worker/models'),\n    },\n  },\n\n  // Training Workers\n  workers: {\n    list: (enabledOnly?: boolean) =>\n      apiClient.get('/api/workers', { params: enabledOnly ? { enabled_only: true } : {} }),\n    get: (id: string) => apiClient.get(`/api/workers/${id}`),\n    create: (data: {\n      name: string;\n      description?: string;\n      url: string;\n      api_key?: string;\n      ollama_service_id?: string;\n    }) => apiClient.post('/api/workers', data),\n    update: (id: string, data: {\n      name?: string;\n      description?: string;\n      url?: string;\n      api_key?: string;\n      enabled?: boolean;\n      ollama_service_id?: string;\n    }) => apiClient.patch(`/api/workers/${id}`, data),\n    delete: (id: string) => apiClient.delete(`/api/workers/${id}`),\n    test: (id: string) => apiClient.post(`/api/workers/${id}/test`),\n    refresh: (id: string) => apiClient.post(`/api/workers/${id}/refresh`),\n    refreshAll: () => apiClient.post('/api/workers/refresh-all'),\n    getMetrics: (id: string) => apiClient.get(`/api/workers/${id}/metrics`),\n    getMetricsHistory: (id: string, limit?: number, minutes?: number) =>\n      apiClient.get(`/api/workers/${id}/metrics/history`, { params: { ...(limit && { limit }), ...(minutes && { minutes }) } }),\n    getModels: (id: string) => apiClient.get(`/api/workers/${id}/models`),\n    // Training control\n    startTraining: (workerId: string, data: {\n      session_id: string;\n      base_model?: string;\n      output_model_name: string;\n      overwrite_existing?: boolean;\n      num_epochs?: number;\n      batch_size?: number;\n      learning_rate?: number;\n      max_seq_length?: number;\n      warmup_steps?: number;\n      lora_r?: number;\n      lora_alpha?: number;\n      quantization_method?: string;\n    }) => apiClient.post(`/api/workers/${workerId}/training/start`, data),\n    getTrainingStatus: (id: string) => apiClient.get(`/api/workers/${id}/training/status`),\n    cancelTraining: (id: string) => apiClient.post(`/api/workers/${id}/training/cancel`),\n  },\n\n  // Backup/Restore\n  backup: {\n    preview: (options?: {\n      services?: boolean;\n      user_mappings?: boolean;\n      groups?: boolean;\n      site_config?: boolean;\n      training_prompts?: boolean;\n    }) => apiClient.get('/api/backup/preview', { params: options }),\n    export: (options?: {\n      services?: boolean;\n      user_mappings?: boolean;\n      groups?: boolean;\n      site_config?: boolean;\n      training_prompts?: boolean;\n    }) => apiClient.post('/api/backup/export', options || {}),\n    import: (data: {\n      version: string;\n      data: Record<string, any>;\n      options?: {\n        services?: boolean;\n        user_mappings?: boolean;\n        groups?: boolean;\n        site_config?: boolean;\n        training_prompts?: boolean;\n        merge_mode?: boolean;\n      };\n    }) => apiClient.post('/api/backup/import', data),\n  },\n};","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/lib/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/lib/serviceColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Configuration.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3662,3665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3662,3665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPreviewStats'. Either include it or remove the dependency array.","line":140,"column":6,"nodeType":"ArrayExpression","endLine":140,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, exportOptions, fetchPreviewStats]","fix":{"range":[3906,3932],"text":"[activeTab, exportOptions, fetchPreviewStats]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport {\n  Settings,\n  Palette,\n  Bell,\n  FileText,\n  Monitor,\n  Moon,\n  Sun,\n  RotateCcw,\n  Check,\n  RefreshCw,\n  LayoutDashboard,\n  Download,\n  Upload,\n  Database,\n  Server,\n  Users,\n  Shield,\n  Brain,\n  Wrench,\n  AlertCircle,\n  CheckCircle,\n  Loader2,\n  FolderArchive,\n} from 'lucide-react';\nimport { useTheme } from '../contexts/ThemeContext';\nimport { useSettings, type LogLevel } from '../contexts/SettingsContext';\nimport { api } from '../lib/api';\n\ntype TabId = 'appearance' | 'general' | 'logs' | 'notifications' | 'dashboard' | 'backup';\n\nconst tabs = [\n  { id: 'appearance' as const, label: 'Apparence', icon: Palette },\n  { id: 'general' as const, label: 'General', icon: RefreshCw },\n  { id: 'logs' as const, label: 'Logs', icon: FileText },\n  { id: 'notifications' as const, label: 'Alertes', icon: Bell },\n  { id: 'dashboard' as const, label: 'Dashboard', icon: LayoutDashboard },\n  { id: 'backup' as const, label: 'Backup', icon: FolderArchive },\n];\n\ninterface ExportOptions {\n  services: boolean;\n  user_mappings: boolean;\n  groups: boolean;\n  site_config: boolean;\n  training_prompts: boolean;\n}\n\ninterface ImportOptions extends ExportOptions {\n  merge_mode: boolean;\n}\n\ninterface PreviewStats {\n  services?: number;\n  user_mappings?: number;\n  groups?: number;\n  group_memberships?: number;\n  group_permissions?: number;\n  site_config?: number;\n  training_prompts?: number;\n}\n\nconst logLevels: { value: LogLevel; label: string }[] = [\n  { value: 'debug', label: 'Debug' },\n  { value: 'info', label: 'Info' },\n  { value: 'warning', label: 'Warning' },\n  { value: 'error', label: 'Error' },\n  { value: 'critical', label: 'Critical' },\n];\n\n// Toggle Switch Component\nfunction Toggle({\n  enabled,\n  onChange,\n  disabled = false,\n}: {\n  enabled: boolean;\n  onChange: (value: boolean) => void;\n  disabled?: boolean;\n}) {\n  return (\n    <button\n      type=\"button\"\n      onClick={() => !disabled && onChange(!enabled)}\n      disabled={disabled}\n      className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n        disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'\n      } ${enabled ? 'bg-blue-600' : 'bg-gray-300 dark:bg-gray-600'}`}\n    >\n      <span\n        className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n          enabled ? 'translate-x-6' : 'translate-x-1'\n        }`}\n      />\n    </button>\n  );\n}\n\nexport default function Configuration() {\n  const [activeTab, setActiveTab] = useState<TabId>('appearance');\n  const { theme, setTheme } = useTheme();\n  const { settings, updateSettings, resetSettings } = useSettings();\n  const [showResetConfirm, setShowResetConfirm] = useState(false);\n\n  // Backup states\n  const [exportOptions, setExportOptions] = useState<ExportOptions>({\n    services: true,\n    user_mappings: true,\n    groups: true,\n    site_config: true,\n    training_prompts: true,\n  });\n  const [importOptions, setImportOptions] = useState<ImportOptions>({\n    services: true,\n    user_mappings: true,\n    groups: true,\n    site_config: true,\n    training_prompts: true,\n    merge_mode: false,\n  });\n  const [previewStats, setPreviewStats] = useState<PreviewStats>({});\n  const [loadingPreview, setLoadingPreview] = useState(false);\n  const [exporting, setExporting] = useState(false);\n  const [importing, setImporting] = useState(false);\n  const [importResult, setImportResult] = useState<{\n    success: boolean;\n    imported: Record<string, number>;\n    errors: { type: string; name: string; error: string }[];\n    warnings: string[];\n  } | null>(null);\n  const [importFile, setImportFile] = useState<any>(null);\n  const [importFileName, setImportFileName] = useState<string>('');\n\n  // Fetch preview stats when backup tab is selected or options change\n  useEffect(() => {\n    if (activeTab === 'backup') {\n      fetchPreviewStats();\n    }\n  }, [activeTab, exportOptions]);\n\n  const fetchPreviewStats = async () => {\n    setLoadingPreview(true);\n    try {\n      const stats = await api.backup.preview(exportOptions);\n      setPreviewStats(stats);\n    } catch (error) {\n      console.error('Failed to fetch preview stats:', error);\n    } finally {\n      setLoadingPreview(false);\n    }\n  };\n\n  const handleFullExport = async () => {\n    setExporting(true);\n    try {\n      const response = await api.backup.export(exportOptions);\n      const blob = new Blob([JSON.stringify(response, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `mcparr-backup-${new Date().toISOString().split('T')[0]}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Export failed:', error);\n    } finally {\n      setExporting(false);\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setImportFileName(file.name);\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        try {\n          const data = JSON.parse(event.target?.result as string);\n          setImportFile(data);\n          setImportResult(null);\n        } catch {\n          console.error('Invalid backup file');\n          setImportFile(null);\n        }\n      };\n      reader.readAsText(file);\n    }\n  };\n\n  const handleFullImport = async () => {\n    if (!importFile) return;\n\n    setImporting(true);\n    try {\n      const result = await api.backup.import({\n        version: importFile.version || '1.0',\n        data: importFile.data,\n        options: importOptions,\n      });\n      setImportResult(result);\n    } catch (error) {\n      console.error('Import failed:', error);\n      setImportResult({\n        success: false,\n        imported: {},\n        errors: [{ type: 'system', name: 'import', error: String(error) }],\n        warnings: [],\n      });\n    } finally {\n      setImporting(false);\n    }\n  };\n\n  const handleExportSettings = () => {\n    const exportData = {\n      theme,\n      settings,\n      exportedAt: new Date().toISOString(),\n      version: '1.0',\n    };\n    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `mcparr-settings-${new Date().toISOString().split('T')[0]}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const handleImportSettings = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (event) => {\n          try {\n            const data = JSON.parse(event.target?.result as string);\n            if (data.theme) setTheme(data.theme);\n            if (data.settings) updateSettings(data.settings);\n          } catch {\n            console.error('Invalid settings file');\n          }\n        };\n        reader.readAsText(file);\n      }\n    };\n    input.click();\n  };\n\n  const renderAppearanceTab = () => (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6\">\n      <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-4\">Theme</h3>\n      <div className=\"grid grid-cols-3 gap-3\">\n        {[\n          { value: 'light', label: 'Clair', icon: Sun },\n          { value: 'dark', label: 'Sombre', icon: Moon },\n          { value: 'system', label: 'Systeme', icon: Monitor },\n        ].map((option) => (\n          <button\n            key={option.value}\n            onClick={() => setTheme(option.value as 'light' | 'dark' | 'system')}\n            className={`relative flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${\n              theme === option.value\n                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n            }`}\n          >\n            <option.icon\n              className={`w-6 h-6 ${\n                theme === option.value ? 'text-blue-600 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'\n              }`}\n            />\n            <span\n              className={`text-sm font-medium ${\n                theme === option.value ? 'text-blue-600 dark:text-blue-400' : 'text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              {option.label}\n            </span>\n            {theme === option.value && (\n              <Check className=\"w-4 h-4 text-blue-500 absolute top-2 right-2\" />\n            )}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderGeneralTab = () => (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6 space-y-4\">\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Actualisation automatique</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Rafraichir les donnees automatiquement</p>\n        </div>\n        <Toggle\n          enabled={settings.autoRefresh}\n          onChange={(value) => updateSettings({ autoRefresh: value })}\n        />\n      </div>\n\n      {settings.autoRefresh && (\n        <div className=\"flex items-center justify-between py-2\">\n          <div>\n            <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Intervalle</p>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Frequence de rafraichissement</p>\n          </div>\n          <select\n            value={settings.refreshInterval}\n            onChange={(e) => updateSettings({ refreshInterval: Number(e.target.value) })}\n            className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          >\n            <option value={5}>5s</option>\n            <option value={10}>10s</option>\n            <option value={30}>30s</option>\n            <option value={60}>1min</option>\n          </select>\n        </div>\n      )}\n    </div>\n  );\n\n  const renderLogsTab = () => (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6 space-y-4\">\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Niveau de log</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Filtrer par severite</p>\n        </div>\n        <select\n          value={settings.logLevel}\n          onChange={(e) => updateSettings({ logLevel: e.target.value as LogLevel })}\n          className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        >\n          {logLevels.map((level) => (\n            <option key={level.value} value={level.value}>\n              {level.label}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Logs console</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Afficher dans la console navigateur</p>\n        </div>\n        <Toggle\n          enabled={settings.logToConsole}\n          onChange={(value) => updateSettings({ logToConsole: value })}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Logs backend</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Envoyer les logs au serveur</p>\n        </div>\n        <Toggle\n          enabled={settings.logToBackend}\n          onChange={(value) => updateSettings({ logToBackend: value })}\n        />\n      </div>\n\n      {/* Log Levels Preview */}\n      <div className=\"pt-4 border-t border-gray-100 dark:border-gray-700\">\n        <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">\n          Niveaux enregistres avec \"{settings.logLevel}\":\n        </p>\n        <div className=\"flex flex-wrap gap-2\">\n          {logLevels.map((level) => {\n            const isIncluded = logLevels.findIndex((l) => l.value === level.value) >=\n              logLevels.findIndex((l) => l.value === settings.logLevel);\n            return (\n              <span\n                key={level.value}\n                className={`px-2 py-1 text-xs rounded-full ${\n                  isIncluded\n                    ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-400 line-through'\n                }`}\n              >\n                {level.label}\n              </span>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n\n  const renderNotificationsTab = () => (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6 space-y-4\">\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Notifications</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Activer les notifications</p>\n        </div>\n        <Toggle\n          enabled={settings.notificationsEnabled}\n          onChange={(value) => updateSettings({ notificationsEnabled: value })}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Sons</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Jouer un son lors des alertes</p>\n        </div>\n        <Toggle\n          enabled={settings.soundEnabled}\n          onChange={(value) => updateSettings({ soundEnabled: value })}\n          disabled={!settings.notificationsEnabled}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Alertes sur erreur</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Notifier lors d'erreurs critiques</p>\n        </div>\n        <Toggle\n          enabled={settings.alertOnError}\n          onChange={(value) => updateSettings({ alertOnError: value })}\n          disabled={!settings.notificationsEnabled}\n        />\n      </div>\n    </div>\n  );\n\n  const renderDashboardTab = () => (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6 space-y-4\">\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Mode compact</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Reduire l'espacement</p>\n        </div>\n        <Toggle\n          enabled={settings.dashboardCompactMode}\n          onChange={(value) => updateSettings({ dashboardCompactMode: value })}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Metriques systeme</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Afficher CPU, RAM, disque</p>\n        </div>\n        <Toggle\n          enabled={settings.showSystemMetrics}\n          onChange={(value) => updateSettings({ showSystemMetrics: value })}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between py-2\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Statistiques MCP</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Afficher les stats du gateway</p>\n        </div>\n        <Toggle\n          enabled={settings.showMcpStats}\n          onChange={(value) => updateSettings({ showMcpStats: value })}\n        />\n      </div>\n    </div>\n  );\n\n  const backupCategories = [\n    { key: 'services' as const, label: 'Services', icon: Server, description: 'Configurations des services (Plex, Authentik, etc.)' },\n    { key: 'user_mappings' as const, label: 'User Mappings', icon: Users, description: 'Mappings utilisateurs entre services' },\n    { key: 'groups' as const, label: 'Groupes', icon: Shield, description: 'Groupes, membres et permissions MCP' },\n    { key: 'site_config' as const, label: 'Configuration', icon: Wrench, description: 'Parametres du site' },\n    { key: 'training_prompts' as const, label: 'AI Training', icon: Brain, description: 'Prompts et donnees d\\'entrainement' },\n  ];\n\n  const renderBackupTab = () => (\n    <div className=\"space-y-6\">\n      {/* Export Section */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <div className=\"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30\">\n            <Download className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <div>\n            <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Exporter la configuration</h3>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Selectionnez les elements a sauvegarder</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4\">\n          {backupCategories.map((cat) => {\n            const Icon = cat.icon;\n            const isChecked = exportOptions[cat.key];\n            const count = previewStats[cat.key] ?? 0;\n\n            return (\n              <button\n                key={cat.key}\n                onClick={() => setExportOptions(prev => ({ ...prev, [cat.key]: !prev[cat.key] }))}\n                className={`relative flex items-start gap-3 p-3 rounded-lg border-2 transition-all text-left ${\n                  isChecked\n                    ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                    : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n                }`}\n              >\n                <div className={`p-1.5 rounded-md ${isChecked ? 'bg-blue-100 dark:bg-blue-900/50' : 'bg-gray-100 dark:bg-gray-700'}`}>\n                  <Icon className={`w-4 h-4 ${isChecked ? 'text-blue-600 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}`} />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-sm font-medium ${isChecked ? 'text-blue-700 dark:text-blue-300' : 'text-gray-700 dark:text-gray-300'}`}>\n                      {cat.label}\n                    </span>\n                    {loadingPreview ? (\n                      <Loader2 className=\"w-3 h-3 text-gray-400 animate-spin\" />\n                    ) : (\n                      <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n                        {count}\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-[10px] text-gray-500 dark:text-gray-400 mt-0.5 truncate\">{cat.description}</p>\n                </div>\n                {isChecked && (\n                  <Check className=\"w-4 h-4 text-blue-500 absolute top-2 right-2\" />\n                )}\n              </button>\n            );\n          })}\n        </div>\n\n        <div className=\"flex items-center justify-between pt-3 border-t border-gray-100 dark:border-gray-700\">\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n            {Object.values(exportOptions).filter(Boolean).length} categories selectionnees\n          </div>\n          <button\n            onClick={handleFullExport}\n            disabled={exporting || Object.values(exportOptions).every(v => !v)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors\"\n          >\n            {exporting ? (\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n            ) : (\n              <Download className=\"w-4 h-4\" />\n            )}\n            Exporter\n          </button>\n        </div>\n      </div>\n\n      {/* Import Section */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 sm:p-6\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <div className=\"p-2 rounded-lg bg-green-100 dark:bg-green-900/30\">\n            <Upload className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n          </div>\n          <div>\n            <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Importer une configuration</h3>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Restaurer depuis un fichier de backup</p>\n          </div>\n        </div>\n\n        {/* File Upload */}\n        <div className=\"mb-4\">\n          <label className=\"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-green-500 dark:hover:border-green-500 transition-colors bg-gray-50 dark:bg-gray-900/50\">\n            <input\n              type=\"file\"\n              accept=\".json\"\n              onChange={handleFileSelect}\n              className=\"hidden\"\n            />\n            {importFile ? (\n              <div className=\"text-center\">\n                <Database className=\"w-8 h-8 text-green-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{importFileName}</p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Version {importFile.version} - {importFile.exported_at ? new Date(importFile.exported_at).toLocaleDateString() : 'Date inconnue'}\n                </p>\n                {importFile.stats && (\n                  <div className=\"flex flex-wrap gap-1 mt-2 justify-center\">\n                    {Object.entries(importFile.stats).map(([key, value]) => (\n                      <span key={key} className=\"text-[10px] px-1.5 py-0.5 rounded bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300\">\n                        {key}: {value as number}\n                      </span>\n                    ))}\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <Upload className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Cliquer pour selectionner un fichier</p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">.json uniquement</p>\n              </div>\n            )}\n          </label>\n        </div>\n\n        {/* Import Options */}\n        {importFile && (\n          <>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4\">\n              {backupCategories.map((cat) => {\n                const Icon = cat.icon;\n                const isChecked = importOptions[cat.key];\n                const hasData = importFile.data?.[cat.key]?.length > 0;\n\n                return (\n                  <button\n                    key={cat.key}\n                    onClick={() => setImportOptions(prev => ({ ...prev, [cat.key]: !prev[cat.key] }))}\n                    disabled={!hasData}\n                    className={`flex items-center gap-2 p-2 rounded-lg border transition-all ${\n                      !hasData\n                        ? 'border-gray-200 dark:border-gray-700 opacity-50 cursor-not-allowed'\n                        : isChecked\n                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\n                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\n                    }`}\n                  >\n                    <Icon className={`w-4 h-4 ${isChecked && hasData ? 'text-green-600' : 'text-gray-400'}`} />\n                    <span className={`text-xs font-medium ${isChecked && hasData ? 'text-green-700 dark:text-green-300' : 'text-gray-600 dark:text-gray-400'}`}>\n                      {cat.label}\n                    </span>\n                    {hasData && isChecked && <Check className=\"w-3 h-3 text-green-500 ml-auto\" />}\n                  </button>\n                );\n              })}\n            </div>\n\n            {/* Merge Mode Toggle */}\n            <div className=\"flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800 mb-4\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle className=\"w-4 h-4 text-amber-600 dark:text-amber-400\" />\n                <div>\n                  <p className=\"text-sm font-medium text-amber-800 dark:text-amber-200\">Mode fusion</p>\n                  <p className=\"text-xs text-amber-600 dark:text-amber-400\">Fusionner avec les donnees existantes au lieu de remplacer</p>\n                </div>\n              </div>\n              <Toggle\n                enabled={importOptions.merge_mode}\n                onChange={(value) => setImportOptions(prev => ({ ...prev, merge_mode: value }))}\n              />\n            </div>\n\n            <button\n              onClick={handleFullImport}\n              disabled={importing || Object.entries(importOptions).filter(([k]) => k !== 'merge_mode').every(([, v]) => !v)}\n              className=\"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors\"\n            >\n              {importing ? (\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n              ) : (\n                <Upload className=\"w-4 h-4\" />\n              )}\n              Importer la configuration\n            </button>\n          </>\n        )}\n\n        {/* Import Result */}\n        {importResult && (\n          <div className={`mt-4 p-4 rounded-lg border ${\n            importResult.success\n              ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800'\n              : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\n          }`}>\n            <div className=\"flex items-center gap-2 mb-2\">\n              {importResult.success ? (\n                <CheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n              ) : (\n                <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\n              )}\n              <span className={`font-medium ${importResult.success ? 'text-green-800 dark:text-green-200' : 'text-red-800 dark:text-red-200'}`}>\n                {importResult.success ? 'Import reussi' : 'Import termine avec des erreurs'}\n              </span>\n            </div>\n\n            {/* Imported counts */}\n            {Object.keys(importResult.imported).length > 0 && (\n              <div className=\"flex flex-wrap gap-2 mb-2\">\n                {Object.entries(importResult.imported).map(([key, count]) => (\n                  <span key={key} className=\"text-xs px-2 py-1 rounded bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300\">\n                    {key}: {count}\n                  </span>\n                ))}\n              </div>\n            )}\n\n            {/* Warnings */}\n            {importResult.warnings.length > 0 && (\n              <div className=\"mt-2\">\n                <p className=\"text-xs font-medium text-amber-700 dark:text-amber-300 mb-1\">Avertissements:</p>\n                <ul className=\"text-xs text-amber-600 dark:text-amber-400 space-y-0.5\">\n                  {importResult.warnings.slice(0, 5).map((warning, i) => (\n                    <li key={i}>• {warning}</li>\n                  ))}\n                  {importResult.warnings.length > 5 && (\n                    <li>... et {importResult.warnings.length - 5} autres</li>\n                  )}\n                </ul>\n              </div>\n            )}\n\n            {/* Errors */}\n            {importResult.errors.length > 0 && (\n              <div className=\"mt-2\">\n                <p className=\"text-xs font-medium text-red-700 dark:text-red-300 mb-1\">Erreurs:</p>\n                <ul className=\"text-xs text-red-600 dark:text-red-400 space-y-0.5\">\n                  {importResult.errors.slice(0, 5).map((error, i) => (\n                    <li key={i}>• [{error.type}] {error.name}: {error.error}</li>\n                  ))}\n                  {importResult.errors.length > 5 && (\n                    <li>... et {importResult.errors.length - 5} autres</li>\n                  )}\n                </ul>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case 'appearance':\n        return renderAppearanceTab();\n      case 'general':\n        return renderGeneralTab();\n      case 'logs':\n        return renderLogsTab();\n      case 'notifications':\n        return renderNotificationsTab();\n      case 'dashboard':\n        return renderDashboardTab();\n      case 'backup':\n        return renderBackupTab();\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Settings className=\"w-6 h-6 sm:w-8 sm:h-8 text-blue-600\" />\n            Configuration\n          </h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n            Parametres de l'application\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleImportSettings}\n            className=\"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n            title=\"Importer\"\n          >\n            <Upload className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={handleExportSettings}\n            className=\"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n            title=\"Exporter\"\n          >\n            <Download className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => setShowResetConfirm(true)}\n            className=\"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\n            title=\"Reinitialiser\"\n          >\n            <RotateCcw className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Tab Navigation - Same style as Users (horizontal pills) */}\n      <div className=\"mb-4 sm:mb-6 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0\">\n        <nav className=\"flex gap-1.5 sm:gap-2 min-w-max sm:min-w-0 sm:flex-wrap\">\n          {tabs.map((tab) => {\n            const Icon = tab.icon;\n            const isActive = activeTab === tab.id;\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                className={`flex items-center gap-1.5 py-1.5 px-2.5 sm:py-2 sm:px-3 rounded-full font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${\n                  isActive\n                    ? 'bg-blue-600 text-white shadow-sm'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n              >\n                <Icon className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                <span>{tab.label}</span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* Tab Content */}\n      <div className=\"space-y-6\">\n        {renderTabContent()}\n      </div>\n\n      {/* Reset Confirmation Modal */}\n      {showResetConfirm && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n              Reinitialiser les parametres ?\n            </h3>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-6\">\n              Cette action va restaurer tous les parametres a leurs valeurs par defaut.\n            </p>\n            <div className=\"flex justify-end gap-3\">\n              <button\n                onClick={() => setShowResetConfirm(false)}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n              >\n                Annuler\n              </button>\n              <button\n                onClick={() => {\n                  resetSettings();\n                  setTheme('system');\n                  setShowResetConfirm(false);\n                }}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors\"\n              >\n                Reinitialiser\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":325,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10143,10146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10143,10146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport {\n  LayoutDashboard,\n  Cpu,\n  HardDrive,\n  MemoryStick,\n  Clock,\n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  Bot,\n  Users,\n  RefreshCw,\n  Wifi,\n  WifiOff,\n  Film,\n  Shield,\n  Eye,\n  Zap,\n  Server,\n  ArrowRight,\n  Activity,\n  FileText,\n  Wrench,\n  Brain,\n  Sparkles\n} from 'lucide-react';\nimport { api, apiClient } from '../lib/api';\nimport { getServiceColor, getServiceFromToolName } from '../lib/serviceColors';\nimport { Link } from 'react-router-dom';\nimport { useSettings } from '../contexts/SettingsContext';\n\ninterface SystemMetrics {\n  cpu_usage: number;\n  cpu_load_avg: number;\n  memory_usage: number;\n  memory_used: number;\n  memory_total: number;\n  disk_usage: number;\n  disk_used: number;\n  disk_total: number;\n  network_bytes_sent: number;\n  network_bytes_recv: number;\n  services_running: number;\n  services_total: number;\n  uptime: number;\n}\n\ninterface ServiceHealth {\n  id: string;\n  name: string;\n  service_type: string;\n  status: string;\n  enabled: boolean;\n  healthy: boolean;\n  last_test_at: string | null;\n  last_error: string | null;\n}\n\ninterface McpStats {\n  total: number;\n  success_rate: number;\n  average_duration_ms: number;\n  by_status: Record<string, number>;\n  by_category: Record<string, number>;\n  top_tools: Record<string, number>;\n  period_hours: number;\n}\n\ninterface AlertStats {\n  total: number;\n  active: number;\n  by_severity: Record<string, number>;\n}\n\ninterface HourlyUsage {\n  hour: string;\n  count: number;\n  success_count?: number;\n  failed_count?: number;\n}\n\ninterface LogStats {\n  total: number;\n  by_level: Record<string, number>;\n  by_source: Record<string, number>;\n  error_rate: number;\n  period_hours: number;\n}\n\ninterface TrainingStats {\n  total_sessions: number;\n  active_sessions: number;\n  completed_sessions: number;\n  failed_sessions: number;\n  total_prompts: number;\n  validated_prompts: number;\n  prompts_by_category: Record<string, number>;\n}\n\ninterface TrainingWorker {\n  id: string;\n  name: string;\n  status: string;\n  enabled: boolean;\n  gpu_available: boolean;\n  gpu_names: string[];\n  gpu_memory_total_mb: number;\n  current_job_id: string | null;\n}\n\ninterface McpUserStats {\n  user_id: string;\n  user_display_name: string | null;\n  request_count: number;\n  avg_duration_ms: number;\n  success_count: number;\n  failed_count: number;\n  success_rate: number;\n}\n\ninterface Group {\n  id: string;\n  name: string;\n  description: string;\n  color: string;\n  priority: number;\n  enabled: boolean;\n  member_count: number;\n  tool_count: number;\n}\n\ninterface UserMapping {\n  id: string;\n  central_user_id: string;\n  central_username: string;\n  service_config: {\n    service_type: string;\n  };\n}\n\n// Helper functions\nconst formatUptime = (seconds: number): string => {\n  const days = Math.floor(seconds / 86400);\n  const hours = Math.floor((seconds % 86400) / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  if (days > 0) return `${days}j ${hours}h`;\n  if (hours > 0) return `${hours}h ${minutes}m`;\n  return `${minutes}m`;\n};\n\nconst formatBytes = (bytes: number): string => {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n};\n\nconst getServiceIcon = (type: string) => {\n  switch (type.toLowerCase()) {\n    case 'plex': return Film;\n    case 'authentik': return Shield;\n    case 'tautulli': return Eye;\n    case 'overseerr': return Zap;\n    case 'openwebui': return Bot;\n    default: return Server;\n  }\n};\n\nconst getServiceColors = (type: string) => {\n  const colors = getServiceColor(type);\n  return {\n    bg: colors.bg,\n    text: colors.text,\n    border: colors.border\n  };\n};\n\n// Progress bar component\nconst ProgressBar = ({ value, color }: { value: number; color: 'blue' | 'green' | 'purple' | 'orange' | 'red' | 'yellow' }) => {\n  const colorClasses = {\n    blue: 'bg-blue-500',\n    green: 'bg-green-500',\n    purple: 'bg-purple-500',\n    orange: 'bg-orange-500',\n    red: 'bg-red-500',\n    yellow: 'bg-yellow-500',\n  };\n\n  return (\n    <div className=\"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n      <div\n        className={`h-full ${colorClasses[color]} transition-all duration-500`}\n        style={{ width: `${Math.min(value, 100)}%` }}\n      />\n    </div>\n  );\n};\n\n// Mini stacked bar chart for MCP hourly usage with success/failure breakdown\nconst MiniBarChart = ({ data, hoursCount = 12 }: { data: HourlyUsage[]; hoursCount?: number }) => {\n  // Generate hours with 0 values for missing hours\n  // Backend uses UTC, so we need to generate UTC hours for matching\n  const now = new Date();\n  const hours: { hour: string; count: number; success: number; failed: number; label: string }[] = [];\n\n  for (let i = hoursCount - 1; i >= 0; i--) {\n    const date = new Date(now.getTime() - i * 60 * 60 * 1000);\n    // API format: \"YYYY-MM-DD HH:00:00\" in UTC\n    const year = date.getUTCFullYear();\n    const month = String(date.getUTCMonth() + 1).padStart(2, '0');\n    const day = String(date.getUTCDate()).padStart(2, '0');\n    const utcHour = String(date.getUTCHours()).padStart(2, '0');\n    const hourKey = `${year}-${month}-${day} ${utcHour}`;\n\n    // Local hour for display\n    const localHour = String(date.getHours()).padStart(2, '0');\n\n    const found = data.find(d => d.hour.startsWith(hourKey));\n    hours.push({\n      hour: hourKey,\n      count: found?.count || 0,\n      success: found?.success_count || 0,\n      failed: found?.failed_count || 0,\n      label: localHour + 'h'  // Display local time\n    });\n  }\n\n  const maxCount = Math.max(...hours.map(h => h.count), 1);\n  const maxHeight = 40; // pixels\n\n  return (\n    <div className=\"flex items-end gap-0.5\" style={{ height: `${maxHeight}px` }}>\n      {hours.map((h, i) => {\n        const totalHeight = h.count > 0 ? Math.max((h.count / maxCount) * maxHeight, 6) : 4;\n        const successRatio = h.count > 0 ? h.success / h.count : 0;\n        const failedRatio = h.count > 0 ? h.failed / h.count : 0;\n        const successHeight = totalHeight * successRatio;\n        const failedHeight = totalHeight * failedRatio;\n        const isLast = i === hours.length - 1;\n\n        return (\n          <div\n            key={i}\n            className=\"flex-1 flex flex-col items-center justify-end\"\n            title={`${h.label}: ${h.count} req (${h.success} ok, ${h.failed} err)`}\n          >\n            {h.count === 0 ? (\n              // No data - gray dot\n              <div\n                className={`w-full rounded-sm bg-gray-300 dark:bg-gray-600 ${isLast ? 'opacity-100' : 'opacity-60'}`}\n                style={{ height: '4px' }}\n              />\n            ) : (\n              // Stacked bar: failed on top, success on bottom\n              <div className=\"w-full flex flex-col-reverse\">\n                {/* Success (green) - bottom, rounded-t when no failed bar on top */}\n                {successHeight > 0 && (\n                  <div\n                    className={`w-full rounded-b-sm ${failedHeight === 0 ? 'rounded-t-sm' : ''} ${isLast ? 'bg-green-500' : 'bg-green-400 dark:bg-green-500/80'}`}\n                    style={{ height: `${successHeight}px` }}\n                  />\n                )}\n                {/* Failed (red) - top */}\n                {failedHeight > 0 && (\n                  <div\n                    className={`w-full ${successHeight > 0 ? '' : 'rounded-b-sm'} rounded-t-sm ${isLast ? 'bg-red-500' : 'bg-red-400 dark:bg-red-500/80'}`}\n                    style={{ height: `${failedHeight}px` }}\n                  />\n                )}\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default function Dashboard() {\n  const { settings } = useSettings();\n  const [metrics, setMetrics] = useState<SystemMetrics | null>(null);\n  const [services, setServices] = useState<ServiceHealth[]>([]);\n  const [mcpStats, setMcpStats] = useState<McpStats | null>(null);\n  const [mcpHourlyUsage, setMcpHourlyUsage] = useState<HourlyUsage[]>([]);\n  const [alertStats, setAlertStats] = useState<AlertStats | null>(null);\n  const [logStats, setLogStats] = useState<LogStats | null>(null);\n  const [trainingStats, setTrainingStats] = useState<TrainingStats | null>(null);\n  const [trainingWorkers, setTrainingWorkers] = useState<TrainingWorker[]>([]);\n  const [promptsByService, setPromptsByService] = useState<Record<string, number>>({});\n  const [mcpUserStats, setMcpUserStats] = useState<McpUserStats[]>([]);\n  const [userMappingsCount, setUserMappingsCount] = useState<number>(0);\n  const [userMappings, setUserMappings] = useState<UserMapping[]>([]);\n  const [groups, setGroups] = useState<Group[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [autoRefresh, setAutoRefresh] = useState(settings.autoRefresh);\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n  // Sync autoRefresh with settings changes\n  useEffect(() => {\n    setAutoRefresh(settings.autoRefresh);\n  }, [settings.autoRefresh]);\n\n  const fetchData = useCallback(async () => {\n    try {\n      const [metricsRes, servicesRes, mcpStatsRes, alertStatsRes, mappingsRes, hourlyUsageRes, logStatsRes, trainingStatsRes, groupsRes, mcpUserStatsRes, workersRes, promptsRes] = await Promise.all([\n        api.system.currentMetrics().catch(() => null),\n        api.services.list().catch(() => []),\n        api.mcp.stats(24).catch(() => null),\n        api.alerts.stats(24).catch(() => null),\n        apiClient.get('/api/users/').catch(() => ({ mappings: [], total: 0 })),\n        api.mcp.hourlyUsage(24).catch(() => []),\n        api.logs.stats(24).catch(() => null),\n        api.training.stats().catch(() => null),\n        api.groups.list().catch(() => ({ groups: [], total: 0 })),\n        api.mcp.userStats(24).catch(() => []),\n        api.workers.list().catch(() => []),\n        api.training.prompts.list().catch(() => []),\n      ]);\n\n      if (metricsRes) setMetrics(metricsRes);\n\n      if (Array.isArray(servicesRes)) {\n        const healthPromises = servicesRes.map(async (service: any) => {\n          try {\n            const health = await apiClient.get(`/api/services/${service.id}/health`);\n            return { ...health, service_type: service.service_type };\n          } catch {\n            return {\n              id: service.id,\n              name: service.name,\n              service_type: service.service_type,\n              status: service.status,\n              enabled: service.enabled,\n              healthy: false,\n              last_test_at: null,\n              last_error: 'Unable to fetch health',\n            };\n          }\n        });\n        const healthResults = await Promise.all(healthPromises);\n        setServices(healthResults);\n      }\n\n      if (mcpStatsRes) setMcpStats(mcpStatsRes);\n      if (alertStatsRes) setAlertStats(alertStatsRes);\n      if (logStatsRes) setLogStats(logStatsRes);\n      if (trainingStatsRes) setTrainingStats(trainingStatsRes);\n      if (Array.isArray(hourlyUsageRes)) {\n        setMcpHourlyUsage(hourlyUsageRes);\n      }\n      if (mappingsRes && typeof mappingsRes.total === 'number') {\n        setUserMappingsCount(mappingsRes.total);\n        if (mappingsRes.mappings) setUserMappings(mappingsRes.mappings);\n      } else if (mappingsRes?.mappings) {\n        setUserMappingsCount(mappingsRes.mappings.length);\n        setUserMappings(mappingsRes.mappings);\n      }\n      if (groupsRes?.groups) {\n        setGroups(groupsRes.groups);\n      }\n      if (Array.isArray(mcpUserStatsRes)) {\n        setMcpUserStats(mcpUserStatsRes);\n      }\n      if (Array.isArray(workersRes)) {\n        setTrainingWorkers(workersRes);\n      }\n\n      // Process prompts to count by service tags\n      if (promptsRes) {\n        const prompts = Array.isArray(promptsRes) ? promptsRes : (promptsRes?.prompts || []);\n\n        // Get service names from configured services\n        const configuredServiceNames = Array.isArray(servicesRes)\n          ? servicesRes.map((s: { name: string }) => s.name.toLowerCase())\n          : [];\n\n        // Common service names to look for in tags\n        const knownServiceNames = [\n          'prowlarr', 'radarr', 'sonarr', 'lidarr', 'readarr', 'bazarr',\n          'tautulli', 'overseerr', 'ombi', 'plex', 'jellyfin', 'emby',\n          'komga', 'zammad', 'system', 'ollama', 'homeassistant', 'unifi',\n          'proxmox', 'portainer', 'docker', 'traefik', 'nginx', 'authentik',\n          ...configuredServiceNames\n        ];\n\n        const serviceCount: Record<string, number> = {};\n        prompts.forEach((prompt: { tags?: string[] }) => {\n          if (prompt.tags && Array.isArray(prompt.tags)) {\n            const serviceTags = prompt.tags.filter((tag: string) =>\n              knownServiceNames.includes(tag.toLowerCase())\n            );\n            serviceTags.forEach((tag: string) => {\n              const normalizedTag = tag.toLowerCase();\n              serviceCount[normalizedTag] = (serviceCount[normalizedTag] || 0) + 1;\n            });\n          }\n        });\n\n        setPromptsByService(serviceCount);\n      }\n\n      setLastUpdated(new Date());\n    } catch (error) {\n      console.error('Failed to fetch dashboard data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  useEffect(() => {\n    if (autoRefresh) {\n      const intervalMs = settings.refreshInterval * 1000;\n      const interval = setInterval(fetchData, intervalMs);\n      return () => clearInterval(interval);\n    }\n  }, [autoRefresh, fetchData, settings.refreshInterval]);\n\n  const healthyServices = services.filter(s => s.healthy && s.enabled).length;\n  const enabledServices = services.filter(s => s.enabled).length;\n  const cpuColor = (metrics?.cpu_usage || 0) > 80 ? 'red' : (metrics?.cpu_usage || 0) > 60 ? 'yellow' : 'blue';\n  const memColor = (metrics?.memory_usage || 0) > 80 ? 'red' : (metrics?.memory_usage || 0) > 60 ? 'yellow' : 'green';\n  const diskColor = (metrics?.disk_usage || 0) > 80 ? 'red' : (metrics?.disk_usage || 0) > 60 ? 'yellow' : 'purple';\n\n  if (loading) {\n    return (\n      <div className=\"p-4 sm:p-6 space-y-4\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-48\"></div>\n          <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n            {[1, 2, 3, 4].map(i => (\n              <div key={i} className=\"h-24 bg-gray-200 dark:bg-gray-700 rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-4\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <LayoutDashboard className=\"w-6 h-6 sm:w-7 sm:h-7 text-blue-600\" />\n            Dashboard\n          </h1>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {lastUpdated && (\n            <span className=\"text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1\">\n              {autoRefresh ? (\n                <Wifi className=\"w-3 h-3 text-green-500\" />\n              ) : (\n                <WifiOff className=\"w-3 h-3 text-gray-400\" />\n              )}\n              {lastUpdated.toLocaleTimeString()}\n            </span>\n          )}\n          <label className=\"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400\">\n            <input\n              type=\"checkbox\"\n              checked={autoRefresh}\n              onChange={(e) => setAutoRefresh(e.target.checked)}\n              className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500 w-3 h-3\"\n            />\n            Auto\n          </label>\n          <button\n            onClick={fetchData}\n            className=\"p-1.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n          >\n            <RefreshCw className=\"w-3.5 h-3.5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* System Metrics Row */}\n      {settings.showSystemMetrics && (\n      <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n        {/* CPU */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center mb-3\">\n            <div className={`p-2 rounded-lg ${cpuColor === 'red' ? 'bg-red-100 dark:bg-red-900/30' : cpuColor === 'yellow' ? 'bg-yellow-100 dark:bg-yellow-900/30' : 'bg-blue-100 dark:bg-blue-900/30'}`}>\n              <Cpu className={`w-5 h-5 ${cpuColor === 'red' ? 'text-red-600 dark:text-red-400' : cpuColor === 'yellow' ? 'text-yellow-600 dark:text-yellow-400' : 'text-blue-600 dark:text-blue-400'}`} />\n            </div>\n            <div className=\"ml-3 flex-1\">\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">CPU</p>\n              <p className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {metrics?.cpu_usage.toFixed(0) || 0}<span className=\"text-base text-gray-500 dark:text-gray-400\">%</span>\n              </p>\n            </div>\n          </div>\n          <ProgressBar value={metrics?.cpu_usage || 0} color={cpuColor as 'blue' | 'yellow' | 'red'} />\n        </div>\n\n        {/* Memory */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center mb-3\">\n            <div className={`p-2 rounded-lg ${memColor === 'red' ? 'bg-red-100 dark:bg-red-900/30' : memColor === 'yellow' ? 'bg-yellow-100 dark:bg-yellow-900/30' : 'bg-green-100 dark:bg-green-900/30'}`}>\n              <MemoryStick className={`w-5 h-5 ${memColor === 'red' ? 'text-red-600 dark:text-red-400' : memColor === 'yellow' ? 'text-yellow-600 dark:text-yellow-400' : 'text-green-600 dark:text-green-400'}`} />\n            </div>\n            <div className=\"ml-3 flex-1\">\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Mémoire</p>\n              <p className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {metrics?.memory_usage.toFixed(0) || 0}<span className=\"text-base text-gray-500 dark:text-gray-400\">%</span>\n              </p>\n            </div>\n          </div>\n          <ProgressBar value={metrics?.memory_usage || 0} color={memColor as 'green' | 'yellow' | 'red'} />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n            {formatBytes(metrics?.memory_used || 0)} / {formatBytes(metrics?.memory_total || 0)}\n          </p>\n        </div>\n\n        {/* Disk */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center mb-3\">\n            <div className={`p-2 rounded-lg ${diskColor === 'red' ? 'bg-red-100 dark:bg-red-900/30' : diskColor === 'yellow' ? 'bg-yellow-100 dark:bg-yellow-900/30' : 'bg-purple-100 dark:bg-purple-900/30'}`}>\n              <HardDrive className={`w-5 h-5 ${diskColor === 'red' ? 'text-red-600 dark:text-red-400' : diskColor === 'yellow' ? 'text-yellow-600 dark:text-yellow-400' : 'text-purple-600 dark:text-purple-400'}`} />\n            </div>\n            <div className=\"ml-3 flex-1\">\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Disque</p>\n              <p className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {metrics?.disk_usage.toFixed(0) || 0}<span className=\"text-base text-gray-500 dark:text-gray-400\">%</span>\n              </p>\n            </div>\n          </div>\n          <ProgressBar value={metrics?.disk_usage || 0} color={diskColor as 'purple' | 'yellow' | 'red'} />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n            {formatBytes(metrics?.disk_used || 0)} / {formatBytes(metrics?.disk_total || 0)}\n          </p>\n        </div>\n\n        {/* Uptime */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30\">\n              <Clock className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\n            </div>\n            <div className=\"ml-3 flex-1\">\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Uptime</p>\n              <p className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {formatUptime(metrics?.uptime || 0)}\n              </p>\n            </div>\n          </div>\n          <div className=\"mt-3 flex items-center gap-1.5\">\n            <CheckCircle className=\"w-4 h-4 text-green-500\" />\n            <span className=\"text-xs text-green-600 dark:text-green-400\">Système actif</span>\n          </div>\n        </div>\n      </div>\n      )}\n\n      {/* Services - Modern pills */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center gap-2\">\n            <Server className=\"w-4 h-4 text-blue-500\" />\n            <span className=\"font-semibold text-sm text-gray-900 dark:text-white\">Services</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {healthyServices}/{enabledServices}\n            </span>\n          </div>\n          <Link to=\"/services\" className=\"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1\">\n            Gérer <ArrowRight className=\"w-3 h-3\" />\n          </Link>\n        </div>\n        <div className=\"flex flex-wrap gap-2\">\n          {services.length > 0 ? (\n            services.map((service) => {\n              const Icon = getServiceIcon(service.service_type);\n              const colors = getServiceColors(service.service_type);\n              const isHealthy = service.enabled && service.healthy;\n              const isDisabled = !service.enabled;\n\n              return (\n                <div\n                  key={service.id}\n                  className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all ${\n                    isDisabled\n                      ? 'bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700 opacity-50'\n                      : isHealthy\n                      ? `${colors.bg} ${colors.border}`\n                      : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\n                  }`}\n                >\n                  <Icon className={`w-3.5 h-3.5 ${isDisabled ? 'text-gray-400' : isHealthy ? colors.text : 'text-red-500'}`} />\n                  <span className={`text-xs font-medium ${isDisabled ? 'text-gray-400' : 'text-gray-900 dark:text-white'}`}>\n                    {service.name}\n                  </span>\n                  {isDisabled ? (\n                    <span className=\"text-[10px] text-gray-400\">off</span>\n                  ) : isHealthy ? (\n                    <CheckCircle className=\"w-3 h-3 text-green-500\" />\n                  ) : (\n                    <XCircle className=\"w-3 h-3 text-red-500\" />\n                  )}\n                </div>\n              );\n            })\n          ) : (\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Aucun service configuré</p>\n          )}\n        </div>\n      </div>\n\n      {/* Bottom Grid: MCP Gateway + Top Tools | Users */}\n      {settings.showMcpStats && (\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n        {/* MCP Gateway + Top Tools Combined */}\n        <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <Bot className=\"w-4 h-4 text-violet-500\" />\n              <span className=\"font-semibold text-sm text-gray-900 dark:text-white\">MCP Gateway</span>\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">(24h)</span>\n            </div>\n            <Link to=\"/mcp\" className=\"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1\">\n              Gérer <ArrowRight className=\"w-3 h-3\" />\n            </Link>\n          </div>\n\n          {/* Stats Row */}\n          <div className=\"flex items-center gap-6 mb-4\">\n            <div className=\"flex items-center gap-5\">\n              <div>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{mcpStats?.total ?? 0}</p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">requêtes</p>\n              </div>\n              <div>\n                <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                  {mcpStats?.total ? `${Math.round(mcpStats.success_rate)}%` : '—'}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">succès</p>\n              </div>\n              <div>\n                <p className=\"text-2xl font-bold text-gray-700 dark:text-gray-300\">\n                  {mcpStats?.average_duration_ms ? `${Math.round(mcpStats.average_duration_ms)}` : '—'}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">ms moy.</p>\n              </div>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <MiniBarChart data={mcpHourlyUsage} hoursCount={24} />\n            </div>\n          </div>\n\n          {/* Usage by Service - Stacked Bar */}\n          <div className=\"border-t border-gray-100 dark:border-gray-700 pt-3\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <Wrench className=\"w-3.5 h-3.5 text-gray-400\" />\n              <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Par Service</span>\n            </div>\n            {mcpStats?.top_tools && Object.keys(mcpStats.top_tools).length > 0 ? (\n              (() => {\n                // Aggregate by service\n                const serviceUsage: Record<string, number> = {};\n                Object.entries(mcpStats.top_tools).forEach(([tool, count]) => {\n                  const serviceName = getServiceFromToolName(tool) || 'system';\n                  serviceUsage[serviceName] = (serviceUsage[serviceName] || 0) + count;\n                });\n\n                // Sort by count descending\n                const sortedServices = Object.entries(serviceUsage)\n                  .sort(([, a], [, b]) => b - a);\n                const totalCount = Object.values(serviceUsage).reduce((a, b) => a + b, 0);\n\n                return (\n                  <div className=\"space-y-3\">\n                    {/* Stacked Bar */}\n                    <div className=\"h-4 rounded-full overflow-hidden flex bg-gray-100 dark:bg-gray-700\">\n                      {sortedServices.map(([serviceName, count]) => {\n                        const colors = getServiceColor(serviceName);\n                        const percentage = (count / totalCount) * 100;\n\n                        return (\n                          <div\n                            key={serviceName}\n                            className=\"h-full transition-all hover:opacity-80 cursor-pointer relative group\"\n                            style={{ width: `${percentage}%`, backgroundColor: colors.hex }}\n                            title={`${serviceName}: ${count} (${percentage.toFixed(1)}%)`}\n                          >\n                            {/* Tooltip on hover */}\n                            <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10\">\n                              {serviceName}: {count}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n\n                    {/* Legend */}\n                    <div className=\"flex flex-wrap gap-x-4 gap-y-1\">\n                      {sortedServices.map(([serviceName, count]) => {\n                        const colors = getServiceColor(serviceName);\n\n                        return (\n                          <div key={serviceName} className=\"flex items-center gap-1.5\">\n                            <span\n                              className=\"w-2.5 h-2.5 rounded-sm flex-shrink-0\"\n                              style={{ backgroundColor: colors.hex }}\n                            />\n                            <span className=\"text-xs text-gray-600 dark:text-gray-400 capitalize\">\n                              {serviceName}\n                            </span>\n                            <span className=\"text-xs tabular-nums text-gray-400 dark:text-gray-500\">\n                              {count}\n                            </span>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                );\n              })()\n            ) : (\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 text-center py-2\">Aucune requête</p>\n            )}\n          </div>\n\n          {/* Usage by User - Stacked Bar */}\n          <div className=\"border-t border-gray-100 dark:border-gray-700 pt-3 mt-3\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <Users className=\"w-3.5 h-3.5 text-gray-400\" />\n              <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Par Utilisateur</span>\n            </div>\n            {mcpUserStats.length > 0 ? (\n              (() => {\n                // User colors palette\n                const userColors = [\n                  { bg: 'bg-blue-500', hex: '#3b82f6' },\n                  { bg: 'bg-emerald-500', hex: '#10b981' },\n                  { bg: 'bg-violet-500', hex: '#8b5cf6' },\n                  { bg: 'bg-amber-500', hex: '#f59e0b' },\n                  { bg: 'bg-rose-500', hex: '#f43f5e' },\n                  { bg: 'bg-cyan-500', hex: '#06b6d4' },\n                  { bg: 'bg-fuchsia-500', hex: '#d946ef' },\n                  { bg: 'bg-lime-500', hex: '#84cc16' },\n                ];\n\n                const sortedUsers = [...mcpUserStats].sort((a, b) => b.request_count - a.request_count);\n                const totalCount = sortedUsers.reduce((sum, u) => sum + u.request_count, 0);\n\n                return (\n                  <div className=\"space-y-3\">\n                    {/* Stacked Bar */}\n                    <div className=\"h-4 rounded-full overflow-hidden flex bg-gray-100 dark:bg-gray-700\">\n                      {sortedUsers.map((user, index) => {\n                        const color = userColors[index % userColors.length];\n                        const percentage = (user.request_count / totalCount) * 100;\n                        const displayName = user.user_display_name || user.user_id.split('@')[0];\n\n                        return (\n                          <div\n                            key={user.user_id}\n                            className=\"h-full transition-all hover:opacity-80 cursor-pointer relative group\"\n                            style={{ width: `${percentage}%`, backgroundColor: color.hex }}\n                            title={`${displayName}: ${user.request_count} (${percentage.toFixed(1)}%)`}\n                          >\n                            {/* Tooltip on hover */}\n                            <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10\">\n                              {displayName}: {user.request_count}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n\n                    {/* Legend */}\n                    <div className=\"flex flex-wrap gap-x-4 gap-y-1\">\n                      {sortedUsers.map((user, index) => {\n                        const color = userColors[index % userColors.length];\n                        const displayName = user.user_display_name || user.user_id.split('@')[0];\n\n                        return (\n                          <div key={user.user_id} className=\"flex items-center gap-1.5\">\n                            <span\n                              className=\"w-2.5 h-2.5 rounded-full flex-shrink-0\"\n                              style={{ backgroundColor: color.hex }}\n                            />\n                            <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n                              {displayName}\n                            </span>\n                            <span className=\"text-xs tabular-nums text-gray-400 dark:text-gray-500\">\n                              {user.request_count}\n                            </span>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                );\n              })()\n            ) : (\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 text-center py-2\">Aucun utilisateur</p>\n            )}\n          </div>\n        </div>\n\n        {/* Users & Groups Block */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <Users className=\"w-4 h-4 text-blue-500\" />\n              <span className=\"font-semibold text-sm text-gray-900 dark:text-white\">Utilisateurs & Groupes</span>\n            </div>\n            <Link to=\"/users\" className=\"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1\">\n              Gérer <ArrowRight className=\"w-3 h-3\" />\n            </Link>\n          </div>\n\n          {/* Stats Row */}\n          <div className=\"grid grid-cols-3 gap-2 mb-3\">\n            <div className=\"text-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n              <p className=\"text-xl font-bold text-blue-600 dark:text-blue-400\">\n                {new Set(userMappings.map(m => m.central_user_id)).size}\n              </p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">utilisateurs</p>\n            </div>\n            <div className=\"text-center p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n              <p className=\"text-xl font-bold text-purple-600 dark:text-purple-400\">{groups.length}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">groupes</p>\n            </div>\n            <div className=\"text-center p-2 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <p className=\"text-xl font-bold text-green-600 dark:text-green-400\">{userMappingsCount}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">mappings</p>\n            </div>\n          </div>\n\n          {/* Groups List */}\n          {groups.length > 0 ? (\n            <div className=\"space-y-1.5\">\n              <p className=\"text-[10px] uppercase tracking-wider text-gray-500 dark:text-gray-400 font-medium mb-1\">Groupes MCP</p>\n              {groups.slice(0, 4).map(group => (\n                <div\n                  key={group.id}\n                  className=\"flex items-center gap-2.5 p-2 bg-gray-50 dark:bg-gray-900/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors\"\n                >\n                  <div\n                    className=\"w-2.5 h-2.5 rounded-full flex-shrink-0 ring-2 ring-white dark:ring-gray-800 shadow-sm\"\n                    style={{ backgroundColor: group.color || '#6b7280' }}\n                  />\n                  <span className=\"text-xs font-medium text-gray-900 dark:text-white truncate flex-1\">\n                    {group.name}\n                  </span>\n                  <div className=\"flex items-center gap-1.5 flex-shrink-0\">\n                    <span className=\"text-[10px] px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded font-medium\">\n                      {group.member_count} usr\n                    </span>\n                    <span className=\"text-[10px] px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded font-medium\">\n                      {group.tool_count} outils\n                    </span>\n                  </div>\n                </div>\n              ))}\n              {groups.length > 4 && (\n                <p className=\"text-[10px] text-gray-400 dark:text-gray-500 text-center pt-1\">\n                  +{groups.length - 4} autres groupes\n                </p>\n              )}\n            </div>\n          ) : (\n            <div className=\"text-center py-4\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Aucun groupe configuré</p>\n              <Link to=\"/users\" className=\"text-xs text-blue-600 hover:text-blue-700 mt-1 inline-block\">\n                Créer un groupe\n              </Link>\n            </div>\n          )}\n        </div>\n      </div>\n      )}\n\n      {/* Second Row: AI Training (expanded) | Observability (compact) */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n        {/* AI Training - Expanded Block with Charts */}\n        <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-violet-100 dark:bg-violet-900/30\">\n                <Brain className=\"w-4 h-4 text-violet-600 dark:text-violet-400\" />\n              </div>\n              <span className=\"font-semibold text-sm text-gray-900 dark:text-white\">AI Training</span>\n              {(trainingStats?.active_sessions ?? 0) > 0 && (\n                <span className=\"flex items-center gap-1.5 text-[10px] px-2 py-0.5 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400\">\n                  <span className=\"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse\" />\n                  {trainingStats?.active_sessions} actif{(trainingStats?.active_sessions ?? 0) > 1 ? 's' : ''}\n                </span>\n              )}\n            </div>\n            <Link to=\"/training\" className=\"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1\">\n              Gérer <ArrowRight className=\"w-3 h-3\" />\n            </Link>\n          </div>\n\n          {/* Main Stats Row */}\n          <div className=\"grid grid-cols-5 gap-3 mb-4\">\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 border border-violet-100 dark:border-violet-800/50 text-center\">\n              <p className=\"text-2xl font-bold text-violet-600 dark:text-violet-400\">{trainingStats?.total_prompts ?? 0}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">prompts</p>\n            </div>\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-fuchsia-50 to-pink-50 dark:from-fuchsia-900/20 dark:to-pink-900/20 border border-fuchsia-100 dark:border-fuchsia-800/50 text-center\">\n              <p className=\"text-2xl font-bold text-fuchsia-600 dark:text-fuchsia-400\">{trainingStats?.validated_prompts ?? 0}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">validés</p>\n            </div>\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100 dark:border-blue-800/50 text-center\">\n              <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{trainingStats?.total_sessions ?? 0}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">sessions</p>\n            </div>\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-100 dark:border-green-800/50 text-center\">\n              <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{trainingStats?.completed_sessions ?? 0}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">terminées</p>\n            </div>\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-cyan-50 to-teal-50 dark:from-cyan-900/20 dark:to-teal-900/20 border border-cyan-100 dark:border-cyan-800/50 text-center\">\n              <p className=\"text-2xl font-bold text-cyan-600 dark:text-cyan-400\">{trainingWorkers.length}</p>\n              <p className=\"text-[10px] text-gray-600 dark:text-gray-400\">workers</p>\n            </div>\n          </div>\n\n          {/* Two Column Layout: Prompts by Category + Workers */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            {/* Prompts by Service - Stacked Bar (same style as TrainingOverview) */}\n            <div className=\"border-t border-gray-100 dark:border-gray-700 pt-3\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Sparkles className=\"w-3.5 h-3.5 text-violet-500\" />\n                <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Prompts par Service</span>\n              </div>\n              {Object.keys(promptsByService).length > 0 ? (\n                (() => {\n                  // Service colors matching TrainingOverview exactly\n                  const SERVICE_COLORS: Record<string, { bg: string; text: string }> = {\n                    homeassistant: { bg: 'bg-cyan-500', text: 'text-cyan-600 dark:text-cyan-400' },\n                    ollama: { bg: 'bg-purple-500', text: 'text-purple-600 dark:text-purple-400' },\n                    filesystem: { bg: 'bg-green-500', text: 'text-green-600 dark:text-green-400' },\n                    docker: { bg: 'bg-blue-500', text: 'text-blue-600 dark:text-blue-400' },\n                    git: { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n                    memory: { bg: 'bg-pink-500', text: 'text-pink-600 dark:text-pink-400' },\n                    browser: { bg: 'bg-yellow-500', text: 'text-yellow-600 dark:text-yellow-400' },\n                    puppeteer: { bg: 'bg-indigo-500', text: 'text-indigo-600 dark:text-indigo-400' },\n                    plex: { bg: 'bg-amber-500', text: 'text-amber-600 dark:text-amber-400' },\n                    tautulli: { bg: 'bg-rose-500', text: 'text-rose-600 dark:text-rose-400' },\n                    overseerr: { bg: 'bg-emerald-500', text: 'text-emerald-600 dark:text-emerald-400' },\n                    radarr: { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n                    sonarr: { bg: 'bg-sky-500', text: 'text-sky-600 dark:text-sky-400' },\n                    prowlarr: { bg: 'bg-violet-500', text: 'text-violet-600 dark:text-violet-400' },\n                    jackett: { bg: 'bg-fuchsia-500', text: 'text-fuchsia-600 dark:text-fuchsia-400' },\n                    bazarr: { bg: 'bg-lime-500', text: 'text-lime-600 dark:text-lime-400' },\n                    lidarr: { bg: 'bg-teal-500', text: 'text-teal-600 dark:text-teal-400' },\n                    zammad: { bg: 'bg-red-500', text: 'text-red-600 dark:text-red-400' },\n                    authentik: { bg: 'bg-orange-600', text: 'text-orange-700 dark:text-orange-400' },\n                    proxmox: { bg: 'bg-slate-500', text: 'text-slate-600 dark:text-slate-400' },\n                    system: { bg: 'bg-gray-500', text: 'text-gray-600 dark:text-gray-400' },\n                    komga: { bg: 'bg-red-400', text: 'text-red-500 dark:text-red-400' },\n                    romm: { bg: 'bg-blue-400', text: 'text-blue-500 dark:text-blue-400' },\n                    deluge: { bg: 'bg-blue-600', text: 'text-blue-700 dark:text-blue-400' },\n                    openwebui: { bg: 'bg-purple-400', text: 'text-purple-500 dark:text-purple-400' },\n                  };\n                  const DEFAULT_COLORS = [\n                    { bg: 'bg-blue-500', text: 'text-blue-600 dark:text-blue-400' },\n                    { bg: 'bg-purple-500', text: 'text-purple-600 dark:text-purple-400' },\n                    { bg: 'bg-green-500', text: 'text-green-600 dark:text-green-400' },\n                    { bg: 'bg-orange-500', text: 'text-orange-600 dark:text-orange-400' },\n                    { bg: 'bg-pink-500', text: 'text-pink-600 dark:text-pink-400' },\n                    { bg: 'bg-cyan-500', text: 'text-cyan-600 dark:text-cyan-400' },\n                    { bg: 'bg-yellow-500', text: 'text-yellow-600 dark:text-yellow-400' },\n                  ];\n                  const getColor = (name: string, index: number) => {\n                    const lower = name.toLowerCase();\n                    return SERVICE_COLORS[lower] || DEFAULT_COLORS[index % DEFAULT_COLORS.length];\n                  };\n\n                  const sortedServices = Object.entries(promptsByService)\n                    .sort(([, a], [, b]) => b - a);\n                  const totalCount = Object.values(promptsByService).reduce((a, b) => a + b, 0);\n\n                  return (\n                    <div className=\"space-y-3\">\n                      {/* Stacked Bar */}\n                      <div className=\"h-5 rounded-full overflow-hidden flex bg-gray-100 dark:bg-gray-700\">\n                        {sortedServices.map(([serviceName, count], index) => {\n                          const color = getColor(serviceName, index);\n                          const percentage = totalCount > 0 ? (count / totalCount) * 100 : 0;\n\n                          return (\n                            <div\n                              key={serviceName}\n                              className={`${color.bg} h-full transition-all duration-300 hover:opacity-80`}\n                              style={{ width: `${percentage}%` }}\n                              title={`${serviceName}: ${count} (${percentage.toFixed(1)}%)`}\n                            />\n                          );\n                        })}\n                      </div>\n\n                      {/* Legend */}\n                      <div className=\"flex flex-wrap gap-x-4 gap-y-1.5\">\n                        {sortedServices.map(([serviceName, count], index) => {\n                          const color = getColor(serviceName, index);\n                          const percentage = totalCount > 0 ? (count / totalCount) * 100 : 0;\n\n                          return (\n                            <div key={serviceName} className=\"flex items-center gap-1.5 text-xs\">\n                              <span className={`w-2.5 h-2.5 rounded-full ${color.bg}`} />\n                              <span className=\"text-gray-600 dark:text-gray-400 capitalize\">{serviceName}</span>\n                              <span className=\"font-medium text-gray-900 dark:text-white\">{count}</span>\n                              <span className=\"text-gray-400 dark:text-gray-500\">({percentage.toFixed(0)}%)</span>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  );\n                })()\n              ) : (\n                <div className=\"h-20 flex items-center justify-center\">\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Aucun prompt avec tag service</p>\n                </div>\n              )}\n            </div>\n\n            {/* Workers Status */}\n            <div className=\"border-t border-gray-100 dark:border-gray-700 pt-3\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Server className=\"w-3.5 h-3.5 text-cyan-500\" />\n                <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Workers GPU</span>\n              </div>\n              {trainingWorkers.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {trainingWorkers.map(worker => {\n                    const isOnline = worker.status === 'online';\n                    const isBusy = !!worker.current_job_id;\n                    const gpuMemoryGb = worker.gpu_memory_total_mb ? (worker.gpu_memory_total_mb / 1024).toFixed(0) : '—';\n\n                    return (\n                      <div key={worker.id} className=\"flex items-center justify-between text-xs p-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-100 dark:border-gray-800\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`w-2 h-2 rounded-full ${\n                            isBusy ? 'bg-yellow-500 animate-pulse' : isOnline ? 'bg-green-500' : 'bg-gray-400'\n                          }`} />\n                          <span className=\"text-gray-700 dark:text-gray-300 font-medium\">{worker.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {worker.gpu_names && worker.gpu_names[0] && (\n                            <span className=\"text-[10px] text-gray-500 dark:text-gray-400 truncate max-w-[100px]\">\n                              {worker.gpu_names[0].replace('NVIDIA ', '').replace('GeForce ', '')}\n                            </span>\n                          )}\n                          {worker.gpu_available && (\n                            <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 font-medium\">\n                              {gpuMemoryGb} GB\n                            </span>\n                          )}\n                          <span className={`text-[10px] px-1.5 py-0.5 rounded font-medium ${\n                            isBusy\n                              ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\n                              : isOnline\n                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\n                                : 'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400'\n                          }`}>\n                            {isBusy ? 'Training' : isOnline ? 'Ready' : 'Offline'}\n                          </span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"h-20 flex items-center justify-center\">\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Aucun worker configuré</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Sessions Success Rate Bar */}\n          {(trainingStats?.total_sessions ?? 0) > 0 && (\n            <div className=\"mt-4 pt-3 border-t border-gray-100 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Taux de réussite des sessions</span>\n                <span className=\"text-xs font-semibold text-gray-700 dark:text-gray-300\">\n                  {((trainingStats?.completed_sessions ?? 0) / (trainingStats?.total_sessions ?? 1) * 100).toFixed(0)}%\n                </span>\n              </div>\n              <div className=\"h-2.5 rounded-full overflow-hidden flex bg-gray-100 dark:bg-gray-700\">\n                <div\n                  className=\"h-full bg-green-500 rounded-l-full\"\n                  style={{ width: `${((trainingStats?.completed_sessions ?? 0) / (trainingStats?.total_sessions ?? 1) * 100)}%` }}\n                  title={`Terminées: ${trainingStats?.completed_sessions ?? 0}`}\n                />\n                <div\n                  className=\"h-full bg-red-500\"\n                  style={{ width: `${((trainingStats?.failed_sessions ?? 0) / (trainingStats?.total_sessions ?? 1) * 100)}%` }}\n                  title={`Échouées: ${trainingStats?.failed_sessions ?? 0}`}\n                />\n                <div\n                  className=\"h-full bg-yellow-500\"\n                  style={{ width: `${((trainingStats?.active_sessions ?? 0) / (trainingStats?.total_sessions ?? 1) * 100)}%` }}\n                  title={`En cours: ${trainingStats?.active_sessions ?? 0}`}\n                />\n              </div>\n              <div className=\"flex items-center justify-between mt-1.5 text-[10px] text-gray-500 dark:text-gray-400\">\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-sm bg-green-500\" /> Terminées: {trainingStats?.completed_sessions ?? 0}\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-sm bg-red-500\" /> Échouées: {trainingStats?.failed_sessions ?? 0}\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-2 h-2 rounded-sm bg-yellow-500\" /> En cours: {trainingStats?.active_sessions ?? 0}\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Observability Block - Compact */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-cyan-100 dark:bg-cyan-900/30\">\n                <Activity className=\"w-4 h-4 text-cyan-600 dark:text-cyan-400\" />\n              </div>\n              <span className=\"font-semibold text-sm text-gray-900 dark:text-white\">Observabilité</span>\n              <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400\">24h</span>\n            </div>\n            <Link to=\"/monitoring\" className=\"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1\">\n              Gérer <ArrowRight className=\"w-3 h-3\" />\n            </Link>\n          </div>\n\n          <div className=\"space-y-3\">\n            {/* Logs Card */}\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100 dark:border-blue-800/50\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-1 rounded-md bg-blue-100 dark:bg-blue-900/50\">\n                    <FileText className=\"w-3.5 h-3.5 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Logs</span>\n                </div>\n                <span className=\"text-lg font-bold text-gray-900 dark:text-white\">\n                  {(logStats?.total ?? 0).toLocaleString()}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-[10px] text-gray-500 dark:text-gray-400\">Taux d'erreur</span>\n                <span className={`text-xs font-semibold px-1.5 py-0.5 rounded ${\n                  (logStats?.error_rate ?? 0) > 5\n                    ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400'\n                    : 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400'\n                }`}>\n                  {logStats?.error_rate?.toFixed(1) ?? 0}%\n                </span>\n              </div>\n            </div>\n\n            {/* Network Card */}\n            <div className=\"p-3 rounded-xl bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 border border-emerald-100 dark:border-emerald-800/50\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <div className=\"p-1 rounded-md bg-emerald-100 dark:bg-emerald-900/50\">\n                  <Wifi className=\"w-3.5 h-3.5 text-emerald-600 dark:text-emerald-400\" />\n                </div>\n                <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Réseau</span>\n              </div>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"w-4 h-4 flex items-center justify-center rounded bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 text-[10px] font-bold\">↑</span>\n                  </div>\n                  <span className=\"text-xs font-semibold text-gray-900 dark:text-white\">{formatBytes(metrics?.network_bytes_sent || 0)}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"w-4 h-4 flex items-center justify-center rounded bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 text-[10px] font-bold\">↓</span>\n                  </div>\n                  <span className=\"text-xs font-semibold text-gray-900 dark:text-white\">{formatBytes(metrics?.network_bytes_recv || 0)}</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Alerts Card */}\n            <div className={`p-3 rounded-xl border ${\n              (alertStats?.active || 0) > 0\n                ? 'bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border-red-200 dark:border-red-800/50'\n                : 'bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-100 dark:border-green-800/50'\n            }`}>\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"flex items-center gap-2\">\n                  <div className={`p-1 rounded-md ${\n                    (alertStats?.active || 0) > 0\n                      ? 'bg-red-100 dark:bg-red-900/50'\n                      : 'bg-green-100 dark:bg-green-900/50'\n                  }`}>\n                    <AlertTriangle className={`w-3.5 h-3.5 ${\n                      (alertStats?.active || 0) > 0\n                        ? 'text-red-600 dark:text-red-400'\n                        : 'text-green-600 dark:text-green-400'\n                    }`} />\n                  </div>\n                  <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Alertes</span>\n                </div>\n                <span className={`text-lg font-bold ${\n                  (alertStats?.active || 0) > 0\n                    ? 'text-red-600 dark:text-red-400'\n                    : 'text-green-600 dark:text-green-400'\n                }`}>\n                  {alertStats?.active || 0}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-[10px] text-gray-500 dark:text-gray-400\">Total 24h</span>\n                <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">{alertStats?.total || 0}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/MCP.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[451,454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[451,454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot reassign variable after render completes\n\nReassigning `cumulativeOffset` after render has completed can cause inconsistent behavior on subsequent renders. Consider using state instead.\n\n/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/MCP.tsx:327:13\n  325 |             const dashLength = circumference * percentage;\n  326 |             const dashOffset = circumference * cumulativeOffset;\n> 327 |             cumulativeOffset += percentage;\n      |             ^^^^^^^^^^^^^^^^ Cannot reassign `cumulativeOffset` after render completes\n  328 |\n  329 |             if (count === 0) return null;\n  330 |","line":327,"column":13,"nodeType":null,"endLine":327,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":384,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":384,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13807,13810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13807,13810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":386,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13906,13909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13906,13909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":393,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14182,14185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14182,14185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14925,14928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14925,14928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":434,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15554,15557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15554,15557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":446,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15948,15951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15948,15951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_statusLoading' is assigned a value but never used.","line":1217,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1217,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_statusError' is assigned a value but never used.","line":1218,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1218,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":1227,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":1227,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":1248,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1248,"endColumn":17}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Bot, RefreshCw, BarChart3, History, Wrench, Settings, ChevronDown, ChevronRight, Play, X, Loader2 } from 'lucide-react';\nimport { api } from '../lib/api';\nimport { getServiceColor, getServiceFromToolName } from '../lib/serviceColors';\n\ninterface McpRequest {\n  id: string;\n  tool_name: string;\n  tool_category: string | null;\n  status: string;\n  input_params: Record<string, any> | null;\n  output_result: Record<string, any> | null;\n  error_message: string | null;\n  duration_ms: number | null;\n  user_id: string | null;\n  user_display_name: string | null;\n  service_id: string | null;\n  created_at: string;\n  completed_at: string | null;\n}\n\ninterface McpStats {\n  total: number;\n  by_status: Record<string, number>;\n  by_category: Record<string, number>;\n  top_tools: Record<string, number>;\n  average_duration_ms: number;\n  success_rate: number;\n  period_hours: number;\n}\n\ninterface McpToolUsage {\n  tool_name: string;\n  category: string | null;\n  usage_count: number;\n  avg_duration_ms: number;\n  success_rate: number;\n}\n\ninterface McpHourlyUsage {\n  hour: string;\n  count: number;\n  success_count?: number;\n  failed_count?: number;\n}\n\ninterface McpUserStats {\n  user_id: string;\n  user_display_name: string | null;\n  request_count: number;\n  avg_duration_ms: number;\n  success_count: number;\n  failed_count: number;\n  success_rate: number;\n}\n\ninterface McpUserServiceStats {\n  user_id: string;\n  user_display_name: string | null;\n  service: string;\n  request_count: number;\n  success_count: number;\n  success_rate: number;\n}\n\ninterface McpHourlyUserUsage {\n  hour: string;\n  user_id: string;\n  user_display_name: string | null;\n  count: number;\n}\n\ninterface McpTool {\n  name: string;\n  description: string;\n  category: string;\n  is_mutation: boolean;\n  requires_service: string | null;\n  parameters: Array<{\n    name: string;\n    description: string;\n    type: string;\n    required: boolean;\n    enum?: string[];\n    default?: any;\n  }>;\n}\n\ninterface McpToolsResponse {\n  total: number;\n  categories: Record<string, McpTool[]>;\n  tools: McpTool[];\n}\n\ninterface ToolGroup {\n  id: string;\n  name: string;\n  color?: string;\n  icon?: string;\n  priority: number;\n  is_wildcard: boolean;\n}\n\nconst StatusBadge = ({ status }: { status: string }) => {\n  const colors: Record<string, string> = {\n    pending: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',\n    processing: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n    completed: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    failed: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n    cancelled: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200',\n  };\n\n  return (\n    <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[status] || colors.pending}`}>\n      {status}\n    </span>\n  );\n};\n\n// Stacked bar chart component for hourly usage with success/failure breakdown\nconst HourlyUsageChart = ({ data, timeRange }: { data: McpHourlyUsage[]; timeRange: number }) => {\n  // Generate all hours for the timeRange with 0 values for missing hours\n  // Backend uses UTC, so we need to generate UTC hours for matching\n  const now = new Date();\n  const hours: { hour: string; count: number; success: number; failed: number; label: string }[] = [];\n\n  for (let i = timeRange - 1; i >= 0; i--) {\n    const date = new Date(now.getTime() - i * 60 * 60 * 1000);\n    // API format: \"YYYY-MM-DD HH:00:00\" in UTC\n    const year = date.getUTCFullYear();\n    const month = String(date.getUTCMonth() + 1).padStart(2, '0');\n    const day = String(date.getUTCDate()).padStart(2, '0');\n    const utcHour = String(date.getUTCHours()).padStart(2, '0');\n    const hourKey = `${year}-${month}-${day} ${utcHour}`;\n\n    // Local hour for display\n    const localHour = String(date.getHours()).padStart(2, '0');\n\n    const found = data.find(d => d.hour.startsWith(hourKey));\n    hours.push({\n      hour: hourKey,\n      count: found?.count || 0,\n      success: found?.success_count || 0,\n      failed: found?.failed_count || 0,\n      label: `${localHour}:00`  // Display local time in label\n    });\n  }\n\n  const maxCount = Math.max(...hours.map(h => h.count), 1);\n  const chartHeight = 128; // pixels (h-32)\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n          Requests Over Time\n        </h3>\n        <div className=\"flex items-center gap-3 text-xs\">\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 rounded-sm bg-green-500\" />\n            <span className=\"text-gray-500 dark:text-gray-400\">Success</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 rounded-sm bg-red-500\" />\n            <span className=\"text-gray-500 dark:text-gray-400\">Failed</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 rounded-sm bg-gray-300 dark:bg-gray-600\" />\n            <span className=\"text-gray-500 dark:text-gray-400\">No data</span>\n          </div>\n        </div>\n      </div>\n      <div className=\"flex items-end gap-0.5\" style={{ height: `${chartHeight}px` }}>\n        {hours.map((h, i) => {\n          const totalHeight = h.count > 0 ? Math.max((h.count / maxCount) * chartHeight, 8) : 6;\n          const successRatio = h.count > 0 ? h.success / h.count : 0;\n          const failedRatio = h.count > 0 ? h.failed / h.count : 0;\n          const successHeight = totalHeight * successRatio;\n          const failedHeight = totalHeight * failedRatio;\n          const isLast = i === hours.length - 1;\n\n          return (\n            <div\n              key={i}\n              className=\"flex-1 flex flex-col items-center justify-end group relative\"\n              title={`${h.label}: ${h.count} req (${h.success} ok, ${h.failed} err)`}\n            >\n              {/* Tooltip on hover */}\n              <div className=\"absolute bottom-full mb-2 hidden group-hover:block z-10\">\n                <div className=\"bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap\">\n                  {h.label}: {h.count} ({h.success} ✓, {h.failed} ✗)\n                </div>\n              </div>\n              {h.count === 0 ? (\n                // No data - gray dot\n                <div\n                  className={`w-full rounded-sm bg-gray-300 dark:bg-gray-600 ${isLast ? 'opacity-100' : 'opacity-50'}`}\n                  style={{ height: '6px' }}\n                />\n              ) : (\n                // Stacked bar: failed on top, success on bottom\n                <div className=\"w-full flex flex-col-reverse\">\n                  {/* Success (green) - bottom, rounded-t when no failed bar on top */}\n                  {successHeight > 0 && (\n                    <div\n                      className={`w-full rounded-b-sm ${failedHeight === 0 ? 'rounded-t-sm' : ''} ${isLast ? 'bg-green-500' : 'bg-green-400 dark:bg-green-500/80'}`}\n                      style={{ height: `${successHeight}px` }}\n                    />\n                  )}\n                  {/* Failed (red) - top */}\n                  {failedHeight > 0 && (\n                    <div\n                      className={`w-full ${successHeight > 0 ? '' : 'rounded-b-sm'} rounded-t-sm ${isLast ? 'bg-red-500' : 'bg-red-400 dark:bg-red-500/80'}`}\n                      style={{ height: `${failedHeight}px` }}\n                    />\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n      <div className=\"flex justify-between mt-2 text-xs text-gray-500 dark:text-gray-400\">\n        <span>{hours[0]?.label || ''}</span>\n        <span>{hours[Math.floor(hours.length / 2)]?.label || ''}</span>\n        <span>{hours[hours.length - 1]?.label || ''}</span>\n      </div>\n    </div>\n  );\n};\n\nconst CategoryBadge = ({ category }: { category: string }) => {\n  const colors: Record<string, string> = {\n    media: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',\n    requests: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n    support: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n    system: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200',\n    users: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n  };\n\n  return (\n    <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[category] || colors.system}`}>\n      {category}\n    </span>\n  );\n};\n\n// Badge coloré pour identifier le service associé à un outil\nconst ServiceBadge = ({ toolName, requiresService }: { toolName: string; requiresService?: string | null }) => {\n  // Priorité: requires_service > préfixe du nom de l'outil\n  const serviceName = requiresService || getServiceFromToolName(toolName);\n\n  if (!serviceName) return null;\n\n  const colors = getServiceColor(serviceName);\n  const Icon = colors.icon;\n\n  return (\n    <span className={`inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full ${colors.badge} ${colors.badgeDark}`}>\n      <Icon className=\"w-3 h-3\" />\n      {serviceName}\n    </span>\n  );\n};\n\nconst StatCard = ({ title, value, subtitle, color = 'blue' }: {\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  color?: string;\n}) => (\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg p-2.5 sm:p-4 shadow\">\n    <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">{title}</p>\n    <p className={`text-lg sm:text-2xl font-bold text-${color}-600 dark:text-${color}-400`}>\n      {value}\n    </p>\n    {subtitle && (\n      <p className=\"text-[10px] sm:text-xs text-gray-400 dark:text-gray-500 mt-0.5 sm:mt-1 truncate\">{subtitle}</p>\n    )}\n  </div>\n);\n\n// Donut chart component for status breakdown\nconst StatusDonutChart = ({ data, total }: { data: Record<string, number>; total: number }) => {\n  const statusColors: Record<string, { stroke: string; fill: string; label: string }> = {\n    completed: { stroke: '#22c55e', fill: 'bg-green-500', label: 'Completed' },\n    failed: { stroke: '#ef4444', fill: 'bg-red-500', label: 'Failed' },\n    pending: { stroke: '#eab308', fill: 'bg-yellow-500', label: 'Pending' },\n    processing: { stroke: '#3b82f6', fill: 'bg-blue-500', label: 'Processing' },\n    cancelled: { stroke: '#6b7280', fill: 'bg-gray-500', label: 'Cancelled' },\n  };\n\n  const size = 120;\n  const strokeWidth = 20;\n  const radius = (size - strokeWidth) / 2;\n  const circumference = 2 * Math.PI * radius;\n  const center = size / 2;\n\n  // Sort entries so completed is first (largest usually)\n  const entries = Object.entries(data).sort((a, b) => {\n    const order = ['completed', 'failed', 'pending', 'processing', 'cancelled'];\n    return order.indexOf(a[0]) - order.indexOf(b[0]);\n  });\n\n  let cumulativeOffset = 0;\n\n  return (\n    <div className=\"flex items-center justify-center gap-6\">\n      {/* SVG Donut */}\n      <div className=\"relative\">\n        <svg width={size} height={size} className=\"transform -rotate-90\">\n          {/* Background circle */}\n          <circle\n            cx={center}\n            cy={center}\n            r={radius}\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth={strokeWidth}\n            className=\"text-gray-200 dark:text-gray-700\"\n          />\n          {/* Data segments */}\n          {entries.map(([status, count]) => {\n            const percentage = total > 0 ? count / total : 0;\n            const dashLength = circumference * percentage;\n            const dashOffset = circumference * cumulativeOffset;\n            cumulativeOffset += percentage;\n\n            if (count === 0) return null;\n\n            return (\n              <circle\n                key={status}\n                cx={center}\n                cy={center}\n                r={radius}\n                fill=\"none\"\n                stroke={statusColors[status]?.stroke || '#6b7280'}\n                strokeWidth={strokeWidth}\n                strokeDasharray={`${dashLength} ${circumference - dashLength}`}\n                strokeDashoffset={-dashOffset}\n                strokeLinecap=\"butt\"\n                className=\"transition-all duration-500\"\n              />\n            );\n          })}\n        </svg>\n        {/* Center text */}\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n          <span className=\"text-2xl font-bold text-gray-900 dark:text-white\">{total}</span>\n          <span className=\"text-xs text-gray-500 dark:text-gray-400\">total</span>\n        </div>\n      </div>\n\n      {/* Legend */}\n      <div className=\"flex flex-col gap-2\">\n        {entries.map(([status, count]) => {\n          if (count === 0) return null;\n          const percentage = total > 0 ? ((count / total) * 100).toFixed(0) : 0;\n          return (\n            <div key={status} className=\"flex items-center gap-2\">\n              <div className={`w-3 h-3 rounded-full ${statusColors[status]?.fill || 'bg-gray-500'}`} />\n              <span className=\"text-sm text-gray-700 dark:text-gray-300 capitalize\">{status}</span>\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-white\">{count}</span>\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">({percentage}%)</span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n// Tool Test Modal - Modal for testing MCP tools with dynamic form\nconst ToolTestModal = ({\n  tool,\n  isOpen,\n  onClose,\n}: {\n  tool: McpTool | null;\n  isOpen: boolean;\n  onClose: () => void;\n}) => {\n  const [params, setParams] = useState<Record<string, any>>({});\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState<any>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [duration, setDuration] = useState<number | null>(null);\n\n  // Initialize params with default values when tool changes\n  useEffect(() => {\n    if (tool) {\n      const initialParams: Record<string, any> = {};\n      tool.parameters.forEach((param) => {\n        if (param.default !== undefined) {\n          initialParams[param.name] = param.default;\n        } else if (param.type === 'boolean') {\n          initialParams[param.name] = false;\n        } else if (param.type === 'integer' || param.type === 'number') {\n          initialParams[param.name] = param.required ? '' : '';\n        } else if (param.enum && param.enum.length > 0) {\n          initialParams[param.name] = param.enum[0];\n        } else {\n          initialParams[param.name] = '';\n        }\n      });\n      setParams(initialParams);\n      setResult(null);\n      setError(null);\n      setDuration(null);\n    }\n  }, [tool]);\n\n  const handleParamChange = (name: string, value: any, type: string) => {\n    let parsedValue = value;\n    if (type === 'integer') {\n      parsedValue = value === '' ? '' : parseInt(value, 10);\n    } else if (type === 'number') {\n      parsedValue = value === '' ? '' : parseFloat(value);\n    } else if (type === 'boolean') {\n      parsedValue = value === 'true' || value === true;\n    }\n    setParams((prev) => ({ ...prev, [name]: parsedValue }));\n  };\n\n  const handleExecute = async () => {\n    if (!tool) return;\n\n    setLoading(true);\n    setError(null);\n    setResult(null);\n\n    // Build params object, only include non-empty values\n    const executeParams: Record<string, any> = {};\n    Object.entries(params).forEach(([key, value]) => {\n      if (value !== '' && value !== null && value !== undefined) {\n        executeParams[key] = value;\n      }\n    });\n\n    const startTime = Date.now();\n    try {\n      const response = await api.mcp.executeTool(tool.name, executeParams);\n      setDuration(Date.now() - startTime);\n      setResult(response);\n    } catch (err: any) {\n      setDuration(Date.now() - startTime);\n      setError(err.message || 'Erreur lors de l\\'execution de l\\'outil');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen || !tool) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      <div className=\"flex items-center justify-center min-h-screen px-4\">\n        <div className=\"fixed inset-0 bg-black bg-opacity-50\" onClick={onClose} />\n        <div className=\"relative bg-white dark:bg-gray-800 rounded-lg max-w-3xl w-full p-6 shadow-xl max-h-[90vh] overflow-y-auto\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h3 className=\"text-lg font-medium text-gray-900 dark:text-white flex items-center gap-2\">\n                <Play className=\"w-5 h-5 text-green-600\" />\n                Tester: {tool.name}\n              </h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                {tool.description}\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-500 p-1\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          {/* Parameters Form */}\n          {tool.parameters.length > 0 ? (\n            <div className=\"space-y-4 mb-6\">\n              <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Parametres\n              </h4>\n              {tool.parameters.map((param) => (\n                <div key={param.name} className=\"space-y-1\">\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                    {param.name}\n                    {param.required && <span className=\"text-red-500 ml-1\">*</span>}\n                    <span className=\"text-xs text-gray-400 ml-2\">({param.type})</span>\n                  </label>\n                  {param.description && (\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      {param.description}\n                    </p>\n                  )}\n                  {param.type === 'boolean' ? (\n                    <select\n                      value={params[param.name]?.toString() || 'false'}\n                      onChange={(e) => handleParamChange(param.name, e.target.value, param.type)}\n                      className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2\"\n                    >\n                      <option value=\"false\">false</option>\n                      <option value=\"true\">true</option>\n                    </select>\n                  ) : param.enum && param.enum.length > 0 ? (\n                    <select\n                      value={params[param.name] || ''}\n                      onChange={(e) => handleParamChange(param.name, e.target.value, param.type)}\n                      className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2\"\n                    >\n                      {param.enum.map((opt) => (\n                        <option key={opt} value={opt}>\n                          {opt}\n                        </option>\n                      ))}\n                    </select>\n                  ) : (\n                    <input\n                      type={param.type === 'integer' || param.type === 'number' ? 'number' : 'text'}\n                      value={params[param.name] || ''}\n                      onChange={(e) => handleParamChange(param.name, e.target.value, param.type)}\n                      placeholder={param.default !== undefined ? `Defaut: ${param.default}` : ''}\n                      className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2\"\n                    />\n                  )}\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg text-sm text-gray-600 dark:text-gray-400\">\n              Cet outil n'a pas de parametres.\n            </div>\n          )}\n\n          {/* Execute Button */}\n          <div className=\"flex justify-end mb-4\">\n            <button\n              onClick={handleExecute}\n              disabled={loading}\n              className=\"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Execution...\n                </>\n              ) : (\n                <>\n                  <Play className=\"w-4 h-4\" />\n                  Executer\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Result / Error */}\n          {(result || error) && (\n            <div className=\"border-t dark:border-gray-700 pt-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  Resultat\n                </h4>\n                {duration !== null && (\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {duration}ms\n                  </span>\n                )}\n              </div>\n              {error ? (\n                <div className=\"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-lg text-sm\">\n                  {error}\n                </div>\n              ) : result ? (\n                <pre className=\"bg-gray-900 dark:bg-black text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64\">\n                  {JSON.stringify(result, null, 2)}\n                </pre>\n              ) : null}\n            </div>\n          )}\n\n          {/* Footer */}\n          <div className=\"mt-6 flex justify-end\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600\"\n            >\n              Fermer\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Color palette for users (modern, distinct colors)\nconst USER_COLORS = [\n  { bg: 'bg-blue-500', hex: '#3b82f6', text: 'text-blue-500' },\n  { bg: 'bg-emerald-500', hex: '#10b981', text: 'text-emerald-500' },\n  { bg: 'bg-violet-500', hex: '#8b5cf6', text: 'text-violet-500' },\n  { bg: 'bg-amber-500', hex: '#f59e0b', text: 'text-amber-500' },\n  { bg: 'bg-rose-500', hex: '#f43f5e', text: 'text-rose-500' },\n  { bg: 'bg-cyan-500', hex: '#06b6d4', text: 'text-cyan-500' },\n  { bg: 'bg-fuchsia-500', hex: '#d946ef', text: 'text-fuchsia-500' },\n  { bg: 'bg-lime-500', hex: '#84cc16', text: 'text-lime-500' },\n  { bg: 'bg-orange-500', hex: '#f97316', text: 'text-orange-500' },\n  { bg: 'bg-teal-500', hex: '#14b8a6', text: 'text-teal-500' },\n];\n\nconst getUserColor = (index: number) => USER_COLORS[index % USER_COLORS.length];\n\n// User Stats Bar Chart - Horizontal bars with user names\nconst UserStatsChart = ({ data }: { data: McpUserStats[] }) => {\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-40 text-gray-500 dark:text-gray-400 text-sm\">\n        Aucune donnée utilisateur\n      </div>\n    );\n  }\n\n  const maxCount = Math.max(...data.map(d => d.request_count), 1);\n\n  return (\n    <div className=\"space-y-3\">\n      {data.slice(0, 8).map((user, index) => {\n        const color = getUserColor(index);\n        const percentage = (user.request_count / maxCount) * 100;\n        const displayName = user.user_display_name || user.user_id.split('@')[0] || user.user_id.substring(0, 8);\n\n        return (\n          <div key={user.user_id} className=\"group\">\n            <div className=\"flex items-center justify-between mb-1\">\n              <div className=\"flex items-center gap-2 min-w-0\">\n                <div className={`w-2 h-2 rounded-full ${color.bg}`} />\n                <span className=\"text-sm font-medium text-gray-900 dark:text-white truncate\" title={user.user_id}>\n                  {displayName}\n                </span>\n              </div>\n              <div className=\"flex items-center gap-3 text-xs\">\n                <span className=\"tabular-nums text-gray-700 dark:text-gray-300 font-medium\">\n                  {user.request_count}\n                </span>\n                <span className={`tabular-nums ${user.success_rate >= 90 ? 'text-green-600 dark:text-green-400' : user.success_rate >= 50 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}`}>\n                  {user.success_rate}%\n                </span>\n              </div>\n            </div>\n            <div className=\"h-2 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden\">\n              <div\n                className=\"h-full rounded-full transition-all duration-500\"\n                style={{ width: `${percentage}%`, backgroundColor: color.hex }}\n              />\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n// User Service Breakdown - Horizontal stacked bars\nconst UserServiceChart = ({ data }: { data: McpUserServiceStats[] }) => {\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-40 text-gray-500 dark:text-gray-400 text-sm\">\n        Aucune donnée utilisateur/service\n      </div>\n    );\n  }\n\n  // Group by user\n  const byUser: Record<string, { displayName: string; services: Record<string, number>; total: number }> = {};\n  data.forEach(item => {\n    if (!byUser[item.user_id]) {\n      byUser[item.user_id] = {\n        displayName: item.user_display_name || item.user_id.split('@')[0] || item.user_id.substring(0, 8),\n        services: {},\n        total: 0,\n      };\n    }\n    byUser[item.user_id].services[item.service] = item.request_count;\n    byUser[item.user_id].total += item.request_count;\n  });\n\n  // Get all unique services\n  const allServices = [...new Set(data.map(d => d.service))];\n  const maxTotal = Math.max(...Object.values(byUser).map(u => u.total), 1);\n\n  // Sort users by total\n  const sortedUsers = Object.entries(byUser).sort((a, b) => b[1].total - a[1].total).slice(0, 6);\n\n  return (\n    <div className=\"space-y-3\">\n      {sortedUsers.map(([userId, userData]) => {\n        const barWidth = (userData.total / maxTotal) * 100;\n\n        return (\n          <div key={userId} className=\"group\">\n            <div className=\"flex items-center justify-between mb-1\">\n              <span className=\"text-sm font-medium text-gray-900 dark:text-white truncate\" title={userId}>\n                {userData.displayName}\n              </span>\n              <span className=\"text-xs tabular-nums text-gray-600 dark:text-gray-400\">\n                {userData.total}\n              </span>\n            </div>\n            <div className=\"h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden flex\" style={{ width: `${barWidth}%` }}>\n              {allServices.map((service) => {\n                const count = userData.services[service] || 0;\n                if (count === 0) return null;\n                const segmentWidth = (count / userData.total) * 100;\n                const colors = getServiceColor(service);\n\n                return (\n                  <div\n                    key={service}\n                    className=\"h-full transition-all first:rounded-l-full last:rounded-r-full\"\n                    style={{ width: `${segmentWidth}%`, backgroundColor: colors.hex }}\n                    title={`${service}: ${count}`}\n                  />\n                );\n              })}\n            </div>\n          </div>\n        );\n      })}\n      {/* Legend */}\n      <div className=\"flex flex-wrap gap-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700\">\n        {allServices.slice(0, 6).map(service => {\n          const colors = getServiceColor(service);\n          return (\n            <div key={service} className=\"flex items-center gap-1\">\n              <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.hex }} />\n              <span className=\"text-xs text-gray-600 dark:text-gray-400 capitalize\">{service}</span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n// Stacked Bar Chart - Hourly usage by user\nconst HourlyUserStackedChart = ({ data, timeRange }: { data: McpHourlyUserUsage[]; timeRange: number }) => {\n  // Get unique users and assign colors\n  const users = [...new Set(data.map(d => d.user_id))];\n  const userColorMap: Record<string, { displayName: string; color: typeof USER_COLORS[0] }> = {};\n  users.forEach((userId, index) => {\n    const item = data.find(d => d.user_id === userId);\n    userColorMap[userId] = {\n      displayName: item?.user_display_name || userId.split('@')[0] || userId.substring(0, 8),\n      color: getUserColor(index),\n    };\n  });\n\n  // Generate hours and aggregate data\n  const now = new Date();\n  const hours: { hour: string; label: string; byUser: Record<string, number>; total: number }[] = [];\n\n  for (let i = timeRange - 1; i >= 0; i--) {\n    const date = new Date(now.getTime() - i * 60 * 60 * 1000);\n    const year = date.getUTCFullYear();\n    const month = String(date.getUTCMonth() + 1).padStart(2, '0');\n    const day = String(date.getUTCDate()).padStart(2, '0');\n    const utcHour = String(date.getUTCHours()).padStart(2, '0');\n    const hourKey = `${year}-${month}-${day} ${utcHour}`;\n    const localHour = String(date.getHours()).padStart(2, '0');\n\n    const hourData: Record<string, number> = {};\n    let total = 0;\n    data.filter(d => d.hour.startsWith(hourKey)).forEach(d => {\n      hourData[d.user_id] = (hourData[d.user_id] || 0) + d.count;\n      total += d.count;\n    });\n\n    hours.push({ hour: hourKey, label: `${localHour}:00`, byUser: hourData, total });\n  }\n\n  const maxCount = Math.max(...hours.map(h => h.total), 1);\n  const chartHeight = 140;\n\n  if (users.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">\n          Requêtes par utilisateur (temps)\n        </h3>\n        <div className=\"flex items-center justify-center h-32 text-gray-500 dark:text-gray-400 text-sm\">\n          Aucune donnée disponible\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n          Requêtes par utilisateur (temps)\n        </h3>\n        <div className=\"flex items-center gap-2 flex-wrap justify-end\">\n          {users.slice(0, 5).map(userId => (\n            <div key={userId} className=\"flex items-center gap-1\">\n              <div className={`w-2.5 h-2.5 rounded-full ${userColorMap[userId].color.bg}`} />\n              <span className=\"text-xs text-gray-600 dark:text-gray-400 truncate max-w-[80px]\" title={userId}>\n                {userColorMap[userId].displayName}\n              </span>\n            </div>\n          ))}\n          {users.length > 5 && (\n            <span className=\"text-xs text-gray-400 dark:text-gray-500\">+{users.length - 5}</span>\n          )}\n        </div>\n      </div>\n\n      <div className=\"flex items-end gap-0.5\" style={{ height: `${chartHeight}px` }}>\n        {hours.map((h, i) => {\n          const totalHeight = h.total > 0 ? Math.max((h.total / maxCount) * chartHeight, 8) : 6;\n          const isLast = i === hours.length - 1;\n\n          return (\n            <div\n              key={i}\n              className=\"flex-1 flex flex-col justify-end group relative\"\n              title={`${h.label}: ${h.total} requêtes`}\n            >\n              {/* Tooltip */}\n              <div className=\"absolute bottom-full mb-2 hidden group-hover:block z-10 left-1/2 -translate-x-1/2\">\n                <div className=\"bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap\">\n                  <div className=\"font-medium mb-1\">{h.label}</div>\n                  {Object.entries(h.byUser).map(([userId, count]) => (\n                    <div key={userId} className=\"flex items-center gap-1\">\n                      <div className={`w-1.5 h-1.5 rounded-full ${userColorMap[userId]?.color.bg || 'bg-gray-400'}`} />\n                      <span>{userColorMap[userId]?.displayName || userId}: {count}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {h.total === 0 ? (\n                <div\n                  className={`w-full rounded-sm bg-gray-300 dark:bg-gray-600 ${isLast ? 'opacity-100' : 'opacity-50'}`}\n                  style={{ height: '6px' }}\n                />\n              ) : (\n                <div className=\"w-full flex flex-col-reverse rounded-sm overflow-hidden\" style={{ height: `${totalHeight}px` }}>\n                  {users.map((userId) => {\n                    const count = h.byUser[userId] || 0;\n                    if (count === 0) return null;\n                    const segmentHeight = (count / h.total) * totalHeight;\n                    const color = userColorMap[userId].color;\n\n                    return (\n                      <div\n                        key={userId}\n                        className={`w-full ${isLast ? '' : 'opacity-90'}`}\n                        style={{ height: `${segmentHeight}px`, backgroundColor: color.hex }}\n                      />\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      <div className=\"flex justify-between mt-2 text-xs text-gray-500 dark:text-gray-400\">\n        <span>{hours[0]?.label || ''}</span>\n        <span>{hours[Math.floor(hours.length / 2)]?.label || ''}</span>\n        <span>{hours[hours.length - 1]?.label || ''}</span>\n      </div>\n    </div>\n  );\n};\n\ninterface McpServerStatus {\n  active: boolean;\n  protocol_version: string;\n  server_name: string;\n  server_version: string;\n  tools_count: number;\n  enabled_services: string[];\n  openapi_url: string;\n  docs_url: string;\n}\n\n// Descriptions des services pour le prompt système\nconst SERVICE_DESCRIPTIONS: Record<string, { name: string; description: string }> = {\n  system: { name: 'Système', description: 'Monitoring et administration' },\n  plex: { name: 'Plex', description: 'Bibliothèque multimédia' },\n  tautulli: { name: 'Tautulli', description: 'Monitoring Plex' },\n  overseerr: { name: 'Overseerr', description: 'Demandes et disponibilité' },\n  openwebui: { name: 'Open WebUI', description: 'Interface IA' },\n  radarr: { name: 'Radarr', description: 'Gestion des films' },\n  sonarr: { name: 'Sonarr', description: 'Gestion des séries TV' },\n  prowlarr: { name: 'Prowlarr', description: 'Indexeurs de torrents' },\n  jackett: { name: 'Jackett', description: 'Proxy d\\'indexeurs' },\n  deluge: { name: 'Deluge', description: 'Client torrent' },\n  komga: { name: 'Komga', description: 'Bibliothèque de comics/mangas' },\n  romm: { name: 'RomM', description: 'Gestion de ROMs de jeux' },\n  audiobookshelf: { name: 'Audiobookshelf', description: 'Livres audio et podcasts' },\n  wikijs: { name: 'Wiki.js', description: 'Documentation et wiki' },\n  zammad: { name: 'Zammad', description: 'Support et tickets' },\n  authentik: { name: 'Authentik', description: 'Authentification SSO' },\n  ollama: { name: 'Ollama', description: 'Modèles IA locaux' },\n};\n\n// Génère le prompt système dynamiquement basé sur les outils disponibles\nconst generateSystemPrompt = (tools: McpToolsResponse | null, enabledServices: string[]): string => {\n  if (!tools || !tools.tools || tools.tools.length === 0) {\n    return `Tu es un assistant intelligent pour la gestion d'un homelab multimédia.\n\nIMPORTANT: Aucun outil n'est configuré pour le moment. Veuillez configurer des services dans l'interface d'administration.`;\n  }\n\n  // Grouper les outils par service\n  const toolsByService: Record<string, McpTool[]> = {};\n\n  tools.tools.forEach(tool => {\n    // Extraire le service du nom de l'outil (ex: plex_search_media -> plex)\n    const serviceName = tool.requires_service || tool.name.split('_')[0];\n    if (!toolsByService[serviceName]) {\n      toolsByService[serviceName] = [];\n    }\n    toolsByService[serviceName].push(tool);\n  });\n\n  // Construire les sections d'outils\n  let toolSections = '';\n\n  // Services activés d'abord\n  const sortedServices = Object.keys(toolsByService).sort((a, b) => {\n    const aEnabled = enabledServices.includes(a.toLowerCase());\n    const bEnabled = enabledServices.includes(b.toLowerCase());\n    if (aEnabled && !bEnabled) return -1;\n    if (!aEnabled && bEnabled) return 1;\n    return a.localeCompare(b);\n  });\n\n  sortedServices.forEach(service => {\n    const serviceTools = toolsByService[service];\n    const serviceInfo = SERVICE_DESCRIPTIONS[service.toLowerCase()];\n    const serviceName = serviceInfo?.name || service.charAt(0).toUpperCase() + service.slice(1);\n    const serviceDesc = serviceInfo?.description || '';\n\n    toolSections += `\\n### ${serviceName}${serviceDesc ? ` (${serviceDesc})` : ''}\\n`;\n\n    serviceTools.forEach(tool => {\n      const params = tool.parameters\n        .filter(p => p.required)\n        .map(p => `${p.name}`)\n        .join(', ');\n      const paramStr = params ? ` (paramètres: ${params})` : '';\n      toolSections += `- ${tool.name}: ${tool.description}${paramStr}\\n`;\n    });\n  });\n\n  // Générer des exemples basés sur les services activés\n  let examples = '';\n\n  if (enabledServices.includes('plex')) {\n    examples += `\nQuestion: \"Le film Avatar est-il disponible?\"\n→ Utilise l'outil plex_search_media avec query=\"Avatar\"\n`;\n  }\n\n  if (enabledServices.includes('tautulli')) {\n    examples += `\nQuestion: \"Qui regarde Plex en ce moment?\"\n→ Utilise l'outil tautulli_get_activity\n\nQuestion: \"Quels sont les utilisateurs les plus actifs ce mois-ci?\"\n→ Utilise l'outil tautulli_get_top_users avec days=30\n\nQuestion: \"Quels sont les films les plus regardés cette semaine?\"\n→ Utilise l'outil tautulli_get_top_movies avec days=7\n\nQuestion: \"Quelles séries sont les plus populaires?\"\n→ Utilise l'outil tautulli_get_top_tv_shows\n\nQuestion: \"Donne-moi un résumé des statistiques de visionnage\"\n→ Utilise l'outil tautulli_get_watch_stats_summary\n\nQuestion: \"Quelles sont les statistiques de l'utilisateur Jean?\"\n→ Utilise l'outil tautulli_get_user_stats avec username=\"Jean\"\n\nQuestion: \"Sur quels appareils les gens regardent Plex?\"\n→ Utilise l'outil tautulli_get_top_platforms\n`;\n  }\n\n  if (enabledServices.includes('overseerr')) {\n    examples += `\nQuestion: \"Demande le film Gladiator 2\"\n→ Utilise l'outil overseerr_request_media avec title=\"Gladiator 2\" et media_type=\"movie\"\n`;\n  }\n\n  if (enabledServices.includes('radarr')) {\n    examples += `\nQuestion: \"Quels films sont en cours de téléchargement?\"\n→ Utilise l'outil radarr_get_queue\n\nQuestion: \"Quels indexeurs sont configurés dans Radarr?\"\n→ Utilise l'outil radarr_get_indexers\n\nQuestion: \"Teste tous les indexeurs de Radarr\"\n→ Utilise l'outil radarr_test_all_indexers\n`;\n  }\n\n  if (enabledServices.includes('sonarr')) {\n    examples += `\nQuestion: \"Quelles séries sont suivies?\"\n→ Utilise l'outil sonarr_get_series\n\nQuestion: \"Teste tous les indexeurs de Sonarr\"\n→ Utilise l'outil sonarr_test_all_indexers\n`;\n  }\n\n  if (enabledServices.includes('prowlarr')) {\n    examples += `\nQuestion: \"Quels indexeurs sont dans Prowlarr?\"\n→ Utilise l'outil prowlarr_get_indexers\n\nQuestion: \"Teste tous les indexeurs de Prowlarr\"\n→ Utilise l'outil prowlarr_test_all_indexers\n\nQuestion: \"Cherche 'Avatar' sur tous les indexeurs\"\n→ Utilise l'outil prowlarr_search avec query=\"Avatar\"\n`;\n  }\n\n  if (enabledServices.includes('jackett')) {\n    examples += `\nQuestion: \"Quels indexeurs sont dans Jackett?\"\n→ Utilise l'outil jackett_get_indexers\n\nQuestion: \"Teste tous les indexeurs de Jackett\"\n→ Utilise l'outil jackett_test_all_indexers\n`;\n  }\n\n  if (enabledServices.includes('komga')) {\n    examples += `\nQuestion: \"Quelles bibliothèques de comics ai-je?\"\n→ Utilise l'outil komga_get_libraries\n`;\n  }\n\n  if (enabledServices.includes('romm')) {\n    examples += `\nQuestion: \"Quelles plateformes de jeux sont disponibles?\"\n→ Utilise l'outil romm_get_platforms\n\nQuestion: \"Quels sont les derniers jeux ajoutés dans RomM?\"\n→ Utilise l'outil romm_get_roms avec limit=10\n\nQuestion: \"Cherche le jeu Mario\"\n→ Utilise l'outil romm_search_roms avec query=\"Mario\"\n`;\n  }\n\n  if (enabledServices.includes('zammad')) {\n    examples += `\nQuestion: \"Crée un ticket de support pour un problème de connexion\"\n→ Utilise l'outil zammad_create_ticket avec title=\"Problème de connexion\" et body=\"Description du problème\"\n\nQuestion: \"Quels sont les tickets ouverts?\"\n→ Utilise l'outil zammad_get_tickets\n\nQuestion: \"Combien de tickets sont ouverts/nouveaux?\"\n→ Utilise l'outil zammad_get_ticket_stats\n\nQuestion: \"Ajoute un commentaire au ticket 125\"\n→ Utilise l'outil zammad_add_comment avec ticket_id=125 et comment=\"Contenu du commentaire\"\n\nQuestion: \"Ferme le ticket 125\"\n→ Utilise l'outil zammad_update_ticket_status avec ticket_id=125 et status=\"closed\"\n`;\n  }\n\n  if (enabledServices.includes('audiobookshelf')) {\n    examples += `\nQuestion: \"Quelles sont mes bibliothèques de livres audio?\"\n→ Utilise l'outil audiobookshelf_get_libraries\n\nQuestion: \"Quels livres audio ai-je récemment ajoutés?\"\n→ Utilise l'outil audiobookshelf_get_recent_items\n\nQuestion: \"Cherche le livre 'Harry Potter'\"\n→ Utilise l'outil audiobookshelf_search avec query=\"Harry Potter\"\n\nQuestion: \"Quelles sessions d'écoute sont en cours?\"\n→ Utilise l'outil audiobookshelf_get_sessions\n`;\n  }\n\n  if (enabledServices.includes('wikijs')) {\n    examples += `\nQuestion: \"Cherche dans le wiki comment configurer Plex\"\n→ Utilise l'outil wikijs_search_pages avec query=\"configurer Plex\"\n\nQuestion: \"Affiche la page 42 du wiki\"\n→ Utilise l'outil wikijs_get_page avec page_id=42\n\nQuestion: \"Liste toutes les pages du wiki\"\n→ Utilise l'outil wikijs_get_pages\n\nQuestion: \"Quelles sont les statistiques du wiki?\"\n→ Utilise l'outil wikijs_get_statistics\n`;\n  }\n\n  if (enabledServices.includes('authentik')) {\n    examples += `\nQuestion: \"Quels utilisateurs sont dans Authentik?\"\n→ Utilise l'outil authentik_get_users\n\nQuestion: \"Quels groupes existent dans Authentik?\"\n→ Utilise l'outil authentik_get_groups\n\nQuestion: \"Quelles applications sont configurées dans Authentik?\"\n→ Utilise l'outil authentik_get_applications\n`;\n  }\n\n  // System tools are always available\n  examples += `\nQuestion: \"Quel est l'état du système?\"\n→ Utilise l'outil system_get_health\n\nQuestion: \"Quels sont les métriques CPU/mémoire actuels?\"\n→ Utilise l'outil system_get_metrics\n\nQuestion: \"Liste tous les services configurés\"\n→ Utilise l'outil system_get_services\n\nQuestion: \"Teste la connexion à Plex\"\n→ Utilise l'outil system_test_service avec service_name=\"Plex\"\n\nQuestion: \"Montre les derniers logs d'erreur\"\n→ Utilise l'outil system_get_logs avec level=\"error\"\n\nQuestion: \"Quelles alertes sont actives?\"\n→ Utilise l'outil system_get_alerts avec active_only=true\n`;\n\n  // Règles basées sur les services\n  let rules = `\n## Format des réponses\n\n1. Convertis les timestamps en dates lisibles (format: \"27 nov 2025, 19h23\")\n2. Convertis les durées en heures:minutes (ex: 158 min → 2h38)`;\n\n  if (enabledServices.includes('plex') && enabledServices.includes('overseerr')) {\n    rules += `\n3. Pour vérifier si un film/série EST DISPONIBLE → plex_search_media avec le titre\n4. Pour demander un contenu non disponible → overseerr_request_media`;\n  }\n\n  if (enabledServices.includes('tautulli')) {\n    rules += `\n5. Pour les sessions actives (qui regarde quoi) → tautulli_get_activity\n6. Pour les classements (top users, films, séries) → tautulli_get_top_* avec days (défaut: 30)\n7. Pour les stats d'un utilisateur spécifique → tautulli_get_user_stats avec username\n8. Pour un résumé global des statistiques → tautulli_get_watch_stats_summary`;\n  }\n\n  if (enabledServices.includes('radarr') || enabledServices.includes('sonarr') || enabledServices.includes('prowlarr') || enabledServices.includes('jackett')) {\n    rules += `\n\n## Tests d'indexeurs - IMPORTANT\n\nChaque service a ses PROPRES indexeurs. Utilise l'outil du service concerné:\n- \"Teste les indexeurs de Radarr\" → radarr_test_all_indexers (PAS prowlarr!)\n- \"Teste les indexeurs de Sonarr\" → sonarr_test_all_indexers (PAS prowlarr!)\n- \"Teste les indexeurs de Prowlarr\" → prowlarr_test_all_indexers\n- \"Teste les indexeurs de Jackett\" → jackett_test_all_indexers\n\n9. Pour lister les indexeurs d'un service → utilise {service}_get_indexers\n10. Pour tester tous les indexeurs d'un service → utilise {service}_test_all_indexers\n11. Pour tester un indexeur spécifique → {service}_test_indexer avec indexer_id`;\n  }\n\n  return `Tu es un assistant homelab avec accès à des outils externes.\n\n## RÈGLES CRITIQUES\n\n1. **TOUJOURS UTILISER LES OUTILS** - Quand l'utilisateur demande des informations sur le homelab (films, séries, qui regarde, téléchargements, etc.), tu DOIS utiliser l'outil correspondant.\n\n2. **NE JAMAIS INVENTER DE DONNÉES** - Si tu n'as pas de résultat d'outil, ne génère pas de fausses informations. Dis plutôt \"Je n'ai pas pu récupérer cette information\".\n\n3. **ATTENDRE LE RÉSULTAT** - Après avoir appelé un outil, attends sa réponse avant de formuler ta réponse à l'utilisateur.\n\n4. **EN CAS D'ERREUR** - Si un outil échoue, explique l'erreur technique au lieu d'inventer des données.\n\n## Outils disponibles\n${toolSections}\n${rules}\n\n## Exemples d'utilisation\n${examples || 'Aucun exemple disponible pour les services configurés.'}\n\nLangue: Réponds en français sauf si l'utilisateur utilise une autre langue.`;\n};\n\nconst ConfigurationTab = ({ tools }: { tools: McpToolsResponse | null }) => {\n  const [copied, setCopied] = useState<string | null>(null);\n  const [serverStatus, setServerStatus] = useState<McpServerStatus | null>(null);\n  const [_statusLoading, setStatusLoading] = useState(true);\n  const [_statusError, setStatusError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchStatus = async () => {\n      setStatusLoading(true);\n      setStatusError(null);\n      try {\n        const status = await api.mcp.status();\n        setServerStatus(status);\n      } catch (error) {\n        setStatusError('Impossible de se connecter au serveur');\n        setServerStatus(null);\n      } finally {\n        setStatusLoading(false);\n      }\n    };\n\n    fetchStatus();\n    const interval = setInterval(fetchStatus, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Générer le prompt dynamiquement\n  const systemPrompt = generateSystemPrompt(tools, serverStatus?.enabled_services || []);\n\n  const copyToClipboard = async (text: string, id: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopied(id);\n      setTimeout(() => setCopied(null), 2000);\n    } catch (err) {\n      // Fallback for older browsers\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-999999px';\n      document.body.appendChild(textArea);\n      textArea.select();\n      try {\n        document.execCommand('copy');\n        setCopied(id);\n        setTimeout(() => setCopied(null), 2000);\n      } catch (e) {\n        console.error('Failed to copy:', e);\n      }\n      document.body.removeChild(textArea);\n    }\n  };\n\n  const backendUrl = window.location.hostname === 'localhost'\n    ? 'http://localhost:8002'\n    : `http://${window.location.hostname}:8002`;\n\n  // OpenAPI endpoints configuration\n  const openApiEndpoints = [\n    {\n      id: 'all',\n      name: 'Tous les outils',\n      path: '/tools/openapi.json',\n      description: 'Tous les outils disponibles (peut être lent avec certains LLMs)',\n      color: 'gray',\n      services: ['Tous'],\n      recommended: false,\n    },\n    {\n      id: 'system',\n      name: 'Système & Support',\n      path: '/tools/system/openapi.json',\n      description: 'Monitoring, logs, alertes, tickets et authentification',\n      color: 'blue',\n      services: ['System', 'Zammad', 'Authentik'],\n      recommended: true,\n    },\n    {\n      id: 'media',\n      name: 'Média & Contenu',\n      path: '/tools/media/openapi.json',\n      description: 'Bibliothèques multimédia, livres audio, comics et jeux',\n      color: 'purple',\n      services: ['Plex', 'Tautulli', 'Overseerr', 'Komga', 'RomM', 'Audiobookshelf'],\n      recommended: true,\n    },\n    {\n      id: 'processing',\n      name: 'Téléchargement',\n      path: '/tools/processing/openapi.json',\n      description: 'Acquisition films/séries et gestion torrents',\n      color: 'orange',\n      services: ['Radarr', 'Sonarr', 'Prowlarr', 'Deluge'],\n      recommended: true,\n    },\n    {\n      id: 'knowledge',\n      name: 'Connaissances & IA',\n      path: '/tools/knowledge/openapi.json',\n      description: 'Wiki, documentation et interface IA',\n      color: 'green',\n      services: ['Wiki.js', 'Open WebUI', 'Ollama'],\n      recommended: false,\n    },\n  ];\n\n  const colorClasses: Record<string, { bg: string; border: string; text: string; badge: string }> = {\n    blue: {\n      bg: 'bg-blue-50 dark:bg-blue-900/20',\n      border: 'border-blue-200 dark:border-blue-800',\n      text: 'text-blue-900 dark:text-blue-100',\n      badge: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n    },\n    purple: {\n      bg: 'bg-purple-50 dark:bg-purple-900/20',\n      border: 'border-purple-200 dark:border-purple-800',\n      text: 'text-purple-900 dark:text-purple-100',\n      badge: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',\n    },\n    orange: {\n      bg: 'bg-orange-50 dark:bg-orange-900/20',\n      border: 'border-orange-200 dark:border-orange-800',\n      text: 'text-orange-900 dark:text-orange-100',\n      badge: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n    },\n    green: {\n      bg: 'bg-green-50 dark:bg-green-900/20',\n      border: 'border-green-200 dark:border-green-800',\n      text: 'text-green-900 dark:text-green-100',\n      badge: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    },\n    gray: {\n      bg: 'bg-gray-50 dark:bg-gray-800',\n      border: 'border-gray-200 dark:border-gray-700',\n      text: 'text-gray-900 dark:text-gray-100',\n      badge: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200',\n    },\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Open WebUI Tool Endpoints */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\"/>\n          </svg>\n          <h3 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white\">\n            Endpoints Open WebUI\n          </h3>\n        </div>\n\n        <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-4\">\n          Ajoutez ces URLs dans Open WebUI → <span className=\"hidden sm:inline\">Settings → Tools →</span><span className=\"sm:hidden\">⚙️ →</span> Add Tool Server.\n          <br className=\"hidden sm:block\" />\n          <span className=\"text-blue-600 dark:text-blue-400 block sm:inline mt-1 sm:mt-0\">Utilisez les endpoints séparés pour de meilleures performances.</span>\n        </p>\n\n        <div className=\"grid gap-3\">\n          {openApiEndpoints.map((endpoint) => {\n            const colors = colorClasses[endpoint.color];\n            const fullUrl = `${backendUrl}${endpoint.path}`;\n\n            return (\n              <div\n                key={endpoint.id}\n                className={`${colors.bg} ${colors.border} border rounded-lg p-3 sm:p-4`}\n              >\n                {/* Mobile: Stack layout, Desktop: Side by side */}\n                <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center flex-wrap gap-2 mb-1\">\n                      <h4 className={`font-medium ${colors.text}`}>\n                        {endpoint.name}\n                      </h4>\n                      {endpoint.recommended && (\n                        <span className=\"px-1.5 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded\">\n                          Recommandé\n                        </span>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\n                      {endpoint.description}\n                    </p>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {endpoint.services.map(service => (\n                        <span\n                          key={service}\n                          className={`px-2 py-0.5 text-xs ${colors.badge} rounded-full`}\n                        >\n                          {service}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                  {/* Mobile: Full width row, Desktop: Column on right */}\n                  <div className=\"flex flex-row sm:flex-col items-center sm:items-end justify-between sm:justify-start gap-2 pt-2 sm:pt-0 border-t sm:border-t-0 border-gray-200 dark:border-gray-600\">\n                    <code className=\"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded font-mono truncate max-w-[200px] sm:max-w-none\">\n                      {endpoint.path}\n                    </code>\n                    <button\n                      onClick={() => copyToClipboard(fullUrl, `endpoint-${endpoint.id}`)}\n                      className={`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors whitespace-nowrap ${\n                        copied === `endpoint-${endpoint.id}`\n                          ? 'bg-green-600 text-white'\n                          : 'bg-blue-600 hover:bg-blue-700 text-white'\n                      }`}\n                    >\n                      {copied === `endpoint-${endpoint.id}` ? '✓ Copié!' : 'Copier URL'}\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Quick setup reminder */}\n        <div className=\"mt-4 p-2 sm:p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\">\n          <p className=\"text-xs sm:text-sm text-amber-800 dark:text-amber-200\">\n            <strong>Config:</strong> Auth = <code className=\"bg-amber-100 dark:bg-amber-900 px-1 rounded text-xs\">Session</code>\n            <span className=\"hidden sm:inline\"> •</span><span className=\"sm:hidden\">,</span>\n            Filter = <code className=\"bg-amber-100 dark:bg-amber-900 px-1 rounded text-xs\">,</code> <span className=\"text-amber-600 dark:text-amber-400\">(virgule)</span>\n          </p>\n        </div>\n\n        {/* Important troubleshooting note */}\n        <details className=\"mt-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg group\">\n          <summary className=\"p-3 sm:p-4 cursor-pointer list-none flex items-center gap-2 hover:bg-blue-100/50 dark:hover:bg-blue-900/30 rounded-lg\">\n            <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 dark:text-blue-400 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n            </svg>\n            <span className=\"font-medium text-sm sm:text-base text-blue-900 dark:text-blue-100\">Les outils ne sont pas appelés ?</span>\n            <svg className=\"w-4 h-4 text-blue-400 transition-transform group-open:rotate-180 ml-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          </summary>\n          <div className=\"px-3 sm:px-4 pb-3 sm:pb-4 text-xs sm:text-sm text-blue-800 dark:text-blue-200 space-y-2\">\n            <p>\n              Si le modèle dit <em>\"Je vais appeler l'outil...\"</em> mais invente des données, le <strong>function calling natif</strong> n'est pas activé.\n            </p>\n            <p><strong>Solutions :</strong></p>\n            <ul className=\"list-disc list-inside ml-1 sm:ml-2 space-y-1\">\n              <li>Utilisez un modèle compatible (GPT-4, Claude, Qwen2.5, Llama 3.3)</li>\n              <li className=\"break-words\">Open WebUI : <code className=\"bg-blue-100 dark:bg-blue-900 px-1 rounded text-xs\">Admin → Models → Native Tool Calling</code></li>\n              <li>Ollama : <code className=\"bg-blue-100 dark:bg-blue-900 px-1 rounded text-xs\">ollama show &lt;model&gt;</code></li>\n            </ul>\n          </div>\n        </details>\n      </div>\n\n      {/* System Prompt - Collapsible */}\n      <details className=\"bg-white dark:bg-gray-800 rounded-lg shadow group\">\n        <summary className=\"p-3 sm:p-4 cursor-pointer list-none flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg\">\n          <div className=\"flex items-center gap-2 sm:gap-3 min-w-0\">\n            <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-purple-600 flex-shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z\"/>\n            </svg>\n            <div className=\"min-w-0\">\n              <h3 className=\"font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate\">\n                Prompt Système\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                {serverStatus?.enabled_services?.length || 0} services • {tools?.total || 0} outils\n              </p>\n            </div>\n          </div>\n          <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 transition-transform group-open:rotate-180 flex-shrink-0 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n          </svg>\n        </summary>\n        <div className=\"p-3 sm:p-4 pt-0 border-t border-gray-100 dark:border-gray-700\">\n          {serverStatus?.enabled_services && serverStatus.enabled_services.length > 0 && (\n            <div className=\"flex flex-wrap gap-1 mb-3\">\n              {serverStatus.enabled_services.map(service => {\n                const info = SERVICE_DESCRIPTIONS[service.toLowerCase()];\n                return (\n                  <span\n                    key={service}\n                    className=\"px-1.5 sm:px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded-full\"\n                    title={info?.description || ''}\n                  >\n                    {info?.name || service}\n                  </span>\n                );\n              })}\n            </div>\n          )}\n          <div className=\"relative\">\n            <pre className=\"bg-gray-900 text-gray-100 p-3 sm:p-4 rounded-lg overflow-x-auto text-xs sm:text-sm whitespace-pre-wrap max-h-60 sm:max-h-80 overflow-y-auto\">\n              <code>{systemPrompt}</code>\n            </pre>\n            <button\n              onClick={() => copyToClipboard(systemPrompt, 'system-prompt')}\n              className={`absolute top-2 right-2 px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium rounded-lg transition-colors ${\n                copied === 'system-prompt'\n                  ? 'bg-green-600 text-white'\n                  : 'bg-purple-600 hover:bg-purple-700 text-white'\n              }`}\n            >\n              {copied === 'system-prompt' ? '✓' : 'Copier'}\n            </button>\n          </div>\n          <p className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n            <span className=\"hidden sm:inline\">Open WebUI → Admin Panel → Settings → Models → System Prompt</span>\n            <span className=\"sm:hidden\">Open WebUI → Admin → Models → System Prompt</span>\n          </p>\n        </div>\n      </details>\n\n      {/* Other configurations - Collapsible */}\n      <details className=\"bg-white dark:bg-gray-800 rounded-lg shadow group\">\n        <summary className=\"p-3 sm:p-4 cursor-pointer list-none flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg\">\n          <div className=\"flex items-center gap-2 sm:gap-3 min-w-0\">\n            <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 flex-shrink-0\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8h16v10z\"/>\n            </svg>\n            <div className=\"min-w-0\">\n              <h3 className=\"font-medium text-sm sm:text-base text-gray-900 dark:text-white\">\n                Autres configs\n              </h3>\n              <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">\n                Claude Desktop, API docs\n              </p>\n            </div>\n          </div>\n          <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 transition-transform group-open:rotate-180 flex-shrink-0 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n          </svg>\n        </summary>\n        <div className=\"p-3 sm:p-4 pt-0 border-t border-gray-100 dark:border-gray-700 space-y-3 sm:space-y-4\">\n          {/* API Documentation Link */}\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <div>\n              <p className=\"font-medium text-sm text-gray-900 dark:text-white\">Documentation API</p>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Swagger interactive</p>\n            </div>\n            <a\n              href={`${backendUrl}/docs`}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"px-3 py-1.5 text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-center\"\n            >\n              Ouvrir /docs\n            </a>\n          </div>\n\n          {/* Claude Desktop */}\n          <div className=\"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <p className=\"font-medium text-sm text-gray-900 dark:text-white mb-2\">Claude Desktop (MCP stdio)</p>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 break-all\">\n              <code className=\"bg-gray-200 dark:bg-gray-600 px-1 rounded text-xs\">~/.config/Claude/claude_desktop_config.json</code>\n            </p>\n            <div className=\"relative\">\n              <pre className=\"bg-gray-900 text-gray-100 p-3 rounded text-xs overflow-x-auto\">\n{`{\n  \"mcpServers\": {\n    \"mcparr-gateway\": {\n      \"command\": \"python\",\n      \"args\": [\"-m\", \"src.mcp.main\"],\n      \"cwd\": \"/path/to/ia-homelab/backend\"\n    }\n  }\n}`}\n              </pre>\n              <button\n                onClick={() => copyToClipboard(`{\n  \"mcpServers\": {\n    \"mcparr-gateway\": {\n      \"command\": \"python\",\n      \"args\": [\"-m\", \"src.mcp.main\"],\n      \"cwd\": \"/path/to/ia-homelab/backend\"\n    }\n  }\n}`, 'claude-config')}\n                className={`absolute top-1 right-1 px-2 py-1 text-xs rounded transition-colors ${\n                  copied === 'claude-config'\n                    ? 'bg-green-600 text-white'\n                    : 'bg-gray-600 hover:bg-gray-500 text-white'\n                }`}\n              >\n                {copied === 'claude-config' ? '✓' : 'Copier'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </details>\n    </div>\n  );\n};\n\nexport default function MCP() {\n  const [activeTab, setActiveTab] = useState<'overview' | 'history' | 'tools' | 'config'>('overview');\n  const [stats, setStats] = useState<McpStats | null>(null);\n  const [toolUsage, setToolUsage] = useState<McpToolUsage[]>([]);\n  const [hourlyUsage, setHourlyUsage] = useState<McpHourlyUsage[]>([]);\n  const [userStats, setUserStats] = useState<McpUserStats[]>([]);\n  const [userServiceStats, setUserServiceStats] = useState<McpUserServiceStats[]>([]);\n  const [hourlyUserUsage, setHourlyUserUsage] = useState<McpHourlyUserUsage[]>([]);\n  const [requests, setRequests] = useState<McpRequest[]>([]);\n  const [tools, setTools] = useState<McpToolsResponse | null>(null);\n  const [toolGroups, setToolGroups] = useState<Record<string, ToolGroup[]>>({});\n  const [totalRequests, setTotalRequests] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [selectedRequest, setSelectedRequest] = useState<McpRequest | null>(null);\n  const [selectedToolToTest, setSelectedToolToTest] = useState<McpTool | null>(null);\n  const [timeRange, setTimeRange] = useState(24);\n  const [categoryFilter, setCategoryFilter] = useState<string>('');\n  const [statusFilter, setStatusFilter] = useState<string>('');\n  const [expandedServices, setExpandedServices] = useState<Set<string>>(new Set());\n\n  const fetchData = useCallback(async () => {\n    setLoading(true);\n    try {\n      const [statsRes, toolUsageRes, hourlyRes, userStatsRes, userServiceStatsRes, hourlyUserRes, requestsRes, toolsRes, toolGroupsRes] = await Promise.all([\n        api.mcp.stats(timeRange).catch(() => null),\n        api.mcp.toolUsage(timeRange).catch(() => []),\n        api.mcp.hourlyUsage(timeRange).catch(() => []),\n        api.mcp.userStats(timeRange).catch(() => []),\n        api.mcp.userServiceStats(timeRange).catch(() => []),\n        api.mcp.hourlyUsageByUser(timeRange).catch(() => []),\n        api.mcp.requests.list({\n          limit: 50,\n          ...(categoryFilter && { category: categoryFilter }),\n          ...(statusFilter && { status: statusFilter }),\n        }).catch(() => ({ items: [], total: 0 })),\n        api.mcp.tools().catch(() => null),\n        api.groups.toolsWithGroups().catch(() => ({ tool_groups: {} })),\n      ]);\n\n      if (statsRes) setStats(statsRes);\n      setToolUsage(toolUsageRes);\n      setHourlyUsage(hourlyRes);\n      setUserStats(userStatsRes);\n      setUserServiceStats(userServiceStatsRes);\n      setHourlyUserUsage(hourlyUserRes);\n      setRequests(requestsRes.items || []);\n      setTotalRequests(requestsRes.total || 0);\n      if (toolsRes) setTools(toolsRes);\n      if (toolGroupsRes) setToolGroups(toolGroupsRes.tool_groups || {});\n    } catch (error) {\n      console.error('Failed to fetch MCP data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [timeRange, categoryFilter, statusFilter]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  // Group tools by service instead of category\n  const toolsByService = useMemo(() => {\n    if (!tools?.tools) return {};\n\n    const grouped: Record<string, McpTool[]> = {};\n\n    tools.tools.forEach((tool) => {\n      const serviceName = tool.requires_service || getServiceFromToolName(tool.name) || 'system';\n      if (!grouped[serviceName]) {\n        grouped[serviceName] = [];\n      }\n      grouped[serviceName].push(tool);\n    });\n\n    // Sort services alphabetically, but put 'system' at the end\n    const sortedServices = Object.keys(grouped).sort((a, b) => {\n      if (a === 'system') return 1;\n      if (b === 'system') return -1;\n      return a.localeCompare(b);\n    });\n\n    const sorted: Record<string, McpTool[]> = {};\n    sortedServices.forEach((service) => {\n      sorted[service] = grouped[service];\n    });\n\n    return sorted;\n  }, [tools]);\n\n  // Calculate usage stats by service\n  const usageByService = useMemo(() => {\n    if (!toolUsage?.length) return {};\n\n    const byService: Record<string, { count: number; avgDuration: number; successRate: number }> = {};\n\n    toolUsage.forEach((tool) => {\n      const serviceName = getServiceFromToolName(tool.tool_name) || 'system';\n      if (!byService[serviceName]) {\n        byService[serviceName] = { count: 0, avgDuration: 0, successRate: 0 };\n      }\n      byService[serviceName].count += tool.usage_count;\n      byService[serviceName].avgDuration += tool.avg_duration_ms * tool.usage_count;\n      byService[serviceName].successRate += tool.success_rate * tool.usage_count;\n    });\n\n    // Calculate averages\n    Object.keys(byService).forEach((service) => {\n      if (byService[service].count > 0) {\n        byService[service].avgDuration = Math.round(byService[service].avgDuration / byService[service].count);\n        byService[service].successRate = Math.round(byService[service].successRate / byService[service].count);\n      }\n    });\n\n    return byService;\n  }, [toolUsage]);\n\n  // Toggle service expansion\n  const toggleService = (serviceName: string) => {\n    setExpandedServices((prev) => {\n      const next = new Set(prev);\n      if (next.has(serviceName)) {\n        next.delete(serviceName);\n      } else {\n        next.add(serviceName);\n      }\n      return next;\n    });\n  };\n\n  // Expand/collapse all services\n  const toggleAllServices = (expand: boolean) => {\n    if (expand) {\n      setExpandedServices(new Set(Object.keys(toolsByService)));\n    } else {\n      setExpandedServices(new Set());\n    }\n  };\n\n  const formatDuration = (ms: number | null): string => {\n    if (ms === null) return '-';\n    if (ms < 1000) return `${ms}ms`;\n    return `${(ms / 1000).toFixed(2)}s`;\n  };\n\n  const formatDate = (date: string): string => {\n    return new Date(date).toLocaleString();\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-4 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Bot className=\"w-6 h-6 sm:w-8 sm:h-8 text-blue-600\" />\n            MCP Server\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n            Model Context Protocol - Analytics et historique\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <select\n            value={timeRange}\n            onChange={(e) => setTimeRange(Number(e.target.value))}\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          >\n            <option value={1}>1h</option>\n            <option value={6}>6h</option>\n            <option value={24}>24h</option>\n            <option value={72}>3j</option>\n            <option value={168}>7j</option>\n          </select>\n          <button\n            onClick={fetchData}\n            className=\"p-2 sm:px-4 sm:py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Actualiser</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Tab Navigation - Compact horizontal pills */}\n      <div className=\"mb-4 sm:mb-6 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0\">\n        <nav className=\"flex gap-1.5 sm:gap-2 min-w-max sm:min-w-0 sm:flex-wrap\">\n          {[\n            { id: 'overview' as const, label: 'Stats', labelFull: 'Vue générale', icon: BarChart3 },\n            { id: 'history' as const, label: 'Historique', labelFull: 'Historique des requêtes', icon: History },\n            { id: 'tools' as const, label: 'Outils', labelFull: 'Outils disponibles', icon: Wrench },\n            { id: 'config' as const, label: 'Config', labelFull: 'Configuration', icon: Settings },\n          ].map((tab) => {\n            const Icon = tab.icon;\n            const isActive = activeTab === tab.id;\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                title={tab.labelFull}\n                className={`flex items-center gap-1.5 py-1.5 px-2.5 sm:py-2 sm:px-3 rounded-full font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${\n                  isActive\n                    ? 'bg-blue-600 text-white shadow-sm'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n              >\n                <Icon className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                <span>{tab.label}</span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {loading ? (\n        <div className=\"text-center py-12 text-gray-500\">Loading MCP data...</div>\n      ) : (\n        <>\n          {/* Overview Tab */}\n          {activeTab === 'overview' && (\n            <div className=\"space-y-6\">\n              {/* Stats Grid */}\n              <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4\">\n                <StatCard\n                  title=\"Total Requests\"\n                  value={stats?.total || 0}\n                  subtitle={`Last ${timeRange}h`}\n                  color=\"blue\"\n                />\n                <StatCard\n                  title=\"Success Rate\"\n                  value={`${stats?.success_rate || 100}%`}\n                  subtitle={`${stats?.by_status?.completed || 0} completed`}\n                  color={stats?.success_rate && stats.success_rate < 90 ? 'red' : 'green'}\n                />\n                <StatCard\n                  title=\"Avg Duration\"\n                  value={formatDuration(stats?.average_duration_ms || null)}\n                  subtitle=\"Per request\"\n                  color=\"purple\"\n                />\n                <StatCard\n                  title=\"Failed\"\n                  value={stats?.by_status?.failed || 0}\n                  subtitle=\"Errors encountered\"\n                  color={(stats?.by_status?.failed || 0) > 0 ? 'red' : 'gray'}\n                />\n              </div>\n\n              {/* Hourly Usage Chart */}\n              <HourlyUsageChart data={hourlyUsage} timeRange={timeRange} />\n\n              {/* Tool Usage & Categories */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Top Tools */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">\n                    Top Tools\n                  </h3>\n                  {toolUsage.length > 0 ? (\n                    <div className=\"space-y-2\">\n                      {toolUsage.slice(0, 10).map((tool, index) => {\n                        const serviceName = getServiceFromToolName(tool.tool_name) || 'system';\n                        const colors = getServiceColor(serviceName);\n                        const maxUsage = Math.max(...toolUsage.map(t => t.usage_count));\n                        const percentage = (tool.usage_count / maxUsage) * 100;\n\n                        return (\n                        <div key={tool.tool_name} className=\"group\">\n                          <div className=\"flex items-center gap-3\">\n                            {/* Rank */}\n                            <span className=\"text-xs font-medium text-gray-400 w-4\">{index + 1}</span>\n                            {/* Color dot */}\n                            <span className={`w-2 h-2 rounded-full ${colors.dot}`} title={serviceName} />\n                            {/* Tool name */}\n                            <span className=\"text-sm text-gray-900 dark:text-white flex-1 truncate\" title={tool.tool_name}>\n                              {tool.tool_name.replace(`${serviceName}_`, '')}\n                            </span>\n                            {/* Stats */}\n                            <span className=\"text-xs tabular-nums text-gray-500 dark:text-gray-400\">\n                              {tool.usage_count}\n                            </span>\n                            <span className={`text-xs tabular-nums ${tool.success_rate >= 90 ? 'text-green-600 dark:text-green-400' : tool.success_rate >= 50 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}`}>\n                              {tool.success_rate}%\n                            </span>\n                          </div>\n                          {/* Progress bar */}\n                          <div className=\"ml-7 mt-1 h-1 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full rounded-full transition-all\"\n                              style={{ width: `${percentage}%`, backgroundColor: colors.hex }}\n                            />\n                          </div>\n                        </div>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <p className=\"text-gray-500 dark:text-gray-400\">No tool usage data</p>\n                  )}\n                </div>\n\n                {/* By Service */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">\n                    Par Service\n                  </h3>\n                  {Object.keys(usageByService).length > 0 ? (\n                    <div className=\"space-y-3\">\n                      {Object.entries(usageByService)\n                        .sort((a, b) => b[1].count - a[1].count)\n                        .map(([serviceName, serviceStats]) => {\n                          const colors = getServiceColor(serviceName);\n                          const Icon = colors.icon;\n                          const totalUsage = Object.values(usageByService).reduce((sum, s) => sum + s.count, 0);\n                          const percentage = totalUsage > 0 ? (serviceStats.count / totalUsage) * 100 : 0;\n\n                          return (\n                            <div key={serviceName} className=\"flex items-center gap-3\">\n                              {/* Icon with color background */}\n                              <div className={`p-1.5 rounded-lg ${colors.bg}`}>\n                                <Icon className={`w-4 h-4 ${colors.text}`} />\n                              </div>\n                              {/* Service info + bar */}\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-center justify-between mb-1\">\n                                  <span className=\"text-sm font-medium text-gray-900 dark:text-white capitalize\">\n                                    {serviceName}\n                                  </span>\n                                  <div className=\"flex items-center gap-2\">\n                                    <span className=\"text-xs tabular-nums text-gray-600 dark:text-gray-400\">\n                                      {serviceStats.count}\n                                    </span>\n                                    <span className={`text-xs tabular-nums ${serviceStats.successRate >= 90 ? 'text-green-600 dark:text-green-400' : serviceStats.successRate >= 50 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}`}>\n                                      {serviceStats.successRate}%\n                                    </span>\n                                  </div>\n                                </div>\n                                <div className=\"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden\">\n                                  <div\n                                    className=\"h-full rounded-full transition-all\"\n                                    style={{ width: `${percentage}%`, backgroundColor: colors.hex }}\n                                  />\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                    </div>\n                  ) : (\n                    <p className=\"text-gray-500 dark:text-gray-400\">Aucune donnée d'utilisation</p>\n                  )}\n                </div>\n              </div>\n\n              {/* Bottom row: Status donut + Performance metrics + Quick stats */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {/* Status Donut - Compact */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n                  <h3 className=\"text-sm font-medium text-gray-900 dark:text-white mb-3\">\n                    Par Status\n                  </h3>\n                  {stats?.by_status && Object.keys(stats.by_status).length > 0 ? (\n                    <StatusDonutChart data={stats.by_status} total={stats.total} />\n                  ) : (\n                    <div className=\"flex items-center justify-center h-24\">\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">Aucune donnée</p>\n                    </div>\n                  )}\n                </div>\n\n                {/* Performance by Service - Bar chart style */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n                  <h3 className=\"text-sm font-medium text-gray-900 dark:text-white mb-3\">\n                    Durée moyenne par service\n                  </h3>\n                  {toolUsage.length > 0 ? (\n                    <div className=\"space-y-2\">\n                      {(() => {\n                        // Calculate avg duration per service\n                        const serviceAvgDuration: Record<string, { total: number; count: number }> = {};\n                        toolUsage.forEach(tool => {\n                          const serviceName = getServiceFromToolName(tool.tool_name) || 'other';\n                          if (!serviceAvgDuration[serviceName]) {\n                            serviceAvgDuration[serviceName] = { total: 0, count: 0 };\n                          }\n                          serviceAvgDuration[serviceName].total += tool.avg_duration_ms * tool.usage_count;\n                          serviceAvgDuration[serviceName].count += tool.usage_count;\n                        });\n\n                        const serviceDurations = Object.entries(serviceAvgDuration)\n                          .map(([name, data]) => ({\n                            name,\n                            avgMs: data.count > 0 ? data.total / data.count : 0\n                          }))\n                          .sort((a, b) => b.avgMs - a.avgMs)\n                          .slice(0, 5);\n\n                        const maxDuration = Math.max(...serviceDurations.map(s => s.avgMs), 1);\n\n                        return serviceDurations.map(service => {\n                          const colors = getServiceColor(service.name);\n                          const percentage = (service.avgMs / maxDuration) * 100;\n                          return (\n                            <div key={service.name} className=\"flex items-center gap-2\">\n                              <span className=\"text-xs text-gray-600 dark:text-gray-400 w-16 truncate capitalize\">\n                                {service.name}\n                              </span>\n                              <div className=\"flex-1 h-4 bg-gray-100 dark:bg-gray-700 rounded overflow-hidden\">\n                                <div\n                                  className=\"h-full rounded transition-all\"\n                                  style={{ width: `${percentage}%`, backgroundColor: colors.hex }}\n                                />\n                              </div>\n                              <span className=\"text-xs font-mono text-gray-700 dark:text-gray-300 w-14 text-right\">\n                                {service.avgMs >= 1000\n                                  ? `${(service.avgMs / 1000).toFixed(1)}s`\n                                  : `${Math.round(service.avgMs)}ms`}\n                              </span>\n                            </div>\n                          );\n                        });\n                      })()}\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center justify-center h-24\">\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">Aucune donnée</p>\n                    </div>\n                  )}\n                </div>\n\n                {/* Quick Stats Cards */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n                  <h3 className=\"text-sm font-medium text-gray-900 dark:text-white mb-3\">\n                    Highlights\n                  </h3>\n                  <div className=\"space-y-3\">\n                    {/* Most used tool */}\n                    {toolUsage.length > 0 && (\n                      <div className=\"flex items-center gap-3 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                        <div className=\"p-1.5 bg-blue-100 dark:bg-blue-800 rounded\">\n                          <BarChart3 className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Plus utilisé</p>\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                            {toolUsage[0]?.tool_name.replace(/^(plex_|tautulli_|overseerr_|zammad_|komga_|ollama_|openwebui_)/, '')}\n                          </p>\n                        </div>\n                        <span className=\"text-sm font-bold text-blue-600 dark:text-blue-400\">\n                          {toolUsage[0]?.usage_count}\n                        </span>\n                      </div>\n                    )}\n\n                    {/* Fastest tool */}\n                    {toolUsage.length > 0 && (\n                      <div className=\"flex items-center gap-3 p-2 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                        <div className=\"p-1.5 bg-green-100 dark:bg-green-800 rounded\">\n                          <RefreshCw className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Plus rapide</p>\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                            {[...toolUsage].sort((a, b) => a.avg_duration_ms - b.avg_duration_ms)[0]?.tool_name.replace(/^(plex_|tautulli_|overseerr_|zammad_|komga_|ollama_|openwebui_)/, '')}\n                          </p>\n                        </div>\n                        <span className=\"text-sm font-bold text-green-600 dark:text-green-400\">\n                          {Math.round([...toolUsage].sort((a, b) => a.avg_duration_ms - b.avg_duration_ms)[0]?.avg_duration_ms || 0)}ms\n                        </span>\n                      </div>\n                    )}\n\n                    {/* Error rate highlight */}\n                    {stats && (\n                      <div className={`flex items-center gap-3 p-2 rounded-lg ${\n                        stats.success_rate >= 95\n                          ? 'bg-emerald-50 dark:bg-emerald-900/20'\n                          : stats.success_rate >= 80\n                            ? 'bg-yellow-50 dark:bg-yellow-900/20'\n                            : 'bg-red-50 dark:bg-red-900/20'\n                      }`}>\n                        <div className={`p-1.5 rounded ${\n                          stats.success_rate >= 95\n                            ? 'bg-emerald-100 dark:bg-emerald-800'\n                            : stats.success_rate >= 80\n                              ? 'bg-yellow-100 dark:bg-yellow-800'\n                              : 'bg-red-100 dark:bg-red-800'\n                        }`}>\n                          <History className={`w-4 h-4 ${\n                            stats.success_rate >= 95\n                              ? 'text-emerald-600 dark:text-emerald-400'\n                              : stats.success_rate >= 80\n                                ? 'text-yellow-600 dark:text-yellow-400'\n                                : 'text-red-600 dark:text-red-400'\n                          }`} />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400\">Fiabilité</p>\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                            {stats.success_rate >= 95 ? 'Excellente' : stats.success_rate >= 80 ? 'Correcte' : 'À surveiller'}\n                          </p>\n                        </div>\n                        <span className={`text-sm font-bold ${\n                          stats.success_rate >= 95\n                            ? 'text-emerald-600 dark:text-emerald-400'\n                            : stats.success_rate >= 80\n                              ? 'text-yellow-600 dark:text-yellow-400'\n                              : 'text-red-600 dark:text-red-400'\n                        }`}>\n                          {stats.success_rate}%\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* User Statistics Section */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* User Stats Chart */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">\n                    Requêtes par utilisateur\n                  </h3>\n                  <UserStatsChart data={userStats} />\n                </div>\n\n                {/* User Service Breakdown */}\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow\">\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">\n                    Services par utilisateur\n                  </h3>\n                  <UserServiceChart data={userServiceStats} />\n                </div>\n              </div>\n\n              {/* Hourly Usage by User - Stacked Chart */}\n              <HourlyUserStackedChart data={hourlyUserUsage} timeRange={timeRange} />\n            </div>\n          )}\n\n          {/* History Tab */}\n          {activeTab === 'history' && (\n            <div className=\"space-y-4\">\n              {/* Filters */}\n              <div className=\"flex gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow\">\n                <select\n                  value={categoryFilter}\n                  onChange={(e) => setCategoryFilter(e.target.value)}\n                  className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                >\n                  <option value=\"\">All Categories</option>\n                  <option value=\"media\">Media</option>\n                  <option value=\"requests\">Requests</option>\n                  <option value=\"support\">Support</option>\n                  <option value=\"system\">System</option>\n                  <option value=\"users\">Users</option>\n                </select>\n                <select\n                  value={statusFilter}\n                  onChange={(e) => setStatusFilter(e.target.value)}\n                  className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                >\n                  <option value=\"\">All Statuses</option>\n                  <option value=\"pending\">Pending</option>\n                  <option value=\"processing\">Processing</option>\n                  <option value=\"completed\">Completed</option>\n                  <option value=\"failed\">Failed</option>\n                </select>\n                <span className=\"ml-auto text-sm text-gray-500 self-center\">\n                  {totalRequests} total requests\n                </span>\n              </div>\n\n              {/* Request List - Mobile: Card view, Desktop: Table view */}\n              {/* Mobile Cards */}\n              <div className=\"sm:hidden space-y-3\">\n                {requests.length > 0 ? (\n                  requests.map((request) => (\n                    <div\n                      key={request.id}\n                      className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-4\"\n                      onClick={() => setSelectedRequest(request)}\n                    >\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div className=\"min-w-0 flex-1\">\n                          <span className=\"text-sm font-medium text-gray-900 dark:text-white block truncate\">\n                            {request.tool_name}\n                          </span>\n                          <span className=\"text-xs text-gray-500\">\n                            {new Date(request.created_at).toLocaleString()}\n                          </span>\n                        </div>\n                        <StatusBadge status={request.status} />\n                      </div>\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <ServiceBadge toolName={request.tool_name} />\n                        {request.tool_category && <CategoryBadge category={request.tool_category} />}\n                        {request.user_display_name && (\n                          <span className=\"text-xs text-gray-500\">par {request.user_display_name}</span>\n                        )}\n                        <span className=\"text-xs text-gray-400 ml-auto\">\n                          {formatDuration(request.duration_ms)}\n                        </span>\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n                    Aucune requete MCP trouvee\n                  </div>\n                )}\n              </div>\n\n              {/* Desktop Table */}\n              <div className=\"hidden sm:block bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n                <div className=\"overflow-x-auto\">\n                  <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                    <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          Outil\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          Service\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          User\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          Statut\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          Duree\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                          Date\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n                      {requests.length > 0 ? (\n                        requests.map((request) => (\n                          <tr key={request.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                                {request.tool_name}\n                              </span>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <ServiceBadge toolName={request.tool_name} />\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              {request.user_id ? (\n                                <span className=\"text-sm text-gray-900 dark:text-white\" title={request.user_id}>\n                                  {request.user_display_name || (request.user_id.includes('@') ? request.user_id.split('@')[0] : request.user_id.substring(0, 8))}\n                                </span>\n                              ) : (\n                                <span className=\"text-sm text-gray-400 dark:text-gray-500\">-</span>\n                              )}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <StatusBadge status={request.status} />\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\n                              {formatDuration(request.duration_ms)}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\n                              {formatDate(request.created_at)}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <button\n                                onClick={() => setSelectedRequest(request)}\n                                className=\"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 text-sm\"\n                              >\n                                Details\n                              </button>\n                            </td>\n                          </tr>\n                        ))\n                      ) : (\n                        <tr>\n                          <td colSpan={7} className=\"px-4 py-12 text-center text-gray-500 dark:text-gray-400\">\n                            Aucune requete MCP trouvee\n                          </td>\n                        </tr>\n                      )}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Tools Tab */}\n          {activeTab === 'tools' && (\n            <div className=\"space-y-4\">\n              {/* Controls */}\n              <div className=\"flex items-center justify-between bg-white dark:bg-gray-800 rounded-lg p-4 shadow\">\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {tools?.total || 0} outils disponibles • {Object.keys(toolsByService).length} services\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => toggleAllServices(true)}\n                    className=\"px-3 py-1.5 text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n                  >\n                    Tout déplier\n                  </button>\n                  <button\n                    onClick={() => toggleAllServices(false)}\n                    className=\"px-3 py-1.5 text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n                  >\n                    Tout replier\n                  </button>\n                </div>\n              </div>\n\n              {/* Services List */}\n              {Object.keys(toolsByService).length > 0 ? (\n                Object.entries(toolsByService).map(([serviceName, serviceTools]) => {\n                  const colors = getServiceColor(serviceName);\n                  const Icon = colors.icon;\n                  const isExpanded = expandedServices.has(serviceName);\n\n                  return (\n                    <div\n                      key={serviceName}\n                      className={`rounded-lg shadow overflow-hidden border ${colors.border}`}\n                    >\n                      {/* Service Header - Clickable */}\n                      <button\n                        onClick={() => toggleService(serviceName)}\n                        className={`w-full flex items-center justify-between p-4 ${colors.bg} hover:opacity-90 transition-opacity`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`p-2 rounded-lg ${colors.badge} ${colors.badgeDark}`}>\n                            <Icon className=\"w-5 h-5\" />\n                          </div>\n                          <div className=\"text-left\">\n                            <h3 className={`font-semibold capitalize ${colors.text}`}>\n                              {serviceName}\n                            </h3>\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                              {serviceTools.length} outil{serviceTools.length !== 1 ? 's' : ''}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {isExpanded ? (\n                            <ChevronDown className=\"w-5 h-5 text-gray-500\" />\n                          ) : (\n                            <ChevronRight className=\"w-5 h-5 text-gray-500\" />\n                          )}\n                        </div>\n                      </button>\n\n                      {/* Tools Grid - Collapsible */}\n                      {isExpanded && (\n                        <div className=\"p-4 bg-white dark:bg-gray-800\">\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {serviceTools.map((tool) => (\n                              <div\n                                key={tool.name}\n                                className={`border rounded-lg p-4 ${colors.border}`}\n                              >\n                                <div className=\"flex items-start justify-between\">\n                                  <div className=\"flex-1 min-w-0\">\n                                    <h4 className=\"font-medium text-gray-900 dark:text-white\">\n                                      {tool.name}\n                                    </h4>\n                                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                                      {tool.description}\n                                    </p>\n                                    {/* Group Labels */}\n                                    {toolGroups[tool.name] && toolGroups[tool.name].length > 0 && (\n                                      <div className=\"flex flex-wrap gap-1 mt-2\">\n                                        {toolGroups[tool.name].map((group) => (\n                                          <span\n                                            key={group.id}\n                                            className=\"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium\"\n                                            style={{\n                                              backgroundColor: `${group.color || '#6366f1'}15`,\n                                              color: group.color || '#6366f1',\n                                              border: `1px solid ${group.color || '#6366f1'}30`\n                                            }}\n                                            title={`Accès via groupe ${group.name}`}\n                                          >\n                                            {group.name}\n                                          </span>\n                                        ))}\n                                      </div>\n                                    )}\n                                  </div>\n                                  <div className=\"flex flex-col gap-1 items-end ml-2\">\n                                    {tool.is_mutation && (\n                                      <span className=\"px-2 py-1 text-xs bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 rounded flex-shrink-0\">\n                                        Mutation\n                                      </span>\n                                    )}\n                                    <button\n                                      onClick={() => setSelectedToolToTest(tool)}\n                                      className=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 rounded transition-colors\"\n                                    >\n                                      <Play className=\"w-3 h-3\" />\n                                      Tester\n                                    </button>\n                                  </div>\n                                </div>\n                                {tool.parameters.length > 0 && (\n                                  <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                                    <p className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2\">\n                                      Paramètres:\n                                    </p>\n                                    <div className=\"space-y-1\">\n                                      {tool.parameters.map((param) => (\n                                        <div key={param.name} className=\"flex items-center text-xs\">\n                                          <span className={`font-mono ${param.required ? 'text-red-600 dark:text-red-400' : 'text-gray-600 dark:text-gray-400'}`}>\n                                            {param.name}\n                                            {param.required && '*'}\n                                          </span>\n                                          <span className=\"text-gray-400 dark:text-gray-500 ml-2\">\n                                            ({param.type})\n                                          </span>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  );\n                })\n              ) : (\n                <div className=\"text-center py-12 text-gray-500\">Aucun outil disponible</div>\n              )}\n            </div>\n          )}\n\n          {/* Configuration Tab */}\n          {activeTab === 'config' && <ConfigurationTab tools={tools} />}\n        </>\n      )}\n\n      {/* Request Details Modal */}\n      {selectedRequest && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          <div className=\"flex items-center justify-center min-h-screen px-4\">\n            <div className=\"fixed inset-0 bg-black bg-opacity-50\" onClick={() => setSelectedRequest(null)} />\n            <div className=\"relative bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6 shadow-xl\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n                  Request Details\n                </h3>\n                <button\n                  onClick={() => setSelectedRequest(null)}\n                  className=\"text-gray-400 hover:text-gray-500\"\n                >\n                  <span className=\"text-2xl\">&times;</span>\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Tool</p>\n                    <p className=\"font-medium text-gray-900 dark:text-white\">{selectedRequest.tool_name}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Category</p>\n                    {selectedRequest.tool_category && <CategoryBadge category={selectedRequest.tool_category} />}\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">User</p>\n                    <p className=\"text-gray-900 dark:text-white\" title={selectedRequest.user_id || undefined}>\n                      {selectedRequest.user_display_name || selectedRequest.user_id || '-'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Status</p>\n                    <StatusBadge status={selectedRequest.status} />\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Duration</p>\n                    <p className=\"text-gray-900 dark:text-white\">{formatDuration(selectedRequest.duration_ms)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Created</p>\n                    <p className=\"text-gray-900 dark:text-white\">{formatDate(selectedRequest.created_at)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Completed</p>\n                    <p className=\"text-gray-900 dark:text-white\">\n                      {selectedRequest.completed_at ? formatDate(selectedRequest.completed_at) : '-'}\n                    </p>\n                  </div>\n                </div>\n\n                {selectedRequest.input_params && Object.keys(selectedRequest.input_params).length > 0 && (\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-2\">Input Parameters</p>\n                    <pre className=\"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg text-xs overflow-x-auto\">\n                      {JSON.stringify(selectedRequest.input_params, null, 2)}\n                    </pre>\n                  </div>\n                )}\n\n                {selectedRequest.output_result && (\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-2\">Result</p>\n                    <pre className=\"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg text-xs overflow-x-auto max-h-48\">\n                      {JSON.stringify(selectedRequest.output_result, null, 2)}\n                    </pre>\n                  </div>\n                )}\n\n                {selectedRequest.error_message && (\n                  <div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-2\">Error</p>\n                    <p className=\"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg\">\n                      {selectedRequest.error_message}\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"mt-6 flex justify-end\">\n                <button\n                  onClick={() => setSelectedRequest(null)}\n                  className=\"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600\"\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Tool Test Modal */}\n      <ToolTestModal\n        tool={selectedToolToTest}\n        isOpen={selectedToolToTest !== null}\n        onClose={() => setSelectedToolToTest(null)}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Monitoring.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":662,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25935,25938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25935,25938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport type { FC } from 'react';\nimport { Activity, FileText, Bell, RefreshCw, Wifi, WifiOff, CheckCircle, XCircle, Clock, Play, Pause, Settings, Loader2 } from 'lucide-react';\nimport { api, apiClient, getApiBaseUrl } from '../lib/api';\nimport { LogViewer } from '../components/Observability/LogViewer';\nimport { AlertManager } from '../components/Observability/AlertManager';\nimport { getServiceColor } from '../lib/serviceColors';\n\ninterface SystemMetrics {\n  cpu_usage: number;\n  cpu_load_avg: number;\n  memory_usage: number;\n  memory_used: number;\n  memory_total: number;\n  disk_usage: number;\n  disk_used: number;\n  disk_total: number;\n  network_bytes_sent: number;\n  network_bytes_recv: number;\n  services_running: number;\n  services_total: number;\n  uptime: number;\n}\n\ninterface ServiceHealth {\n  id: string;\n  name: string;\n  status: string;\n  enabled: boolean;\n  healthy: boolean;\n  last_test_at: string | null;\n  last_test_success: boolean | null;\n  last_error: string | null;\n}\n\ninterface AlertStats {\n  total: number;\n  active: number;\n  by_severity: Record<string, number>;\n  resolved_last_24h: number;\n}\n\ninterface LogStats {\n  total: number;\n  by_level: Record<string, number>;\n  by_source: Record<string, number>;\n  error_rate: number;\n  period_hours: number;\n}\n\ninterface ServiceHealthHistoryRecord {\n  tested_at: string;\n  success: boolean;\n  response_time_ms: number | null;\n  error_message: string | null;\n}\n\ninterface ServiceHealthHistory {\n  service_id: string;\n  service_name: string;\n  service_type: string;\n  enabled: boolean;\n  history: ServiceHealthHistoryRecord[];\n}\n\ninterface SchedulerStatus {\n  enabled: boolean;\n  interval_minutes: number;\n  running: boolean;\n  last_run: string | null;\n  next_run: string | null;\n}\n\ntype TabType = 'metrics' | 'logs' | 'alerts';\n\nconst MetricCard: React.FC<{\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  color?: string;\n  icon?: React.ReactNode;\n}> = ({ title, value, subtitle, color = 'blue', icon }) => (\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg p-3 sm:p-4 shadow\">\n    <div className=\"flex items-center justify-between\">\n      <div className=\"min-w-0 flex-1\">\n        <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">{title}</p>\n        <p className={`text-lg sm:text-2xl font-bold text-${color}-600 dark:text-${color}-400 truncate`}>\n          {value}\n        </p>\n        {subtitle && (\n          <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate\">{subtitle}</p>\n        )}\n      </div>\n      {icon && (\n        <div className={`text-${color}-500 opacity-50 hidden sm:block ml-2`}>{icon}</div>\n      )}\n    </div>\n  </div>\n);\n\nconst ProgressBar: React.FC<{\n  value: number;\n  max?: number;\n  color?: string;\n  showLabel?: boolean;\n}> = ({ value, max = 100, color = 'blue', showLabel = true }) => {\n  const percentage = Math.min((value / max) * 100, 100);\n  const barColor = percentage > 90 ? 'red' : percentage > 70 ? 'yellow' : color;\n\n  return (\n    <div className=\"w-full\">\n      <div className=\"flex justify-between items-center mb-1\">\n        {showLabel && (\n          <span className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n            {percentage.toFixed(1)}%\n          </span>\n        )}\n      </div>\n      <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n        <div\n          className={`bg-${barColor}-500 h-2 rounded-full transition-all duration-300`}\n          style={{ width: `${percentage}%` }}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Service Uptime Bar Chart Component\n// Shows the last N tests as bars (one bar per test, not per time interval)\nconst ServiceUptimeChart: React.FC<{\n  healthHistory: ServiceHealthHistory[];\n  intervalMinutes: number;\n}> = ({ healthHistory, intervalMinutes }) => {\n  // Number of bars to display - show enough to cover ~24h worth of tests\n  const maxBars = Math.min(Math.ceil((24 * 60) / intervalMinutes), 48);\n\n  if (healthHistory.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n        <h2 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-4\">\n          Continuité des Services\n        </h2>\n        <p className=\"text-gray-500 dark:text-gray-400 text-center py-4\">\n          Aucun historique disponible. Testez vos services pour générer des données.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white\">\n          Continuité des Services\n        </h2>\n        <div className=\"flex items-center gap-3 text-xs\">\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 rounded-sm bg-green-500\" />\n            <span className=\"text-gray-500 dark:text-gray-400\">OK</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 rounded-sm bg-red-500\" />\n            <span className=\"text-gray-500 dark:text-gray-400\">Erreur</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {healthHistory.map((service) => {\n          const colors = getServiceColor(service.service_type);\n          const Icon = colors.icon;\n\n          // Take the last N tests (already sorted by most recent first)\n          const tests = service.history.slice(0, maxBars);\n\n          // Reverse to show oldest first (left to right chronological)\n          const displayTests = [...tests].reverse();\n\n          // Calculate uptime percentage\n          const totalTests = tests.length;\n          const successTests = tests.filter(h => h.success).length;\n          const uptimePercent = totalTests > 0\n            ? (successTests / totalTests * 100).toFixed(1)\n            : '---';\n          const currentStatus = service.history[0]?.success;\n\n          return (\n            <div key={service.service_id} className=\"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2 min-w-0\">\n                  <div className={`p-1.5 rounded flex-shrink-0 ${colors.bg}`}>\n                    <Icon className={`w-3.5 h-3.5 ${colors.text}`} />\n                  </div>\n                  <span className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                    {service.service_name}\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-1.5 flex-shrink-0\">\n                  <span className={`text-xs font-medium ${\n                    currentStatus === true ? 'text-green-600 dark:text-green-400' :\n                    currentStatus === false ? 'text-red-600 dark:text-red-400' :\n                    'text-gray-500 dark:text-gray-400'\n                  }`}>\n                    {uptimePercent}%\n                  </span>\n                  {currentStatus === true && <CheckCircle className=\"w-3.5 h-3.5 text-green-500\" />}\n                  {currentStatus === false && <XCircle className=\"w-3.5 h-3.5 text-red-500\" />}\n                  {currentStatus === undefined && <Clock className=\"w-3.5 h-3.5 text-gray-400\" />}\n                </div>\n              </div>\n\n              {/* Bar chart - one bar per test */}\n              <div className=\"flex items-center gap-px h-4\">\n                {displayTests.length === 0 ? (\n                  <div className=\"flex-1 h-full rounded-sm bg-gray-300 dark:bg-gray-600\" title=\"Pas de test\" />\n                ) : (\n                  displayTests.map((test, idx) => {\n                    const barClass = test.success ? 'bg-green-500' : 'bg-red-500';\n\n                    // Format time for tooltip\n                    const timestamp = test.tested_at.endsWith('Z') ? test.tested_at : test.tested_at + 'Z';\n                    const date = new Date(timestamp);\n                    const time = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });\n                    const status = test.success ? 'OK' : 'Erreur';\n                    const tooltip = `${time} - ${status}`;\n\n                    return (\n                      <div\n                        key={idx}\n                        className={`flex-1 h-full rounded-sm ${barClass}`}\n                        title={tooltip}\n                      />\n                    );\n                  })\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n// Scheduler Controls Component\nconst SchedulerControls: React.FC<{\n  scheduler: SchedulerStatus | null;\n  onRefresh: () => void;\n}> = ({ scheduler, onRefresh }) => {\n  const [loading, setLoading] = useState(false);\n  const [selectedInterval, setSelectedInterval] = useState(15);\n  const [showSettings, setShowSettings] = useState(false);\n\n  const intervalOptions = [\n    { value: 5, label: '5 min' },\n    { value: 15, label: '15 min' },\n    { value: 30, label: '30 min' },\n    { value: 60, label: '1 heure' },\n  ];\n\n  const handleToggle = async () => {\n    setLoading(true);\n    try {\n      if (scheduler?.enabled) {\n        await fetch(`${getApiBaseUrl()}/api/services/health/scheduler/stop`, { method: 'POST' });\n      } else {\n        await fetch(`${getApiBaseUrl()}/api/services/health/scheduler/start?interval_minutes=${selectedInterval}`, { method: 'POST' });\n      }\n      onRefresh();\n    } catch (error) {\n      console.error('Failed to toggle scheduler:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRunNow = async () => {\n    setLoading(true);\n    try {\n      await fetch(`${getApiBaseUrl()}/api/services/health/scheduler/run-now`, { method: 'POST' });\n      onRefresh();\n    } catch (error) {\n      console.error('Failed to run health checks:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleIntervalChange = async (minutes: number) => {\n    setSelectedInterval(minutes);\n    if (scheduler?.enabled) {\n      setLoading(true);\n      try {\n        await fetch(`${getApiBaseUrl()}/api/services/health/scheduler/interval?interval_minutes=${minutes}`, { method: 'PUT' });\n        onRefresh();\n      } catch (error) {\n        console.error('Failed to update interval:', error);\n      } finally {\n        setLoading(false);\n      }\n    }\n  };\n\n  const formatLastRun = (lastRun: string | null) => {\n    if (!lastRun) return 'Jamais';\n    const date = new Date(lastRun);\n    return date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <div className={`p-2 rounded-lg ${scheduler?.enabled ? 'bg-green-100 dark:bg-green-900/30' : 'bg-gray-100 dark:bg-gray-700'}`}>\n            <Clock className={`w-5 h-5 ${scheduler?.enabled ? 'text-green-600 dark:text-green-400' : 'text-gray-500'}`} />\n          </div>\n          <div>\n            <h3 className=\"text-sm font-medium text-gray-900 dark:text-white\">\n              Tests automatiques\n            </h3>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {scheduler?.enabled\n                ? `Actif - toutes les ${scheduler.interval_minutes} min`\n                : 'Désactivé'}\n              {scheduler?.last_run && ` • Dernier: ${formatLastRun(scheduler.last_run)}`}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Settings toggle */}\n          <button\n            onClick={() => setShowSettings(!showSettings)}\n            className={`p-2 rounded-lg transition-colors ${\n              showSettings\n                ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400'\n                : 'hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500'\n            }`}\n            title=\"Paramètres\"\n          >\n            <Settings className=\"w-4 h-4\" />\n          </button>\n\n          {/* Run now button */}\n          <button\n            onClick={handleRunNow}\n            disabled={loading || scheduler?.running}\n            className=\"px-3 py-1.5 text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors disabled:opacity-50 flex items-center gap-1.5\"\n          >\n            {loading || scheduler?.running ? (\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n            ) : (\n              <Play className=\"w-4 h-4\" />\n            )}\n            Tester\n          </button>\n\n          {/* Toggle button */}\n          <button\n            onClick={handleToggle}\n            disabled={loading}\n            className={`px-3 py-1.5 text-sm rounded-lg transition-colors flex items-center gap-1.5 ${\n              scheduler?.enabled\n                ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50'\n                : 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 hover:bg-green-200 dark:hover:bg-green-900/50'\n            } disabled:opacity-50`}\n          >\n            {scheduler?.enabled ? (\n              <>\n                <Pause className=\"w-4 h-4\" />\n                Arrêter\n              </>\n            ) : (\n              <>\n                <Play className=\"w-4 h-4\" />\n                Activer\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n\n      {/* Settings panel */}\n      {showSettings && (\n        <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-4\">\n            <span className=\"text-sm text-gray-600 dark:text-gray-400\">Intervalle:</span>\n            <div className=\"flex gap-2\">\n              {intervalOptions.map(option => (\n                <button\n                  key={option.value}\n                  onClick={() => handleIntervalChange(option.value)}\n                  className={`px-3 py-1 text-xs rounded-lg transition-colors ${\n                    (scheduler?.enabled ? scheduler.interval_minutes : selectedInterval) === option.value\n                      ? 'bg-blue-600 text-white'\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                  }`}\n                >\n                  {option.label}\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst formatUptime = (seconds: number): string => {\n  const days = Math.floor(seconds / 86400);\n  const hours = Math.floor((seconds % 86400) / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n\n  if (days > 0) return `${days}d ${hours}h`;\n  if (hours > 0) return `${hours}h ${minutes}m`;\n  return `${minutes}m`;\n};\n\nconst formatBytes = (bytes: number): string => {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n};\n\n// Metrics Tab Content\nconst MetricsTab: React.FC<{\n  metrics: SystemMetrics | null;\n  services: ServiceHealth[];\n  healthHistory: ServiceHealthHistory[];\n  alertStats: AlertStats | null;\n  logStats: LogStats | null;\n  loading: boolean;\n  scheduler: SchedulerStatus | null;\n  onRefresh: () => void;\n}> = ({ metrics, services, healthHistory, alertStats, logStats, loading, scheduler, onRefresh }) => {\n  const healthyServices = services.filter(s => s.healthy && s.enabled).length;\n  const enabledServices = services.filter(s => s.enabled).length;\n\n  if (loading) {\n    return <div className=\"text-center py-12 text-gray-500\">Chargement des metriques...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6\">\n      {/* System Resources */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n        <h2 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-4\">\n          Ressources Systeme\n        </h2>\n        {metrics ? (\n          <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6\">\n            <div>\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-2\">\n                <span className=\"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300\">CPU</span>\n                <span className=\"text-xs sm:text-sm text-gray-500\">{metrics.cpu_usage.toFixed(1)}%</span>\n              </div>\n              <ProgressBar value={metrics.cpu_usage} color=\"blue\" showLabel={false} />\n            </div>\n\n            <div>\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-2\">\n                <span className=\"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300\">Memoire</span>\n                <span className=\"text-xs sm:text-sm text-gray-500 truncate\">\n                  {(metrics.memory_used / (1024 ** 3)).toFixed(1)}/{(metrics.memory_total / (1024 ** 3)).toFixed(0)}GB\n                </span>\n              </div>\n              <ProgressBar value={metrics.memory_usage} color=\"green\" showLabel={false} />\n            </div>\n\n            <div>\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-2\">\n                <span className=\"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300\">Disque</span>\n                <span className=\"text-xs sm:text-sm text-gray-500 truncate\">\n                  {(metrics.disk_used / (1024 ** 3)).toFixed(0)}/{(metrics.disk_total / (1024 ** 3)).toFixed(0)}GB\n                </span>\n              </div>\n              <ProgressBar value={metrics.disk_usage} color=\"purple\" showLabel={false} />\n            </div>\n\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300\">Uptime</span>\n              </div>\n              <p className=\"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white\">\n                {formatUptime(metrics.uptime)}\n              </p>\n            </div>\n          </div>\n        ) : (\n          <p className=\"text-gray-500 dark:text-gray-400\">Impossible de recuperer les metriques systeme</p>\n        )}\n      </div>\n\n      {/* Quick Stats */}\n      <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n        <MetricCard\n          title=\"Services\"\n          value={`${healthyServices}/${enabledServices}`}\n          subtitle=\"en bonne sante\"\n          color={healthyServices === enabledServices ? 'green' : 'yellow'}\n        />\n        <MetricCard\n          title=\"Alertes Actives\"\n          value={alertStats?.active || 0}\n          subtitle={`${alertStats?.total || 0} configs`}\n          color={(alertStats?.active || 0) > 0 ? 'red' : 'green'}\n        />\n        <MetricCard\n          title=\"Logs (24h)\"\n          value={logStats?.total?.toLocaleString() || 0}\n          subtitle={`${logStats?.error_rate?.toFixed(1) || 0}% erreurs`}\n          color={(logStats?.error_rate || 0) > 10 ? 'red' : 'blue'}\n        />\n        <MetricCard\n          title=\"Reseau I/O\"\n          value={metrics ? formatBytes(metrics.network_bytes_recv + metrics.network_bytes_sent) : '-'}\n          subtitle=\"Total transfere\"\n          color=\"purple\"\n        />\n      </div>\n\n      {/* Scheduler Controls & Service Uptime Chart */}\n      <SchedulerControls scheduler={scheduler} onRefresh={onRefresh} />\n      <ServiceUptimeChart healthHistory={healthHistory} intervalMinutes={scheduler?.interval_minutes || 15} />\n\n      {/* Log Distribution */}\n      {logStats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n            <h2 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-4\">\n              Logs par Niveau (24h)\n            </h2>\n            <div className=\"space-y-3\">\n              {Object.entries(logStats.by_level).map(([level, count]) => {\n                const colors: Record<string, string> = {\n                  debug: 'gray',\n                  info: 'blue',\n                  warning: 'yellow',\n                  error: 'red',\n                  critical: 'purple',\n                };\n                const color = colors[level] || 'gray';\n                const percentage = logStats.total > 0 ? (count / logStats.total) * 100 : 0;\n\n                return (\n                  <div key={level}>\n                    <div className=\"flex justify-between items-center mb-1\">\n                      <span className={`text-xs sm:text-sm font-medium capitalize text-${color}-600 dark:text-${color}-400`}>\n                        {level}\n                      </span>\n                      <span className=\"text-xs sm:text-sm text-gray-500\">{count}</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                      <div\n                        className={`bg-${color}-500 h-2 rounded-full`}\n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 shadow\">\n            <h2 className=\"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-4\">\n              Logs par Source (24h)\n            </h2>\n            <div className=\"space-y-3\">\n              {Object.entries(logStats.by_source).map(([source, count]) => {\n                const percentage = logStats.total > 0 ? (count / logStats.total) * 100 : 0;\n\n                return (\n                  <div key={source}>\n                    <div className=\"flex justify-between items-center mb-1\">\n                      <span className=\"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 truncate\">\n                        {source}\n                      </span>\n                      <span className=\"text-xs sm:text-sm text-gray-500 ml-2\">{count}</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                      <div\n                        className=\"bg-blue-500 h-2 rounded-full\"\n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Alert Summary */}\n      {alertStats && alertStats.active > 0 && (\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 sm:p-6\">\n          <h2 className=\"text-base sm:text-lg font-medium text-red-900 dark:text-red-100 mb-4\">\n            Alertes Actives ({alertStats.active})\n          </h2>\n          <div className=\"flex flex-wrap gap-2 sm:gap-4\">\n            {Object.entries(alertStats.by_severity || {}).map(([severity, count]) => {\n              if (count === 0) return null;\n              const colors: Record<string, string> = {\n                low: 'blue',\n                medium: 'yellow',\n                high: 'orange',\n                critical: 'red',\n              };\n              const color = colors[severity] || 'gray';\n\n              return (\n                <div\n                  key={severity}\n                  className={`px-3 py-1 sm:px-4 sm:py-2 rounded-lg bg-${color}-100 dark:bg-${color}-900/40`}\n                >\n                  <span className={`text-xs sm:text-sm font-medium capitalize text-${color}-700 dark:text-${color}-300`}>\n                    {severity}: {count}\n                  </span>\n                </div>\n              );\n            })}\n          </div>\n          <p className=\"text-xs sm:text-sm text-red-700 dark:text-red-300 mt-4\">\n            {alertStats.resolved_last_24h} alertes resolues dans les dernieres 24 heures\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst Monitoring: FC = () => {\n  const [activeTab, setActiveTab] = useState<TabType>('metrics');\n  const [metrics, setMetrics] = useState<SystemMetrics | null>(null);\n  const [services, setServices] = useState<ServiceHealth[]>([]);\n  const [healthHistory, setHealthHistory] = useState<ServiceHealthHistory[]>([]);\n  const [alertStats, setAlertStats] = useState<AlertStats | null>(null);\n  const [logStats, setLogStats] = useState<LogStats | null>(null);\n  const [scheduler, setScheduler] = useState<SchedulerStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n  const fetchData = useCallback(async () => {\n    try {\n      const [metricsRes, servicesRes, alertStatsRes, logStatsRes, healthHistoryRes, schedulerRes] = await Promise.all([\n        api.system.currentMetrics().catch(() => null),\n        api.services.list().catch(() => []),\n        api.alerts.stats(24).catch(() => null),\n        api.logs.stats(24).catch(() => null),\n        fetch(`${getApiBaseUrl()}/api/services/health/history?hours=24`).then(r => r.json()).catch(() => []),\n        fetch(`${getApiBaseUrl()}/api/services/health/scheduler/status`).then(r => r.json()).catch(() => null),\n      ]);\n\n      if (metricsRes) setMetrics(metricsRes);\n      if (Array.isArray(servicesRes)) {\n        const healthPromises = servicesRes.map(async (service: any) => {\n          try {\n            const health = await apiClient.get(`/api/services/${service.id}/health`);\n            return health;\n          } catch {\n            return {\n              id: service.id,\n              name: service.name,\n              status: service.status,\n              enabled: service.enabled,\n              healthy: false,\n              last_test_at: null,\n              last_test_success: null,\n              last_error: 'Unable to fetch health',\n            };\n          }\n        });\n        const healthResults = await Promise.all(healthPromises);\n        setServices(healthResults);\n      }\n      if (alertStatsRes) setAlertStats(alertStatsRes);\n      if (logStatsRes) setLogStats(logStatsRes);\n      if (Array.isArray(healthHistoryRes)) setHealthHistory(healthHistoryRes);\n      if (schedulerRes) setScheduler(schedulerRes);\n\n      setLastUpdated(new Date());\n    } catch (error) {\n      console.error('Failed to fetch monitoring data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  useEffect(() => {\n    if (autoRefresh && activeTab === 'metrics') {\n      const interval = setInterval(fetchData, 10000);\n      return () => clearInterval(interval);\n    }\n  }, [autoRefresh, fetchData, activeTab]);\n\n  const tabs = [\n    { id: 'metrics' as TabType, label: 'Metriques', icon: Activity },\n    { id: 'logs' as TabType, label: 'Logs', icon: FileText },\n    { id: 'alerts' as TabType, label: 'Alertes', icon: Bell, badge: alertStats?.active },\n  ];\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-4 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Activity className=\"w-6 h-6 sm:w-8 sm:h-8 text-blue-600\" />\n            Monitoring\n          </h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n            Surveillance système en temps réel\n          </p>\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-2 sm:gap-3\">\n          {activeTab === 'metrics' && lastUpdated && (\n            <span className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1\">\n              {autoRefresh ? (\n                <Wifi className=\"w-3 h-3 sm:w-4 sm:h-4 text-green-500\" />\n              ) : (\n                <WifiOff className=\"w-3 h-3 sm:w-4 sm:h-4 text-gray-400\" />\n              )}\n              <span className=\"hidden sm:inline\">Mis à jour:</span> {lastUpdated.toLocaleTimeString()}\n            </span>\n          )}\n          {activeTab === 'metrics' && (\n            <label className=\"flex items-center gap-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400\">\n              <input\n                type=\"checkbox\"\n                checked={autoRefresh}\n                onChange={(e) => setAutoRefresh(e.target.checked)}\n                className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n              />\n              <span className=\"hidden sm:inline\">Auto</span>\n            </label>\n          )}\n          <button\n            onClick={fetchData}\n            className=\"p-2 sm:px-4 sm:py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Actualiser</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Tabs Navigation */}\n      <div className=\"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0\">\n        <nav className=\"flex gap-1.5 sm:gap-2 min-w-max sm:min-w-0 sm:flex-wrap\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id)}\n              className={`flex items-center gap-1.5 py-1.5 px-2.5 sm:py-2 sm:px-3 rounded-full font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${\n                activeTab === tab.id\n                  ? 'bg-blue-600 text-white shadow-sm'\n                  : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n              }`}\n            >\n              <tab.icon className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n              <span>{tab.label}</span>\n              {tab.badge !== undefined && tab.badge > 0 && (\n                <span className={`px-1.5 py-0.5 rounded-full text-xs ${\n                  activeTab === tab.id\n                    ? 'bg-white/20 text-white'\n                    : 'bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-400'\n                }`}>\n                  {tab.badge}\n                </span>\n              )}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* Tab Content */}\n      <div>\n        {activeTab === 'metrics' && (\n          <MetricsTab\n            metrics={metrics}\n            services={services}\n            healthHistory={healthHistory}\n            alertStats={alertStats}\n            logStats={logStats}\n            loading={loading}\n            scheduler={scheduler}\n            onRefresh={fetchData}\n          />\n        )}\n        {activeTab === 'logs' && <LogViewer />}\n        {activeTab === 'alerts' && <AlertManager />}\n      </div>\n    </div>\n  );\n};\n\nexport default Monitoring;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Services.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2672,2675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2672,2675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3170,3173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3170,3173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3997,4000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3997,4000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport {\n  Server,\n  Plus,\n  Globe,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Edit,\n  Trash2,\n  Play,\n  Pause,\n  RefreshCw,\n  Zap,\n  Clock,\n  ExternalLink,\n  PlayCircle,\n  Loader2,\n  X\n} from 'lucide-react';\nimport ServiceForm from '../components/ServiceForm';\nimport ServiceTestModal from '../components/ServiceTestModal';\nimport { getApiBaseUrl } from '../lib/api';\nimport { getServiceColor } from '../lib/serviceColors';\n\ninterface Service {\n  id: string;\n  name: string;\n  service_type: string;\n  description?: string;\n  base_url: string;\n  port?: number;\n  api_key?: string;\n  username?: string;\n  password?: string;\n  status: 'active' | 'inactive' | 'error' | 'testing' | 'unknown';\n  enabled: boolean;\n  health_check_enabled: boolean;\n  health_check_interval: number;\n  last_test_at?: string;\n  last_test_success?: boolean;\n  last_error?: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// Couleurs importées depuis serviceColors.ts pour cohérence globale\n\ninterface TestAllResult {\n  service_id: string;\n  service_name: string;\n  service_type: string;\n  status: 'pending' | 'testing' | 'success' | 'error';\n  error_message?: string;\n  response_time_ms?: number;\n}\n\nconst Services: React.FC = () => {\n  const [services, setServices] = useState<Service[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedService, setSelectedService] = useState<Service | null>(null);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [testingService, setTestingService] = useState<Service | null>(null);\n\n  // Test All state\n  const [showTestAllModal, setShowTestAllModal] = useState(false);\n  const [testAllResults, setTestAllResults] = useState<TestAllResult[]>([]);\n  const [testingAll, setTestingAll] = useState(false);\n\n  useEffect(() => {\n    fetchServices();\n  }, []);\n\n  const fetchServices = async () => {\n    try {\n      setError(null);\n      const timestamp = new Date().getTime();\n      const response = await fetch(`${getApiBaseUrl()}/api/services/?_t=${timestamp}`);\n\n      if (!response.ok) {\n        throw new Error(`Failed to fetch services: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      setServices(data);\n      setLoading(false);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch services';\n      setError(errorMessage);\n      setLoading(false);\n    }\n  };\n\n  // Helper to extract error message from API response\n  const getErrorMessage = (errorData: any, fallback: string): string => {\n    if (typeof errorData.detail === 'string') {\n      return errorData.detail;\n    }\n    if (Array.isArray(errorData.detail) && errorData.detail.length > 0) {\n      // Pydantic validation error format\n      const firstError = errorData.detail[0];\n      const field = firstError.loc?.slice(1).join('.') || 'field';\n      return `${field}: ${firstError.msg}`;\n    }\n    return errorData.message || fallback;\n  };\n\n  const handleCreateService = async (serviceData: any) => {\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/services/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          ...serviceData,\n          port: serviceData.port ? parseInt(serviceData.port) : null,\n          health_check_interval: parseInt(serviceData.health_check_interval)\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(getErrorMessage(errorData, 'Failed to create service'));\n      }\n\n      await fetchServices();\n      setShowCreateModal(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to create service');\n      throw err;\n    }\n  };\n\n  const handleUpdateService = async (serviceData: any) => {\n    if (!selectedService) return;\n\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/services/${selectedService.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          ...serviceData,\n          port: serviceData.port ? parseInt(serviceData.port) : null,\n          health_check_interval: parseInt(serviceData.health_check_interval)\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(getErrorMessage(errorData, 'Failed to update service'));\n      }\n\n      await fetchServices();\n      setSelectedService(null);\n      setShowEditModal(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update service');\n      throw err;\n    }\n  };\n\n  const handleToggleService = async (serviceId: string, enabled: boolean) => {\n    try {\n      const endpoint = enabled ? 'disable' : 'enable';\n      const response = await fetch(`${getApiBaseUrl()}/api/services/${serviceId}/${endpoint}`, {\n        method: 'PATCH',\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to ${endpoint} service`);\n      }\n\n      await fetchServices();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : `Failed to toggle service`);\n    }\n  };\n\n  const handleTestConnection = (service: Service) => {\n    setTestingService(service);\n  };\n\n  const handleTestComplete = async () => {\n    await fetchServices();\n  };\n\n  const handleTestAll = async () => {\n    const enabledServices = services.filter(s => s.enabled);\n    if (enabledServices.length === 0) return;\n\n    // Initialize results\n    const initialResults: TestAllResult[] = enabledServices.map(s => ({\n      service_id: s.id,\n      service_name: s.name,\n      service_type: s.service_type,\n      status: 'pending' as const\n    }));\n\n    setTestAllResults(initialResults);\n    setShowTestAllModal(true);\n    setTestingAll(true);\n\n    // Test each service sequentially\n    for (let i = 0; i < enabledServices.length; i++) {\n      const service = enabledServices[i];\n\n      // Update status to testing\n      setTestAllResults(prev => prev.map(r =>\n        r.service_id === service.id ? { ...r, status: 'testing' as const } : r\n      ));\n\n      try {\n        const startTime = Date.now();\n        const response = await fetch(`${getApiBaseUrl()}/api/services/${service.id}/test`, {\n          method: 'POST',\n        });\n        const duration = Date.now() - startTime;\n        const result = await response.json();\n\n        if (response.ok && result.success) {\n          setTestAllResults(prev => prev.map(r =>\n            r.service_id === service.id\n              ? { ...r, status: 'success' as const, response_time_ms: result.response_time_ms || duration }\n              : r\n          ));\n        } else {\n          setTestAllResults(prev => prev.map(r =>\n            r.service_id === service.id\n              ? { ...r, status: 'error' as const, error_message: result.error_message || 'Test failed' }\n              : r\n          ));\n        }\n      } catch (err) {\n        setTestAllResults(prev => prev.map(r =>\n          r.service_id === service.id\n            ? { ...r, status: 'error' as const, error_message: err instanceof Error ? err.message : 'Unknown error' }\n            : r\n        ));\n      }\n    }\n\n    setTestingAll(false);\n    await fetchServices();\n  };\n\n  const handleDeleteService = async (serviceId: string) => {\n    if (!window.confirm('Êtes-vous sûr de vouloir supprimer ce service ?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`${getApiBaseUrl()}/api/services/${serviceId}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete service');\n      }\n\n      await fetchServices();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete service');\n    }\n  };\n\n  const formatLastTest = (dateStr?: string) => {\n    if (!dateStr) return 'Jamais';\n    const date = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'À l\\'instant';\n    if (diffMins < 60) return `${diffMins}min`;\n    if (diffHours < 24) return `${diffHours}h`;\n    return `${diffDays}j`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-4 sm:p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-6\"></div>\n          <div className=\"space-y-3\">\n            {[...Array(4)].map((_, i) => (\n              <div key={i} className=\"bg-gray-200 dark:bg-gray-700 h-20 rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Server className=\"w-6 h-6 sm:w-7 sm:h-7 text-blue-600\" />\n            Services\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n            {services.length} service{services.length > 1 ? 's' : ''} configuré{services.length > 1 ? 's' : ''}\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={fetchServices}\n            className=\"p-2 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n            title=\"Actualiser\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={handleTestAll}\n            disabled={testingAll || services.filter(s => s.enabled).length === 0}\n            className=\"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors\"\n            title=\"Tester tous les services\"\n          >\n            {testingAll ? (\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n            ) : (\n              <PlayCircle className=\"w-4 h-4\" />\n            )}\n            <span className=\"hidden sm:inline\">Tester tout</span>\n          </button>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Ajouter</span>\n          </button>\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6\">\n          <div className=\"flex items-center\">\n            <XCircle className=\"w-5 h-5 text-red-500 mr-2 flex-shrink-0\" />\n            <span className=\"text-red-700 dark:text-red-400 text-sm\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      {services.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-dashed border-gray-300 dark:border-gray-600\">\n          <Server className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">Aucun service configuré</h3>\n          <p className=\"text-gray-500 dark:text-gray-400 mb-6 text-sm\">\n            Commencez par ajouter votre premier service.\n          </p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg inline-flex items-center gap-2\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Ajouter un Service\n          </button>\n        </div>\n      ) : (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden\">\n          {/* Table Header - Desktop */}\n          <div className=\"hidden md:grid md:grid-cols-12 gap-4 px-4 py-3 bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n            <div className=\"col-span-4\">Service</div>\n            <div className=\"col-span-3\">URL</div>\n            <div className=\"col-span-2 text-center\">Statut</div>\n            <div className=\"col-span-1 text-center\">Test</div>\n            <div className=\"col-span-2 text-right\">Actions</div>\n          </div>\n\n          {/* Services List */}\n          <div className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n            {services.map((service) => {\n              const colors = getServiceColor(service.service_type);\n              const Icon = colors.icon;\n              const isHealthy = service.enabled && service.last_test_success === true;\n              const hasError = service.enabled && service.last_test_success === false;\n              const isDisabled = !service.enabled;\n\n              return (\n                <div\n                  key={service.id}\n                  className={`px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${\n                    isDisabled ? 'opacity-50' : ''\n                  }`}\n                >\n                  {/* Mobile Layout */}\n                  <div className=\"md:hidden space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3 min-w-0\">\n                        <span className={`w-2.5 h-2.5 rounded-full flex-shrink-0 ${colors.dot}`}></span>\n                        <div className=\"min-w-0\">\n                          <h3 className=\"font-medium text-gray-900 dark:text-white truncate\">{service.name}</h3>\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400 capitalize\">{service.service_type}</p>\n                        </div>\n                      </div>\n                      <div className={`flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${\n                        isDisabled\n                          ? 'bg-gray-100 dark:bg-gray-700 text-gray-500'\n                          : isHealthy\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\n                          : hasError\n                          ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\n                          : 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400'\n                      }`}>\n                        {isDisabled ? <Pause className=\"w-3 h-3\" /> : isHealthy ? <CheckCircle className=\"w-3 h-3\" /> : hasError ? <XCircle className=\"w-3 h-3\" /> : <AlertCircle className=\"w-3 h-3\" />}\n                        <span>{isDisabled ? 'Off' : isHealthy ? 'OK' : hasError ? 'Erreur' : 'N/A'}</span>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400\">\n                      <Globe className=\"w-3.5 h-3.5\" />\n                      <span className=\"truncate font-mono\">{service.base_url}{service.port ? `:${service.port}` : ''}</span>\n                    </div>\n\n                    <div className=\"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700\">\n                      <div className=\"flex items-center gap-1 text-xs text-gray-400\">\n                        <Clock className=\"w-3.5 h-3.5\" />\n                        {formatLastTest(service.last_test_at)}\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <button\n                          onClick={() => handleToggleService(service.id, service.enabled)}\n                          className={`p-1.5 rounded transition-colors ${\n                            service.enabled\n                              ? 'text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20'\n                              : 'text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20'\n                          }`}\n                          title={service.enabled ? 'Désactiver' : 'Activer'}\n                        >\n                          {service.enabled ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\n                        </button>\n                        <button\n                          onClick={() => handleTestConnection(service)}\n                          disabled={!service.enabled}\n                          className=\"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors disabled:opacity-40\"\n                          title=\"Tester\"\n                        >\n                          <Zap className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                          onClick={() => {\n                            setSelectedService(service);\n                            setShowEditModal(true);\n                          }}\n                          className=\"p-1.5 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n                          title=\"Modifier\"\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                          onClick={() => handleDeleteService(service.id)}\n                          className=\"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors\"\n                          title=\"Supprimer\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Desktop Layout */}\n                  <div className=\"hidden md:grid md:grid-cols-12 gap-4 items-center\">\n                    {/* Service Info */}\n                    <div className=\"col-span-4 flex items-center gap-3 min-w-0\">\n                      <div className={`p-2 rounded-lg ${colors.bg}`}>\n                        <Icon className={`w-4 h-4 ${colors.text}`} />\n                      </div>\n                      <div className=\"min-w-0\">\n                        <h3 className=\"font-medium text-gray-900 dark:text-white truncate\">{service.name}</h3>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 capitalize\">{service.service_type}</p>\n                      </div>\n                    </div>\n\n                    {/* URL */}\n                    <div className=\"col-span-3 flex items-center gap-2 min-w-0\">\n                      <span className=\"text-sm text-gray-600 dark:text-gray-300 truncate font-mono\">\n                        {service.base_url}{service.port ? `:${service.port}` : ''}\n                      </span>\n                      <a\n                        href={`${service.base_url}${service.port ? `:${service.port}` : ''}`}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors flex-shrink-0\"\n                      >\n                        <ExternalLink className=\"w-3.5 h-3.5\" />\n                      </a>\n                    </div>\n\n                    {/* Status */}\n                    <div className=\"col-span-2 flex justify-center\">\n                      <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${\n                        isDisabled\n                          ? 'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400'\n                          : isHealthy\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\n                          : hasError\n                          ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\n                          : 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400'\n                      }`}>\n                        {isDisabled ? (\n                          <Pause className=\"w-3 h-3\" />\n                        ) : isHealthy ? (\n                          <CheckCircle className=\"w-3 h-3\" />\n                        ) : hasError ? (\n                          <XCircle className=\"w-3 h-3\" />\n                        ) : (\n                          <AlertCircle className=\"w-3 h-3\" />\n                        )}\n                        {isDisabled ? 'Désactivé' : isHealthy ? 'En ligne' : hasError ? 'Erreur' : 'Inconnu'}\n                      </div>\n                    </div>\n\n                    {/* Last Test */}\n                    <div className=\"col-span-1 text-center\">\n                      <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {formatLastTest(service.last_test_at)}\n                      </span>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"col-span-2 flex items-center justify-end gap-1\">\n                      <button\n                        onClick={() => handleToggleService(service.id, service.enabled)}\n                        className={`p-1.5 rounded transition-colors ${\n                          service.enabled\n                            ? 'text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20'\n                            : 'text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20'\n                        }`}\n                        title={service.enabled ? 'Désactiver' : 'Activer'}\n                      >\n                        {service.enabled ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\n                      </button>\n                      <button\n                        onClick={() => handleTestConnection(service)}\n                        disabled={!service.enabled}\n                        className=\"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors disabled:opacity-40 disabled:cursor-not-allowed\"\n                        title=\"Tester la connexion\"\n                      >\n                        <Zap className=\"w-4 h-4\" />\n                      </button>\n                      <button\n                        onClick={() => {\n                          setSelectedService(service);\n                          setShowEditModal(true);\n                        }}\n                        className=\"p-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n                        title=\"Modifier\"\n                      >\n                        <Edit className=\"w-4 h-4\" />\n                      </button>\n                      <button\n                        onClick={() => handleDeleteService(service.id)}\n                        className=\"p-1.5 text-gray-500 dark:text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors\"\n                        title=\"Supprimer\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Error Message */}\n                  {service.last_error && hasError && (\n                    <div className=\"mt-2 ml-0 md:ml-11 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs text-red-600 dark:text-red-400\">\n                      {service.last_error}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {/* Service creation modal */}\n      <ServiceForm\n        isOpen={showCreateModal}\n        onClose={() => setShowCreateModal(false)}\n        onSubmit={handleCreateService}\n        isEditing={false}\n      />\n\n      {/* Service edit modal */}\n      {selectedService && showEditModal && (\n        <ServiceForm\n          isOpen={showEditModal}\n          onClose={() => {\n            setSelectedService(null);\n            setShowEditModal(false);\n          }}\n          onSubmit={handleUpdateService}\n          initialData={{\n            name: selectedService.name,\n            service_type: selectedService.service_type,\n            description: selectedService.description || '',\n            base_url: selectedService.base_url,\n            port: selectedService.port?.toString() || '',\n            api_key: selectedService.api_key || '',\n            username: selectedService.username || '',\n            password: selectedService.password || '',\n            enabled: selectedService.enabled,\n            health_check_enabled: selectedService.health_check_enabled,\n            health_check_interval: selectedService.health_check_interval?.toString() || '300'\n          }}\n          isEditing={true}\n        />\n      )}\n\n      {/* Service test modal */}\n      {testingService && (\n        <ServiceTestModal\n          isOpen={!!testingService}\n          onClose={() => setTestingService(null)}\n          service={testingService}\n          onTestComplete={handleTestComplete}\n        />\n      )}\n\n      {/* Test All Modal */}\n      {showTestAllModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center gap-3\">\n                {testingAll ? (\n                  <Loader2 className=\"w-6 h-6 text-blue-500 animate-spin\" />\n                ) : (\n                  <PlayCircle className=\"w-6 h-6 text-emerald-500\" />\n                )}\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                    Test de tous les services\n                  </h3>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    {testAllResults.length} service{testAllResults.length > 1 ? 's' : ''} activé{testAllResults.length > 1 ? 's' : ''}\n                  </p>\n                </div>\n              </div>\n              <button\n                onClick={() => setShowTestAllModal(false)}\n                disabled={testingAll}\n                className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50\"\n              >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n            </div>\n\n            {/* Results List */}\n            <div className=\"flex-1 overflow-y-auto p-4\">\n              <div className=\"space-y-2\">\n                {testAllResults.map((result) => {\n                  const colors = getServiceColor(result.service_type);\n                  const Icon = colors.icon;\n\n                  return (\n                    <div\n                      key={result.service_id}\n                      className={`p-3 rounded-lg border transition-all ${\n                        result.status === 'testing'\n                          ? 'border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20'\n                          : result.status === 'success'\n                          ? 'border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20'\n                          : result.status === 'error'\n                          ? 'border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20'\n                          : 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`p-1.5 rounded ${colors.bg}`}>\n                            <Icon className={`w-4 h-4 ${colors.text}`} />\n                          </div>\n                          <div>\n                            <span className=\"font-medium text-gray-900 dark:text-white\">\n                              {result.service_name}\n                            </span>\n                            <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize\">\n                              {result.service_type}\n                            </span>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                          {result.response_time_ms && (\n                            <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                              {result.response_time_ms}ms\n                            </span>\n                          )}\n                          {result.status === 'pending' && (\n                            <Clock className=\"w-4 h-4 text-gray-400\" />\n                          )}\n                          {result.status === 'testing' && (\n                            <Loader2 className=\"w-4 h-4 text-blue-500 animate-spin\" />\n                          )}\n                          {result.status === 'success' && (\n                            <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                          )}\n                          {result.status === 'error' && (\n                            <XCircle className=\"w-4 h-4 text-red-500\" />\n                          )}\n                        </div>\n                      </div>\n\n                      {result.error_message && (\n                        <div className=\"mt-2 text-xs text-red-600 dark:text-red-400\">\n                          {result.error_message}\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Footer with Summary */}\n            <div className=\"border-t border-gray-200 dark:border-gray-700 p-4\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex gap-4 text-sm\">\n                  <span className=\"flex items-center gap-1 text-green-600 dark:text-green-400\">\n                    <CheckCircle className=\"w-4 h-4\" />\n                    {testAllResults.filter(r => r.status === 'success').length} OK\n                  </span>\n                  <span className=\"flex items-center gap-1 text-red-600 dark:text-red-400\">\n                    <XCircle className=\"w-4 h-4\" />\n                    {testAllResults.filter(r => r.status === 'error').length} Erreur\n                  </span>\n                  {testingAll && (\n                    <span className=\"flex items-center gap-1 text-blue-600 dark:text-blue-400\">\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      {testAllResults.filter(r => r.status === 'pending' || r.status === 'testing').length} En cours\n                    </span>\n                  )}\n                </div>\n              </div>\n\n              <button\n                onClick={() => setShowTestAllModal(false)}\n                disabled={testingAll}\n                className=\"w-full py-2 px-4 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors disabled:opacity-50\"\n              >\n                {testingAll ? 'Tests en cours...' : 'Fermer'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Services;\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Training.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1173,1176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1173,1176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3160,3163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3160,3163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":298,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":298,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1094,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1094,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45343,45346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45343,45346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1752,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1752,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76315,76318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76315,76318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1829,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1829,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79100,79103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79100,79103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_sessionPrompts' is assigned a value but never used.","line":2118,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2118,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'session'. Either include it or remove the dependency array.","line":2133,"column":6,"nodeType":"ArrayExpression","endLine":2133,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, session, session.id]","fix":{"range":[93420,93441],"text":"[isOpen, session, session.id]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ollamaMetrics' is assigned a value but never used.","line":2361,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2361,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":2447,"column":6,"nodeType":"ArrayExpression","endLine":2447,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[106807,106809],"text":"[fetchData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2488,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2488,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108400,108403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108400,108403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2489,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2489,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108500,108503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108500,108503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2584,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2584,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[111359,111362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[111359,111362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2594,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2594,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[111684,111687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[111684,111687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport {\n  Brain,\n  RefreshCw,\n  BarChart3,\n  History,\n  FileText,\n  Settings,\n  Server,\n  Play,\n  Square,\n  Trash2,\n  Plus,\n  CheckCircle,\n  HardDrive,\n  Cpu,\n  Download,\n  Upload,\n  Search,\n  ChevronDown,\n  ChevronUp,\n  X,\n  Zap,\n  Activity,\n  Edit,\n  Check,\n  Monitor,\n  Copy,\n  Eye,\n} from 'lucide-react';\nimport { WorkerList } from '../components/Workers';\nimport { api } from '../lib/api';\nimport { useTrainingWebSocket, type TrainingMetrics } from '../hooks/useTrainingWebSocket';\nimport SessionDetailsModal from '../components/Training/SessionDetailsModal';\nimport SessionLogsModal from '../components/Training/SessionLogsModal';\nimport TrainingOverview from '../components/Training/TrainingOverview';\n\n// Types\ninterface OllamaModel {\n  name: string;\n  model: string;\n  size: number;\n  size_gb: number;\n  family: string;\n  parameter_size: string;\n  quantization_level: string;\n  modified_at?: string;\n}\n\ninterface OllamaStatus {\n  status: string;\n  version?: string;\n  url: string;\n  error?: string;\n  models: OllamaModel[];\n  model_count: number;\n  total_size_gb: number;\n  running_models: any[];\n  running_count: number;\n}\n\ninterface TrainingSession {\n  id: string;\n  name: string;\n  description?: string;\n  base_model: string;\n  output_model?: string;\n  training_type: string;\n  training_backend: string;\n  worker_id?: string;\n  status: string;\n  error_message?: string;\n  current_epoch: number;\n  total_epochs: number;\n  current_step: number;\n  total_steps: number;\n  progress_percent: number;\n  loss?: number;\n  learning_rate?: number;\n  started_at?: string;\n  completed_at?: string;\n  estimated_completion?: string;\n  gpu_memory_used?: number;\n  cpu_usage?: number;\n  dataset_size: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface TrainingPrompt {\n  id: string;\n  name: string;\n  description?: string;\n  category: string;\n  difficulty: string;\n  source: string;\n  format: string;\n  system_prompt?: string;\n  user_input: string;\n  expected_output: string;\n  // Tool calling support\n  tool_call?: {\n    name: string;\n    arguments: Record<string, unknown>;\n  };\n  tool_response?: Record<string, unknown>;\n  assistant_response?: string;\n  tags: string[];\n  is_validated: boolean;\n  validation_score?: number;\n  times_used: number;\n  enabled: boolean;\n  session_id?: string;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface TrainingWorker {\n  id: string;\n  name: string;\n  description?: string;\n  url: string;\n  status: string;\n  enabled: boolean;\n  gpu_available: boolean;\n  gpu_count: number;\n  gpu_names: string[];\n  current_job_id?: string;\n}\n\ninterface TrainingStats {\n  total_sessions: number;\n  active_sessions: number;\n  completed_sessions: number;\n  failed_sessions: number;\n  total_prompts: number;\n  validated_prompts: number;\n  prompts_by_category: Record<string, number>;\n  recent_sessions: TrainingSession[];\n}\n\ninterface OllamaMetrics {\n  // Ollama metrics\n  ollama_status: string;\n  ollama_version?: string;\n  ollama_url: string;\n  models_count: number;\n  models_total_size_gb: number;\n  running_models_count: number;\n  running_models: any[];\n  models: {\n    name: string;\n    size_gb: number;\n    family: string;\n    parameter_size: string;\n    quantization_level: string;\n  }[];\n\n  // System metrics\n  system_cpu_percent?: number;\n  system_memory_used_gb?: number;\n  system_memory_total_gb?: number;\n  system_memory_percent?: number;\n  system_gpu_used_gb?: number;\n  system_gpu_total_gb?: number;\n  system_gpu_percent?: number;\n  system_gpu_name?: string;\n\n  // Training metrics\n  training_total_sessions: number;\n  training_active_sessions: number;\n  training_completed_sessions: number;\n  training_total_prompts: number;\n  training_prompts_by_category: Record<string, number>;\n\n  error?: string;\n}\n\n// Components\nconst StatusBadge = ({ status }: { status: string }) => {\n  const colors: Record<string, string> = {\n    pending: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',\n    preparing: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n    running: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    completed: 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200',\n    failed: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n    cancelled: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',\n    paused: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n    healthy: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    unhealthy: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n    not_configured: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',\n  };\n\n  return (\n    <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[status] || colors.pending}`}>\n      {status.replace('_', ' ')}\n    </span>\n  );\n};\n\n// Liste des services disponibles (utilisé dans les formulaires et filtres)\nconst AVAILABLE_SERVICES = [\n  { id: 'plex', label: 'Plex', icon: '🎬', color: 'bg-amber-500' },\n  { id: 'tautulli', label: 'Tautulli', icon: '📊', color: 'bg-orange-500' },\n  { id: 'overseerr', label: 'Overseerr', icon: '🎯', color: 'bg-violet-500' },\n  { id: 'radarr', label: 'Radarr', icon: '🎥', color: 'bg-yellow-500' },\n  { id: 'sonarr', label: 'Sonarr', icon: '📺', color: 'bg-sky-500' },\n  { id: 'prowlarr', label: 'Prowlarr', icon: '🔍', color: 'bg-pink-500' },\n  { id: 'jackett', label: 'Jackett', icon: '🧥', color: 'bg-rose-600' },\n  { id: 'deluge', label: 'Deluge', icon: '🌊', color: 'bg-blue-600' },\n  { id: 'zammad', label: 'Zammad', icon: '🎫', color: 'bg-teal-500' },\n  { id: 'authentik', label: 'Authentik', icon: '🔐', color: 'bg-orange-600' },\n  { id: 'komga', label: 'Komga', icon: '📚', color: 'bg-indigo-500' },\n  { id: 'romm', label: 'Romm', icon: '🎮', color: 'bg-green-500' },\n  { id: 'ollama', label: 'Ollama', icon: '🤖', color: 'bg-purple-500' },\n  { id: 'openwebui', label: 'OpenWebUI', icon: '💬', color: 'bg-cyan-500' },\n  { id: 'audiobookshelf', label: 'Audiobookshelf', icon: '🎧', color: 'bg-purple-500' },\n  { id: 'wikijs', label: 'Wiki.js', icon: '📝', color: 'bg-blue-500' },\n  { id: 'system', label: 'Système', icon: '⚙️', color: 'bg-slate-600' },\n];\n\nconst DifficultyBadge = ({ difficulty }: { difficulty: string }) => {\n  const colors: Record<string, string> = {\n    basic: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    intermediate: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',\n    advanced: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n    expert: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n  };\n\n  return (\n    <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[difficulty] || colors.basic}`}>\n      {difficulty}\n    </span>\n  );\n};\n\nconst ServiceBadge = ({ tags }: { tags: string[] }) => {\n  const serviceConfig: Record<string, { color: string; icon: string; label: string }> = {\n    plex: { color: 'bg-amber-500 text-white', icon: '🎬', label: 'Plex' },\n    tautulli: { color: 'bg-orange-500 text-white', icon: '📊', label: 'Tautulli' },\n    overseerr: { color: 'bg-violet-500 text-white', icon: '🎯', label: 'Overseerr' },\n    radarr: { color: 'bg-yellow-500 text-black', icon: '🎥', label: 'Radarr' },\n    sonarr: { color: 'bg-sky-500 text-white', icon: '📺', label: 'Sonarr' },\n    prowlarr: { color: 'bg-pink-500 text-white', icon: '🔍', label: 'Prowlarr' },\n    jackett: { color: 'bg-rose-600 text-white', icon: '🧥', label: 'Jackett' },\n    system: { color: 'bg-slate-600 text-white', icon: '⚙️', label: 'Système' },\n    zammad: { color: 'bg-teal-500 text-white', icon: '🎫', label: 'Zammad' },\n    komga: { color: 'bg-indigo-500 text-white', icon: '📚', label: 'Komga' },\n    romm: { color: 'bg-green-500 text-white', icon: '🎮', label: 'RomM' },\n    authentik: { color: 'bg-orange-600 text-white', icon: '🔐', label: 'Authentik' },\n    ollama: { color: 'bg-purple-500 text-white', icon: '🤖', label: 'Ollama' },\n    openwebui: { color: 'bg-cyan-500 text-white', icon: '💬', label: 'OpenWebUI' },\n    audiobookshelf: { color: 'bg-purple-500 text-white', icon: '🎧', label: 'Audiobookshelf' },\n    wikijs: { color: 'bg-blue-500 text-white', icon: '📝', label: 'Wiki.js' },\n  };\n\n  // Afficher un badge pour chaque service trouvé dans les tags\n  const serviceTags = tags.filter(tag => serviceConfig[tag.toLowerCase()]);\n\n  if (serviceTags.length === 0) return null;\n\n  return (\n    <>\n      {serviceTags.map(tag => {\n        const config = serviceConfig[tag.toLowerCase()];\n        return (\n          <span key={tag} className={`px-2 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${config.color}`}>\n            <span>{config.icon}</span>\n            <span>{config.label}</span>\n          </span>\n        );\n      })}\n    </>\n  );\n};\n\nconst ProgressBar = ({ value, max, label }: { value: number; max: number; label?: string }) => {\n  const percent = max > 0 ? (value / max) * 100 : 0;\n  return (\n    <div>\n      {label && (\n        <div className=\"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1\">\n          <span>{label}</span>\n          <span>{percent.toFixed(1)}%</span>\n        </div>\n      )}\n      <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n        <div\n          className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\n          style={{ width: `${Math.min(percent, 100)}%` }}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Phase display helper (used by TrainingOverview)\nexport const getPhaseDisplay = (phase: string | undefined) => {\n  const phases: Record<string, { label: string; icon: React.ReactNode; color: string }> = {\n    preparing: { label: 'Préparation', icon: <Settings className=\"w-3 h-3 animate-spin\" />, color: 'bg-blue-500' },\n    downloading: { label: 'Téléchargement modèle', icon: <Download className=\"w-3 h-3 animate-bounce\" />, color: 'bg-cyan-500' },\n    training: { label: 'Entraînement', icon: <Brain className=\"w-3 h-3 animate-pulse\" />, color: 'bg-purple-500' },\n    exporting: { label: 'Export GGUF', icon: <HardDrive className=\"w-3 h-3 animate-pulse\" />, color: 'bg-orange-500' },\n    importing: { label: 'Import Ollama', icon: <Upload className=\"w-3 h-3 animate-bounce\" />, color: 'bg-green-500' },\n    completed: { label: 'Terminé', icon: <CheckCircle className=\"w-3 h-3\" />, color: 'bg-emerald-500' },\n  };\n  return phases[phase || ''] || { label: phase || 'En cours', icon: <Activity className=\"w-3 h-3 animate-pulse\" />, color: 'bg-gray-500' };\n};\n\n// Sessions Tab\nconst SessionsTab = ({\n  sessions,\n  loading,\n  onCreate,\n  onStart,\n  onCancel,\n  onDelete,\n  onDuplicate,\n  onManagePrompts,\n  onViewDetails,\n  onViewLogs,\n}: {\n  sessions: TrainingSession[];\n  loading: boolean;\n  onCreate: () => void;\n  onStart: (id: string) => void;\n  onCancel: (id: string) => void;\n  onDelete: (id: string) => void;\n  onDuplicate: (id: string) => void;\n  onManagePrompts: (session: TrainingSession) => void;\n  onViewDetails: (id: string) => void;\n  onViewLogs: (id: string, name?: string, status?: string) => void;\n}) => {\n  const [expandedSession, setExpandedSession] = useState<string | null>(null);\n\n  const formatDate = (date: string | undefined): string => {\n    if (!date) return '-';\n    return new Date(date).toLocaleString();\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Actions */}\n      <div className=\"flex items-center justify-between bg-white dark:bg-gray-800 p-4 rounded-lg shadow\">\n        <span className=\"text-sm text-gray-500\">\n          {sessions.length} session{sessions.length !== 1 ? 's' : ''}\n        </span>\n        <button\n          onClick={onCreate}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          Nouvelle session\n        </button>\n      </div>\n\n      {/* Sessions List */}\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n        </div>\n      ) : sessions.length > 0 ? (\n        <div className=\"space-y-3\">\n          {sessions.map((session) => (\n            <div\n              key={session.id}\n              className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\"\n            >\n              <div\n                className=\"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                onClick={() => setExpandedSession(expandedSession === session.id ? null : session.id)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <h4 className=\"font-medium text-gray-900 dark:text-white truncate\">\n                          {session.name}\n                        </h4>\n                        <StatusBadge status={session.status} />\n                      </div>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                        {session.base_model} - {session.training_type}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {session.status === 'running' && (\n                      <div className=\"text-right mr-4\">\n                        <p className=\"text-sm font-medium text-blue-600 dark:text-blue-400\">\n                          {session.progress_percent.toFixed(1)}%\n                        </p>\n                        <p className=\"text-xs text-gray-400\">\n                          Epoch {session.current_epoch}/{session.total_epochs}\n                        </p>\n                      </div>\n                    )}\n                    {expandedSession === session.id ? (\n                      <ChevronUp className=\"w-5 h-5 text-gray-400\" />\n                    ) : (\n                      <ChevronDown className=\"w-5 h-5 text-gray-400\" />\n                    )}\n                  </div>\n                </div>\n\n                {/* Progress bar for running sessions */}\n                {session.status === 'running' && (\n                  <div className=\"mt-3\">\n                    <ProgressBar\n                      value={session.current_epoch}\n                      max={session.total_epochs}\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* Expanded details */}\n              {expandedSession === session.id && (\n                <div className=\"px-4 pb-4 border-t border-gray-200 dark:border-gray-700\">\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4\">\n                    <div>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Créé le</p>\n                      <p className=\"text-sm text-gray-900 dark:text-white\">{formatDate(session.created_at)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Démarré le</p>\n                      <p className=\"text-sm text-gray-900 dark:text-white\">{formatDate(session.started_at)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Epochs</p>\n                      <p className=\"text-sm text-gray-900 dark:text-white\">\n                        {session.current_epoch} / {session.total_epochs}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Dataset</p>\n                      <p className=\"text-sm text-gray-900 dark:text-white\">{session.dataset_size} prompts</p>\n                    </div>\n                  </div>\n\n                  {session.loss !== null && session.loss !== undefined && (\n                    <div className=\"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Cpu className=\"w-4 h-4 text-gray-400\" />\n                        <div>\n                          <p className=\"text-xs text-gray-500\">Loss</p>\n                          <p className=\"text-sm font-medium\">{session.loss.toFixed(4)}</p>\n                        </div>\n                      </div>\n                      {session.gpu_memory_used && (\n                        <div className=\"flex items-center gap-2\">\n                          <HardDrive className=\"w-4 h-4 text-gray-400\" />\n                          <div>\n                            <p className=\"text-xs text-gray-500\">GPU Memory</p>\n                            <p className=\"text-sm font-medium\">{session.gpu_memory_used.toFixed(1)} GB</p>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {session.error_message && (\n                    <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n                      <p className=\"text-sm text-red-800 dark:text-red-200\">{session.error_message}</p>\n                    </div>\n                  )}\n\n                  {session.description && (\n                    <p className=\"mt-4 text-sm text-gray-600 dark:text-gray-300\">{session.description}</p>\n                  )}\n\n                  {/* Actions */}\n                  <div className=\"mt-4 flex gap-2 flex-wrap\">\n                    {session.status === 'pending' && (\n                      <>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onManagePrompts(session);\n                          }}\n                          className=\"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 flex items-center gap-1\"\n                        >\n                          <Edit className=\"w-3.5 h-3.5\" />\n                          Gérer les prompts ({session.dataset_size})\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onStart(session.id);\n                          }}\n                          disabled={session.dataset_size === 0}\n                          className=\"px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1\"\n                          title={session.dataset_size === 0 ? 'Ajoutez des prompts avant de démarrer' : ''}\n                        >\n                          <Play className=\"w-3.5 h-3.5\" />\n                          Démarrer\n                        </button>\n                      </>\n                    )}\n                    {['running', 'preparing'].includes(session.status) && (\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onCancel(session.id);\n                        }}\n                        className=\"px-3 py-1.5 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700 flex items-center gap-1\"\n                      >\n                        <Square className=\"w-3.5 h-3.5\" />\n                        Annuler\n                      </button>\n                    )}\n                    {!['running', 'preparing'].includes(session.status) && (\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onDelete(session.id);\n                        }}\n                        className=\"px-3 py-1.5 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 flex items-center gap-1\"\n                      >\n                        <Trash2 className=\"w-3.5 h-3.5\" />\n                        Supprimer\n                      </button>\n                    )}\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onDuplicate(session.id);\n                      }}\n                      className=\"px-3 py-1.5 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 flex items-center gap-1\"\n                    >\n                      <Copy className=\"w-3.5 h-3.5\" />\n                      Dupliquer\n                    </button>\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onViewDetails(session.id);\n                      }}\n                      className=\"px-3 py-1.5 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700 flex items-center gap-1\"\n                    >\n                      <Eye className=\"w-3.5 h-3.5\" />\n                      Details\n                    </button>\n                    {['completed', 'failed', 'cancelled'].includes(session.status) && (\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onViewLogs(session.id, session.name, session.status);\n                        }}\n                        className=\"px-3 py-1.5 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600 flex items-center gap-1\"\n                      >\n                        <FileText className=\"w-3.5 h-3.5\" />\n                        Logs\n                      </button>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow\">\n          <Brain className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <p className=\"text-gray-500 dark:text-gray-400\">Aucune session d'entraînement</p>\n          <p className=\"text-sm text-gray-400 dark:text-gray-500 mt-1\">\n            Créez une nouvelle session pour commencer\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Fonction utilitaire pour détecter les services d'un prompt à partir de ses tags\nconst detectServices = (prompt: TrainingPrompt): string[] => {\n  const knownServices = ['plex', 'tautulli', 'overseerr', 'radarr', 'sonarr', 'prowlarr', 'jackett', 'system', 'zammad'];\n  return prompt.tags.filter(tag => knownServices.includes(tag.toLowerCase())).map(t => t.toLowerCase());\n};\n\n// Models Tab - Liste et gestion des modèles Ollama\nconst ModelsTab = ({\n  models,\n  loading,\n  onRefresh,\n  runningModels = [],\n}: {\n  models: OllamaModel[];\n  loading: boolean;\n  onRefresh: () => void;\n  runningModels?: { name: string }[];\n}) => {\n  const [deleting, setDeleting] = useState<string | null>(null);\n  const [confirmDelete, setConfirmDelete] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [loadingModel, setLoadingModel] = useState<string | null>(null);\n\n  const isModelRunning = (modelName: string) => {\n    return runningModels.some(m => m.name === modelName || m.name.startsWith(modelName + ':'));\n  };\n\n  const handleToggleLoad = async (modelName: string) => {\n    setLoadingModel(modelName);\n    try {\n      if (isModelRunning(modelName)) {\n        await api.training.ollama.unloadModel(modelName);\n      } else {\n        await api.training.ollama.loadModel(modelName);\n      }\n      onRefresh();\n    } catch (error) {\n      console.error('Failed to toggle model load:', error);\n    } finally {\n      setLoadingModel(null);\n    }\n  };\n\n  const handleDelete = async (modelName: string) => {\n    setDeleting(modelName);\n    try {\n      await api.training.ollama.deleteModel(modelName);\n      onRefresh();\n    } catch (error) {\n      console.error('Failed to delete model:', error);\n    } finally {\n      setDeleting(null);\n      setConfirmDelete(null);\n    }\n  };\n\n  const filteredModels = models.filter(model =>\n    model.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    model.family?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const formatDate = (dateStr?: string) => {\n    if (!dateStr) return '-';\n    const date = new Date(dateStr);\n    return date.toLocaleDateString('fr-FR', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const totalSize = models.reduce((acc, m) => acc + (m.size_gb || 0), 0);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"relative flex-1 sm:w-64\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"Rechercher un modèle...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500\"\n            />\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400\">\n          <Brain className=\"w-4 h-4\" />\n          <span>{models.length} modèles</span>\n          <span className=\"text-gray-300 dark:text-gray-600\">•</span>\n          <HardDrive className=\"w-4 h-4\" />\n          <span>{totalSize.toFixed(1)} GB</span>\n        </div>\n      </div>\n\n      {/* Models List */}\n      {loading ? (\n        <div className=\"text-center py-12 text-gray-500\">Chargement...</div>\n      ) : filteredModels.length === 0 ? (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-8 text-center\">\n          <Brain className=\"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600 mb-3\" />\n          <p className=\"text-gray-500 dark:text-gray-400\">\n            {searchQuery ? 'Aucun modèle trouvé' : 'Aucun modèle installé'}\n          </p>\n        </div>\n      ) : (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50 dark:bg-gray-900/50\">\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                  Modèle\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden sm:table-cell\">\n                  Famille\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden md:table-cell\">\n                  Paramètres\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                  Taille\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden lg:table-cell\">\n                  Modifié\n                </th>\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n              {filteredModels.map((model) => (\n                <tr key={model.name} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"relative\">\n                        <Brain className=\"w-5 h-5 text-purple-500 flex-shrink-0\" />\n                        {isModelRunning(model.name) && (\n                          <span className=\"absolute -top-0.5 -right-0.5 w-2 h-2 bg-green-500 rounded-full\" title=\"Chargé en mémoire\" />\n                        )}\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-medium text-gray-900 dark:text-white text-sm\">\n                            {model.name}\n                          </p>\n                          {isModelRunning(model.name) && (\n                            <span className=\"px-1.5 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded\">\n                              Chargé\n                            </span>\n                          )}\n                        </div>\n                        {model.quantization_level && (\n                          <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                            {model.quantization_level}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-300 hidden sm:table-cell\">\n                    {model.family || '-'}\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-300 hidden md:table-cell\">\n                    {model.parameter_size || '-'}\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-300\">\n                    {model.size_gb?.toFixed(1) || '-'} GB\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400 hidden lg:table-cell\">\n                    {formatDate(model.modified_at)}\n                  </td>\n                  <td className=\"px-4 py-3 text-right\">\n                    {confirmDelete === model.name ? (\n                      <div className=\"flex items-center justify-end gap-2\">\n                        <span className=\"text-xs text-red-600 dark:text-red-400\">Confirmer ?</span>\n                        <button\n                          onClick={() => handleDelete(model.name)}\n                          disabled={deleting === model.name}\n                          className=\"p-1.5 text-white bg-red-500 rounded hover:bg-red-600 disabled:opacity-50\"\n                        >\n                          {deleting === model.name ? (\n                            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                          ) : (\n                            <Check className=\"w-4 h-4\" />\n                          )}\n                        </button>\n                        <button\n                          onClick={() => setConfirmDelete(null)}\n                          className=\"p-1.5 text-gray-600 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600\"\n                        >\n                          <X className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center justify-end gap-1\">\n                        {/* Load/Unload button */}\n                        <button\n                          onClick={() => handleToggleLoad(model.name)}\n                          disabled={loadingModel === model.name}\n                          className={`p-1.5 rounded transition-colors ${\n                            isModelRunning(model.name)\n                              ? 'text-green-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20'\n                              : 'text-gray-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/20'\n                          }`}\n                          title={isModelRunning(model.name) ? 'Décharger le modèle' : 'Charger le modèle'}\n                        >\n                          {loadingModel === model.name ? (\n                            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                          ) : isModelRunning(model.name) ? (\n                            <Zap className=\"w-4 h-4\" />\n                          ) : (\n                            <Play className=\"w-4 h-4\" />\n                          )}\n                        </button>\n                        {/* Delete button */}\n                        <button\n                          onClick={() => setConfirmDelete(model.name)}\n                          className=\"p-1.5 text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors\"\n                          title=\"Supprimer le modèle\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Prompts Tab\nconst PromptsTab = ({\n  prompts,\n  loading,\n  searchQuery,\n  setSearchQuery,\n  serviceFilter,\n  setServiceFilter,\n  onCreate,\n  onImport,\n  onExport,\n  onSeed,\n  onValidate,\n  onDelete,\n  onEdit,\n}: {\n  prompts: TrainingPrompt[];\n  loading: boolean;\n  searchQuery: string;\n  setSearchQuery: (query: string) => void;\n  serviceFilter: string;\n  setServiceFilter: (service: string) => void;\n  onCreate: () => void;\n  onImport: () => void;\n  onExport: () => void;\n  onSeed: (reset: boolean) => void;\n  onValidate: (id: string) => void;\n  onDelete: (id: string) => void;\n  onEdit: (prompt: TrainingPrompt) => void;\n}) => {\n  const [expandedPrompt, setExpandedPrompt] = useState<string | null>(null);\n\n  // Filtrer les prompts par service côté client\n  const filteredPrompts = serviceFilter\n    ? prompts.filter(p => detectServices(p).includes(serviceFilter))\n    : prompts;\n\n  // Compter les prompts par service\n  const serviceCounts = prompts.reduce((acc, p) => {\n    const services = detectServices(p);\n    services.forEach(service => {\n      acc[service] = (acc[service] || 0) + 1;\n    });\n    return acc;\n  }, {} as Record<string, number>);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Filters */}\n      <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow flex flex-wrap gap-4 items-center\">\n        <div className=\"flex-1 min-w-[200px] relative\">\n          <Search className=\"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Rechercher...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-9 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n          />\n        </div>\n        <select\n          value={serviceFilter}\n          onChange={(e) => setServiceFilter(e.target.value)}\n          className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n        >\n          <option value=\"\">Tous les services ({prompts.length})</option>\n          <option value=\"plex\">🎬 Plex ({serviceCounts['plex'] || 0})</option>\n          <option value=\"tautulli\">📊 Tautulli ({serviceCounts['tautulli'] || 0})</option>\n          <option value=\"overseerr\">🎯 Overseerr ({serviceCounts['overseerr'] || 0})</option>\n          <option value=\"radarr\">🎥 Radarr ({serviceCounts['radarr'] || 0})</option>\n          <option value=\"sonarr\">📺 Sonarr ({serviceCounts['sonarr'] || 0})</option>\n          <option value=\"prowlarr\">🔍 Prowlarr ({serviceCounts['prowlarr'] || 0})</option>\n          <option value=\"jackett\">🧥 Jackett ({serviceCounts['jackett'] || 0})</option>\n          <option value=\"system\">⚙️ Système ({serviceCounts['system'] || 0})</option>\n          <option value=\"zammad\">🎫 Zammad ({serviceCounts['zammad'] || 0})</option>\n        </select>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => onSeed(true)}\n            className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2\"\n            title=\"Supprimer tous les prompts et recharger les prompts homelab\"\n          >\n            <Zap className=\"w-4 h-4\" />\n            Reset Prompts\n          </button>\n          <button\n            onClick={onImport}\n            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\n          >\n            <Upload className=\"w-4 h-4\" />\n            Importer\n          </button>\n          <button\n            onClick={onExport}\n            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\n          >\n            <Download className=\"w-4 h-4\" />\n            Exporter\n          </button>\n          <button\n            onClick={onCreate}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Nouveau\n          </button>\n        </div>\n      </div>\n\n      {/* Prompts List */}\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n        </div>\n      ) : filteredPrompts.length > 0 ? (\n        <div className=\"space-y-3\">\n          {filteredPrompts.map((prompt) => (\n            <div\n              key={prompt.id}\n              className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\"\n            >\n              <div\n                className=\"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                onClick={() => setExpandedPrompt(expandedPrompt === prompt.id ? null : prompt.id)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <h4 className=\"font-medium text-gray-900 dark:text-white truncate\">\n                          {prompt.name}\n                        </h4>\n                        <ServiceBadge tags={prompt.tags} />\n                        <DifficultyBadge difficulty={prompt.difficulty} />\n                        {prompt.is_validated && (\n                          <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate\">\n                        {prompt.user_input.substring(0, 100)}...\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs text-gray-400\">\n                      {prompt.times_used} utilisations\n                    </span>\n                    {expandedPrompt === prompt.id ? (\n                      <ChevronUp className=\"w-5 h-5 text-gray-400\" />\n                    ) : (\n                      <ChevronDown className=\"w-5 h-5 text-gray-400\" />\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* Expanded details */}\n              {expandedPrompt === prompt.id && (\n                <div className=\"px-4 pb-4 border-t border-gray-200 dark:border-gray-700 space-y-4\">\n                  {prompt.system_prompt && (\n                    <div className=\"mt-4\">\n                      <p className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                        System Prompt\n                      </p>\n                      <pre className=\"text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded-lg overflow-x-auto whitespace-pre-wrap\">\n                        {prompt.system_prompt}\n                      </pre>\n                    </div>\n                  )}\n\n                  <div>\n                    <p className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                      Input utilisateur\n                    </p>\n                    <pre className=\"text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded-lg overflow-x-auto whitespace-pre-wrap\">\n                      {prompt.user_input}\n                    </pre>\n                  </div>\n\n                  {/* Tool calling display */}\n                  {prompt.tool_call && (\n                    <div className=\"space-y-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                      <p className=\"text-xs font-semibold text-blue-700 dark:text-blue-300\">Tool Call</p>\n                      <pre className=\"text-sm bg-white dark:bg-gray-900 p-2 rounded overflow-x-auto\">\n                        {JSON.stringify(prompt.tool_call, null, 2)}\n                      </pre>\n                    </div>\n                  )}\n\n                  {prompt.tool_response && (\n                    <div className=\"space-y-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                      <p className=\"text-xs font-semibold text-green-700 dark:text-green-300\">Tool Response</p>\n                      <pre className=\"text-sm bg-white dark:bg-gray-900 p-2 rounded overflow-x-auto max-h-32\">\n                        {JSON.stringify(prompt.tool_response, null, 2)}\n                      </pre>\n                    </div>\n                  )}\n\n                  {prompt.assistant_response ? (\n                    <div className=\"space-y-2 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                      <p className=\"text-xs font-semibold text-purple-700 dark:text-purple-300\">Réponse finale</p>\n                      <pre className=\"text-sm bg-white dark:bg-gray-900 p-2 rounded overflow-x-auto whitespace-pre-wrap max-h-48\">\n                        {prompt.assistant_response}\n                      </pre>\n                    </div>\n                  ) : (\n                    <div>\n                      <p className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1\">\n                        Sortie attendue\n                      </p>\n                      <pre className=\"text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded-lg overflow-x-auto whitespace-pre-wrap max-h-48\">\n                        {prompt.expected_output}\n                      </pre>\n                    </div>\n                  )}\n\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onEdit(prompt);\n                      }}\n                      className=\"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 flex items-center gap-1\"\n                    >\n                      <Edit className=\"w-3.5 h-3.5\" />\n                      Modifier\n                    </button>\n                    {!prompt.is_validated && (\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onValidate(prompt.id);\n                        }}\n                        className=\"px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 flex items-center gap-1\"\n                      >\n                        <CheckCircle className=\"w-3.5 h-3.5\" />\n                        Valider\n                      </button>\n                    )}\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onDelete(prompt.id);\n                      }}\n                      className=\"px-3 py-1.5 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 flex items-center gap-1\"\n                    >\n                      <Trash2 className=\"w-3.5 h-3.5\" />\n                      Supprimer\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow\">\n          <FileText className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <p className=\"text-gray-500 dark:text-gray-400\">Aucun prompt d'entraînement</p>\n          <p className=\"text-sm text-gray-400 dark:text-gray-500 mt-1\">\n            Ajoutez des prompts pour entraîner vos modèles\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Session Creation Modal\nconst SessionModal = ({\n  isOpen,\n  onClose,\n  onSubmit,\n  models,\n  allPrompts,\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (data: any, promptIds: string[]) => Promise<void>;\n  models: OllamaModel[];\n  allPrompts: TrainingPrompt[];\n}) => {\n  const [step, setStep] = useState<1 | 2>(1);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    base_model: '',\n    training_backend: 'ollama_modelfile' as 'ollama_modelfile' | 'unsloth',\n    worker_id: '',\n    total_epochs: 3,\n    batch_size: 2,\n    learning_rate: 0.0002,\n    overwrite_existing: false,\n    base_adapter_path: '' as string,  // For incremental training from existing LoRA adapter\n  });\n\n  // HuggingFace models for GPU fine-tuning (Unsloth)\n  const huggingfaceModels = [\n    { name: 'unsloth/llama-3.2-3b-instruct-bnb-4bit', size: '3B', description: 'Llama 3.2 3B - Rapide, faible VRAM' },\n    { name: 'unsloth/llama-3.2-1b-instruct-bnb-4bit', size: '1B', description: 'Llama 3.2 1B - Très rapide, minimal' },\n    { name: 'unsloth/Llama-3.1-8B-Instruct-bnb-4bit', size: '8B', description: 'Llama 3.1 8B - Meilleure qualité' },\n    { name: 'unsloth/mistral-7b-instruct-v0.3-bnb-4bit', size: '7B', description: 'Mistral 7B - Excellent rapport qualité/taille' },\n    { name: 'unsloth/Phi-3.5-mini-instruct-bnb-4bit', size: '3.8B', description: 'Phi 3.5 Mini - Microsoft, compact' },\n    { name: 'unsloth/gemma-2-2b-it-bnb-4bit', size: '2B', description: 'Gemma 2 2B - Google, léger' },\n  ];\n  const [workers, setWorkers] = useState<TrainingWorker[]>([]);\n  const [loadingWorkers, setLoadingWorkers] = useState(false);\n\n  // LoRA adapters for incremental training\n  interface LoraAdapter {\n    adapter_name: string;\n    model_name?: string;\n    session_id?: string;\n    session_name?: string;\n    prompts_count?: number;\n    created_at?: string;\n    size_mb?: number;\n    path: string;\n    parent_adapter?: string;\n  }\n  const [loraAdapters, setLoraAdapters] = useState<LoraAdapter[]>([]);\n  const [loadingAdapters, setLoadingAdapters] = useState(false);\n\n  // Fetch available workers when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setLoadingWorkers(true);\n      api.workers.list(true)\n        .then((data) => setWorkers(data || []))\n        .catch(() => setWorkers([]))\n        .finally(() => setLoadingWorkers(false));\n    }\n  }, [isOpen]);\n\n  // Fetch LoRA adapters from selected worker\n  useEffect(() => {\n    if (formData.worker_id && formData.training_backend === 'unsloth') {\n      const selectedWorker = workers.find(w => w.id === formData.worker_id);\n      if (selectedWorker?.url) {\n        setLoadingAdapters(true);\n        fetch(`${selectedWorker.url}/api/adapters`)\n          .then(res => res.json())\n          .then(data => setLoraAdapters(data.adapters || []))\n          .catch(() => setLoraAdapters([]))\n          .finally(() => setLoadingAdapters(false));\n      }\n    } else {\n      setLoraAdapters([]);\n    }\n  }, [formData.worker_id, formData.training_backend, workers]);\n  const [selectedPrompts, setSelectedPrompts] = useState<Set<string>>(new Set());\n  const [serviceFilter, setServiceFilter] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\n  const detectServices = (prompt: TrainingPrompt): string[] => {\n    const serviceKeywords = ['plex', 'tautulli', 'overseerr', 'radarr', 'sonarr', 'prowlarr', 'jackett', 'zammad', 'system'];\n    return prompt.tags.filter(tag => serviceKeywords.includes(tag.toLowerCase()));\n  };\n\n  const filteredPrompts = allPrompts.filter((prompt) => {\n    if (!prompt.enabled) return false;\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      if (!prompt.name.toLowerCase().includes(query) &&\n          !prompt.user_input.toLowerCase().includes(query)) {\n        return false;\n      }\n    }\n    if (serviceFilter) {\n      const services = detectServices(prompt);\n      if (!services.includes(serviceFilter)) return false;\n    }\n    return true;\n  });\n\n  const togglePrompt = (promptId: string) => {\n    const newSelected = new Set(selectedPrompts);\n    if (newSelected.has(promptId)) {\n      newSelected.delete(promptId);\n    } else {\n      newSelected.add(promptId);\n    }\n    setSelectedPrompts(newSelected);\n  };\n\n  const selectAll = () => setSelectedPrompts(new Set(filteredPrompts.map(p => p.id)));\n  const selectNone = () => setSelectedPrompts(new Set());\n\n  const resetForm = () => {\n    setStep(1);\n    setFormData({\n      name: '',\n      description: '',\n      base_model: '',\n      training_backend: 'ollama_modelfile',\n      worker_id: '',\n      total_epochs: 3,\n      batch_size: 2,\n      learning_rate: 0.0002,\n      overwrite_existing: false,\n      base_adapter_path: '',\n    });\n    setSelectedPrompts(new Set());\n    setServiceFilter('');\n    setSearchQuery('');\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  const handleSubmit = async () => {\n    setSubmitting(true);\n    try {\n      // Structure the data as expected by the backend API\n      const sessionData = {\n        name: formData.name,\n        description: formData.description,\n        base_model: formData.base_model,\n        training_backend: formData.training_backend,\n        worker_id: formData.worker_id || null,\n        total_epochs: formData.total_epochs,\n        hyperparameters: {\n          batch_size: formData.batch_size,\n          learning_rate: formData.learning_rate,\n          overwrite_existing: formData.overwrite_existing,\n        },\n        // For incremental training: path to existing LoRA adapter\n        base_adapter_path: formData.base_adapter_path || null,\n      };\n      await onSubmit(sessionData, Array.from(selectedPrompts));\n      handleClose();\n    } catch (error) {\n      console.error('Failed to create session:', error);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n              Nouvelle session d'entraînement\n            </h3>\n            <div className=\"flex items-center gap-2 mt-1\">\n              <span className={`px-2 py-0.5 text-xs rounded-full ${step === 1 ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300'}`}>\n                1. Configuration\n              </span>\n              <span className=\"text-gray-400\">→</span>\n              <span className={`px-2 py-0.5 text-xs rounded-full ${step === 2 ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300'}`}>\n                2. Sélection des prompts\n              </span>\n            </div>\n          </div>\n          <button onClick={handleClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Step 1: Configuration */}\n        {step === 1 && (\n          <div className=\"p-4 space-y-4 overflow-y-auto\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nom *</label>\n              <input\n                type=\"text\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                placeholder=\"Ma session d'entraînement\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Description</label>\n              <textarea\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                rows={2}\n                placeholder=\"Description optionnelle...\"\n              />\n            </div>\n            {/* Training Method Selection - MOVED BEFORE MODEL SELECTION */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Méthode d'entraînement</label>\n              <div className=\"space-y-2\">\n                <label className={`flex items-start p-3 border rounded-lg cursor-pointer transition-colors ${\n                  formData.training_backend === 'ollama_modelfile'\n                    ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                    : 'hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-300 dark:border-gray-600'\n                }`}>\n                  <input\n                    type=\"radio\"\n                    name=\"training_backend\"\n                    value=\"ollama_modelfile\"\n                    checked={formData.training_backend === 'ollama_modelfile'}\n                    onChange={() => setFormData({ ...formData, training_backend: 'ollama_modelfile', base_model: '' })}\n                    className=\"mt-1 mr-3\"\n                  />\n                  <div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-gray-900 dark:text-white\">Modelfile (rapide)</span>\n                      <span className=\"px-2 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded\">\n                        Recommandé\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                      Crée un modèle Ollama avec les exemples intégrés. Pas de GPU requis.\n                    </p>\n                  </div>\n                </label>\n                <label className={`flex items-start p-3 border rounded-lg cursor-pointer transition-colors ${\n                  formData.training_backend === 'unsloth'\n                    ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                    : 'hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-300 dark:border-gray-600'\n                }`}>\n                  <input\n                    type=\"radio\"\n                    name=\"training_backend\"\n                    value=\"unsloth\"\n                    checked={formData.training_backend === 'unsloth'}\n                    onChange={() => setFormData({ ...formData, training_backend: 'unsloth', base_model: '' })}\n                    className=\"mt-1 mr-3\"\n                  />\n                  <div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-gray-900 dark:text-white\">Fine-tuning GPU (Unsloth)</span>\n                      <span className=\"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300 rounded flex items-center gap-1\">\n                        <Zap className=\"w-3 h-3\" /> GPU requis\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                      Fine-tuning LoRA sur worker GPU distant. Meilleurs résultats.\n                    </p>\n                  </div>\n                </label>\n              </div>\n            </div>\n\n            {/* Model Selection - changes based on training backend */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                {formData.training_backend === 'unsloth' ? 'Modèle de base *' : 'Modèle Ollama *'}\n              </label>\n              {formData.training_backend === 'unsloth' ? (\n                <select\n                  value={formData.base_adapter_path || formData.base_model}\n                  onChange={(e) => {\n                    const value = e.target.value;\n                    // Check if selected value is an adapter path (starts with /)\n                    if (value.startsWith('/')) {\n                      // Find the adapter to get its base model\n                      const adapter = loraAdapters.find(a => a.path === value);\n                      setFormData({\n                        ...formData,\n                        base_adapter_path: value,\n                        // Use the adapter's original base model, or keep current\n                        base_model: adapter?.model_name || formData.base_model,\n                      });\n                    } else {\n                      // Regular HuggingFace model selected\n                      setFormData({\n                        ...formData,\n                        base_model: value,\n                        base_adapter_path: '',\n                      });\n                    }\n                  }}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                >\n                  <option value=\"\">Sélectionner un modèle</option>\n                  {loraAdapters.length > 0 && (\n                    <optgroup label=\"🔄 Modèles entraînés (entraînement incrémental)\">\n                      {loraAdapters.map((adapter) => (\n                        <option key={adapter.path} value={adapter.path}>\n                          {adapter.session_name || adapter.adapter_name} ({adapter.prompts_count || '?'} prompts, {adapter.size_mb?.toFixed(1) || '?'} MB)\n                        </option>\n                      ))}\n                    </optgroup>\n                  )}\n                  <optgroup label=\"📦 Modèles HuggingFace (nouvel entraînement)\">\n                    {huggingfaceModels.map((model) => (\n                      <option key={model.name} value={model.name}>\n                        {model.description} ({model.size})\n                      </option>\n                    ))}\n                  </optgroup>\n                </select>\n              ) : (\n                <select\n                  value={formData.base_model}\n                  onChange={(e) => setFormData({ ...formData, base_model: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                >\n                  <option value=\"\">Sélectionner un modèle Ollama</option>\n                  {models.map((model) => (\n                    <option key={model.name} value={model.name}>\n                      {model.name} ({model.size_gb.toFixed(1)} GB)\n                    </option>\n                  ))}\n                </select>\n              )}\n              {formData.training_backend === 'unsloth' && (\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                  {loadingAdapters ? (\n                    <span className=\"flex items-center gap-1\">\n                      <RefreshCw className=\"w-3 h-3 animate-spin\" />\n                      Chargement des adaptateurs...\n                    </span>\n                  ) : formData.base_adapter_path ? (\n                    <span className=\"text-blue-500 dark:text-blue-400\">\n                      ⚡ Entraînement incrémental : les nouveaux prompts s'ajouteront aux connaissances existantes\n                    </span>\n                  ) : (\n                    'Modèles optimisés 4-bit pour GTX 1080 Ti (11GB VRAM)'\n                  )}\n                </p>\n              )}\n            </div>\n\n            {/* Overwrite existing model option */}\n            <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n              <input\n                type=\"checkbox\"\n                id=\"overwrite_existing\"\n                checked={formData.overwrite_existing}\n                onChange={(e) => setFormData({ ...formData, overwrite_existing: e.target.checked })}\n                className=\"mt-1\"\n              />\n              <label htmlFor=\"overwrite_existing\" className=\"cursor-pointer\">\n                <span className=\"font-medium text-gray-900 dark:text-white\">Écraser le modèle existant</span>\n                <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                  Si un modèle avec le même nom existe déjà dans Ollama, il sera remplacé.\n                  Sinon, une erreur se produira si le nom est déjà pris.\n                </p>\n              </label>\n            </div>\n\n            {/* Worker Selection */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Worker d'entraînement</label>\n              {loadingWorkers ? (\n                <div className=\"flex items-center gap-2 p-3 text-gray-500 dark:text-gray-400\">\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                  Chargement des workers...\n                </div>\n              ) : workers.length === 0 ? (\n                <div className=\"p-3 border border-gray-300 dark:border-gray-600 rounded-lg\">\n                  <div className=\"flex items-center gap-2 text-gray-500 dark:text-gray-400\">\n                    <Server className=\"w-4 h-4\" />\n                    <span>Aucun worker configuré</span>\n                  </div>\n                  <p className=\"text-sm text-gray-400 dark:text-gray-500 mt-1\">\n                    Configurez un worker dans les paramètres pour activer l'entraînement.\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {workers.map((worker) => {\n                    const isOnline = worker.status === 'online';\n                    const hasGpu = worker.gpu_available;\n                    const isDisabled = !isOnline || !worker.enabled;\n\n                    return (\n                      <label\n                        key={worker.id}\n                        className={`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${\n                          isDisabled\n                            ? 'opacity-50 cursor-not-allowed border-gray-200 dark:border-gray-700'\n                            : formData.worker_id === worker.id\n                              ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                              : 'hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-300 dark:border-gray-600'\n                        }`}\n                      >\n                        <input\n                          type=\"radio\"\n                          name=\"worker_id\"\n                          value={worker.id}\n                          checked={formData.worker_id === worker.id}\n                          onChange={(e) => setFormData({ ...formData, worker_id: e.target.value })}\n                          disabled={isDisabled}\n                          className=\"mr-3\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            {hasGpu ? (\n                              <Zap className=\"w-4 h-4 text-yellow-500\" />\n                            ) : (\n                              <Server className=\"w-4 h-4 text-blue-500\" />\n                            )}\n                            <span className=\"font-medium text-gray-900 dark:text-white\">{worker.name}</span>\n                            {isOnline ? (\n                              hasGpu ? (\n                                <span className=\"px-2 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded\">\n                                  GPU: {worker.gpu_names?.[0] || 'Disponible'}\n                                </span>\n                              ) : (\n                                <span className=\"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 rounded\">\n                                  CPU only\n                                </span>\n                              )\n                            ) : (\n                              <span className=\"px-2 py-0.5 text-xs bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 rounded\">\n                                Hors ligne\n                              </span>\n                            )}\n                            {worker.current_job_id && (\n                              <span className=\"px-2 py-0.5 text-xs bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300 rounded flex items-center gap-1\">\n                                <Activity className=\"w-3 h-3\" /> Occupé\n                              </span>\n                            )}\n                          </div>\n                          {worker.description && (\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                              {worker.description}\n                            </p>\n                          )}\n                        </div>\n                      </label>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Epochs</label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={formData.total_epochs}\n                  onChange={(e) => setFormData({ ...formData, total_epochs: parseInt(e.target.value) || 1 })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Batch size</label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={formData.batch_size}\n                  onChange={(e) => setFormData({ ...formData, batch_size: parseInt(e.target.value) || 1 })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Learning rate</label>\n                <input\n                  type=\"number\"\n                  step=\"0.00001\"\n                  min=\"0\"\n                  value={formData.learning_rate}\n                  onChange={(e) => setFormData({ ...formData, learning_rate: parseFloat(e.target.value) || 0.0001 })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                />\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Step 2: Prompt Selection */}\n        {step === 2 && (\n          <div className=\"flex-1 flex flex-col overflow-hidden\">\n            {/* Filters */}\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 space-y-3\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Rechercher...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"w-full pl-9 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n                  />\n                </div>\n                <select\n                  value={serviceFilter}\n                  onChange={(e) => setServiceFilter(e.target.value)}\n                  className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n                >\n                  <option value=\"\">Tous les services</option>\n                  {AVAILABLE_SERVICES.map((service) => (\n                    <option key={service.id} value={service.id}>\n                      {service.icon} {service.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <button onClick={selectAll} className=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400\">\n                    Tout sélectionner\n                  </button>\n                  <span className=\"text-gray-300 dark:text-gray-600\">|</span>\n                  <button onClick={selectNone} className=\"text-sm text-gray-500 hover:text-gray-600 dark:text-gray-400\">\n                    Tout désélectionner\n                  </button>\n                </div>\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  {selectedPrompts.size} sélectionné{selectedPrompts.size !== 1 ? 's' : ''} / {filteredPrompts.length}\n                </span>\n              </div>\n            </div>\n\n            {/* Prompts List */}\n            <div className=\"flex-1 overflow-y-auto p-4\">\n              {filteredPrompts.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {filteredPrompts.map((prompt) => {\n                    const services = detectServices(prompt);\n                    const isSelected = selectedPrompts.has(prompt.id);\n                    return (\n                      <div\n                        key={prompt.id}\n                        onClick={() => togglePrompt(prompt.id)}\n                        className={`p-3 rounded-lg border cursor-pointer transition-all ${\n                          isSelected\n                            ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                            : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n                        }`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <div className={`mt-0.5 w-5 h-5 rounded border flex items-center justify-center ${\n                            isSelected ? 'bg-blue-600 border-blue-600 text-white' : 'border-gray-300 dark:border-gray-600'\n                          }`}>\n                            {isSelected && <Check className=\"w-3.5 h-3.5\" />}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{prompt.name}</span>\n                              {services.map((service) => {\n                                const svc = AVAILABLE_SERVICES.find(s => s.id === service);\n                                return svc ? (\n                                  <span key={service} className={`px-1.5 py-0.5 text-xs rounded ${svc.color} text-white`}>\n                                    {svc.icon}\n                                  </span>\n                                ) : null;\n                              })}\n                            </div>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-1\">{prompt.user_input}</p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <FileText className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n                  <p className=\"text-gray-500 dark:text-gray-400\">Aucun prompt trouvé</p>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-4 border-t border-gray-200 dark:border-gray-700\">\n          <div>\n            {step === 2 && (\n              <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {selectedPrompts.size} prompt{selectedPrompts.size !== 1 ? 's' : ''} pour l'entraînement\n              </span>\n            )}\n          </div>\n          <div className=\"flex gap-3\">\n            {step === 1 ? (\n              <>\n                <button\n                  onClick={handleClose}\n                  className=\"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n                >\n                  Annuler\n                </button>\n                <button\n                  onClick={() => setStep(2)}\n                  disabled={!formData.name || !formData.base_model}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2\"\n                >\n                  Suivant\n                  <ChevronDown className=\"w-4 h-4 rotate-[-90deg]\" />\n                </button>\n              </>\n            ) : (\n              <>\n                <button\n                  onClick={() => setStep(1)}\n                  className=\"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2\"\n                >\n                  <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                  Retour\n                </button>\n                <button\n                  onClick={handleSubmit}\n                  disabled={submitting || selectedPrompts.size === 0}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2\"\n                >\n                  {submitting ? (\n                    <>\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                      Création...\n                    </>\n                  ) : (\n                    <>\n                      <Check className=\"w-4 h-4\" />\n                      Créer ({selectedPrompts.size} prompts)\n                    </>\n                  )}\n                </button>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n// Prompt Creation/Edit Modal\nconst PromptModal = ({\n  isOpen,\n  onClose,\n  onSubmit,\n  availableServices,\n  editingPrompt,\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (data: any) => Promise<void>;\n  availableServices: { id: string; label: string; icon: string; color: string }[];\n  editingPrompt?: TrainingPrompt | null;\n}) => {\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    difficulty: 'basic',\n    system_prompt: 'Tu es un assistant IA homelab. Utilise les outils MCP pour répondre aux demandes.',\n    user_input: '',\n    expected_output: '',\n    // Tool calling support\n    tool_call_name: '',\n    tool_call_arguments: '',\n    tool_response: '',\n    assistant_response: '',\n    services: [] as string[],\n  });\n  const [submitting, setSubmitting] = useState(false);\n  const [useToolCalling, setUseToolCalling] = useState(false);\n\n  // Populate form when editing\n  useEffect(() => {\n    if (editingPrompt) {\n      setFormData({\n        name: editingPrompt.name,\n        description: editingPrompt.description || '',\n        difficulty: editingPrompt.difficulty,\n        system_prompt: editingPrompt.system_prompt || 'Tu es un assistant IA homelab. Utilise les outils MCP pour répondre aux demandes.',\n        user_input: editingPrompt.user_input,\n        expected_output: editingPrompt.expected_output,\n        tool_call_name: editingPrompt.tool_call?.name || '',\n        tool_call_arguments: editingPrompt.tool_call?.arguments ? JSON.stringify(editingPrompt.tool_call.arguments, null, 2) : '',\n        tool_response: editingPrompt.tool_response ? JSON.stringify(editingPrompt.tool_response, null, 2) : '',\n        assistant_response: editingPrompt.assistant_response || '',\n        services: editingPrompt.tags || [],\n      });\n      setUseToolCalling(!!editingPrompt.tool_call);\n    } else {\n      // Reset form for new prompt\n      setFormData({\n        name: '',\n        description: '',\n        difficulty: 'basic',\n        system_prompt: 'Tu es un assistant IA homelab. Utilise les outils MCP pour répondre aux demandes.',\n        user_input: '',\n        expected_output: '',\n        tool_call_name: '',\n        tool_call_arguments: '',\n        tool_response: '',\n        assistant_response: '',\n        services: [],\n      });\n      setUseToolCalling(false);\n    }\n  }, [editingPrompt, isOpen]);\n\n  if (!isOpen) return null;\n\n  const toggleService = (serviceId: string) => {\n    setFormData(prev => ({\n      ...prev,\n      services: prev.services.includes(serviceId)\n        ? prev.services.filter(s => s !== serviceId)\n        : [...prev.services, serviceId]\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (formData.services.length === 0) {\n      alert('Veuillez sélectionner au moins un service');\n      return;\n    }\n    setSubmitting(true);\n    try {\n      // Build the submission data (without category - using tags for services)\n      const submitData: any = {\n        name: formData.name,\n        description: formData.description,\n        category: 'homelab', // Default category (required by backend but not user-facing)\n        difficulty: formData.difficulty,\n        system_prompt: formData.system_prompt,\n        user_input: formData.user_input,\n        tags: formData.services,\n      };\n\n      // Add ID if editing\n      if (editingPrompt) {\n        submitData.id = editingPrompt.id;\n      }\n\n      // Handle tool calling fields\n      if (useToolCalling && formData.tool_call_name && formData.tool_response && formData.assistant_response) {\n        // Parse tool call arguments\n        let parsedArgs = {};\n        try {\n          if (formData.tool_call_arguments.trim()) {\n            parsedArgs = JSON.parse(formData.tool_call_arguments);\n          }\n        } catch {\n          alert('Les arguments du tool call doivent être un JSON valide');\n          setSubmitting(false);\n          return;\n        }\n\n        // Parse tool response\n        let parsedResponse = {};\n        try {\n          parsedResponse = JSON.parse(formData.tool_response);\n        } catch {\n          alert('La réponse du tool doit être un JSON valide');\n          setSubmitting(false);\n          return;\n        }\n\n        submitData.tool_call = {\n          name: formData.tool_call_name,\n          arguments: parsedArgs,\n        };\n        submitData.tool_response = parsedResponse;\n        submitData.assistant_response = formData.assistant_response;\n        submitData.expected_output = formData.assistant_response; // For backwards compatibility\n      } else {\n        submitData.expected_output = formData.expected_output;\n      }\n\n      await onSubmit(submitData);\n      onClose();\n    } catch (error) {\n      console.error('Failed to save prompt:', error);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto\">\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\n            {editingPrompt ? 'Modifier le prompt' : 'Nouveau prompt d\\'entraînement'}\n          </h3>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n        <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nom *</label>\n              <input\n                type=\"text\"\n                required\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                placeholder=\"Nom du prompt\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Difficulté</label>\n              <select\n                value={formData.difficulty}\n                onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              >\n                <option value=\"basic\">Basique</option>\n                <option value=\"intermediate\">Intermédiaire</option>\n                <option value=\"advanced\">Avancé</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Services Selection */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Services concernés *</label>\n            <div className=\"flex flex-wrap gap-2\">\n              {availableServices.map((service) => (\n                <button\n                  key={service.id}\n                  type=\"button\"\n                  onClick={() => toggleService(service.id)}\n                  className={`px-3 py-1.5 rounded-full text-sm font-medium flex items-center gap-1.5 transition-all ${\n                    formData.services.includes(service.id)\n                      ? `${service.color} text-white ring-2 ring-offset-2 ring-${service.color.replace('bg-', '')}`\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                  }`}\n                >\n                  <span>{service.icon}</span>\n                  <span>{service.label}</span>\n                </button>\n              ))}\n            </div>\n            {formData.services.length === 0 && (\n              <p className=\"text-xs text-red-500 mt-1\">Sélectionnez au moins un service</p>\n            )}\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Description</label>\n            <input\n              type=\"text\"\n              value={formData.description}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              placeholder=\"Description du prompt\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">System Prompt</label>\n            <textarea\n              value={formData.system_prompt}\n              onChange={(e) => setFormData({ ...formData, system_prompt: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n              rows={3}\n              placeholder=\"Instructions système pour le modèle...\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Input utilisateur *</label>\n            <textarea\n              required\n              value={formData.user_input}\n              onChange={(e) => setFormData({ ...formData, user_input: e.target.value })}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n              rows={3}\n              placeholder=\"Question ou demande de l'utilisateur...\"\n            />\n          </div>\n          {/* Tool Calling Toggle */}\n          <div className=\"flex items-center gap-3 py-2 border-t border-gray-200 dark:border-gray-700\">\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={useToolCalling}\n                onChange={(e) => setUseToolCalling(e.target.checked)}\n                className=\"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500\"\n              />\n              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Utiliser Tool Calling\n              </span>\n            </label>\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n              (apprend au modèle à appeler des outils ET utiliser les résultats)\n            </span>\n          </div>\n\n          {useToolCalling ? (\n            <>\n              {/* Tool Call Section */}\n              <div className=\"space-y-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                <h4 className=\"text-sm font-semibold text-blue-700 dark:text-blue-300\">Tool Call (Appel d'outil)</h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nom du tool *</label>\n                    <input\n                      type=\"text\"\n                      required\n                      value={formData.tool_call_name}\n                      onChange={(e) => setFormData({ ...formData, tool_call_name: e.target.value })}\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n                      placeholder=\"ex: system_get_health\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Arguments (JSON)</label>\n                    <input\n                      type=\"text\"\n                      value={formData.tool_call_arguments}\n                      onChange={(e) => setFormData({ ...formData, tool_call_arguments: e.target.value })}\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n                      placeholder='ex: {\"service\": \"ollama\"}'\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Tool Response Section */}\n              <div className=\"space-y-2 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                <label className=\"block text-sm font-semibold text-green-700 dark:text-green-300\">Réponse du Tool (JSON) *</label>\n                <textarea\n                  required\n                  value={formData.tool_response}\n                  onChange={(e) => setFormData({ ...formData, tool_response: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n                  rows={4}\n                  placeholder='{\"status\": \"healthy\", \"version\": \"0.1.0\", \"services\": [...]}'\n                />\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Réponse réaliste que le tool retournerait (utilisée pour l'entraînement)\n                </p>\n              </div>\n\n              {/* Final Assistant Response */}\n              <div className=\"space-y-2 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                <label className=\"block text-sm font-semibold text-purple-700 dark:text-purple-300\">Réponse finale de l'assistant *</label>\n                <textarea\n                  required\n                  value={formData.assistant_response}\n                  onChange={(e) => setFormData({ ...formData, assistant_response: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n                  rows={4}\n                  placeholder=\"Le système est en bonne santé. Ollama version 0.1.0 est opérationnel avec 3 services actifs...\"\n                />\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Comment l'assistant doit synthétiser et présenter les données du tool\n                </p>\n              </div>\n            </>\n          ) : (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Sortie attendue *</label>\n              <textarea\n                required\n                value={formData.expected_output}\n                onChange={(e) => setFormData({ ...formData, expected_output: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm\"\n                rows={4}\n                placeholder=\"Réponse attendue du modèle...\"\n              />\n            </div>\n          )}\n\n          <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Annuler\n            </button>\n            <button\n              type=\"submit\"\n              disabled={submitting}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {submitting\n                ? (editingPrompt ? 'Enregistrement...' : 'Création...')\n                : (editingPrompt ? 'Enregistrer' : 'Créer le prompt')}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\n// Session Prompts Selection Modal\nconst SessionPromptsModal = ({\n  isOpen,\n  onClose,\n  session,\n  allPrompts,\n  onSave,\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  session: TrainingSession;\n  allPrompts: TrainingPrompt[];\n  onSave: (sessionId: string, promptIds: string[]) => Promise<void>;\n}) => {\n  const [selectedPrompts, setSelectedPrompts] = useState<Set<string>>(new Set());\n  const [serviceFilter, setServiceFilter] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [saving, setSaving] = useState(false);\n  const [_sessionPrompts, setSessionPrompts] = useState<TrainingPrompt[]>([]);\n  const [loadingSessionPrompts, setLoadingSessionPrompts] = useState(true);\n\n  // Load current session prompts on open\n  useEffect(() => {\n    if (isOpen && session) {\n      setLoadingSessionPrompts(true);\n      api.training.sessions.getPrompts(session.id)\n        .then((prompts: TrainingPrompt[]) => {\n          setSessionPrompts(prompts);\n          setSelectedPrompts(new Set(prompts.map(p => p.id)));\n        })\n        .catch(console.error)\n        .finally(() => setLoadingSessionPrompts(false));\n    }\n  }, [isOpen, session?.id]);\n\n  const detectServices = (prompt: TrainingPrompt): string[] => {\n    const serviceKeywords = ['plex', 'tautulli', 'overseerr', 'radarr', 'sonarr', 'prowlarr', 'jackett', 'zammad', 'system'];\n    return prompt.tags.filter(tag => serviceKeywords.includes(tag.toLowerCase()));\n  };\n\n  const filteredPrompts = allPrompts.filter((prompt) => {\n    if (!prompt.enabled) return false;\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      if (!prompt.name.toLowerCase().includes(query) &&\n          !prompt.user_input.toLowerCase().includes(query)) {\n        return false;\n      }\n    }\n    if (serviceFilter) {\n      const services = detectServices(prompt);\n      if (!services.includes(serviceFilter)) return false;\n    }\n    return true;\n  });\n\n  const togglePrompt = (promptId: string) => {\n    const newSelected = new Set(selectedPrompts);\n    if (newSelected.has(promptId)) {\n      newSelected.delete(promptId);\n    } else {\n      newSelected.add(promptId);\n    }\n    setSelectedPrompts(newSelected);\n  };\n\n  const selectAll = () => {\n    const allIds = new Set(filteredPrompts.map(p => p.id));\n    setSelectedPrompts(allIds);\n  };\n\n  const selectNone = () => {\n    setSelectedPrompts(new Set());\n  };\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onSave(session.id, Array.from(selectedPrompts));\n      onClose();\n    } catch (error) {\n      console.error('Failed to save prompts:', error);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              Sélection des prompts\n            </h3>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              Session: {session.name}\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Filters */}\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 space-y-3\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Rechercher...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-9 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n              />\n            </div>\n            <select\n              value={serviceFilter}\n              onChange={(e) => setServiceFilter(e.target.value)}\n              className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n            >\n              <option value=\"\">Tous les services</option>\n              {AVAILABLE_SERVICES.map((service) => (\n                <option key={service.id} value={service.id}>\n                  {service.icon} {service.label}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={selectAll}\n                className=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              >\n                Tout sélectionner\n              </button>\n              <span className=\"text-gray-300 dark:text-gray-600\">|</span>\n              <button\n                onClick={selectNone}\n                className=\"text-sm text-gray-500 hover:text-gray-600 dark:text-gray-400\"\n              >\n                Tout désélectionner\n              </button>\n            </div>\n            <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {selectedPrompts.size} sélectionné{selectedPrompts.size !== 1 ? 's' : ''} / {filteredPrompts.length} affiché{filteredPrompts.length !== 1 ? 's' : ''}\n            </span>\n          </div>\n        </div>\n\n        {/* Prompts List */}\n        <div className=\"flex-1 overflow-y-auto p-4\">\n          {loadingSessionPrompts ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n            </div>\n          ) : filteredPrompts.length > 0 ? (\n            <div className=\"space-y-2\">\n              {filteredPrompts.map((prompt) => {\n                const services = detectServices(prompt);\n                const isSelected = selectedPrompts.has(prompt.id);\n                return (\n                  <div\n                    key={prompt.id}\n                    onClick={() => togglePrompt(prompt.id)}\n                    className={`p-3 rounded-lg border cursor-pointer transition-all ${\n                      isSelected\n                        ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                        : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n                    }`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      <div className={`mt-0.5 w-5 h-5 rounded border flex items-center justify-center ${\n                        isSelected\n                          ? 'bg-blue-600 border-blue-600 text-white'\n                          : 'border-gray-300 dark:border-gray-600'\n                      }`}>\n                        {isSelected && <Check className=\"w-3.5 h-3.5\" />}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <span className=\"font-medium text-gray-900 dark:text-white text-sm\">\n                            {prompt.name}\n                          </span>\n                          {services.map((service) => {\n                            const svc = AVAILABLE_SERVICES.find(s => s.id === service);\n                            return svc ? (\n                              <span\n                                key={service}\n                                className={`px-1.5 py-0.5 text-xs rounded ${svc.color} text-white`}\n                              >\n                                {svc.icon}\n                              </span>\n                            ) : null;\n                          })}\n                        </div>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-1\">\n                          {prompt.user_input}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <FileText className=\"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n              <p className=\"text-gray-500 dark:text-gray-400\">Aucun prompt trouvé</p>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-4 border-t border-gray-200 dark:border-gray-700\">\n          <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n            {selectedPrompts.size} prompt{selectedPrompts.size !== 1 ? 's' : ''} sera{selectedPrompts.size !== 1 ? 'ont' : ''} utilisé{selectedPrompts.size !== 1 ? 's' : ''} pour l'entraînement\n          </span>\n          <div className=\"flex gap-3\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\n            >\n              Annuler\n            </button>\n            <button\n              onClick={handleSave}\n              disabled={saving}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2\"\n            >\n              {saving ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  Enregistrement...\n                </>\n              ) : (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Enregistrer ({selectedPrompts.size})\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Main Component\nexport default function Training() {\n  const [activeTab, setActiveTab] = useState<'overview' | 'sessions' | 'prompts' | 'workers' | 'models'>('overview');\n  const [ollamaStatus, setOllamaStatus] = useState<OllamaStatus | null>(null);\n  const [_ollamaMetrics, _setOllamaMetrics] = useState<OllamaMetrics | null>(null);\n  const [stats, setStats] = useState<TrainingStats | null>(null);\n  const [sessions, setSessions] = useState<TrainingSession[]>([]);\n  const [prompts, setPrompts] = useState<TrainingPrompt[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [serviceFilter, setServiceFilter] = useState('');\n  const [showSessionModal, setShowSessionModal] = useState(false);\n  const [showPromptModal, setShowPromptModal] = useState(false);\n  const [showPromptsSelectionModal, setShowPromptsSelectionModal] = useState(false);\n  const [selectedSessionForPrompts, setSelectedSessionForPrompts] = useState<TrainingSession | null>(null);\n  const [showDetailsModal, setShowDetailsModal] = useState(false);\n  const [selectedSessionId, setSelectedSessionId] = useState<string | null>(null);\n  const [showLogsModal, setShowLogsModal] = useState(false);\n  const [selectedLogsSessionId, setSelectedLogsSessionId] = useState<string | null>(null);\n  const [selectedLogsSessionName, setSelectedLogsSessionName] = useState<string | undefined>(undefined);\n  const [selectedLogsSessionStatus, setSelectedLogsSessionStatus] = useState<string | undefined>(undefined);\n  const [editingPrompt, setEditingPrompt] = useState<TrainingPrompt | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // WebSocket for real-time training metrics\n  const {\n    connected: wsConnected,\n    connect: wsConnect,\n    subscribeToSession,\n    unsubscribeFromSession,\n  } = useTrainingWebSocket({\n    autoConnect: false,\n    onSessionUpdate: (update) => {\n      // Update local session state with real-time metrics\n      setSessions(prev => prev.map(session => {\n        if (session.id === update.session_id && update.data) {\n          const metrics = update.data;\n          return {\n            ...session,\n            progress_percent: metrics.progress?.progress_percent ?? session.progress_percent,\n            current_epoch: metrics.progress?.current_epoch ?? session.current_epoch,\n            total_epochs: metrics.progress?.total_epochs ?? session.total_epochs,\n            current_step: metrics.progress?.current_step ?? session.current_step,\n            total_steps: metrics.progress?.total_steps ?? session.total_steps,\n            loss: metrics.performance?.loss ?? session.loss,\n            learning_rate: metrics.performance?.learning_rate ?? session.learning_rate,\n            gpu_memory_used: metrics.gpu?.memory_used_mb ? metrics.gpu.memory_used_mb / 1024 : session.gpu_memory_used,\n            cpu_usage: session.cpu_usage,\n            // Store full metrics for display\n            _realtime_metrics: metrics,\n          } as TrainingSession & { _realtime_metrics?: TrainingMetrics };\n        }\n        return session;\n      }));\n\n      // Update stats based on update type\n      if (update.update_type === 'completed' || update.update_type === 'failed' || update.update_type === 'cancelled') {\n        // Refresh data when a session ends\n        fetchData();\n      }\n    },\n  });\n\n  const fetchData = useCallback(async () => {\n    setLoading(true);\n    try {\n      const [statusRes, metricsRes, statsRes, sessionsRes, promptsRes] = await Promise.all([\n        api.training.ollama.status().catch(() => null),\n        api.training.ollama.metrics().catch(() => null),\n        api.training.stats().catch(() => null),\n        api.training.sessions.list().catch(() => []),\n        api.training.prompts.list({\n          ...(searchQuery && { search: searchQuery }),\n        }).catch(() => []),\n      ]);\n\n      if (statusRes) setOllamaStatus(statusRes);\n      if (metricsRes) _setOllamaMetrics(metricsRes);\n      if (statsRes) setStats(statsRes);\n      setSessions(sessionsRes);\n      setPrompts(promptsRes);\n    } catch (error) {\n      console.error('Failed to fetch training data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [searchQuery]);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  // Connect WebSocket and subscribe to active sessions when they exist\n  useEffect(() => {\n    const activeSessions = sessions.filter(s => s.status === 'running' || s.status === 'preparing');\n\n    if (activeSessions.length > 0 && !wsConnected) {\n      wsConnect();\n    }\n\n    // Subscribe to each active session\n    if (wsConnected) {\n      activeSessions.forEach(session => {\n        subscribeToSession(session.id, 2); // 2 second update interval\n      });\n    }\n\n    // Cleanup: unsubscribe when sessions complete\n    return () => {\n      activeSessions.forEach(session => {\n        unsubscribeFromSession(session.id);\n      });\n    };\n  }, [sessions, wsConnected, wsConnect, subscribeToSession, unsubscribeFromSession]);\n\n  // Light polling for stats only (not full data) when sessions are active - every 30 seconds\n  useEffect(() => {\n    if (stats?.active_sessions && stats.active_sessions > 0) {\n      const interval = setInterval(async () => {\n        // Only refresh stats and sessions list, not the entire page\n        try {\n          const [statsRes, sessionsRes] = await Promise.all([\n            api.training.stats().catch(() => null),\n            api.training.sessions.list().catch(() => []),\n          ]);\n          if (statsRes) setStats(statsRes);\n          if (sessionsRes) {\n            // Merge new session data with existing realtime metrics\n            setSessions(prev => {\n              return sessionsRes.map((newSession: TrainingSession) => {\n                const existing = prev.find(s => s.id === newSession.id);\n                if (existing && (existing as any)._realtime_metrics) {\n                  return { ...newSession, _realtime_metrics: (existing as any)._realtime_metrics };\n                }\n                return newSession;\n              });\n            });\n          }\n        } catch (error) {\n          console.error('Failed to refresh stats:', error);\n        }\n      }, 30000); // 30 second polling for session list updates\n      return () => clearInterval(interval);\n    }\n  }, [stats?.active_sessions]);\n\n  const handleStartSession = async (id: string) => {\n    try {\n      // Find the session to get its configured backend\n      const session = sessions.find(s => s.id === id);\n      const backend = (session?.training_backend || 'ollama_modelfile') as 'ollama_modelfile' | 'unsloth';\n      await api.training.sessions.start(id, backend);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to start session:', error);\n    }\n  };\n\n  const handleCancelSession = async (id: string) => {\n    try {\n      await api.training.sessions.cancel(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to cancel session:', error);\n    }\n  };\n\n  const handleDeleteSession = async (id: string) => {\n    if (!confirm('Êtes-vous sûr de vouloir supprimer cette session ?')) return;\n    try {\n      await api.training.sessions.delete(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to delete session:', error);\n    }\n  };\n\n  const handleDuplicateSession = async (id: string) => {\n    try {\n      await api.training.sessions.duplicate(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to duplicate session:', error);\n    }\n  };\n\n  const handleManageSessionPrompts = (session: TrainingSession) => {\n    setSelectedSessionForPrompts(session);\n    setShowPromptsSelectionModal(true);\n  };\n\n  const handleViewSessionDetails = (sessionId: string) => {\n    setSelectedSessionId(sessionId);\n    setShowDetailsModal(true);\n  };\n\n  const handleViewSessionLogs = (sessionId: string, sessionName?: string, sessionStatus?: string) => {\n    setSelectedLogsSessionId(sessionId);\n    setSelectedLogsSessionName(sessionName);\n    setSelectedLogsSessionStatus(sessionStatus);\n    setShowLogsModal(true);\n  };\n\n  const handleSaveSessionPrompts = async (sessionId: string, promptIds: string[]) => {\n    await api.training.sessions.setPrompts(sessionId, promptIds);\n    fetchData();\n  };\n\n  const handleValidatePrompt = async (id: string) => {\n    try {\n      await api.training.prompts.validate(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to validate prompt:', error);\n    }\n  };\n\n  const handleDeletePrompt = async (id: string) => {\n    if (!confirm('Êtes-vous sûr de vouloir supprimer ce prompt ?')) return;\n    try {\n      await api.training.prompts.delete(id);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to delete prompt:', error);\n    }\n  };\n\n  const handleCreateSession = async (data: any, promptIds: string[]) => {\n    // Create session\n    const session = await api.training.sessions.create(data);\n    // Associate prompts\n    if (promptIds.length > 0 && session?.id) {\n      await api.training.sessions.setPrompts(session.id, promptIds);\n    }\n    fetchData();\n  };\n\n  const handleSavePrompt = async (data: any) => {\n    if (data.id) {\n      // Update existing prompt\n      await api.training.prompts.update(data.id, data);\n    } else {\n      // Create new prompt\n      await api.training.prompts.create(data);\n    }\n    setEditingPrompt(null);\n    fetchData();\n  };\n\n  const handleEditPrompt = (prompt: TrainingPrompt) => {\n    setEditingPrompt(prompt);\n    setShowPromptModal(true);\n  };\n\n  const handleImportPrompts = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    try {\n      const text = await file.text();\n      const prompts = JSON.parse(text);\n      await api.training.prompts.import(Array.isArray(prompts) ? prompts : [prompts]);\n      fetchData();\n      alert('Prompts importés avec succès');\n    } catch (error) {\n      console.error('Failed to import prompts:', error);\n      alert('Erreur lors de l\\'import des prompts');\n    }\n    e.target.value = '';\n  };\n\n  const handleExportPrompts = async () => {\n    try {\n      const data = await api.training.prompts.export({});\n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `prompts-export-${new Date().toISOString().split('T')[0]}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Failed to export prompts:', error);\n      alert('Erreur lors de l\\'export des prompts');\n    }\n  };\n\n  const handleSeedPrompts = async (reset: boolean = false) => {\n    if (reset && !confirm('Ceci va supprimer TOUS les prompts existants et les remplacer par les prompts par défaut. Continuer ?')) {\n      return;\n    }\n    try {\n      const result = await api.training.prompts.seed(reset);\n      alert(`${result.message}`);\n      fetchData();\n    } catch (error) {\n      console.error('Failed to seed prompts:', error);\n      alert('Erreur lors du chargement des prompts homelab');\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-4 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Brain className=\"w-6 h-6 sm:w-8 sm:h-8 text-purple-600\" />\n            Training IA\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n            Entraînement et fine-tuning avec Ollama\n          </p>\n        </div>\n        <button\n          onClick={fetchData}\n          className=\"p-2 sm:px-4 sm:py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2\"\n        >\n          <RefreshCw className=\"w-4 h-4\" />\n          <span className=\"hidden sm:inline\">Actualiser</span>\n        </button>\n      </div>\n\n      {/* Tab Navigation - Compact horizontal pills */}\n      <div className=\"mb-4 sm:mb-6 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0\">\n        <nav className=\"flex gap-1.5 sm:gap-2 min-w-max sm:min-w-0 sm:flex-wrap\">\n          {[\n            { id: 'overview' as const, label: 'Stats', labelFull: 'Vue générale', icon: BarChart3 },\n            { id: 'sessions' as const, label: 'Sessions', labelFull: 'Sessions d\\'entraînement', icon: History },\n            { id: 'prompts' as const, label: 'Prompts', labelFull: 'Prompts d\\'entraînement', icon: FileText },\n            { id: 'workers' as const, label: 'Workers', labelFull: 'Workers GPU', icon: Monitor },\n            { id: 'models' as const, label: 'Models', labelFull: 'Modèles Ollama', icon: Brain },\n          ].map((tab) => {\n            const Icon = tab.icon;\n            const isActive = activeTab === tab.id;\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                title={tab.labelFull}\n                className={`flex items-center gap-1.5 py-1.5 px-2.5 sm:py-2 sm:px-3 rounded-full font-medium text-xs sm:text-sm transition-all whitespace-nowrap ${\n                  isActive\n                    ? 'bg-purple-600 text-white shadow-sm'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n              >\n                <Icon className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                <span>{tab.label}</span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* Tab Content */}\n      {loading && activeTab === 'overview' ? (\n        <div className=\"text-center py-12 text-gray-500\">Chargement...</div>\n      ) : (\n        <>\n          {activeTab === 'overview' && (\n            <TrainingOverview\n              stats={stats}\n              ollamaStatus={ollamaStatus}\n              activeSessions={sessions.filter(s => s.status === 'running' || s.status === 'preparing')}\n              wsConnected={wsConnected}\n              onViewLogs={handleViewSessionLogs}\n            />\n          )}\n\n          {activeTab === 'sessions' && (\n            <SessionsTab\n              sessions={sessions}\n              loading={loading}\n              onCreate={() => setShowSessionModal(true)}\n              onStart={handleStartSession}\n              onCancel={handleCancelSession}\n              onDelete={handleDeleteSession}\n              onDuplicate={handleDuplicateSession}\n              onManagePrompts={handleManageSessionPrompts}\n              onViewDetails={handleViewSessionDetails}\n              onViewLogs={handleViewSessionLogs}\n            />\n          )}\n\n          {activeTab === 'prompts' && (\n            <PromptsTab\n              prompts={prompts}\n              loading={loading}\n              searchQuery={searchQuery}\n              setSearchQuery={setSearchQuery}\n              serviceFilter={serviceFilter}\n              setServiceFilter={setServiceFilter}\n              onCreate={() => {\n                setEditingPrompt(null);\n                setShowPromptModal(true);\n              }}\n              onImport={handleImportPrompts}\n              onExport={handleExportPrompts}\n              onSeed={handleSeedPrompts}\n              onValidate={handleValidatePrompt}\n              onDelete={handleDeletePrompt}\n              onEdit={handleEditPrompt}\n            />\n          )}\n\n          {activeTab === 'workers' && (\n            <WorkerList />\n          )}\n\n          {activeTab === 'models' && (\n            <ModelsTab\n              models={ollamaStatus?.models || []}\n              loading={loading}\n              onRefresh={fetchData}\n              runningModels={ollamaStatus?.running_models || []}\n            />\n          )}\n\n        </>\n      )}\n\n      {/* Session Creation Modal */}\n      <SessionModal\n        isOpen={showSessionModal}\n        onClose={() => setShowSessionModal(false)}\n        onSubmit={handleCreateSession}\n        models={ollamaStatus?.models || []}\n        allPrompts={prompts}\n      />\n\n      {/* Prompt Creation/Edit Modal */}\n      <PromptModal\n        isOpen={showPromptModal}\n        onClose={() => {\n          setShowPromptModal(false);\n          setEditingPrompt(null);\n        }}\n        onSubmit={handleSavePrompt}\n        availableServices={AVAILABLE_SERVICES}\n        editingPrompt={editingPrompt}\n      />\n\n      {selectedSessionForPrompts && (\n        <SessionPromptsModal\n          isOpen={showPromptsSelectionModal}\n          onClose={() => {\n            setShowPromptsSelectionModal(false);\n            setSelectedSessionForPrompts(null);\n          }}\n          session={selectedSessionForPrompts}\n          allPrompts={prompts}\n          onSave={handleSaveSessionPrompts}\n        />\n      )}\n\n      {/* Session Details Modal */}\n      <SessionDetailsModal\n        isOpen={showDetailsModal}\n        sessionId={selectedSessionId}\n        onClose={() => {\n          setShowDetailsModal(false);\n          setSelectedSessionId(null);\n        }}\n      />\n\n      {/* Session Logs Modal */}\n      <SessionLogsModal\n        isOpen={showLogsModal}\n        sessionId={selectedLogsSessionId}\n        sessionName={selectedLogsSessionName}\n        sessionStatus={selectedLogsSessionStatus}\n        onClose={() => {\n          setShowLogsModal(false);\n          setSelectedLogsSessionId(null);\n          setSelectedLogsSessionName(undefined);\n          setSelectedLogsSessionStatus(undefined);\n        }}\n      />\n\n      {/* Hidden file input for import */}\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        onChange={handleFileChange}\n        accept=\".json\"\n        className=\"hidden\"\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/pages/Users.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/src/types/api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1542,1545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1542,1545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1668,1671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1668,1671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3750,3753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3750,3753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4637,4640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4637,4640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * TypeScript interfaces matching backend models\n */\n\n// Service Types\nexport const ServiceType = {\n  PLEX: 'plex',\n  TAUTULLI: 'tautulli',\n  OVERSEERR: 'overseerr',\n  ZAMMAD: 'zammad',\n  AUTHENTIK: 'authentik',\n  OPENWEBUI: 'openwebui',\n  OLLAMA: 'ollama',\n  RADARR: 'radarr',\n  SONARR: 'sonarr',\n  PROWLARR: 'prowlarr',\n  JACKETT: 'jackett',\n  DELUGE: 'deluge',\n  KOMGA: 'komga',\n  ROMM: 'romm',\n  MONITORING: 'monitoring',\n  CUSTOM: 'custom',\n} as const;\nexport type ServiceType = typeof ServiceType[keyof typeof ServiceType];\n\n// Status Types\nexport const TestStatus = {\n  SUCCESS: 'success',\n  FAILED: 'failed',\n  PENDING: 'pending',\n} as const;\nexport type TestStatus = typeof TestStatus[keyof typeof TestStatus];\n\nexport const TrainingStatus = {\n  PENDING: 'pending',\n  RUNNING: 'running',\n  COMPLETED: 'completed',\n  FAILED: 'failed',\n  CANCELLED: 'cancelled',\n} as const;\nexport type TrainingStatus = typeof TrainingStatus[keyof typeof TrainingStatus];\n\nexport const RequestStatus = {\n  SUCCESS: 'success',\n  ERROR: 'error',\n  TIMEOUT: 'timeout',\n} as const;\nexport type RequestStatus = typeof RequestStatus[keyof typeof RequestStatus];\n\nexport const UserRole = {\n  ADMIN: 'admin',\n  USER: 'user',\n} as const;\nexport type UserRole = typeof UserRole[keyof typeof UserRole];\n\nexport const LogLevel = {\n  DEBUG: 'debug',\n  INFO: 'info',\n  WARNING: 'warning',\n  ERROR: 'error',\n  CRITICAL: 'critical',\n} as const;\nexport type LogLevel = typeof LogLevel[keyof typeof LogLevel];\n\n// API Response Types\nexport interface ApiResponse<T = any> {\n  data?: T;\n  error?: string;\n  message?: string;\n  correlation_id?: string;\n}\n\nexport interface PaginatedResponse<T = any> {\n  entries: T[];\n  total: number;\n  offset: number;\n  limit: number;\n  has_more: boolean;\n}\n\n// Dashboard Types\nexport interface DashboardOverview {\n  services: {\n    total: number;\n    active: number;\n    failing: number;\n  };\n  users: {\n    total: number;\n    active_sessions: number;\n  };\n  training: {\n    active_sessions: number;\n    completed_today: number;\n  };\n  logs: {\n    recent_errors: number;\n    total_today: number;\n  };\n  mcp: {\n    requests_today: number;\n    average_response_time: number;\n  };\n  system: SystemStatus;\n}\n\nexport interface SystemStatus {\n  cpu_percent: number;\n  memory_used_mb: number;\n  memory_total_mb: number;\n  disk_used_gb: number;\n  disk_total_gb: number;\n  uptime_seconds: number;\n  docker_containers: {\n    running: number;\n    stopped: number;\n  };\n}\n\n// System Metrics for real-time monitoring\nexport interface SystemMetrics {\n  cpu_usage: number;\n  cpu_load_avg: number;\n  memory_usage: number;\n  memory_used: number;\n  memory_total: number;\n  disk_usage: number;\n  disk_used: number;\n  disk_total: number;\n  network_bytes_sent: number;\n  network_bytes_recv: number;\n  services_running: number;\n  services_total: number;\n  uptime: number;\n}\n\nexport interface HealthStatus {\n  status: 'healthy' | 'degraded' | 'unhealthy';\n  checks: Array<{\n    name: string;\n    status: string;\n    message: string;\n    response_time_ms?: number;\n  }>;\n}\n\n// Service Configuration Types\nexport interface ServiceConfig {\n  id: string;\n  name: string;\n  service_type: ServiceType;\n  base_url: string;\n  connection_timeout: number;\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n  last_test_at?: string;\n  test_status: TestStatus;\n  test_error?: string;\n}\n\nexport interface ServiceConfigCreate {\n  name: string;\n  service_type: ServiceType;\n  base_url: string;\n  api_key?: string;\n  username?: string;\n  password?: string;\n  custom_headers?: Record<string, string>;\n  connection_timeout?: number;\n}\n\nexport interface ServiceTestResult {\n  success: boolean;\n  message: string;\n  response_time_ms: number;\n  details?: Record<string, any>;\n  tested_at: string;\n}\n\n// User Types\nexport interface UserMapping {\n  id: string;\n  email: string;\n  display_name: string;\n  role: UserRole;\n  open_webui_username?: string;\n  authentik_user_id?: string;\n  authentik_username?: string;\n  plex_user_id?: string;\n  plex_username?: string;\n  overseerr_user_id?: string;\n  overseerr_username?: string;\n  zammad_user_id?: string;\n  zammad_email?: string;\n  tautulli_user_id?: string;\n  is_active: boolean;\n  auto_detected: boolean;\n  confidence_score: number;\n  created_at: string;\n  updated_at: string;\n  last_sync_at?: string;\n}\n\n// Log Types\nexport interface LogEntry {\n  id: string;\n  timestamp: string;\n  level: LogLevel;\n  service_id?: string;\n  service_name?: string;\n  user_mapping_id?: string;\n  user_email?: string;\n  correlation_id: string;\n  component: string;\n  action: string;\n  message: string;\n  details?: Record<string, any>;\n  request_path?: string;\n  request_method?: string;\n  response_status?: number;\n  duration_ms?: number;\n  error_type?: string;\n  ip_address?: string;\n}\n\n// WebSocket Message Types\nexport interface WebSocketMessage {\n  type: string;\n  timestamp: string;\n  correlation_id?: string;\n}\n\nexport interface LogEntryMessage extends WebSocketMessage {\n  type: 'log_entry';\n  log: LogEntry;\n}\n\nexport interface MetricsUpdateMessage extends WebSocketMessage {\n  type: 'metrics_update';\n  system?: SystemStatus;\n  services?: Array<{\n    service_id: string;\n    name: string;\n    status: 'online' | 'offline' | 'degraded';\n    response_time_ms: number;\n    last_check: string;\n  }>;\n}\n\n// Configuration Types\nexport interface ConfigurationSetting {\n  id: string;\n  category: string;\n  key: string;\n  value: string;\n  value_type: string;\n  default_value: string;\n  description: string;\n  is_sensitive: boolean;\n  requires_restart: boolean;\n  updated_at: string;\n  updated_by?: string;\n}\n\n// Group Types\nexport interface Group {\n  id: string;\n  name: string;\n  description?: string;\n  color?: string;\n  icon?: string;\n  priority: number;\n  is_system: boolean;\n  enabled: boolean;\n  created_at: string;\n  updated_at: string;\n  member_count: number;\n  tool_count: number;\n}\n\nexport interface GroupDetail extends Group {\n  memberships: GroupMembership[];\n  tool_permissions: GroupToolPermission[];\n}\n\nexport interface GroupMembership {\n  id: string;\n  group_id: string;\n  central_user_id: string;\n  enabled: boolean;\n  granted_at: string;\n  granted_by?: string;\n  created_at: string;\n  updated_at: string;\n  central_username?: string;\n}\n\nexport interface GroupToolPermission {\n  id: string;\n  group_id: string;\n  tool_name: string;\n  service_type?: string;\n  enabled: boolean;\n  description?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface GroupListResponse {\n  groups: Group[];\n  total: number;\n  skip: number;\n  limit: number;\n}\n\nexport interface UserGroupsResponse {\n  central_user_id: string;\n  groups: Group[];\n  total_groups: number;\n}\n\nexport interface AvailableToolsResponse {\n  tools_by_service: Record<string, Array<{\n    name: string;\n    description: string;\n    category?: string;\n  }>>;\n  total_tools: number;\n}","usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/jeremie/Documents/Developpement/mcparr/src/frontend/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]